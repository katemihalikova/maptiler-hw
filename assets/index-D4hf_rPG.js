(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const p of f.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(u){if(u.ep)return;u.ep=!0;const f=n(u);fetch(u.href,f)}})();function E1(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var zf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.0/LICENSE.txt
 */var vT=zf.exports,fx;function xT(){return fx||(fx=1,function(c,e){(function(n,r){c.exports=r()})(vT,function(){var n={},r={};function u(p,s,S){if(r[p]=S,p==="index"){var M="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",C={};return r.shared(C),r.index(n,C),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([M],{type:"text/javascript"}))),n}}u("shared",["exports"],function(p){function s(l,i,o,h){return new(o||(o=Promise))(function(g,v){function x(P){try{E(h.next(P))}catch(k){v(k)}}function w(P){try{E(h.throw(P))}catch(k){v(k)}}function E(P){var k;P.done?g(P.value):(k=P.value,k instanceof o?k:new o(function(F){F(k)})).then(x,w)}E((h=h.apply(l,i||[])).next())})}function S(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var M,C;function I(){if(C)return M;function l(i,o){this.x=i,this.y=o}return C=1,M=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,o){return this.clone()._rotateAround(i,o)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var o=i.x-this.x,h=i.y-this.y;return o*o+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,o){return Math.atan2(this.x*o-this.y*i,this.x*i+this.y*o)},_matMult:function(i){var o=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=o,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var o=Math.cos(i),h=Math.sin(i),g=h*this.x+o*this.y;return this.x=o*this.x-h*this.y,this.y=g,this},_rotateAround:function(i,o){var h=Math.cos(i),g=Math.sin(i),v=o.y+g*(this.x-o.x)+h*(this.y-o.y);return this.x=o.x+h*(this.x-o.x)-g*(this.y-o.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(i){return i instanceof l?i:Array.isArray(i)?new l(i[0],i[1]):i},M}typeof SuppressedError=="function"&&SuppressedError;var L,R,B=S(I()),Z=function(){if(R)return L;function l(i,o,h,g){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=h,this.p2y=g}return R=1,L=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,g=0;g<8;g++){var v=this.sampleCurveX(h)-i;if(Math.abs(v)<o)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=v/x}var w=0,E=1;for(h=i,g=0;g<20&&(v=this.sampleCurveX(h),!(Math.abs(v-i)<o));g++)i>v?w=h:E=h,h=.5*(E-w)+w;return h},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},L}(),V=S(Z);let O,ge;function me(){return O==null&&(O=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),O}function Q(){if(ge==null&&(ge=!1,me())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let h=0;h<5*5;h++){const g=4*h;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(h%5,Math.floor(h/5),1,1)}const o=i.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&o[h]!==h){ge=!0;break}}}return ge||!1}var de=1e-6,fe=typeof Float32Array<"u"?Float32Array:Array;function ye(){var l=new fe(9);return fe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function ke(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ce(){var l=new fe(3);return fe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function ie(l){return Math.hypot(l[0],l[1],l[2])}function Oe(l,i,o){var h=new fe(3);return h[0]=l,h[1]=i,h[2]=o,h}function nt(l,i,o){return l[0]=i[0]+o[0],l[1]=i[1]+o[1],l[2]=i[2]+o[2],l}function Je(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l[2]=i[2]*o,l}function ut(l,i,o){var h=i[0],g=i[1],v=i[2],x=o[0],w=o[1],E=o[2];return l[0]=g*E-v*w,l[1]=v*x-h*E,l[2]=h*w-g*x,l}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)});var ht,ot=ie;function ft(l,i,o){var h=i[0],g=i[1],v=i[2],x=i[3];return l[0]=o[0]*h+o[4]*g+o[8]*v+o[12]*x,l[1]=o[1]*h+o[5]*g+o[9]*v+o[13]*x,l[2]=o[2]*h+o[6]*g+o[10]*v+o[14]*x,l[3]=o[3]*h+o[7]*g+o[11]*v+o[15]*x,l}function tt(){var l=new fe(4);return fe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function It(l,i,o,h){var g=.5*Math.PI/180;i*=g,o*=g,h*=g;var v=Math.sin(i),x=Math.cos(i),w=Math.sin(o),E=Math.cos(o),P=Math.sin(h),k=Math.cos(h);return l[0]=v*E*k-x*w*P,l[1]=x*w*k+v*E*P,l[2]=x*E*P-v*w*k,l[3]=x*E*k+v*w*P,l}function Ut(){var l=new fe(2);return fe!=Float32Array&&(l[0]=0,l[1]=0),l}function Wt(l,i){var o=new fe(2);return o[0]=l,o[1]=i,o}ce(),ht=new fe(4),fe!=Float32Array&&(ht[0]=0,ht[1]=0,ht[2]=0,ht[3]=0),ce(),Oe(1,0,0),Oe(0,1,0),tt(),tt(),ye(),Ut();const $t=8192;function Rn(l,i,o){return i*($t/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function it(l,i){return(l%i+i)%i}function Tt(l,i,o){return l*(1-o)+i*o}function qt(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,o=i*l;return 4*(l<.5?o:3*(l-i)+o-.75)}function Rt(l,i,o,h){const g=new V(l,i,o,h);return v=>g.solve(v)}const on=Rt(.25,.1,.25,1);function Xt(l,i,o){return Math.min(o,Math.max(i,l))}function yn(l,i,o){const h=o-i,g=((l-i)%h+h)%h+i;return g===i?o:g}function Vn(l,...i){for(const o of i)for(const h in o)l[h]=o[h];return l}let Ln=1;function pn(l,i,o){const h={};for(const g in l)h[g]=i.call(this,l[g],g,l);return h}function Fe(l,i,o){const h={};for(const g in l)i.call(this,l[g],g,l)&&(h[g]=l[g]);return h}function gi(l){return Array.isArray(l)?l.map(gi):typeof l=="object"&&l?pn(l,gi):l}const bn={};function cn(l){bn[l]||(typeof console<"u"&&console.warn(l),bn[l]=!0)}function Zt(l,i,o){return(o.y-l.y)*(i.x-l.x)>(i.y-l.y)*(o.x-l.x)}function Tn(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Yt=null;function ve(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ze(l,i,o,h,g){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(l,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),E=new Uint8ClampedArray(h*g*4);if(yield v.copyTo(E,function(P,k,F,G,$){const q=4*Math.max(1,0),K=(Math.max(0,F)-F)*G*4+q,se=4*G,he=Math.max(0,k),ze=Math.max(0,F);return{rect:{x:he,y:ze,width:Math.min(P.width,k+G)-he,height:Math.min(P.height,F+$)-ze},layout:[{offset:K,stride:se}]}}(l,i,o,h,g)),w)for(let P=0;P<E.length;P+=4){const k=E[P];E[P]=E[P+2],E[P+2]=k}return E}finally{v.close()}})}let ct,mt;function rt(l,i,o,h){return l.addEventListener(i,o,h),{unsubscribe:()=>{l.removeEventListener(i,o,h)}}}function Vt(l){return l*Math.PI/180}function At(l){return l/Math.PI*180}const Gt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},zn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},bt="AbortError";function Ce(){return new Error(bt)}const W={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function X(l){return W.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const J="global-dispatcher";class ue extends Error{constructor(i,o,h,g){super(`AJAXError: ${o} (${i}): ${h}`),this.status=i,this.statusText=o,this.url=h,this.body=g}}const Te=()=>Tn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,De=function(l,i){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const h=X(l.url);if(h)return h(l,i);if(Tn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:J},i)}if(!(/^file:/.test(o=l.url)||/^file:/.test(Te())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,g){return s(this,void 0,void 0,function*(){const v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Te(),signal:g.signal});let x,w;h.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");try{x=yield fetch(v)}catch(P){throw new ue(0,P.message,h.url,new Blob)}if(!x.ok){const P=yield x.blob();throw new ue(x.status,x.statusText,h.url,P)}w=h.type==="arrayBuffer"||h.type==="image"?x.arrayBuffer():h.type==="json"?x.json():x.text();const E=yield w;if(g.signal.aborted)throw Ce();return{data:E,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(l,i);if(Tn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:J},i)}var o;return function(h,g){return new Promise((v,x)=>{var w;const E=new XMLHttpRequest;E.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(E.responseType="arraybuffer");for(const P in h.headers)E.setRequestHeader(P,h.headers[P]);h.type==="json"&&(E.responseType="text",!((w=h.headers)===null||w===void 0)&&w.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=h.credentials==="include",E.onerror=()=>{x(new Error(E.statusText))},E.onload=()=>{if(!g.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let P=E.response;if(h.type==="json")try{P=JSON.parse(E.response)}catch(k){return void x(k)}v({data:P,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const P=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});x(new ue(E.status,E.statusText,h.url,P))}},g.signal.addEventListener("abort",()=>{E.abort(),x(Ce())}),E.send(h.body)})}(l,i)};function ne(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const i=new URL(l),o=window.location;return i.protocol===o.protocol&&i.host===o.host}function _e(l,i,o){o[l]&&o[l].indexOf(i)!==-1||(o[l]=o[l]||[],o[l].push(i))}function xe(l,i,o){if(o&&o[l]){const h=o[l].indexOf(i);h!==-1&&o[l].splice(h,1)}}class Ee{constructor(i,o={}){Vn(this,o),this.type=i}}class Ie extends Ee{constructor(i,o={}){super("error",Vn({error:i},o))}}class Ue{on(i,o){return this._listeners=this._listeners||{},_e(i,o,this._listeners),{unsubscribe:()=>{this.off(i,o)}}}off(i,o){return xe(i,o,this._listeners),xe(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},_e(i,o,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,o){typeof i=="string"&&(i=new Ee(i,o||{}));const h=i.type;if(this.listens(h)){i.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of g)w.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of v)xe(h,w,this._oneTimeListeners),w.call(this,i);const x=this._eventedParent;x&&(Vn(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Ie&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const dt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Nt(l,i){const o={};for(const h in l)h!=="ref"&&(o[h]=l[h]);return dt.forEach(h=>{h in i&&(o[h]=i[h])}),o}function pt(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let o=0;o<l.length;o++)if(!pt(l[o],i[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const o in l)if(!pt(l[o],i[o]))return!1;return!0}return l===i}function Dt(l,i){l.push(i)}function Kt(l,i,o){Dt(o,{command:"addSource",args:[l,i[l]]})}function ni(l,i,o){Dt(i,{command:"removeSource",args:[l]}),o[l]=!0}function qn(l,i,o,h){ni(l,o,h),Kt(l,i,o)}function xn(l,i,o){let h;for(h in l[o])if(Object.prototype.hasOwnProperty.call(l[o],h)&&h!=="data"&&!pt(l[o][h],i[o][h]))return!1;for(h in i[o])if(Object.prototype.hasOwnProperty.call(i[o],h)&&h!=="data"&&!pt(l[o][h],i[o][h]))return!1;return!0}function nn(l,i,o,h,g,v){l=l||{},i=i||{};for(const x in l)Object.prototype.hasOwnProperty.call(l,x)&&(pt(l[x],i[x])||o.push({command:v,args:[h,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(l,x)&&(pt(l[x],i[x])||o.push({command:v,args:[h,x,i[x],g]}))}function wn(l){return l.id}function Ii(l,i){return l[i.id]=i,l}class _t{constructor(i,o,h,g){this.message=(i?`${i}: `:"")+h,g&&(this.identifier=g),o!=null&&o.__line__&&(this.line=o.__line__)}}function ki(l,...i){for(const o of i)for(const h in o)l[h]=o[h];return l}class ii extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}class as{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[h,g]of o)this.bindings[h]=g}concat(i){return new as(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Ss={kind:"null"},wt={kind:"number"},fn={kind:"string"},mn={kind:"boolean"},vr={kind:"color"},uo={kind:"projectionDefinition"},Xr={kind:"object"},ee={kind:"value"},Be={kind:"collator"},Ke={kind:"formatted"},We={kind:"padding"},Ve={kind:"colorArray"},vt={kind:"numberArray"},Ct={kind:"resolvedImage"},Bt={kind:"variableAnchorOffsetCollection"};function Lt(l,i){return{kind:"array",itemType:l,N:i}}function Ht(l){if(l.kind==="array"){const i=Ht(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const un=[Ss,wt,fn,mn,vr,uo,Ke,Xr,Lt(ee),We,vt,Ve,Ct,Bt];function tn(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!tn(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const o of un)if(!tn(o,i))return null}}return`Expected ${Ht(l)} but found ${Ht(i)} instead.`}function Fn(l,i){return i.some(o=>o.kind===l.kind)}function On(l,i){return i.some(o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l)}function ri(l,i){return l.kind==="array"&&i.kind==="array"?l.itemType.kind===i.itemType.kind&&typeof l.N=="number":l.kind===i.kind}const _i=.96422,Hn=.82521,sn=4/29,vi=6/29,Zn=3*vi*vi,Ir=vi*vi*vi,Yr=Math.PI/180,xr=180/Math.PI;function sa(l){return(l%=360)<0&&(l+=360),l}function ti([l,i,o,h]){let g,v;const x=dr((.2225045*(l=hr(l))+.7168786*(i=hr(i))+.0606169*(o=hr(o)))/1);l===i&&i===o?g=v=x:(g=dr((.4360747*l+.3850649*i+.1430804*o)/_i),v=dr((.0139322*l+.0971045*i+.7141733*o)/Hn));const w=116*x-16;return[w<0?0:w,500*(g-x),200*(x-v),h]}function hr(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function dr(l){return l>Ir?Math.pow(l,1/3):l/Zn+sn}function Hi([l,i,o,h]){let g=(l+16)/116,v=isNaN(i)?g:g+i/500,x=isNaN(o)?g:g-o/200;return g=1*aa(g),v=_i*aa(v),x=Hn*aa(x),[Ui(3.1338561*v-1.6168667*g-.4906146*x),Ui(-.9787684*v+1.9161415*g+.033454*x),Ui(.0719453*v-.2289914*g+1.4052427*x),h]}function Ui(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function aa(l){return l>vi?l*l*l:Zn*(l-sn)}const ji=Object.hasOwn||function(l,i){return Object.prototype.hasOwnProperty.call(l,i)};function En(l,i){return ji(l,i)?l[i]:void 0}function zs(l){return parseInt(l.padEnd(2,l),16)/255}function Fs(l,i){return Da(i?l/100:l,0,1)}function Da(l,i,o){return Math.min(Math.max(i,l),o)}function ih(l){return!l.some(Number.isNaN)}const rh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Kr(l,i,o){return l+o*(i-l)}function Os(l,i,o){return l.map((h,g)=>Kr(h,i[g],o))}class An{constructor(i,o,h,g=1,v=!0){this.r=i,this.g=o,this.b=h,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,o,h,g]))}static parse(i){if(i instanceof An)return i;if(typeof i!="string")return;const o=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=En(rh,h);if(g){const[x,w,E]=g;return[x/255,w/255,E/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const x=h.length<6?1:2;let w=1;return[zs(h.slice(w,w+=x)),zs(h.slice(w,w+=x)),zs(h.slice(w,w+=x)),zs(h.slice(w,w+x)||"ff")]}if(h.startsWith("rgb")){const x=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,E,P,k,F,G,$,q,K,se,he,ze]=x,Me=[k||" ",$||" ",se].join("");if(Me==="  "||Me==="  /"||Me===",,"||Me===",,,"){const j=[P,G,K].join(""),re=j==="%%%"?100:j===""?255:0;if(re){const Pe=[Da(+E/re,0,1),Da(+F/re,0,1),Da(+q/re,0,1),he?Fs(+he,ze):1];if(ih(Pe))return Pe}}return}}const v=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,E,P,k,F,G,$,q]=v,K=[E||" ",k||" ",G].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const se=[+w,Da(+P,0,100),Da(+F,0,100),$?Fs(+$,q):1];if(ih(se))return function([he,ze,Me,j]){function re(Pe){const $e=(Pe+he/30)%12,st=ze*Math.min(Me,1-Me);return Me-st*Math.max(-1,Math.min($e-3,9-$e,1))}return he=sa(he),ze/=100,Me/=100,[re(0),re(8),re(4),j]}(se)}}}(i);return o?new An(...o,!1):void 0}get rgb(){const{r:i,g:o,b:h,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[i/v,o/v,h/v,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[o,h,g,v]=ti(i),x=Math.sqrt(h*h+g*g);return[Math.round(1e4*x)?sa(Math.atan2(g,h)*xr):NaN,x,o,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ti(this.rgb))}overwriteGetter(i,o){return Object.defineProperty(this,i,{value:o}),o}toString(){const[i,o,h,g]=this.rgb;return`rgba(${[i,o,h].map(v=>Math.round(255*v)).join(",")},${g})`}static interpolate(i,o,h,g="rgb"){switch(g){case"rgb":{const[v,x,w,E]=Os(i.rgb,o.rgb,h);return new An(v,x,w,E,!1)}case"hcl":{const[v,x,w,E]=i.hcl,[P,k,F,G]=o.hcl;let $,q;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?$=NaN:($=P,w!==1&&w!==0||(q=k)):($=v,F!==1&&F!==0||(q=x));else{let Me=P-v;P>v&&Me>180?Me-=360:P<v&&v-P>180&&(Me+=360),$=v+h*Me}const[K,se,he,ze]=function([Me,j,re,Pe]){return Me=isNaN(Me)?0:Me*Yr,Hi([re,Math.cos(Me)*j,Math.sin(Me)*j,Pe])}([$,q??Kr(x,k,h),Kr(w,F,h),Kr(E,G,h)]);return new An(K,se,he,ze,!1)}case"lab":{const[v,x,w,E]=Hi(Os(i.lab,o.lab,h));return new An(v,x,w,E,!1)}}}}An.black=new An(0,0,0,1),An.white=new An(1,1,1,1),An.transparent=new An(0,0,0,0),An.red=new An(1,0,0,1);class il{constructor(i,o,h){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const mc=["bottom","center","top"];class sh{constructor(i,o,h,g,v,x){this.text=i,this.image=o,this.scale=h,this.fontStack=g,this.textColor=v,this.verticalAlign=x}}class pr{constructor(i){this.sections=i}static fromString(i){return new pr([new sh(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof pr?i:pr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class zi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof zi)return i;if(typeof i=="number")return new zi([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const o of i)if(typeof o!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new zi(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){return new zi(Os(i.values,o.values,h))}}class fr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof fr)return i;if(typeof i=="number")return new fr([i]);if(Array.isArray(i)){for(const o of i)if(typeof o!="number")return;return new fr(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){return new fr(Os(i.values,o.values,h))}}class $i{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof $i)return i;if(typeof i=="string"){const h=An.parse(i);return h?new $i([h]):void 0}if(!Array.isArray(i))return;const o=[];for(const h of i){if(typeof h!="string")return;const g=An.parse(h);if(!g)return;o.push(g)}return new $i(o)}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h,g="rgb"){const v=[];if(i.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let x=0;x<i.values.length;x++)v.push(An.interpolate(i.values[x],o.values[x],h,g));return new $i(v)}}class xi extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const gc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Nn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Nn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let o=0;o<i.length;o+=2){const h=i[o],g=i[o+1];if(typeof h!="string"||!gc.has(h)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Nn(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){const g=i.values,v=o.values;if(g.length!==v.length)throw new xi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${o.toString()}`);const x=[];for(let w=0;w<g.length;w+=2){if(g[w]!==v[w])throw new xi(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${g[w]}, to[${w}]: ${v[w]}`);x.push(g[w]);const[E,P]=g[w+1],[k,F]=v[w+1];x.push([Kr(E,k,h),Kr(P,F,h)])}return new Nn(x)}}class Rr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Rr({name:i,available:!1}):null}}class hn{constructor(i,o,h){this.from=i,this.to=o,this.transition=h}static interpolate(i,o,h){return new hn(i,o,h)}static parse(i){return i instanceof hn?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new hn(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new hn(i.from,i.to,i.transition):typeof i=="string"?new hn(i,i,1):void 0}}function gn(l,i,o,h){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof o=="number"&&o>=0&&o<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,i,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,i,o,h]:[l,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ka(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof hn||l instanceof An||l instanceof il||l instanceof pr||l instanceof zi||l instanceof fr||l instanceof $i||l instanceof Nn||l instanceof Rr)return!0;if(Array.isArray(l)){for(const i of l)if(!ka(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!ka(l[i]))return!1;return!0}return!1}function an(l){if(l===null)return Ss;if(typeof l=="string")return fn;if(typeof l=="boolean")return mn;if(typeof l=="number")return wt;if(l instanceof An)return vr;if(l instanceof hn)return uo;if(l instanceof il)return Be;if(l instanceof pr)return Ke;if(l instanceof zi)return We;if(l instanceof fr)return vt;if(l instanceof $i)return Ve;if(l instanceof Nn)return Bt;if(l instanceof Rr)return Ct;if(Array.isArray(l)){const i=l.length;let o;for(const h of l){const g=an(h);if(o){if(o===g)continue;o=ee;break}o=g}return Lt(o||ee,i)}return Xr}function za(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof An||l instanceof hn||l instanceof pr||l instanceof zi||l instanceof fr||l instanceof $i||l instanceof Nn||l instanceof Rr?l.toString():JSON.stringify(l)}class br{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(i.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ka(i[1]))return o.error("invalid value");const h=i[1];let g=an(h);const v=o.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new br(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ho={string:fn,number:wt,boolean:mn,object:Xr};class Jr{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let h,g=1;const v=i[0];if(v==="array"){let w,E;if(i.length>2){const P=i[1];if(typeof P!="string"||!(P in ho)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=ho[P],g++}else w=ee;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=i[2],g++}h=Lt(w,E)}else{if(!ho[v])throw new Error(`Types doesn't contain name = ${v}`);h=ho[v]}const x=[];for(;g<i.length;g++){const w=o.parse(i[g],g,ee);if(!w)return null;x.push(w)}return new Jr(h,x)}evaluate(i){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(i);if(!tn(this.type,an(h)))return h;if(o===this.args.length-1)throw new xi(`Expected value to be of type ${Ht(this.type)}, but found ${Ht(an(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ah={"to-boolean":mn,"to-color":vr,"to-number":wt,"to-string":fn};class Ms{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const h=i[0];if(!ah[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&i.length!==2)return o.error("Expected one argument.");const g=ah[h],v=[];for(let x=1;x<i.length;x++){const w=o.parse(i[x],x,ee);if(!w)return null;v.push(w)}return new Ms(g,v)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let o,h;for(const g of this.args){if(o=g.evaluate(i),h=null,o instanceof An)return o;if(typeof o=="string"){const v=i.parseColor(o);if(v)return v}else if(Array.isArray(o)&&(h=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:gn(o[0],o[1],o[2],o[3]),!h))return new An(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new xi(h||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const h of this.args){o=h.evaluate(i);const g=zi.parse(o);if(g)return g}throw new xi(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const h of this.args){o=h.evaluate(i);const g=fr.parse(o);if(g)return g}throw new xi(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const h of this.args){o=h.evaluate(i);const g=$i.parse(o);if(g)return g}throw new xi(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const h of this.args){o=h.evaluate(i);const g=Nn.parse(o);if(g)return g}throw new xi(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const h of this.args){if(o=h.evaluate(i),o===null)return 0;const g=Number(o);if(!isNaN(g))return g}throw new xi(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return pr.fromString(za(this.args[0].evaluate(i)));case"resolvedImage":return Rr.fromString(za(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return za(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Jd=["Unknown","Point","LineString","Polygon"];class Qd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let o=this._parseColorCache.get(i);return o||(o=An.parse(i),this._parseColorCache.set(i,o)),o}}class rl{constructor(i,o,h=[],g,v=new as,x=[]){this.registry=i,this.path=h,this.key=h.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=g,this._isConstant=o}parse(i,o,h,g,v={}){return o?this.concat(o,h,g)._parse(i,v):this._parse(i,v)}_parse(i,o){function h(g,v,x){return x==="assert"?new Jr(v,[g]):x==="coerce"?new Ms(v,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let x=v.parse(i,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(E.kind)||w.kind==="colorArray"&&["value","string","array"].includes(E.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))x=h(x,w,o.typeAnnotation||"coerce");else if(this.checkSubtype(w,E))return null}else x=h(x,w,o.typeAnnotation||"assert")}if(!(x instanceof br)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new Qd;try{x=new br(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,h){const g=typeof i=="number"?this.path.concat(i):this.path,v=h?this.scope.concat(h):this.scope;return new rl(this.registry,this._isConstant,g,o||null,v,this.errors)}error(i,...o){const h=`${this.key}${o.map(g=>`[${g}]`).join("")}`;this.errors.push(new ii(h,i))}checkSubtype(i,o){const h=tn(i,o);return h&&this.error(h),h}}class sl{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let v=1;v<i.length-1;v+=2){const x=i[v];if(typeof x!="string")return o.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return o.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=o.parse(i[v+1],v+1);if(!w)return null;h.push([x,w])}const g=o.parse(i[i.length-1],i.length-1,o.expectedType,h);return g?new sl(h,g):null}outputDefined(){return this.result.outputDefined()}}class os{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(i.length!==2||typeof i[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=i[1];return o.scope.has(h)?new os(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Wi{constructor(i,o,h){this.type=i,this.index=o,this.input=h}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,wt),g=o.parse(i[2],2,Lt(o.expectedType||ee));return h&&g?new Wi(g.type.itemType,h,g):null}evaluate(i){const o=this.index.evaluate(i),h=this.input.evaluate(i);if(o<0)throw new xi(`Array index out of bounds: ${o} < 0.`);if(o>=h.length)throw new xi(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o!==Math.floor(o))throw new xi(`Array index must be an integer, but found ${o} instead.`);return h[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class po{constructor(i,o){this.type=mn,this.needle=i,this.haystack=o}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,ee),g=o.parse(i[2],2,ee);return h&&g?Fn(h.type,[mn,fn,wt,Ss,ee])?new po(h,g):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(h.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!On(o,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(an(o))} instead.`);if(!On(h,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${Ht(an(h))} instead.`);return h.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class al{constructor(i,o,h){this.type=wt,this.needle=i,this.haystack=o,this.fromIndex=h}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,ee),g=o.parse(i[2],2,ee);if(!h||!g)return null;if(!Fn(h.type,[mn,fn,wt,Ss,ee]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(h.type)} instead`);if(i.length===4){const v=o.parse(i[3],3,wt);return v?new al(h,g,v):null}return new al(h,g)}evaluate(i){const o=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!On(o,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ht(an(o))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),On(h,["string"])){const v=h.indexOf(o,g);return v===-1?-1:[...h.slice(0,v)].length}if(On(h,["array"]))return h.indexOf(o,g);throw new xi(`Expected second argument to be of type array or string, but found ${Ht(an(h))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class fo{constructor(i,o,h,g,v,x){this.inputType=i,this.type=o,this.input=h,this.cases=g,this.outputs=v,this.otherwise=x}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let h,g;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);const v={},x=[];for(let P=2;P<i.length-1;P+=2){let k=i[P];const F=i[P+1];Array.isArray(k)||(k=[k]);const G=o.concat(P);if(k.length===0)return G.error("Expected at least one branch label.");for(const q of k){if(typeof q!="number"&&typeof q!="string")return G.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return G.error("Numeric branch labels must be integer values.");if(h){if(G.checkSubtype(h,an(q)))return null}else h=an(q);if(v[String(q)]!==void 0)return G.error("Branch labels must be unique.");v[String(q)]=x.length}const $=o.parse(F,P,g);if(!$)return null;g=g||$.type,x.push($)}const w=o.parse(i[1],1,ee);if(!w)return null;const E=o.parse(i[i.length-1],i.length-1,g);return E?w.type.kind!=="value"&&o.concat(1).checkSubtype(h,w.type)?null:new fo(h,g,w,v,x,E):null}evaluate(i){const o=this.input.evaluate(i);return(an(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Fi{constructor(i,o,h){this.type=i,this.branches=o,this.otherwise=h}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const w=o.parse(i[x],x,mn);if(!w)return null;const E=o.parse(i[x+1],x+1,h);if(!E)return null;g.push([w,E]),h=h||E.type}const v=o.parse(i[i.length-1],i.length-1,h);if(!v)return null;if(!h)throw new Error("Can't infer output type");return new Fi(h,g,v)}evaluate(i){for(const[o,h]of this.branches)if(o.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,h]of this.branches)i(o),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class ol{constructor(i,o,h,g){this.type=i,this.input=o,this.beginIndex=h,this.endIndex=g}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,ee),g=o.parse(i[2],2,wt);if(!h||!g)return null;if(!Fn(h.type,[Lt(ee),fn,ee]))return o.error(`Expected first argument to be of type array or string, but found ${Ht(h.type)} instead`);if(i.length===4){const v=o.parse(i[3],3,wt);return v?new ol(h.type,h,g,v):null}return new ol(h.type,h,g)}evaluate(i){const o=this.input.evaluate(i),h=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),On(o,["string"]))return[...o].slice(h,g).join("");if(On(o,["array"]))return o.slice(h,g);throw new xi(`Expected first argument to be of type array or string, but found ${Ht(an(o))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function mo(l,i){const o=l.length-1;let h,g,v=0,x=o,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),h=l[w],g=l[w+1],h<=i){if(w===o||i<g)return w;v=w+1}else{if(!(h>i))throw new xi("Input is not a number.");x=w-1}return 0}class go{constructor(i,o,h){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[g,v]of h)this.labels.push(g),this.outputs.push(v)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const h=o.parse(i[1],1,wt);if(!h)return null;const g=[];let v=null;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);for(let x=1;x<i.length;x+=2){const w=x===1?-1/0:i[x],E=i[x+1],P=x,k=x+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const F=o.parse(E,k,v);if(!F)return null;v=v||F.type,g.push([w,F])}return new go(v,h,g)}evaluate(i){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=o[0])return h[0].evaluate(i);const v=o.length;return g>=o[v-1]?h[v-1].evaluate(i):h[mo(o,g)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Sm(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var oa,ll,oh=function(){if(ll)return oa;function l(i,o,h,g){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=h,this.p2y=g}return ll=1,oa=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,g=0;g<8;g++){var v=this.sampleCurveX(h)-i;if(Math.abs(v)<o)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=v/x}var w=0,E=1;for(h=i,g=0;g<20&&(v=this.sampleCurveX(h),!(Math.abs(v-i)<o));g++)i>v?w=h:E=h,h=.5*(E-w)+w;return h},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},oa}(),Mm=Sm(oh);class wr{constructor(i,o,h,g,v){this.type=i,this.operator=o,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(i,o,h,g){let v=0;if(i.name==="exponential")v=_o(o,i.base,h,g);else if(i.name==="linear")v=_o(o,1,h,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;v=new Mm(x[0],x[1],x[2],x[3]).solve(_o(o,1,h,g))}return v}static parse(i,o){let[h,g,v,...x]=i;if(!Array.isArray(g)||g.length===0)return o.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(k=>typeof k!="number"||k<0||k>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(v=o.parse(v,2,wt),!v)return null;const w=[];let E=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||o.expectedType==Ve?o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType):E=vr;for(let P=0;P<x.length;P+=2){const k=x[P],F=x[P+1],G=P+3,$=P+4;if(typeof k!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(w.length&&w[w.length-1][0]>=k)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const q=o.parse(F,$,E);if(!q)return null;E=E||q.type,w.push([k,q])}return ri(E,wt)||ri(E,uo)||ri(E,vr)||ri(E,We)||ri(E,vt)||ri(E,Ve)||ri(E,Bt)||ri(E,Lt(wt))?new wr(E,h,g,v,w):o.error(`Type ${Ht(E)} is not interpolatable.`)}evaluate(i){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=o[0])return h[0].evaluate(i);const v=o.length;if(g>=o[v-1])return h[v-1].evaluate(i);const x=mo(o,g),w=wr.interpolationFactor(this.interpolation,g,o[x],o[x+1]),E=h[x].evaluate(i),P=h[x+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Kr(E,P,w);case"color":return An.interpolate(E,P,w);case"padding":return zi.interpolate(E,P,w);case"colorArray":return $i.interpolate(E,P,w);case"numberArray":return fr.interpolate(E,P,w);case"variableAnchorOffsetCollection":return Nn.interpolate(E,P,w);case"array":return Os(E,P,w);case"projectionDefinition":return hn.interpolate(E,P,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return An.interpolate(E,P,w,"hcl");case"colorArray":return $i.interpolate(E,P,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return An.interpolate(E,P,w,"lab");case"colorArray":return $i.interpolate(E,P,w,"lab")}}}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function _o(l,i,o,h){const g=h-o,v=l-o;return g===0?0:i===1?v/g:(Math.pow(i,v)-1)/(Math.pow(i,g)-1)}const Nr={color:An.interpolate,number:Kr,padding:zi.interpolate,numberArray:fr.interpolate,colorArray:$i.interpolate,variableAnchorOffsetCollection:Nn.interpolate,array:Os};class Lr{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let h=null;const g=o.expectedType;g&&g.kind!=="value"&&(h=g);const v=[];for(const w of i.slice(1)){const E=o.parse(w,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!E)return null;h=h||E.type,v.push(E)}if(!h)throw new Error("No output type");const x=g&&v.some(w=>tn(g,w.type));return new Lr(x?ee:h,v)}evaluate(i){let o,h=null,g=0;for(const v of this.args)if(g++,h=v.evaluate(i),h&&h instanceof Rr&&!h.available&&(o||(o=h.name),h=null,g===this.args.length&&(h=o)),h!==null)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function lh(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function cl(l,i,o,h){return h.compare(i,o)===0}function yo(l,i,o){const h=l!=="=="&&l!=="!=";return class A1{constructor(v,x,w){this.type=mn,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let E=x.parse(v[1],1,ee);if(!E)return null;if(!lh(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${Ht(E.type)}'.`);let P=x.parse(v[2],2,ee);if(!P)return null;if(!lh(w,P.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${Ht(P.type)}'.`);if(E.type.kind!==P.type.kind&&E.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${Ht(E.type)}' and '${Ht(P.type)}'.`);h&&(E.type.kind==="value"&&P.type.kind!=="value"?E=new Jr(P.type,[E]):E.type.kind!=="value"&&P.type.kind==="value"&&(P=new Jr(E.type,[P])));let k=null;if(v.length===4){if(E.type.kind!=="string"&&P.type.kind!=="string"&&E.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(k=x.parse(v[3],3,Be),!k)return null}return new A1(E,P,k)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const E=an(x),P=an(w);if(E.kind!==P.kind||E.kind!=="string"&&E.kind!=="number")throw new xi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${E.kind}, ${P.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const E=an(x),P=an(w);if(E.kind!=="string"||P.kind!=="string")return i(v,x,w)}return this.collator?o(v,x,w,this.collator.evaluate(v)):i(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const ch=yo("==",function(l,i,o){return i===o},cl),Tm=yo("!=",function(l,i,o){return i!==o},function(l,i,o,h){return!cl(0,i,o,h)}),Em=yo("<",function(l,i,o){return i<o},function(l,i,o,h){return h.compare(i,o)<0}),Am=yo(">",function(l,i,o){return i>o},function(l,i,o,h){return h.compare(i,o)>0}),Cm=yo("<=",function(l,i,o){return i<=o},function(l,i,o,h){return h.compare(i,o)<=0}),_c=yo(">=",function(l,i,o){return i>=o},function(l,i,o,h){return h.compare(i,o)>=0});class yc{constructor(i,o,h){this.type=Be,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(i.length!==2)return o.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const g=o.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,mn);if(!g)return null;const v=o.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,mn);if(!v)return null;let x=null;return h.locale&&(x=o.parse(h.locale,1,fn),!x)?null:new yc(g,v,x)}evaluate(i){return new il(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class vc{constructor(i,o,h,g,v){this.type=fn,this.number=i,this.locale=o,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,o){if(i.length!==3)return o.error("Expected two arguments.");const h=o.parse(i[1],1,wt);if(!h)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return o.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=o.parse(g.locale,1,fn),!v))return null;let x=null;if(g.currency&&(x=o.parse(g.currency,1,fn),!x))return null;let w=null;if(g["min-fraction-digits"]&&(w=o.parse(g["min-fraction-digits"],1,wt),!w))return null;let E=null;return g["max-fraction-digits"]&&(E=o.parse(g["max-fraction-digits"],1,wt),!E)?null:new vc(h,v,x,w,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ul{constructor(i){this.type=Ke,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const g=[];let v=!1;for(let x=1;x<=i.length-1;++x){const w=i[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let E=null;if(w["font-scale"]&&(E=o.parse(w["font-scale"],1,wt),!E))return null;let P=null;if(w["text-font"]&&(P=o.parse(w["text-font"],1,Lt(fn)),!P))return null;let k=null;if(w["text-color"]&&(k=o.parse(w["text-color"],1,vr),!k))return null;let F=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!mc.includes(w["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(F=o.parse(w["vertical-align"],1,fn),!F)return null}const G=g[g.length-1];G.scale=E,G.font=P,G.textColor=k,G.verticalAlign=F}else{const E=o.parse(i[x],1,ee);if(!E)return null;const P=E.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ul(g)}evaluate(i){return new pr(this.sections.map(o=>{const h=o.content.evaluate(i);return an(h)===Ct?new sh("",h,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(i):null):new sh(za(h),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null,o.verticalAlign?o.verticalAlign.evaluate(i):null)}))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor),o.verticalAlign&&i(o.verticalAlign)}outputDefined(){return!1}}class uh{constructor(i){this.type=Ct,this.input=i}static parse(i,o){if(i.length!==2)return o.error("Expected two arguments.");const h=o.parse(i[1],1,fn);return h?new uh(h):o.error("No image name provided.")}evaluate(i){const o=this.input.evaluate(i),h=Rr.fromString(o);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(o)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class xc{constructor(i){this.type=wt,this.input=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=o.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Ht(h.type)} instead.`):new xc(h):null}evaluate(i){const o=this.input.evaluate(i);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new xi(`Expected value to be of type string or array, but found ${Ht(an(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ts=8192;function Pm(l,i){const o=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(o*g*Ts),Math.round(h*g*Ts)]}function hh(l,i){const o=Math.pow(2,i.z);return[(g=(l[0]/Ts+i.x)/o,360*g-180),(h=(l[1]/Ts+i.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,g}function hl(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function dl(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function ep(l,i,o){const h=l[0]-i[0],g=l[1]-i[1],v=l[0]-o[0],x=l[1]-o[1];return h*x-v*g==0&&h*v<=0&&g*x<=0}function pl(l,i,o,h){return(g=[h[0]-o[0],h[1]-o[1]])[0]*(v=[i[0]-l[0],i[1]-l[1]])[1]-g[1]*v[0]!=0&&!(!bc(l,i,o,h)||!bc(o,h,l,i));var g,v}function tp(l,i,o){for(const h of o)for(let g=0;g<h.length-1;++g)if(pl(l,i,h[g],h[g+1]))return!0;return!1}function vo(l,i,o=!1){let h=!1;for(const w of i)for(let E=0;E<w.length-1;E++){if(ep(l,w[E],w[E+1]))return o;(v=w[E])[1]>(g=l)[1]!=(x=w[E+1])[1]>g[1]&&g[0]<(x[0]-v[0])*(g[1]-v[1])/(x[1]-v[1])+v[0]&&(h=!h)}var g,v,x;return h}function Im(l,i){for(const o of i)if(vo(l,o))return!0;return!1}function np(l,i){for(const o of l)if(!vo(o,i))return!1;for(let o=0;o<l.length-1;++o)if(tp(l[o],l[o+1],i))return!1;return!0}function Rm(l,i){for(const o of i)if(np(l,o))return!0;return!1}function bc(l,i,o,h){const g=h[0]-o[0],v=h[1]-o[1],x=(l[0]-o[0])*v-g*(l[1]-o[1]),w=(i[0]-o[0])*v-g*(i[1]-o[1]);return x>0&&w<0||x<0&&w>0}function dh(l,i,o){const h=[];for(let g=0;g<l.length;g++){const v=[];for(let x=0;x<l[g].length;x++){const w=Pm(l[g][x],o);hl(i,w),v.push(w)}h.push(v)}return h}function ip(l,i,o){const h=[];for(let g=0;g<l.length;g++){const v=dh(l[g],i,o);h.push(v)}return h}function rp(l,i,o,h){if(l[0]<o[0]||l[0]>o[2]){const g=.5*h;let v=l[0]-o[0]>g?-h:o[0]-l[0]>g?h:0;v===0&&(v=l[0]-o[2]>g?-h:o[2]-l[0]>g?h:0),l[0]+=v}hl(i,l)}function ph(l,i,o,h){const g=Math.pow(2,h.z)*Ts,v=[h.x*Ts,h.y*Ts],x=[];for(const w of l)for(const E of w){const P=[E.x+v[0],E.y+v[1]];rp(P,i,o,g),x.push(P)}return x}function fh(l,i,o,h){const g=Math.pow(2,h.z)*Ts,v=[h.x*Ts,h.y*Ts],x=[];for(const E of l){const P=[];for(const k of E){const F=[k.x+v[0],k.y+v[1]];hl(i,F),P.push(F)}x.push(P)}if(i[2]-i[0]<=g/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const P of E)rp(P,i,o,g)}var w;return x}class Fa{constructor(i,o){this.type=mn,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ka(i[1])){const h=i[1];if(h.type==="FeatureCollection"){const g=[];for(const v of h.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&g.push(w),x==="MultiPolygon"&&g.push(...w)}if(g.length)return new Fa(h,{type:"MultiPolygon",coordinates:g})}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Fa(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Fa(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(o,h){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(h.type==="Polygon"){const w=dh(h.coordinates,v,x),E=ph(o.geometry(),g,v,x);if(!dl(g,v))return!1;for(const P of E)if(!vo(P,w))return!1}if(h.type==="MultiPolygon"){const w=ip(h.coordinates,v,x),E=ph(o.geometry(),g,v,x);if(!dl(g,v))return!1;for(const P of E)if(!Im(P,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(o,h){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(h.type==="Polygon"){const w=dh(h.coordinates,v,x),E=fh(o.geometry(),g,v,x);if(!dl(g,v))return!1;for(const P of E)if(!np(P,w))return!1}if(h.type==="MultiPolygon"){const w=ip(h.coordinates,v,x),E=fh(o.geometry(),g,v,x);if(!dl(g,v))return!1;for(const P of E)if(!Rm(P,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let sp=class{constructor(l=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=l,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:i,compare:o}=this,h=i[l];for(;l>0;){const g=l-1>>1,v=i[g];if(o(h,v)>=0)break;i[l]=v,l=g}i[l]=h}_down(l){const{data:i,compare:o}=this,h=this.length>>1,g=i[l];for(;l<h;){let v=1+(l<<1);const x=v+1;if(x<this.length&&o(i[x],i[v])<0&&(v=x),o(i[v],g)>=0)break;i[l]=i[v],l=v}i[l]=g}};function mh(l,i,o=0,h=l.length-1,g=Lm){for(;h>o;){if(h-o>600){const E=h-o+1,P=i-o+1,k=Math.log(E),F=.5*Math.exp(2*k/3),G=.5*Math.sqrt(k*F*(E-F)/E)*(P-E/2<0?-1:1);mh(l,i,Math.max(o,Math.floor(i-P*F/E+G)),Math.min(h,Math.floor(i+(E-P)*F/E+G)),g)}const v=l[i];let x=o,w=h;for(xo(l,o,i),g(l[h],v)>0&&xo(l,o,h);x<w;){for(xo(l,x,w),x++,w--;g(l[x],v)<0;)x++;for(;g(l[w],v)>0;)w--}g(l[o],v)===0?xo(l,o,w):(w++,xo(l,w,h)),w<=i&&(o=w+1),i<=w&&(h=w-1)}}function xo(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}function Lm(l,i){return l<i?-1:l>i?1:0}function wc(l,i){if(l.length<=1)return[l];const o=[];let h,g;for(const v of l){const x=ap(v);x!==0&&(v.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(h&&o.push(h),h=[v]):h.push(v))}if(h&&o.push(h),i>1)for(let v=0;v<o.length;v++)o[v].length<=i||(mh(o[v],i,1,o[v].length-1,Dm),o[v]=o[v].slice(0,i));return o}function Dm(l,i){return i.area-l.area}function ap(l){let i=0;for(let o,h,g=0,v=l.length,x=v-1;g<v;x=g++)o=l[g],h=l[x],i+=(h.x-o.x)*(o.y+h.y);return i}const op=1/298.257223563,lp=op*(2-op),cp=Math.PI/180;class gh{constructor(i){const o=6378.137*cp*1e3,h=Math.cos(i*cp),g=1/(1-lp*(1-h*h)),v=Math.sqrt(g);this.kx=o*v*h,this.ky=o*v*g*(1-lp)}distance(i,o){const h=this.wrap(i[0]-o[0])*this.kx,g=(i[1]-o[1])*this.ky;return Math.sqrt(h*h+g*g)}pointOnLine(i,o){let h,g,v,x,w=1/0;for(let E=0;E<i.length-1;E++){let P=i[E][0],k=i[E][1],F=this.wrap(i[E+1][0]-P)*this.kx,G=(i[E+1][1]-k)*this.ky,$=0;F===0&&G===0||($=(this.wrap(o[0]-P)*this.kx*F+(o[1]-k)*this.ky*G)/(F*F+G*G),$>1?(P=i[E+1][0],k=i[E+1][1]):$>0&&(P+=F/this.kx*$,k+=G/this.ky*$)),F=this.wrap(o[0]-P)*this.kx,G=(o[1]-k)*this.ky;const q=F*F+G*G;q<w&&(w=q,h=P,g=k,v=E,x=$)}return{point:[h,g],index:v,t:Math.max(0,Math.min(1,x))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function Xn(l,i){return i[0]-l[0]}function Sc(l){return l[1]-l[0]+1}function Ns(l,i){return l[1]>=l[0]&&l[1]<i}function _h(l,i){if(l[0]>l[1])return[null,null];const o=Sc(l);if(i){if(o===2)return[l,null];const g=Math.floor(o/2);return[[l[0],l[0]+g],[l[0]+g,l[1]]]}if(o===1)return[l,null];const h=Math.floor(o/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}function yh(l,i){if(!Ns(i,l.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let h=i[0];h<=i[1];++h)hl(o,l[h]);return o}function vh(l){const i=[1/0,1/0,-1/0,-1/0];for(const o of l)for(const h of o)hl(i,h);return i}function up(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function xh(l,i,o){if(!up(l)||!up(i))return NaN;let h=0,g=0;return l[2]<i[0]&&(h=i[0]-l[2]),l[0]>i[2]&&(h=l[0]-i[2]),l[1]>i[3]&&(g=l[1]-i[3]),l[3]<i[1]&&(g=i[1]-l[3]),o.distance([0,0],[h,g])}function Oa(l,i,o){const h=o.pointOnLine(i,l);return o.distance(l,h.point)}function bh(l,i,o,h,g){const v=Math.min(Oa(l,[o,h],g),Oa(i,[o,h],g)),x=Math.min(Oa(o,[l,i],g),Oa(h,[l,i],g));return Math.min(v,x)}function km(l,i,o,h,g){if(!Ns(i,l.length)||!Ns(h,o.length))return 1/0;let v=1/0;for(let x=i[0];x<i[1];++x){const w=l[x],E=l[x+1];for(let P=h[0];P<h[1];++P){const k=o[P],F=o[P+1];if(pl(w,E,k,F))return 0;v=Math.min(v,bh(w,E,k,F,g))}}return v}function zm(l,i,o,h,g){if(!Ns(i,l.length)||!Ns(h,o.length))return NaN;let v=1/0;for(let x=i[0];x<=i[1];++x)for(let w=h[0];w<=h[1];++w)if(v=Math.min(v,g.distance(l[x],o[w])),v===0)return v;return v}function Fm(l,i,o){if(vo(l,i,!0))return 0;let h=1/0;for(const g of i){const v=g[0],x=g[g.length-1];if(v!==x&&(h=Math.min(h,Oa(l,[x,v],o)),h===0))return h;const w=o.pointOnLine(g,l);if(h=Math.min(h,o.distance(l,w.point)),h===0)return h}return h}function Om(l,i,o,h){if(!Ns(i,l.length))return NaN;for(let v=i[0];v<=i[1];++v)if(vo(l[v],o,!0))return 0;let g=1/0;for(let v=i[0];v<i[1];++v){const x=l[v],w=l[v+1];for(const E of o)for(let P=0,k=E.length,F=k-1;P<k;F=P++){const G=E[F],$=E[P];if(pl(x,w,G,$))return 0;g=Math.min(g,bh(x,w,G,$,h))}}return g}function hp(l,i){for(const o of l)for(const h of o)if(vo(h,i,!0))return!0;return!1}function Nm(l,i,o,h=1/0){const g=vh(l),v=vh(i);if(h!==1/0&&xh(g,v,o)>=h)return h;if(dl(g,v)){if(hp(l,i))return 0}else if(hp(i,l))return 0;let x=1/0;for(const w of l)for(let E=0,P=w.length,k=P-1;E<P;k=E++){const F=w[k],G=w[E];for(const $ of i)for(let q=0,K=$.length,se=K-1;q<K;se=q++){const he=$[se],ze=$[q];if(pl(F,G,he,ze))return 0;x=Math.min(x,bh(F,G,he,ze,o))}}return x}function dp(l,i,o,h,g,v){if(!v)return;const x=xh(yh(h,v),g,o);x<i&&l.push([x,v,[0,0]])}function Mc(l,i,o,h,g,v,x){if(!v||!x)return;const w=xh(yh(h,v),yh(g,x),o);w<i&&l.push([w,v,x])}function Tc(l,i,o,h,g=1/0){let v=Math.min(h.distance(l[0],o[0][0]),g);if(v===0)return v;const x=new sp([[0,[0,l.length-1],[0,0]]],Xn),w=vh(o);for(;x.length>0;){const E=x.pop();if(E[0]>=v)continue;const P=E[1],k=i?50:100;if(Sc(P)<=k){if(!Ns(P,l.length))return NaN;if(i){const F=Om(l,P,o,h);if(isNaN(F)||F===0)return F;v=Math.min(v,F)}else for(let F=P[0];F<=P[1];++F){const G=Fm(l[F],o,h);if(v=Math.min(v,G),v===0)return 0}}else{const F=_h(P,i);dp(x,v,h,l,w,F[0]),dp(x,v,h,l,w,F[1])}}return v}function Ec(l,i,o,h,g,v=1/0){let x=Math.min(v,g.distance(l[0],o[0]));if(x===0)return x;const w=new sp([[0,[0,l.length-1],[0,o.length-1]]],Xn);for(;w.length>0;){const E=w.pop();if(E[0]>=x)continue;const P=E[1],k=E[2],F=i?50:100,G=h?50:100;if(Sc(P)<=F&&Sc(k)<=G){if(!Ns(P,l.length)&&Ns(k,o.length))return NaN;let $;if(i&&h)$=km(l,P,o,k,g),x=Math.min(x,$);else if(i&&!h){const q=l.slice(P[0],P[1]+1);for(let K=k[0];K<=k[1];++K)if($=Oa(o[K],q,g),x=Math.min(x,$),x===0)return x}else if(!i&&h){const q=o.slice(k[0],k[1]+1);for(let K=P[0];K<=P[1];++K)if($=Oa(l[K],q,g),x=Math.min(x,$),x===0)return x}else $=zm(l,P,o,k,g),x=Math.min(x,$)}else{const $=_h(P,i),q=_h(k,h);Mc(w,x,g,l,o,$[0],q[0]),Mc(w,x,g,l,o,$[0],q[1]),Mc(w,x,g,l,o,$[1],q[0]),Mc(w,x,g,l,o,$[1],q[1])}}return x}function wh(l){return l.type==="MultiPolygon"?l.coordinates.map(i=>({type:"Polygon",coordinates:i})):l.type==="MultiLineString"?l.coordinates.map(i=>({type:"LineString",coordinates:i})):l.type==="MultiPoint"?l.coordinates.map(i=>({type:"Point",coordinates:i})):[l]}class Na{constructor(i,o){this.type=wt,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ka(i[1])){const h=i[1];if(h.type==="FeatureCollection")return new Na(h,h.features.map(g=>wh(g.geometry)).flat());if(h.type==="Feature")return new Na(h,wh(h.geometry));if("type"in h&&"coordinates"in h)return new Na(h,wh(h))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(o,h){const g=o.geometry(),v=g.flat().map(E=>hh([E.x,E.y],o.canonical));if(g.length===0)return NaN;const x=new gh(v[0][1]);let w=1/0;for(const E of h){switch(E.type){case"Point":w=Math.min(w,Ec(v,!1,[E.coordinates],!1,x,w));break;case"LineString":w=Math.min(w,Ec(v,!1,E.coordinates,!0,x,w));break;case"Polygon":w=Math.min(w,Tc(v,!1,E.coordinates,x,w))}if(w===0)return w}return w}(i,this.geometries);if(i.geometryType()==="LineString")return function(o,h){const g=o.geometry(),v=g.flat().map(E=>hh([E.x,E.y],o.canonical));if(g.length===0)return NaN;const x=new gh(v[0][1]);let w=1/0;for(const E of h){switch(E.type){case"Point":w=Math.min(w,Ec(v,!0,[E.coordinates],!1,x,w));break;case"LineString":w=Math.min(w,Ec(v,!0,E.coordinates,!0,x,w));break;case"Polygon":w=Math.min(w,Tc(v,!0,E.coordinates,x,w))}if(w===0)return w}return w}(i,this.geometries);if(i.geometryType()==="Polygon")return function(o,h){const g=o.geometry();if(g.length===0||g[0].length===0)return NaN;const v=wc(g,0).map(E=>E.map(P=>P.map(k=>hh([k.x,k.y],o.canonical)))),x=new gh(v[0][0][0][1]);let w=1/0;for(const E of h)for(const P of v){switch(E.type){case"Point":w=Math.min(w,Tc([E.coordinates],!1,P,x,w));break;case"LineString":w=Math.min(w,Tc(E.coordinates,!0,P,x,w));break;case"Polygon":w=Math.min(w,Nm(P,E.coordinates,x,w))}if(w===0)return w}return w}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class fl{constructor(i){this.type=ee,this.key=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=i[1];return h==null?o.error("Global state property must be defined."):typeof h!="string"?o.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new fl(h)}evaluate(i){var o;const h=(o=i.globals)===null||o===void 0?void 0:o.globalState;return h&&Object.keys(h).length!==0?En(h,this.key):null}eachChild(){}outputDefined(){return!1}}const bo={"==":ch,"!=":Tm,">":Am,"<":Em,">=":_c,"<=":Cm,array:Jr,at:Wi,boolean:Jr,case:Fi,coalesce:Lr,collator:yc,format:ul,image:uh,in:po,"index-of":al,interpolate:wr,"interpolate-hcl":wr,"interpolate-lab":wr,length:xc,let:sl,literal:br,match:fo,number:Jr,"number-format":vc,object:Jr,slice:ol,step:go,string:Jr,"to-boolean":Ms,"to-color":Ms,"to-number":Ms,"to-string":Ms,var:os,within:Fa,distance:Na,"global-state":fl};class Qr{constructor(i,o,h,g){this.name=i,this.type=o,this._evaluate=h,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,o){const h=i[0],g=Qr.definitions[h];if(!g)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,w=x.filter(([P])=>!Array.isArray(P)||P.length===i.length-1);let E=null;for(const[P,k]of w){E=new rl(o.registry,Ac,o.path,null,o.scope);const F=[];let G=!1;for(let $=1;$<i.length;$++){const q=i[$],K=Array.isArray(P)?P[$-1]:P.type,se=E.parse(q,1+F.length,K);if(!se){G=!0;break}F.push(se)}if(!G)if(Array.isArray(P)&&P.length!==F.length)E.error(`Expected ${P.length} arguments, but found ${F.length} instead.`);else{for(let $=0;$<F.length;$++){const q=Array.isArray(P)?P[$]:P.type,K=F[$];E.concat($+1).checkSubtype(q,K.type)}if(E.errors.length===0)return new Qr(h,v,k,F)}}if(w.length===1)o.errors.push(...E.errors);else{const P=(w.length?w:x).map(([F])=>{return G=F,Array.isArray(G)?`(${G.map(Ht).join(", ")})`:`(${Ht(G.type)}...)`;var G}).join(" | "),k=[];for(let F=1;F<i.length;F++){const G=o.parse(i[F],1+k.length);if(!G)return null;k.push(Ht(G.type))}o.error(`Expected arguments of type ${P}, but found (${k.join(", ")}) instead.`)}return null}static register(i,o){Qr.definitions=o;for(const h in o)i[h]=Qr}}function pp(l,[i,o,h,g]){i=i.evaluate(l),o=o.evaluate(l),h=h.evaluate(l);const v=g?g.evaluate(l):1,x=gn(i,o,h,v);if(x)throw new xi(x);return new An(i/255,o/255,h/255,v,!1)}function fp(l,i){return l in i}function Sh(l,i){const o=i[l];return o===void 0?null:o}function Ua(l){return{type:l}}function Ac(l){if(l instanceof os)return Ac(l.boundExpression);if(l instanceof Qr&&l.name==="error"||l instanceof yc||l instanceof Fa||l instanceof Na||l instanceof fl)return!1;const i=l instanceof Ms||l instanceof Jr;let o=!0;return l.eachChild(h=>{o=i?o&&Ac(h):o&&h instanceof br}),!!o&&Cc(l)&&wo(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Cc(l){if(l instanceof Qr&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Fa||l instanceof Na)return!1;let i=!0;return l.eachChild(o=>{i&&!Cc(o)&&(i=!1)}),i}function ml(l){if(l instanceof Qr&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(o=>{i&&!ml(o)&&(i=!1)}),i}function wo(l,i){if(l instanceof Qr&&i.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild(h=>{o&&!wo(h,i)&&(o=!1)}),o}function mp(l){return{result:"success",value:l}}function So(l){return{result:"error",value:l}}function Mo(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Mh(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Th(l){return!!l.expression&&l.expression.interpolated}function Cn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Ba(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&an(l)===Xr}function gp(l){return l}function _p(l,i){const o=l.stops&&typeof l.stops[0][0]=="object",h=o||!(o||l.property!==void 0),g=l.type||(Th(i)?"exponential":"interval"),v=function(k){switch(k.type){case"color":return An.parse;case"padding":return zi.parse;case"numberArray":return fr.parse;case"colorArray":return $i.parse;default:return null}}(i);if(v&&((l=ki({},l)).stops&&(l.stops=l.stops.map(k=>[k[0],v(k[1])])),l.default=v(l.default?l.default:i.default)),l.colorSpace&&(x=l.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var x;const w=function(k){switch(k){case"exponential":return yp;case"interval":return Bm;case"categorical":return Um;case"identity":return vp;default:throw new Error(`Unknown function type "${k}"`)}}(g);let E,P;if(g==="categorical"){E=Object.create(null);for(const k of l.stops)E[k[0]]=k[1];P=typeof l.stops[0][0]}if(o){const k={},F=[];for(let q=0;q<l.stops.length;q++){const K=l.stops[q],se=K[0].zoom;k[se]===void 0&&(k[se]={zoom:se,type:l.type,property:l.property,default:l.default,stops:[]},F.push(se)),k[se].stops.push([K[0].value,K[1]])}const G=[];for(const q of F)G.push([k[q].zoom,_p(k[q],i)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:wr.interpolationFactor.bind(void 0,$),zoomStops:G.map(q=>q[0]),evaluate:({zoom:q},K)=>yp({stops:G,base:l.base},i,q).evaluate(q,K)}}if(h){const k=g==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:wr.interpolationFactor.bind(void 0,k),zoomStops:l.stops.map(F=>F[0]),evaluate:({zoom:F})=>w(l,i,F,E,P)}}return{kind:"source",evaluate(k,F){const G=F&&F.properties?F.properties[l.property]:void 0;return G===void 0?gl(l.default,i.default):w(l,i,G,E,P)}}}function gl(l,i,o){return l!==void 0?l:i!==void 0?i:o!==void 0?o:void 0}function Um(l,i,o,h,g){return gl(typeof o===g?h[o]:void 0,l.default,i.default)}function Bm(l,i,o){if(Cn(o)!=="number")return gl(l.default,i.default);const h=l.stops.length;if(h===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[h-1][0])return l.stops[h-1][1];const g=mo(l.stops.map(v=>v[0]),o);return l.stops[g][1]}function yp(l,i,o){const h=l.base!==void 0?l.base:1;if(Cn(o)!=="number")return gl(l.default,i.default);const g=l.stops.length;if(g===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[g-1][0])return l.stops[g-1][1];const v=mo(l.stops.map(k=>k[0]),o),x=function(k,F,G,$){const q=$-G,K=k-G;return q===0?0:F===1?K/q:(Math.pow(F,K)-1)/(Math.pow(F,q)-1)}(o,h,l.stops[v][0],l.stops[v+1][0]),w=l.stops[v][1],E=l.stops[v+1][1],P=Nr[i.type]||gp;return typeof w.evaluate=="function"?{evaluate(...k){const F=w.evaluate.apply(void 0,k),G=E.evaluate.apply(void 0,k);if(F!==void 0&&G!==void 0)return P(F,G,x,l.colorSpace)}}:P(w,E,x,l.colorSpace)}function vp(l,i,o){switch(i.type){case"color":o=An.parse(o);break;case"formatted":o=pr.fromString(o.toString());break;case"resolvedImage":o=Rr.fromString(o.toString());break;case"padding":o=zi.parse(o);break;case"colorArray":o=$i.parse(o);break;case"numberArray":o=fr.parse(o);break;default:Cn(o)===i.type||i.type==="enum"&&i.values[o]||(o=void 0)}return gl(o,l.default,i.default)}Qr.register(bo,{error:[{kind:"error"},[fn],(l,[i])=>{throw new xi(i.evaluate(l))}],typeof:[fn,[ee],(l,[i])=>Ht(an(i.evaluate(l)))],"to-rgba":[Lt(wt,4),[vr],(l,[i])=>{const[o,h,g,v]=i.evaluate(l).rgb;return[255*o,255*h,255*g,v]}],rgb:[vr,[wt,wt,wt],pp],rgba:[vr,[wt,wt,wt,wt],pp],has:{type:mn,overloads:[[[fn],(l,[i])=>fp(i.evaluate(l),l.properties())],[[fn,Xr],(l,[i,o])=>fp(i.evaluate(l),o.evaluate(l))]]},get:{type:ee,overloads:[[[fn],(l,[i])=>Sh(i.evaluate(l),l.properties())],[[fn,Xr],(l,[i,o])=>Sh(i.evaluate(l),o.evaluate(l))]]},"feature-state":[ee,[fn],(l,[i])=>Sh(i.evaluate(l),l.featureState||{})],properties:[Xr,[],l=>l.properties()],"geometry-type":[fn,[],l=>l.geometryType()],id:[ee,[],l=>l.id()],zoom:[wt,[],l=>l.globals.zoom],"heatmap-density":[wt,[],l=>l.globals.heatmapDensity||0],elevation:[wt,[],l=>l.globals.elevation||0],"line-progress":[wt,[],l=>l.globals.lineProgress||0],accumulated:[ee,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[wt,Ua(wt),(l,i)=>{let o=0;for(const h of i)o+=h.evaluate(l);return o}],"*":[wt,Ua(wt),(l,i)=>{let o=1;for(const h of i)o*=h.evaluate(l);return o}],"-":{type:wt,overloads:[[[wt,wt],(l,[i,o])=>i.evaluate(l)-o.evaluate(l)],[[wt],(l,[i])=>-i.evaluate(l)]]},"/":[wt,[wt,wt],(l,[i,o])=>i.evaluate(l)/o.evaluate(l)],"%":[wt,[wt,wt],(l,[i,o])=>i.evaluate(l)%o.evaluate(l)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(l,[i,o])=>Math.pow(i.evaluate(l),o.evaluate(l))],sqrt:[wt,[wt],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[wt,[wt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[wt,[wt],(l,[i])=>Math.log(i.evaluate(l))],log2:[wt,[wt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[wt,[wt],(l,[i])=>Math.sin(i.evaluate(l))],cos:[wt,[wt],(l,[i])=>Math.cos(i.evaluate(l))],tan:[wt,[wt],(l,[i])=>Math.tan(i.evaluate(l))],asin:[wt,[wt],(l,[i])=>Math.asin(i.evaluate(l))],acos:[wt,[wt],(l,[i])=>Math.acos(i.evaluate(l))],atan:[wt,[wt],(l,[i])=>Math.atan(i.evaluate(l))],min:[wt,Ua(wt),(l,i)=>Math.min(...i.map(o=>o.evaluate(l)))],max:[wt,Ua(wt),(l,i)=>Math.max(...i.map(o=>o.evaluate(l)))],abs:[wt,[wt],(l,[i])=>Math.abs(i.evaluate(l))],round:[wt,[wt],(l,[i])=>{const o=i.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[wt,[wt],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[wt,[wt],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[mn,[fn,ee],(l,[i,o])=>l.properties()[i.value]===o.value],"filter-id-==":[mn,[ee],(l,[i])=>l.id()===i.value],"filter-type-==":[mn,[fn],(l,[i])=>l.geometryType()===i.value],"filter-<":[mn,[fn,ee],(l,[i,o])=>{const h=l.properties()[i.value],g=o.value;return typeof h==typeof g&&h<g}],"filter-id-<":[mn,[ee],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o<h}],"filter->":[mn,[fn,ee],(l,[i,o])=>{const h=l.properties()[i.value],g=o.value;return typeof h==typeof g&&h>g}],"filter-id->":[mn,[ee],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o>h}],"filter-<=":[mn,[fn,ee],(l,[i,o])=>{const h=l.properties()[i.value],g=o.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[mn,[ee],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o<=h}],"filter->=":[mn,[fn,ee],(l,[i,o])=>{const h=l.properties()[i.value],g=o.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[mn,[ee],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o>=h}],"filter-has":[mn,[ee],(l,[i])=>i.value in l.properties()],"filter-has-id":[mn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[mn,[Lt(fn)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[mn,[Lt(ee)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[mn,[fn,Lt(ee)],(l,[i,o])=>o.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[mn,[fn,Lt(ee)],(l,[i,o])=>function(h,g,v,x){for(;v<=x;){const w=v+x>>1;if(g[w]===h)return!0;g[w]>h?x=w-1:v=w+1}return!1}(l.properties()[i.value],o.value,0,o.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(l,[i,o])=>i.evaluate(l)&&o.evaluate(l)],[Ua(mn),(l,i)=>{for(const o of i)if(!o.evaluate(l))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(l,[i,o])=>i.evaluate(l)||o.evaluate(l)],[Ua(mn),(l,i)=>{for(const o of i)if(o.evaluate(l))return!0;return!1}]]},"!":[mn,[mn],(l,[i])=>!i.evaluate(l)],"is-supported-script":[mn,[fn],(l,[i])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(i.evaluate(l))}],upcase:[fn,[fn],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[fn,[fn],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[fn,Ua(ee),(l,i)=>i.map(o=>za(o.evaluate(l))).join("")],"resolved-locale":[fn,[Be],(l,[i])=>i.evaluate(l).resolvedLocale()]});class Pc{constructor(i,o){this.expression=i,this._warningHistory={},this._evaluator=new Qd,this._defaultValue=o?function(h){if(h.type==="color"&&Ba(h.default))return new An(0,0,0,0);switch(h.type){case"color":return An.parse(h.default)||null;case"padding":return zi.parse(h.default)||null;case"numberArray":return fr.parse(h.default)||null;case"colorArray":return $i.parse(h.default)||null;case"variableAnchorOffsetCollection":return Nn.parse(h.default)||null;case"projectionDefinition":return hn.parse(h.default)||null;default:return h.default===void 0?null:h.default}}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(i,o,h,g,v,x){return this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,o,h,g,v,x){this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ic(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in bo}function Rc(l,i){const o=new rl(bo,Ac,[],i?function(g){const v={color:vr,string:fn,number:wt,enum:fn,boolean:mn,formatted:Ke,padding:We,numberArray:vt,colorArray:Ve,projectionDefinition:uo,resolvedImage:Ct,variableAnchorOffsetCollection:Bt};return g.type==="array"?Lt(v[g.value]||ee,g.length):v[g.type]}(i):void 0),h=o.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?mp(new Pc(h,i)):So(o.errors)}class _l{constructor(i,o){this.kind=i,this._styleExpression=o,this.isStateDependent=i!=="constant"&&!ml(o.expression),this.globalStateRefs=Eo(o.expression)}evaluateWithoutErrorHandling(i,o,h,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,o,h,g,v,x)}evaluate(i,o,h,g,v,x){return this._styleExpression.evaluate(i,o,h,g,v,x)}}class Lc{constructor(i,o,h,g){this.kind=i,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=i!=="camera"&&!ml(o.expression),this.globalStateRefs=Eo(o.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,o,h,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,o,h,g,v,x)}evaluate(i,o,h,g,v,x){return this._styleExpression.evaluate(i,o,h,g,v,x)}interpolationFactor(i,o,h){return this.interpolationType?wr.interpolationFactor(this.interpolationType,i,o,h):0}}function Eh(l,i){const o=Rc(l,i);if(o.result==="error")return o;const h=o.value.expression,g=Cc(h);if(!g&&!Mo(i))return So([new ii("","data expressions not supported")]);const v=wo(h,["zoom"]);if(!v&&!Mh(i))return So([new ii("","zoom expressions not supported")]);const x=To(h);return x||v?x instanceof ii?So([x]):x instanceof wr&&!Th(i)?So([new ii("",'"interpolate" expressions cannot be used with this property')]):mp(x?new Lc(g?"camera":"composite",o.value,x.labels,x instanceof wr?x.interpolation:void 0):new _l(g?"constant":"source",o.value)):So([new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class yl{constructor(i,o){this._parameters=i,this._specification=o,ki(this,_p(this._parameters,this._specification))}static deserialize(i){return new yl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function To(l){let i=null;if(l instanceof sl)i=To(l.result);else if(l instanceof Lr){for(const o of l.args)if(i=To(o),i)break}else(l instanceof go||l instanceof wr)&&l.input instanceof Qr&&l.input.name==="zoom"&&(i=l);return i instanceof ii||l.eachChild(o=>{const h=To(o);h instanceof ii?i=h:!i&&h?i=new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new ii("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Eo(l,i=new Set){return l instanceof fl&&i.add(l.key),l.eachChild(o=>{Eo(o,i)}),i}function vl(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!vl(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Ah={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function la(l){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};vl(l)||(l=Dc(l));const i=Rc(l,Ah);if(i.result==="error")throw new Error(i.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,h,g)=>i.value.evaluate(o,h,{},g),needGeometry:xp(l),getGlobalStateRefs:()=>Eo(i.value.expression)}}function Vm(l,i){return l<i?-1:l>i?1:0}function xp(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(xp(l[i]))return!0;return!1}function Dc(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?Ch(l[1],l[2],"=="):i==="!="?xl(Ch(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ch(l[1],l[2],i):i==="any"?(o=l.slice(1),["any"].concat(o.map(Dc))):i==="all"?["all"].concat(l.slice(1).map(Dc)):i==="none"?["all"].concat(l.slice(1).map(Dc).map(xl)):i==="in"?bp(l[1],l.slice(2)):i==="!in"?xl(bp(l[1],l.slice(2))):i==="has"?wp(l[1]):i!=="!has"||xl(wp(l[1]));var o}function Ch(l,i,o){switch(l){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,l,i]}}function bp(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(o=>typeof o!=typeof i[0])?["filter-in-large",l,["literal",i.sort(Vm)]]:["filter-in-small",l,["literal",i]]}}function wp(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function xl(l){return["!",l]}function kc(l){const i=typeof l;if(i==="number"||i==="boolean"||i==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let g="[";for(const v of l)g+=`${kc(v)},`;return`${g}]`}const o=Object.keys(l).sort();let h="{";for(let g=0;g<o.length;g++)h+=`${JSON.stringify(o[g])}:${kc(l[o[g]])},`;return`${h}}`}function zc(l){let i="";for(const o of dt)i+=`/${kc(l[o])}`;return i}function Sp(l){const i=l.value;return i?[new _t(l.key,i,"constants have been deprecated as of v8")]:[]}function Ti(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function ca(l){if(Array.isArray(l))return l.map(ca);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const o in l)i[o]=ca(l[o]);return i}return Ti(l)}function es(l){const i=l.key,o=l.value,h=l.valueSpec||{},g=l.objectElementValidators||{},v=l.style,x=l.styleSpec,w=l.validateSpec;let E=[];const P=Cn(o);if(P!=="object")return[new _t(i,o,`object expected, ${P} found`)];for(const k in o){const F=k.split(".")[0],G=En(h,F)||h["*"];let $;if(En(g,F))$=g[F];else if(En(h,F))$=w;else if(g["*"])$=g["*"];else{if(!h["*"]){E.push(new _t(i,o[k],`unknown property "${k}"`));continue}$=w}E=E.concat($({key:(i&&`${i}.`)+k,value:o[k],valueSpec:G,style:v,styleSpec:x,object:o,objectKey:k,validateSpec:w},o))}for(const k in h)g[k]||h[k].required&&h[k].default===void 0&&o[k]===void 0&&E.push(new _t(i,o,`missing required property "${k}"`));return E}function Fc(l){const i=l.value,o=l.valueSpec,h=l.style,g=l.styleSpec,v=l.key,x=l.arrayElementValidator||l.validateSpec;if(Cn(i)!=="array")return[new _t(v,i,`array expected, ${Cn(i)} found`)];if(o.length&&i.length!==o.length)return[new _t(v,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new _t(v,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let w={type:o.value,values:o.values};g.$version<7&&(w.function=o.function),Cn(o.value)==="object"&&(w=o.value);let E=[];for(let P=0;P<i.length;P++)E=E.concat(x({array:i,arrayIndex:P,value:i[P],valueSpec:w,validateSpec:l.validateSpec,style:h,styleSpec:g,key:`${v}[${P}]`}));return E}function bl(l){const i=l.key,o=l.value,h=l.valueSpec;let g=Cn(o);return g==="number"&&o!=o&&(g="NaN"),g!=="number"?[new _t(i,o,`number expected, ${g} found`)]:"minimum"in h&&o<h.minimum?[new _t(i,o,`${o} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&o>h.maximum?[new _t(i,o,`${o} is greater than the maximum value ${h.maximum}`)]:[]}function Ao(l){const i=l.valueSpec,o=Ti(l.value.type);let h,g,v,x={};const w=o!=="categorical"&&l.value.property===void 0,E=!w,P=Cn(l.value.stops)==="array"&&Cn(l.value.stops[0])==="array"&&Cn(l.value.stops[0][0])==="object",k=es({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function($){if(o==="identity")return[new _t($.key,$.value,'identity function may not have a "stops" property')];let q=[];const K=$.value;return q=q.concat(Fc({key:$.key,value:K,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:F})),Cn(K)==="array"&&K.length===0&&q.push(new _t($.key,K,"array must have at least one stop")),q},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:i,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return o==="identity"&&w&&k.push(new _t(l.key,l.value,'missing required property "property"')),o==="identity"||l.value.stops||k.push(new _t(l.key,l.value,'missing required property "stops"')),o==="exponential"&&l.valueSpec.expression&&!Th(l.valueSpec)&&k.push(new _t(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(E&&!Mo(l.valueSpec)?k.push(new _t(l.key,l.value,"property functions not supported")):w&&!Mh(l.valueSpec)&&k.push(new _t(l.key,l.value,"zoom functions not supported"))),o!=="categorical"&&!P||l.value.property!==void 0||k.push(new _t(l.key,l.value,'"property" property is required')),k;function F($){let q=[];const K=$.value,se=$.key;if(Cn(K)!=="array")return[new _t(se,K,`array expected, ${Cn(K)} found`)];if(K.length!==2)return[new _t(se,K,`array length 2 expected, length ${K.length} found`)];if(P){if(Cn(K[0])!=="object")return[new _t(se,K,`object expected, ${Cn(K[0])} found`)];if(K[0].zoom===void 0)return[new _t(se,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new _t(se,K,"object stop key must have value")];if(v&&v>Ti(K[0].zoom))return[new _t(se,K[0].zoom,"stop zoom values must appear in ascending order")];Ti(K[0].zoom)!==v&&(v=Ti(K[0].zoom),g=void 0,x={}),q=q.concat(es({key:`${se}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:bl,value:G}}))}else q=q.concat(G({key:`${se}[0]`,value:K[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},K));return Ic(ca(K[1]))?q.concat([new _t(`${se}[1]`,K[1],"expressions are not allowed in function stops.")]):q.concat($.validateSpec({key:`${se}[1]`,value:K[1],valueSpec:i,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function G($,q){const K=Cn($.value),se=Ti($.value),he=$.value!==null?$.value:q;if(h){if(K!==h)return[new _t($.key,he,`${K} stop domain type must match previous stop domain type ${h}`)]}else h=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new _t($.key,he,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&o!=="categorical"){let ze=`number expected, ${K} found`;return Mo(i)&&o===void 0&&(ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t($.key,he,ze)]}return o!=="categorical"||K!=="number"||isFinite(se)&&Math.floor(se)===se?o!=="categorical"&&K==="number"&&g!==void 0&&se<g?[new _t($.key,he,"stop domain values must appear in ascending order")]:(g=se,o==="categorical"&&se in x?[new _t($.key,he,"stop domain values must be unique")]:(x[se]=!0,[])):[new _t($.key,he,`integer expected, found ${se}`)]}}function Co(l){const i=(l.expressionContext==="property"?Eh:Rc)(ca(l.value),l.valueSpec);if(i.result==="error")return i.value.map(h=>new _t(`${l.key}${h.key}`,l.value,h.message));const o=i.value.expression||i.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new _t(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ml(o))return[new _t(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ml(o))return[new _t(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!wo(o,["zoom","feature-state"]))return[new _t(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Cc(o))return[new _t(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ph(l){const i=l.key,o=l.value,h=Cn(o);return h!=="string"?[new _t(i,o,`color expected, ${h} found`)]:An.parse(String(o))?[]:[new _t(i,o,`color expected, "${o}" found`)]}function wl(l){const i=l.key,o=l.value,h=l.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Ti(o))===-1&&g.push(new _t(i,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(Ti(o))===-1&&g.push(new _t(i,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function Ih(l){return vl(ca(l.value))?Co(ki({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mp(l)}function Mp(l){const i=l.value,o=l.key;if(Cn(i)!=="array")return[new _t(o,i,`array expected, ${Cn(i)} found`)];const h=l.styleSpec;let g,v=[];if(i.length<1)return[new _t(o,i,"filter array must have at least 1 element")];switch(v=v.concat(wl({key:`${o}[0]`,value:i[0],valueSpec:h.filter_operator,style:l.style,styleSpec:l.styleSpec})),Ti(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Ti(i[1])==="$type"&&v.push(new _t(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new _t(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Cn(i[1]),g!=="string"&&v.push(new _t(`${o}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=Cn(i[x]),Ti(i[1])==="$type"?v=v.concat(wl({key:`${o}[${x}]`,value:i[x],valueSpec:h.geometry_type,style:l.style,styleSpec:l.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new _t(`${o}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)v=v.concat(Mp({key:`${o}[${x}]`,value:i[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":g=Cn(i[1]),i.length!==2?v.push(new _t(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new _t(`${o}[1]`,i[1],`string expected, ${g} found`))}return v}function Tp(l,i){const o=l.key,h=l.validateSpec,g=l.style,v=l.styleSpec,x=l.value,w=l.objectKey,E=v[`${i}_${l.layerType}`];if(!E)return[];const P=w.match(/^(.*)-transition$/);if(i==="paint"&&P&&E[P[1]]&&E[P[1]].transition)return h({key:o,value:x,valueSpec:v.transition,style:g,styleSpec:v});const k=l.valueSpec||E[w];if(!k)return[new _t(o,x,`unknown property "${w}"`)];let F;if(Cn(x)==="string"&&Mo(k)&&!k.tokens&&(F=/^{([^}]+)}$/.exec(x)))return[new _t(o,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const G=[];return l.layerType==="symbol"&&(w==="text-field"&&g&&!g.glyphs&&G.push(new _t(o,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ba(ca(x))&&Ti(x.type)==="identity"&&G.push(new _t(o,x,'"text-font" does not support identity functions'))),G.concat(h({key:l.key,value:x,valueSpec:k,style:g,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:w}))}function Po(l){return Tp(l,"paint")}function Io(l){return Tp(l,"layout")}function Dr(l){let i=[];const o=l.value,h=l.key,g=l.style,v=l.styleSpec;if(Cn(o)!=="object")return[new _t(h,o,`object expected, ${Cn(o)} found`)];o.type||o.ref||i.push(new _t(h,o,'either "type" or "ref" is required'));let x=Ti(o.type);const w=Ti(o.ref);if(o.id){const E=Ti(o.id);for(let P=0;P<l.arrayIndex;P++){const k=g.layers[P];Ti(k.id)===E&&i.push(new _t(h,o.id,`duplicate layer id "${o.id}", previously used at line ${k.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach(P=>{P in o&&i.push(new _t(h,o[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{Ti(P.id)===w&&(E=P)}),E?E.ref?i.push(new _t(h,o.ref,"ref cannot reference another ref layer")):x=Ti(E.type):i.push(new _t(h,o.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(o.source){const E=g.sources&&g.sources[o.source],P=E&&Ti(E.type);E?P==="vector"&&x==="raster"?i.push(new _t(h,o.source,`layer "${o.id}" requires a raster source`)):P!=="raster-dem"&&x==="hillshade"||P!=="raster-dem"&&x==="color-relief"?i.push(new _t(h,o.source,`layer "${o.id}" requires a raster-dem source`)):P==="raster"&&x!=="raster"?i.push(new _t(h,o.source,`layer "${o.id}" requires a vector source`)):P!=="vector"||o["source-layer"]?P==="raster-dem"&&x!=="hillshade"&&x!=="color-relief"?i.push(new _t(h,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):x!=="line"||!o.paint||!o.paint["line-gradient"]||P==="geojson"&&E.lineMetrics||i.push(new _t(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new _t(h,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new _t(h,o.source,`source "${o.source}" not found`))}else i.push(new _t(h,o,'missing required property "source"'));return i=i.concat(es({key:h,value:o,valueSpec:v.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${h}.type`,value:o.type,valueSpec:v.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:o,objectKey:"type"}),filter:Ih,layout:E=>es({layer:o,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":P=>Io(ki({layerType:x},P))}}),paint:E=>es({layer:o,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":P=>Po(ki({layerType:x},P))}})}})),i}function ls(l){const i=l.value,o=l.key,h=Cn(i);return h!=="string"?[new _t(o,i,`string expected, ${h} found`)]:[]}const Rh={promoteId:function({key:l,value:i}){if(Cn(i)==="string")return ls({key:l,value:i});{const o=[];for(const h in i)o.push(...ls({key:`${l}.${h}`,value:i[h]}));return o}}};function Ep(l){const i=l.value,o=l.key,h=l.styleSpec,g=l.style,v=l.validateSpec;if(!i.type)return[new _t(o,i,'"type" is required')];const x=Ti(i.type);let w;switch(x){case"vector":case"raster":return w=es({key:o,value:i,valueSpec:h[`source_${x.replace("-","_")}`],style:l.style,styleSpec:h,objectElementValidators:Rh,validateSpec:v}),w;case"raster-dem":return w=function(E){var P;const k=(P=E.sourceName)!==null&&P!==void 0?P:"",F=E.value,G=E.styleSpec,$=G.source_raster_dem,q=E.style;let K=[];const se=Cn(F);if(F===void 0)return K;if(se!=="object")return K.push(new _t("source_raster_dem",F,`object expected, ${se} found`)),K;const he=Ti(F.encoding)==="custom",ze=["redFactor","greenFactor","blueFactor","baseShift"],Me=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const j in F)!he&&ze.includes(j)?K.push(new _t(j,F[j],`In "${k}": "${j}" is only valid when "encoding" is set to "custom". ${Me} encoding found`)):$[j]?K=K.concat(E.validateSpec({key:j,value:F[j],valueSpec:$[j],validateSpec:E.validateSpec,style:q,styleSpec:G})):K.push(new _t(j,F[j],`unknown property "${j}"`));return K}({sourceName:o,value:i,style:l.style,styleSpec:h,validateSpec:v}),w;case"geojson":if(w=es({key:o,value:i,valueSpec:h.source_geojson,style:g,styleSpec:h,validateSpec:v,objectElementValidators:Rh}),i.cluster)for(const E in i.clusterProperties){const[P,k]=i.clusterProperties[E],F=typeof P=="string"?[P,["accumulated"],["get",E]]:P;w.push(...Co({key:`${o}.${E}.map`,value:k,expressionContext:"cluster-map"})),w.push(...Co({key:`${o}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return w;case"video":return es({key:o,value:i,valueSpec:h.source_video,style:g,validateSpec:v,styleSpec:h});case"image":return es({key:o,value:i,valueSpec:h.source_image,style:g,validateSpec:v,styleSpec:h});case"canvas":return[new _t(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wl({key:`${o}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ap(l){const i=l.value,o=l.styleSpec,h=o.light,g=l.style;let v=[];const x=Cn(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new _t("light",i,`object expected, ${x} found`)]),v;for(const w in i){const E=w.match(/^(.*)-transition$/);v=v.concat(E&&h[E[1]]&&h[E[1]].transition?l.validateSpec({key:w,value:i[w],valueSpec:o.transition,validateSpec:l.validateSpec,style:g,styleSpec:o}):h[w]?l.validateSpec({key:w,value:i[w],valueSpec:h[w],validateSpec:l.validateSpec,style:g,styleSpec:o}):[new _t(w,i[w],`unknown property "${w}"`)])}return v}function Ro(l){const i=l.value,o=l.styleSpec,h=o.sky,g=l.style,v=Cn(i);if(i===void 0)return[];if(v!=="object")return[new _t("sky",i,`object expected, ${v} found`)];let x=[];for(const w in i)x=x.concat(h[w]?l.validateSpec({key:w,value:i[w],valueSpec:h[w],style:g,styleSpec:o}):[new _t(w,i[w],`unknown property "${w}"`)]);return x}function Lh(l){const i=l.value,o=l.styleSpec,h=o.terrain,g=l.style;let v=[];const x=Cn(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new _t("terrain",i,`object expected, ${x} found`)]),v;for(const w in i)v=v.concat(h[w]?l.validateSpec({key:w,value:i[w],valueSpec:h[w],validateSpec:l.validateSpec,style:g,styleSpec:o}):[new _t(w,i[w],`unknown property "${w}"`)]);return v}function Oc(l){let i=[];const o=l.value,h=l.key;if(Array.isArray(o)){const g=[],v=[];for(const x in o)o[x].id&&g.includes(o[x].id)&&i.push(new _t(h,o,`all the sprites' ids must be unique, but ${o[x].id} is duplicated`)),g.push(o[x].id),o[x].url&&v.includes(o[x].url)&&i.push(new _t(h,o,`all the sprites' URLs must be unique, but ${o[x].url} is duplicated`)),v.push(o[x].url),i=i.concat(es({key:`${h}[${x}]`,value:o[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return i}return ls({key:h,value:o})}function Cp(l){return i=l.value,i&&i.constructor===Object?[]:[new _t(l.key,l.value,`object expected, ${Cn(l.value)} found`)];var i}const Nc={"*":()=>[],array:Fc,boolean:function(l){const i=l.value,o=l.key,h=Cn(i);return h!=="boolean"?[new _t(o,i,`boolean expected, ${h} found`)]:[]},number:bl,color:Ph,constants:Sp,enum:wl,filter:Ih,function:Ao,layer:Dr,object:es,source:Ep,light:Ap,sky:Ro,terrain:Lh,projection:function(l){const i=l.value,o=l.styleSpec,h=o.projection,g=l.style,v=Cn(i);if(i===void 0)return[];if(v!=="object")return[new _t("projection",i,`object expected, ${v} found`)];let x=[];for(const w in i)x=x.concat(h[w]?l.validateSpec({key:w,value:i[w],valueSpec:h[w],style:g,styleSpec:o}):[new _t(w,i[w],`unknown property "${w}"`)]);return x},projectionDefinition:function(l){const i=l.key;let o=l.value;o=o instanceof String?o.valueOf():o;const h=Cn(o);return h!=="array"||function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}(o)||function(g){return!!["interpolate","step","literal"].includes(g[0])}(o)?["array","string"].includes(h)?[]:[new _t(i,o,`projection expected, invalid type "${h}" found`)]:[new _t(i,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:ls,formatted:function(l){return ls(l).length===0?[]:Co(l)},resolvedImage:function(l){return ls(l).length===0?[]:Co(l)},padding:function(l){const i=l.key,o=l.value;if(Cn(o)==="array"){if(o.length<1||o.length>4)return[new _t(i,o,`padding requires 1 to 4 values; ${o.length} values found`)];const h={type:"number"};let g=[];for(let v=0;v<o.length;v++)g=g.concat(l.validateSpec({key:`${i}[${v}]`,value:o[v],validateSpec:l.validateSpec,valueSpec:h}));return g}return bl({key:i,value:o,valueSpec:{}})},numberArray:function(l){const i=l.key,o=l.value;if(Cn(o)==="array"){const h={type:"number"};if(o.length<1)return[new _t(i,o,"array length at least 1 expected, length 0 found")];let g=[];for(let v=0;v<o.length;v++)g=g.concat(l.validateSpec({key:`${i}[${v}]`,value:o[v],validateSpec:l.validateSpec,valueSpec:h}));return g}return bl({key:i,value:o,valueSpec:{}})},colorArray:function(l){const i=l.key,o=l.value;if(Cn(o)==="array"){if(o.length<1)return[new _t(i,o,"array length at least 1 expected, length 0 found")];let h=[];for(let g=0;g<o.length;g++)h=h.concat(Ph({key:`${i}[${g}]`,value:o[g]}));return h}return Ph({key:i,value:o})},variableAnchorOffsetCollection:function(l){const i=l.key,o=l.value,h=Cn(o),g=l.styleSpec;if(h!=="array"||o.length<1||o.length%2!=0)return[new _t(i,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<o.length;x+=2)v=v.concat(wl({key:`${i}[${x}]`,value:o[x],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(Fc({key:`${i}[${x+1}]`,value:o[x+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:g}));return v},sprite:Oc,state:Cp};function Uc(l){const i=l.value,o=l.valueSpec,h=l.styleSpec;return l.validateSpec=Uc,o.expression&&Ba(Ti(i))?Ao(l):o.expression&&Ic(ca(i))?Co(l):o.type&&Nc[o.type]?Nc[o.type](l):es(ki({},l,{valueSpec:o.type?h[o.type]:o}))}function Lo(l){const i=l.value,o=l.key,h=ls(l);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new _t(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new _t(o,i,'"glyphs" url must include a "{range}" token'))),h}function ts(l,i=be){let o=[];return o=o.concat(Uc({key:"",value:l,valueSpec:i.$root,styleSpec:i,style:l,validateSpec:Uc,objectElementValidators:{glyphs:Lo,"*":()=>[]}})),l.constants&&(o=o.concat(Sp({key:"constants",value:l.constants}))),Pp(o)}function cs(l){return function(i){return l({...i,validateSpec:Uc})}}function Pp(l){return[].concat(l).sort((i,o)=>i.line-o.line)}function Sr(l){return function(...i){return Pp(l.apply(this,i))}}ts.source=Sr(cs(Ep)),ts.sprite=Sr(cs(Oc)),ts.glyphs=Sr(cs(Lo)),ts.light=Sr(cs(Ap)),ts.sky=Sr(cs(Ro)),ts.terrain=Sr(cs(Lh)),ts.state=Sr(cs(Cp)),ts.layer=Sr(cs(Dr)),ts.filter=Sr(cs(Ih)),ts.paintProperty=Sr(cs(Po)),ts.layoutProperty=Sr(cs(Io));const Do=ts,Gm=Do.light,Bc=Do.sky,Hm=Do.paintProperty,Dh=Do.layoutProperty;function Sl(l,i){let o=!1;if(i&&i.length)for(const h of i)l.fire(new Ie(new Error(h.message))),o=!0;return o}class ko{constructor(i,o,h){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(o=x[1])+2*(h=x[2]);for(let E=0;E<this.d*this.d;E++){const P=x[3+E],k=x[3+E+1];g.push(P===k?null:x.subarray(P,k))}const w=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=o+2*h;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;const v=h/o*i;this.min=-v,this.max=i+v}insert(i,o,h,g,v){this._forEachCell(o,h,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,o,h,g,v,x){this.cells[v].push(x)}query(i,o,h,g,v){const x=this.min,w=this.max;if(i<=x&&o<=x&&w<=h&&w<=g&&!v)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(i,o,h,g,this._queryCell,E,{},v),E}}_queryCell(i,o,h,g,v,x,w,E){const P=this.cells[v];if(P!==null){const k=this.keys,F=this.bboxes;for(let G=0;G<P.length;G++){const $=P[G];if(w[$]===void 0){const q=4*$;(E?E(F[q+0],F[q+1],F[q+2],F[q+3]):i<=F[q+2]&&o<=F[q+3]&&h>=F[q+0]&&g>=F[q+1])?(w[$]=!0,x.push(k[$])):w[$]=!1}}}}_forEachCell(i,o,h,g,v,x,w,E){const P=this._convertToCellCoord(i),k=this._convertToCellCoord(o),F=this._convertToCellCoord(h),G=this._convertToCellCoord(g);for(let $=P;$<=F;$++)for(let q=k;q<=G;q++){const K=this.d*q+$;if((!E||E(this._convertFromCellCoord($),this._convertFromCellCoord(q),this._convertFromCellCoord($+1),this._convertFromCellCoord(q+1)))&&v.call(this,i,o,h,g,K,x,w,E))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,o=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const g=new Int32Array(o+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=o;for(let x=0;x<i.length;x++){const w=i[x];g[3+x]=v,g.set(w,v),v+=w.length}return g[3+i.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+i.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(i,o){const h=i.toArrayBuffer();return o&&o.push(h),{buffer:h}}static deserialize(i){return new ko(i.buffer)}}const Es={};function Pt(l,i,o={}){if(Es[l])throw new Error(`${l} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:l,writeable:!1}),Es[l]={klass:i,omit:o.omit||[],shallow:o.shallow||[]}}Pt("Object",Object),Pt("Set",Set),Pt("TransferableGridIndex",ko),Pt("Color",An),Pt("Error",Error),Pt("AJAXError",ue),Pt("ResolvedImage",Rr),Pt("StylePropertyFunction",yl),Pt("StyleExpression",Pc,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Lc),Pt("ZoomConstantExpression",_l),Pt("CompoundExpression",Qr,{omit:["_evaluate"]});for(const l in bo)bo[l]._classRegistryKey||Pt(`Expression_${l}`,bo[l]);function kh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Ml(l){return l.$name||l.constructor._classRegistryKey}function zh(l){return!function(i){if(i===null||typeof i!="object")return!1;const o=Ml(i);return!(!o||o==="Object")}(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||kh(l)||ve(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function Tl(l,i){if(zh(l))return(kh(l)||ve(l))&&i&&i.push(l),ArrayBuffer.isView(l)&&i&&i.push(l.buffer),l instanceof ImageData&&i&&i.push(l.data.buffer),l;if(Array.isArray(l)){const v=[];for(const x of l)v.push(Tl(x,i));return v}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const o=Ml(l);if(!o)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!Es[o])throw new Error(`${o} is not registered.`);const{klass:h}=Es[o],g=h.serialize?h.serialize(l,i):{};if(h.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in l){if(!l.hasOwnProperty(v)||Es[o].omit.indexOf(v)>=0)continue;const x=l[v];g[v]=Es[o].shallow.indexOf(v)>=0?x:Tl(x,i)}l instanceof Error&&(g.message=l.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(g.$name=o),g}function zo(l){if(zh(l))return l;if(Array.isArray(l))return l.map(zo);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const i=Ml(l)||"Object";if(!Es[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:o}=Es[i];if(!o)throw new Error(`can't deserialize unregistered class ${i}`);if(o.deserialize)return o.deserialize(l);const h=Object.create(o.prototype);for(const g of Object.keys(l)){if(g==="$name")continue;const v=l[g];h[g]=Es[i].shallow.indexOf(g)>=0?v:zo(v)}return h}class Fh{constructor(){this.first=!0}update(i,o){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=o),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const Pn={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Hangul Syllables":l=>l>=44032&&l<=55215,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function Oh(l){for(const i of l)if(Gc(i.charCodeAt(0)))return!0;return!1}function Ip(l){for(const i of l)if(!$m(i.charCodeAt(0)))return!1;return!0}function Vc(l){const i=l.map(o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}}).filter(o=>o);return new RegExp(i.join("|"),"u")}const jm=Vc(["Arab","Dupl","Mong","Ougr","Syrc"]);function $m(l){return!jm.test(String.fromCodePoint(l))}const Nh=Vc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Gc(l){return!(l!==746&&l!==747&&(l<4352||!(Pn["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Pn["CJK Compatibility"](l)||Pn["CJK Strokes"](l)||!(!Pn["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Pn["Enclosed CJK Letters and Months"](l)||Pn["Ideographic Description Characters"](l)||Pn.Kanbun(l)||Pn.Katakana(l)&&l!==12540||!(!Pn["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Pn["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Pn["Vertical Forms"](l)||Pn["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||Nh.test(String.fromCodePoint(l)))))}function Uh(l){return!(Gc(l)||function(i){return!!(Pn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Pn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Pn["Letterlike Symbols"](i)||Pn["Number Forms"](i)||Pn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Pn["Control Pictures"](i)&&i!==9251||Pn["Optical Character Recognition"](i)||Pn["Enclosed Alphanumerics"](i)||Pn["Geometric Shapes"](i)||Pn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Pn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Pn["CJK Symbols and Punctuation"](i)||Pn.Katakana(i)||Pn["Private Use Area"](i)||Pn["CJK Compatibility Forms"](i)||Pn["Small Form Variants"](i)||Pn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}const Rp=Vc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function El(l){return Rp.test(String.fromCodePoint(l))}function Wm(l,i){return!(!i&&El(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Pn.Khmer(l))}function Bh(l){for(const i of l)if(El(i.charCodeAt(0)))return!0;return!1}const ua=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(ua.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,i){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const o=l.pluginURL,h=new Promise(v=>{this.loadScriptResolve=v});i(o);const g=new Promise(v=>setTimeout(()=>v(),this.TIMEOUT));if(yield Promise.race([h,g]),this.isParsed()){const v={pluginStatus:"loaded",pluginURL:o};return this.setState(v),v}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)})}};class yi{constructor(i,o){this.zoom=i,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new Fh,this.transition=o.transition||{},this.globalState=o.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fh,this.transition={},this.globalState={})}isSupportedScript(i){return function(o,h){for(const g of o)if(!Wm(g.charCodeAt(0),h))return!1;return!0}(i,ua.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,o=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*o}}}class Al{constructor(i,o){this.property=i,this.value=o,this.expression=function(h,g){if(Ba(h))return new yl(h,g);if(Ic(h)){const v=Eh(h,g);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=h;return g.type==="color"&&typeof h=="string"?v=An.parse(h):g.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?g.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?g.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?v=Nn.parse(h):g.type==="projectionDefinition"&&typeof h=="string"&&(v=hn.parse(h)):v=$i.parse(h):v=fr.parse(h):v=zi.parse(h),{globalStateRefs:new Set,kind:"constant",evaluate:()=>v}}}(o===void 0?i.specification.default:o,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,o,h){return this.property.possiblyEvaluate(this,i,o,h)}}class Hc{constructor(i){this.property=i,this.value=new Al(i,void 0)}transitioned(i,o){return new Lp(this.property,this.value,o,Vn({},i.transition,this.transition),i.now)}untransitioned(){return new Lp(this.property,this.value,null,{},0)}}class Vh{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return gi(this._values[i].value.value)}setValue(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Hc(this._values[i].property)),this._values[i].value=new Al(this._values[i].property,o===null?void 0:gi(o))}getTransition(i){return gi(this._values[i].transition)}setTransition(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Hc(this._values[i].property)),this._values[i].transition=gi(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(i[o]=h);const g=this.getTransition(o);g!==void 0&&(i[`${o}-transition`]=g)}return i}transitioned(i,o){const h=new Dp(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(i,o._values[g]);return h}untransitioned(){const i=new Dp(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class Lp{constructor(i,o,h,g,v){this.property=i,this.value=o,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(i,o,h){const g=i.now||0,v=this.value.possiblyEvaluate(i,o,h),x=this.prior;if(x){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return x.possiblyEvaluate(i,o,h);{const w=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,o,h),v,qt(w))}}return v}}class Dp{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,h){const g=new jc(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,o,h);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class qm{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return gi(this._values[i].value)}setValue(i,o){this._values[i]=new Al(this._values[i].property,o===null?void 0:gi(o))}serialize(){const i={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(i[o]=h)}return i}possiblyEvaluate(i,o,h){const g=new jc(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,o,h);return g}}class As{constructor(i,o,h){this.property=i,this.value=o,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,o,h,g){return this.property.evaluate(this.value,this.parameters,i,o,h,g)}}class jc{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ft{constructor(i){this.specification=i}possiblyEvaluate(i,o){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(o)}interpolate(i,o,h){const g=Nr[this.specification.type];return g?g(i,o,h):i}}class rn{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,h,g){return new As(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(o,null,{},h,g)}:i.expression,o)}interpolate(i,o,h){if(i.value.kind!=="constant"||o.value.kind!=="constant")return i;if(i.value.value===void 0||o.value.value===void 0)return new As(this,{kind:"constant",value:void 0},i.parameters);const g=Nr[this.specification.type];if(g){const v=g(i.value.value,o.value.value,h);return new As(this,{kind:"constant",value:v},i.parameters)}return i}evaluate(i,o,h,g,v,x){return i.kind==="constant"?i.value:i.evaluate(o,h,g,v,x)}}class $c extends rn{possiblyEvaluate(i,o,h,g){if(i.value===void 0)return new As(this,{kind:"constant",value:void 0},o);if(i.expression.kind==="constant"){const v=i.expression.evaluate(o,null,{},h,g),x=i.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,o);return new As(this,{kind:"constant",value:w},o)}if(i.expression.kind==="camera"){const v=this._calculate(i.expression.evaluate({zoom:o.zoom-1}),i.expression.evaluate({zoom:o.zoom}),i.expression.evaluate({zoom:o.zoom+1}),o);return new As(this,{kind:"constant",value:v},o)}return new As(this,i.expression,o)}evaluate(i,o,h,g,v,x){if(i.kind==="source"){const w=i.evaluate(o,h,g,v,x);return this._calculate(w,w,w,o)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(o.zoom)-1},h,g),i.evaluate({zoom:Math.floor(o.zoom)},h,g),i.evaluate({zoom:Math.floor(o.zoom)+1},h,g),o):i.value}_calculate(i,o,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:h,to:o}}interpolate(i){return i}}class Gh{constructor(i){this.specification=i}possiblyEvaluate(i,o,h,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const v=i.expression.evaluate(o,null,{},h,g);return this._calculate(v,v,v,o)}return this._calculate(i.expression.evaluate(new yi(Math.floor(o.zoom-1),o)),i.expression.evaluate(new yi(Math.floor(o.zoom),o)),i.expression.evaluate(new yi(Math.floor(o.zoom+1),o)),o)}}_calculate(i,o,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:h,to:o}}interpolate(i){return i}}class Cl{constructor(i){this.specification=i}possiblyEvaluate(i,o,h,g){return!!i.expression.evaluate(o,null,{},h,g)}interpolate(){return!1}}class Mr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in i){const h=i[o];h.specification.overridable&&this.overridableProperties.push(o);const g=this.defaultPropertyValues[o]=new Al(h,void 0),v=this.defaultTransitionablePropertyValues[o]=new Hc(h);this.defaultTransitioningPropertyValues[o]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=g.possiblyEvaluate({})}}}Pt("DataDrivenProperty",rn),Pt("DataConstantProperty",Ft),Pt("CrossFadedDataDrivenProperty",$c),Pt("CrossFadedProperty",Gh),Pt("ColorRampProperty",Cl);const kp="-transition";class tr extends Ue{constructor(i,o){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=la(i.filter)),o.layout&&(this._unevaluatedLayout=new qm(o.layout)),o.paint)){this._transitionablePaint=new Vh(o.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jc(o.paint)}}setFilter(i){this.filter=i,this._featureFilter=la(i)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){const i=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[o];for(const g of h.getGlobalStateRefs())i.add(g)}for(const o of this._featureFilter.getGlobalStateRefs())i.add(o);return i}setLayoutProperty(i,o,h={}){o!=null&&this._validate(Dh,`layers.${this.id}.layout.${i}`,i,o,h)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,o):this.visibility=o)}getPaintProperty(i){return i.endsWith(kp)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o,h={}){if(o!=null&&this._validate(Hm,`layers.${this.id}.paint.${i}`,i,o,h))return!1;if(i.endsWith(kp))return this._transitionablePaint.setTransition(i.slice(0,-11),o||void 0),!1;{const g=this._transitionablePaint._values[i],v=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),w=g.value;this._transitionablePaint.setValue(i,o),this._handleSpecialPaintPropertyUpdate(i);const E=this._transitionablePaint._values[i].value;return E.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(i,w,E)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,o,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Fe(i,(o,h)=>!(o===void 0||h==="layout"&&!Object.keys(o).length||h==="paint"&&!Object.keys(o).length))}_validate(i,o,h,g,v={}){return(!v||v.validate!==!1)&&Sl(this,i.call(Do,{key:o,layerType:this.type,objectKey:h,value:g,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof As&&Mo(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const zp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Va{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&(i.isTransferred=!0,o.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ei(l,i=1){let o=0,h=0;return{members:l.map(g=>{const v=zp[g.type].BYTES_PER_ELEMENT,x=o=Fp(o,Math.max(i,v)),w=g.components||1;return h=Math.max(h,v),o+=v*w,{name:g.name,type:g.type,components:w,offset:x}}),size:Fp(o,Math.max(h,i)),alignment:i}}function Fp(l,i){return Math.ceil(l/i)*i}class ha extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const g=2*i;return this.int16[g+0]=o,this.int16[g+1]=h,i}}ha.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",ha);class da extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h)}emplace(i,o,h,g){const v=3*i;return this.int16[v+0]=o,this.int16[v+1]=h,this.int16[v+2]=g,i}}da.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",da);class Hh extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,o,h,g)}emplace(i,o,h,g,v){const x=4*i;return this.int16[x+0]=o,this.int16[x+1]=h,this.int16[x+2]=g,this.int16[x+3]=v,i}}Hh.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Hh);class Wc extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,h,g,v,x)}emplace(i,o,h,g,v,x,w){const E=6*i;return this.int16[E+0]=o,this.int16[E+1]=h,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}Wc.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4i12",Wc);class Ga extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,h,g,v,x)}emplace(i,o,h,g,v,x,w){const E=4*i,P=8*i;return this.int16[E+0]=o,this.int16[E+1]=h,this.uint8[P+4]=g,this.uint8[P+5]=v,this.uint8[P+6]=x,this.uint8[P+7]=w,i}}Ga.prototype.bytesPerElement=8,Pt("StructArrayLayout2i4ub8",Ga);class Pl extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const g=2*i;return this.float32[g+0]=o,this.float32[g+1]=h,i}}Pl.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",Pl);class jh extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x,w,E,P,k){const F=this.length;return this.resize(F+1),this.emplace(F,i,o,h,g,v,x,w,E,P,k)}emplace(i,o,h,g,v,x,w,E,P,k,F){const G=10*i;return this.uint16[G+0]=o,this.uint16[G+1]=h,this.uint16[G+2]=g,this.uint16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=E,this.uint16[G+7]=P,this.uint16[G+8]=k,this.uint16[G+9]=F,i}}jh.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",jh);class qc extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x,w,E,P,k,F,G){const $=this.length;return this.resize($+1),this.emplace($,i,o,h,g,v,x,w,E,P,k,F,G)}emplace(i,o,h,g,v,x,w,E,P,k,F,G,$){const q=12*i;return this.int16[q+0]=o,this.int16[q+1]=h,this.int16[q+2]=g,this.int16[q+3]=v,this.uint16[q+4]=x,this.uint16[q+5]=w,this.uint16[q+6]=E,this.uint16[q+7]=P,this.int16[q+8]=k,this.int16[q+9]=F,this.int16[q+10]=G,this.int16[q+11]=$,i}}qc.prototype.bytesPerElement=24,Pt("StructArrayLayout4i4ui4i24",qc);class $h extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h)}emplace(i,o,h,g){const v=3*i;return this.float32[v+0]=o,this.float32[v+1]=h,this.float32[v+2]=g,i}}$h.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",$h);class _ extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}_.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",_);class t extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x,w,E,P){const k=this.length;return this.resize(k+1),this.emplace(k,i,o,h,g,v,x,w,E,P)}emplace(i,o,h,g,v,x,w,E,P,k){const F=10*i,G=5*i;return this.int16[F+0]=o,this.int16[F+1]=h,this.int16[F+2]=g,this.int16[F+3]=v,this.int16[F+4]=x,this.int16[F+5]=w,this.uint32[G+3]=E,this.uint16[F+8]=P,this.uint16[F+9]=k,i}}t.prototype.bytesPerElement=20,Pt("StructArrayLayout6i1ul2ui20",t);class a extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,h,g,v,x)}emplace(i,o,h,g,v,x,w){const E=6*i;return this.int16[E+0]=o,this.int16[E+1]=h,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}a.prototype.bytesPerElement=12,Pt("StructArrayLayout2i2i2i12",a);class d extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,h,g,v)}emplace(i,o,h,g,v,x){const w=4*i,E=8*i;return this.float32[w+0]=o,this.float32[w+1]=h,this.float32[w+2]=g,this.int16[E+6]=v,this.int16[E+7]=x,i}}d.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",d);class m extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,o,h,g,v,x)}emplace(i,o,h,g,v,x,w){const E=16*i,P=4*i,k=8*i;return this.uint8[E+0]=o,this.uint8[E+1]=h,this.float32[P+1]=g,this.float32[P+2]=v,this.int16[k+6]=x,this.int16[k+7]=w,i}}m.prototype.bytesPerElement=16,Pt("StructArrayLayout2ub2f2i16",m);class y extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h)}emplace(i,o,h,g){const v=3*i;return this.uint16[v+0]=o,this.uint16[v+1]=h,this.uint16[v+2]=g,i}}y.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",y);class b extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he){const ze=this.length;return this.resize(ze+1),this.emplace(ze,i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he)}emplace(i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he,ze){const Me=24*i,j=12*i,re=48*i;return this.int16[Me+0]=o,this.int16[Me+1]=h,this.uint16[Me+2]=g,this.uint16[Me+3]=v,this.uint32[j+2]=x,this.uint32[j+3]=w,this.uint32[j+4]=E,this.uint16[Me+10]=P,this.uint16[Me+11]=k,this.uint16[Me+12]=F,this.float32[j+7]=G,this.float32[j+8]=$,this.uint8[re+36]=q,this.uint8[re+37]=K,this.uint8[re+38]=se,this.uint32[j+10]=he,this.int16[Me+22]=ze,i}}b.prototype.bytesPerElement=48,Pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",b);class T extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he,ze,Me,j,re,Pe,$e,st,Ye,Qe,gt,lt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he,ze,Me,j,re,Pe,$e,st,Ye,Qe,gt,lt)}emplace(i,o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he,ze,Me,j,re,Pe,$e,st,Ye,Qe,gt,lt,yt){const et=32*i,zt=16*i;return this.int16[et+0]=o,this.int16[et+1]=h,this.int16[et+2]=g,this.int16[et+3]=v,this.int16[et+4]=x,this.int16[et+5]=w,this.int16[et+6]=E,this.int16[et+7]=P,this.uint16[et+8]=k,this.uint16[et+9]=F,this.uint16[et+10]=G,this.uint16[et+11]=$,this.uint16[et+12]=q,this.uint16[et+13]=K,this.uint16[et+14]=se,this.uint16[et+15]=he,this.uint16[et+16]=ze,this.uint16[et+17]=Me,this.uint16[et+18]=j,this.uint16[et+19]=re,this.uint16[et+20]=Pe,this.uint16[et+21]=$e,this.uint16[et+22]=st,this.uint32[zt+12]=Ye,this.float32[zt+13]=Qe,this.float32[zt+14]=gt,this.uint16[et+30]=lt,this.uint16[et+31]=yt,i}}T.prototype.bytesPerElement=64,Pt("StructArrayLayout8i15ui1ul2f2ui64",T);class A extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}A.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",A);class D extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h)}emplace(i,o,h,g){const v=3*i;return this.uint16[6*i+0]=o,this.float32[v+1]=h,this.float32[v+2]=g,i}}D.prototype.bytesPerElement=12,Pt("StructArrayLayout1ui2f12",D);class z extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h)}emplace(i,o,h,g){const v=4*i;return this.uint32[2*i+0]=o,this.uint16[v+2]=h,this.uint16[v+3]=g,i}}z.prototype.bytesPerElement=8,Pt("StructArrayLayout1ul2ui8",z);class U extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const g=2*i;return this.uint16[g+0]=o,this.uint16[g+1]=h,i}}U.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",U);class N extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}N.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",N);class H extends bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,o,h,g)}emplace(i,o,h,g,v){const x=4*i;return this.float32[x+0]=o,this.float32[x+1]=h,this.float32[x+2]=g,this.float32[x+3]=v,i}}H.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",H);class Y extends Va{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}Y.prototype.size=20;class oe extends t{get(i){return new Y(this,i)}}Pt("CollisionBoxArray",oe);class ae extends Va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class le extends b{get(i){return new ae(this,i)}}Pt("PlacedSymbolArray",le);class pe extends Va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pe.prototype.size=64;class Ae extends T{get(i){return new pe(this,i)}}Pt("SymbolInstanceArray",Ae);class we extends A{getoffsetX(i){return this.float32[1*i+0]}}Pt("GlyphOffsetArray",we);class Re extends da{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Pt("SymbolLineVertexArray",Re);class Le extends Va{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Le.prototype.size=12;class Se extends D{get(i){return new Le(this,i)}}Pt("TextAnchorOffsetArray",Se);class Ne extends Va{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ne.prototype.size=8;class qe extends z{get(i){return new Ne(this,i)}}Pt("FeatureIndexArray",qe);class He extends ha{}class je extends ha{}class Xe extends ha{}class St extends Wc{}class xt extends Ga{}class at extends Pl{}class kt extends jh{}class _n extends qc{}class Yn extends $h{}class wi extends _{}class si extends a{}class Si extends m{}class li extends y{}class ai extends U{}const ci=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:nr}=ci;class Gn{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,o,h,g){const v=this.segments[this.segments.length-1];return i>Gn.MAX_VERTEX_ARRAY_LENGTH&&cn(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Gn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!v||v.vertexLength+i>Gn.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g?this.createNewSegment(o,h,g):v}createNewSegment(i,o,h){const g={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(g.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(i,o,h){return this.prepareSegment(0,i,o,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,h,g){return new Gn([{vertexOffset:i,primitiveOffset:o,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function qi(l,i){return 256*(l=Xt(Math.floor(l),0,255))+Xt(Math.floor(i),0,255)}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",Gn);const ir=Ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var pa,fa,ma,Cs={exports:{}},Il={exports:{}},Rl={exports:{}},Fo=function(){if(ma)return Cs.exports;ma=1;var l=(pa||(pa=1,Il.exports=function(o,h){var g,v,x,w,E,P,k,F;for(v=o.length-(g=3&o.length),x=h,E=3432918353,P=461845907,F=0;F<v;)k=255&o.charCodeAt(F)|(255&o.charCodeAt(++F))<<8|(255&o.charCodeAt(++F))<<16|(255&o.charCodeAt(++F))<<24,++F,x=27492+(65535&(w=5*(65535&(x=(x^=k=(65535&(k=(k=(65535&k)*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*P+(((k>>>16)*P&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(k=0,g){case 3:k^=(255&o.charCodeAt(F+2))<<16;case 2:k^=(255&o.charCodeAt(F+1))<<8;case 1:x^=k=(65535&(k=(k=(65535&(k^=255&o.charCodeAt(F)))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*P+(((k>>>16)*P&65535)<<16)&4294967295}return x^=o.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Il.exports),i=(fa||(fa=1,Rl.exports=function(o,h){for(var g,v=o.length,x=h^v,w=0;v>=4;)g=1540483477*(65535&(g=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(g>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),v-=4,++w;switch(v){case 3:x^=(255&o.charCodeAt(w+2))<<16;case 2:x^=(255&o.charCodeAt(w+1))<<8;case 1:x=1540483477*(65535&(x^=255&o.charCodeAt(w)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Rl.exports);return Cs.exports=l,Cs.exports.murmur3=l,Cs.exports.murmur2=i,Cs.exports}(),kr=S(Fo);class us{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,o,h,g){this.ids.push(ga(i)),this.positions.push(o,h,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=ga(i);let h=0,g=this.ids.length-1;for(;h<g;){const x=h+g>>1;this.ids[x]>=o?g=x:h=x+1}const v=[];for(;this.ids[h]===o;)v.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return v}static serialize(i,o){const h=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Ha(h,g,0,h.length-1),o&&o.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(i){const o=new us;return o.ids=i.ids,o.positions=i.positions,o.indexed=!0,o}}function ga(l){const i=+l;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:kr(String(l))}function Ha(l,i,o,h){for(;o<h;){const g=l[o+h>>1];let v=o-1,x=h+1;for(;;){do v++;while(l[v]<g);do x--;while(l[x]>g);if(v>=x)break;Ci(l,v,x),Ci(i,3*v,3*x),Ci(i,3*v+1,3*x+1),Ci(i,3*v+2,3*x+2)}x-o<h-x?(Ha(l,i,o,x),o=x+1):(Ha(l,i,x+1,h),h=x)}}function Ci(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}Pt("FeaturePositionMap",us);class pi{constructor(i,o){this.gl=i.gl,this.location=o}}class Tr extends pi{constructor(i,o){super(i,o),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Bi extends pi{constructor(i,o){super(i,o),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Op extends pi{constructor(i,o){super(i,o),this.current=An.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Zm=new Float32Array(16);function Wh(l){return[qi(255*l.r,255*l.g),qi(255*l.b,255*l.a)]}class Ll{constructor(i,o,h){this.value=i,this.uniformNames=o.map(g=>`u_${g}`),this.type=h}setUniform(i,o,h){i.set(h.constantOr(this.value))}getBinding(i,o,h){return this.type==="color"?new Op(i,o):new Tr(i,o)}}class Oo{constructor(i,o){this.uniformNames=o.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=i.tlbr}setUniform(i,o,h,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,o,h){return h.substr(0,9)==="u_pattern"?new Bi(i,o):new Tr(i,o)}}class Us{constructor(i,o,h,g){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,o,h,g,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new yi(0),o,{},g,[],v);this.paintVertexArray.resize(i),this._setPaintValue(x,i,w)}updatePaintArray(i,o,h,g){const v=this.expression.evaluate({zoom:0},h,g);this._setPaintValue(i,o,v)}_setPaintValue(i,o,h){if(this.type==="color"){const g=Wh(h);for(let v=i;v<o;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rr{constructor(i,o,h,g,v,x){this.expression=i,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,o,h,g,v){const x=this.expression.evaluate(new yi(this.zoom),o,{},g,[],v),w=this.expression.evaluate(new yi(this.zoom+1),o,{},g,[],v),E=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(E,i,x,w)}updatePaintArray(i,o,h,g){const v=this.expression.evaluate({zoom:this.zoom},h,g),x=this.expression.evaluate({zoom:this.zoom+1},h,g);this._setPaintValue(i,o,v,x)}_setPaintValue(i,o,h,g){if(this.type==="color"){const v=Wh(h),x=Wh(g);for(let w=i;w<o;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=i;v<o;v++)this.paintVertexArray.emplace(v,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Xt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,o,h){return new Tr(i,o)}}class Bs{constructor(i,o,h,g,v,x){this.expression=i,this.type=o,this.useIntegerZoom=h,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,o,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,o.patterns&&o.patterns[this.layerId],h)}updatePaintArray(i,o,h,g,v){this._setPaintValues(i,o,h.patterns&&h.patterns[this.layerId],v)}_setPaintValues(i,o,h,g){if(!g||!h)return;const{min:v,mid:x,max:w}=h,E=g[v],P=g[x],k=g[w];if(E&&P&&k)for(let F=i;F<o;F++)this.zoomInPaintVertexArray.emplace(F,P.tl[0],P.tl[1],P.br[0],P.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],P.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,P.tl[0],P.tl[1],P.br[0],P.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],P.pixelRatio,k.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,ir.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,ir.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qh{constructor(i,o,h){this.binders={},this._buffers=[];const g=[];for(const v in i.paint._values){if(!h(v))continue;const x=i.paint.get(v);if(!(x instanceof As&&Mo(x.property.specification)))continue;const w=Zh(v,i.type),E=x.value,P=x.property.specification.type,k=x.property.useIntegerZoom,F=x.property.specification["property-type"],G=F==="cross-faded"||F==="cross-faded-data-driven";if(E.kind==="constant")this.binders[v]=G?new Oo(E.value,w):new Ll(E.value,w,P),g.push(`/u_${v}`);else if(E.kind==="source"||G){const $=Xh(v,P,"source");this.binders[v]=G?new Bs(E,P,k,o,$,i.id):new Us(E,w,P,$),g.push(`/a_${v}`)}else{const $=Xh(v,P,"composite");this.binders[v]=new rr(E,w,P,k,o,$),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof Us||o instanceof rr?o.maxValue:0}populatePaintArrays(i,o,h,g,v){for(const x in this.binders){const w=this.binders[x];(w instanceof Us||w instanceof rr||w instanceof Bs)&&w.populatePaintArray(i,o,h,g,v)}}setConstantPatternPositions(i,o){for(const h in this.binders){const g=this.binders[h];g instanceof Oo&&g.setConstantPatternPositions(i,o)}}updatePaintArrays(i,o,h,g,v){let x=!1;for(const w in i){const E=o.getPositions(w);for(const P of E){const k=h.feature(P.index);for(const F in this.binders){const G=this.binders[F];if((G instanceof Us||G instanceof rr||G instanceof Bs)&&G.expression.isStateDependent===!0){const $=g.paint.get(F);G.expression=$.value,G.updatePaintArray(P.start,P.end,k,i[w],v),x=!0}}}}return x}defines(){const i=[];for(const o in this.binders){const h=this.binders[o];(h instanceof Ll||h instanceof Oo)&&i.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof Us||h instanceof rr)for(let g=0;g<h.paintVertexAttributes.length;g++)i.push(h.paintVertexAttributes[g].name);else if(h instanceof Bs)for(let g=0;g<ir.members.length;g++)i.push(ir.members[g].name)}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof Ll||h instanceof Oo||h instanceof rr)for(const g of h.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,o){const h=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof Ll||v instanceof Oo||v instanceof rr){for(const x of v.uniformNames)if(o[x]){const w=v.getBinding(i,o[x],x);h.push({name:x,property:g,binding:w})}}}return h}setUniforms(i,o,h,g){for(const{name:v,property:x,binding:w}of o)this.binders[x].setUniform(w,g,h.get(x),v)}updatePaintBuffers(i){this._buffers=[];for(const o in this.binders){const h=this.binders[o];if(i&&h instanceof Bs){const g=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof Us||h instanceof rr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const o in this.binders){const h=this.binders[o];(h instanceof Us||h instanceof rr||h instanceof Bs)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof Us||o instanceof rr||o instanceof Bs)&&o.destroy()}}}class _a{constructor(i,o,h=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new qh(g,o,h);this.needsUpload=!1,this._featureMap=new us,this._bufferOffset=0}populatePaintArrays(i,o,h,g,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,o,g,v,x);o.id!==void 0&&this._featureMap.add(o.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,h,g){for(const v of h)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,o,v,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Zh(l,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}function Xh(l,i,o){const h={color:{source:Pl,composite:H},number:{source:A,composite:Pl}},g=function(v){return{"line-pattern":{source:kt,composite:kt},"fill-pattern":{source:kt,composite:kt},"fill-extrusion-pattern":{source:kt,composite:kt}}[v]}(l);return g&&g[o]||h[i][o]}Pt("ConstantBinder",Ll),Pt("CrossFadedConstantBinder",Oo),Pt("SourceExpressionBinder",Us),Pt("CrossFadedCompositeBinder",Bs),Pt("CompositeExpressionBinder",rr),Pt("ProgramConfiguration",qh,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",_a);const Dl=Math.pow(2,14)-1,Cv=-Dl-1;function kl(l){const i=$t/l.extent,o=l.loadGeometry();for(let h=0;h<o.length;h++){const g=o[h];for(let v=0;v<g.length;v++){const x=g[v],w=Math.round(x.x*i),E=Math.round(x.y*i);x.x=Xt(w,Cv,Dl),x.y=Xt(E,Cv,Dl),(w<x.x||w>x.x+1||E<x.y||E>x.y+1)&&cn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function zl(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?kl(l):[]}}const Pv=-32768;function kS(l,i,o,h,g){l.emplaceBack(Pv+8*i+h,Pv+8*o+g)}class Xm{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new je,this.indexArray=new li,this.segments=new Gn,this.programConfigurations=new _a(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,h){const g=this.layers[0],v=[];let x=null,w=!1,E=g.type==="heatmap";if(g.type==="circle"){const k=g;x=k.layout.get("circle-sort-key"),w=!x.isConstant(),E=E||k.paint.get("circle-pitch-alignment")==="map"}const P=E?o.subdivisionGranularity.circle:1;for(const{feature:k,id:F,index:G,sourceLayerIndex:$}of i){const q=this.layers[0]._featureFilter.needGeometry,K=zl(k,q);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom,{globalState:this.globalState}),K,h))continue;const se=w?x.evaluate(K,{},h):void 0,he={id:F,properties:k.properties,type:k.type,sourceLayerIndex:$,index:G,geometry:q?K.geometry:kl(k),patterns:{},sortKey:se};v.push(he)}w&&v.sort((k,F)=>k.sortKey-F.sortKey);for(const k of v){const{geometry:F,index:G,sourceLayerIndex:$}=k,q=i[G].feature;this.addFeature(k,F,G,h,P),o.featureIndex.insert(q,F,G,$,this.index)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,nr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,h,g,v=1){let x;switch(v){case 1:x=[0,7];break;case 3:x=[0,2,5,7];break;case 5:x=[0,1,3,4,6,7];break;case 7:x=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${v}; valid values are 1, 3, 5, 7.`)}const w=x.length;for(const E of o)for(const P of E){const k=P.x,F=P.y;if(k<0||k>=$t||F<0||F>=$t)continue;const G=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,i.sortKey),$=G.vertexLength;for(let q=0;q<w;q++)for(let K=0;K<w;K++)kS(this.layoutVertexArray,k,F,x[K],x[q]);for(let q=0;q<w-1;q++)for(let K=0;K<w-1;K++){const se=$+q*w+K,he=$+(q+1)*w+K;this.indexArray.emplaceBack(se,he+1,se+1),this.indexArray.emplaceBack(se,he,he+1)}G.vertexLength+=w*w,G.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},g)}}function Iv(l,i){for(let o=0;o<l.length;o++)if(Zc(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(Zc(l,i[o]))return!0;return!!Ym(l,i)}function zS(l,i,o){return!!Zc(l,i)||!!Km(i,l,o)}function Rv(l,i){if(l.length===1)return Dv(i,l[0]);for(let o=0;o<i.length;o++){const h=i[o];for(let g=0;g<h.length;g++)if(Zc(l,h[g]))return!0}for(let o=0;o<l.length;o++)if(Dv(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(Ym(l,i[o]))return!0;return!1}function FS(l,i,o){if(l.length>1){if(Ym(l,i))return!0;for(let h=0;h<i.length;h++)if(Km(i[h],l,o))return!0}for(let h=0;h<l.length;h++)if(Km(l[h],i,o))return!0;return!1}function Ym(l,i){if(l.length===0||i.length===0)return!1;for(let o=0;o<l.length-1;o++){const h=l[o],g=l[o+1];for(let v=0;v<i.length-1;v++)if(OS(h,g,i[v],i[v+1]))return!0}return!1}function OS(l,i,o,h){return Zt(l,o,h)!==Zt(i,o,h)&&Zt(l,i,o)!==Zt(l,i,h)}function Km(l,i,o){const h=o*o;if(i.length===1)return l.distSqr(i[0])<h;for(let g=1;g<i.length;g++)if(Lv(l,i[g-1],i[g])<h)return!0;return!1}function Lv(l,i,o){const h=i.distSqr(o);if(h===0)return l.distSqr(i);const g=((l.x-i.x)*(o.x-i.x)+(l.y-i.y)*(o.y-i.y))/h;return l.distSqr(g<0?i:g>1?o:o.sub(i)._mult(g)._add(i))}function Dv(l,i){let o,h,g,v=!1;for(let x=0;x<l.length;x++){o=l[x];for(let w=0,E=o.length-1;w<o.length;E=w++)h=o[w],g=o[E],h.y>i.y!=g.y>i.y&&i.x<(g.x-h.x)*(i.y-h.y)/(g.y-h.y)+h.x&&(v=!v)}return v}function Zc(l,i){let o=!1;for(let h=0,g=l.length-1;h<l.length;g=h++){const v=l[h],x=l[g];v.y>i.y!=x.y>i.y&&i.x<(x.x-v.x)*(i.y-v.y)/(x.y-v.y)+v.x&&(o=!o)}return o}function NS(l,i,o){const h=o[0],g=o[2];if(l.x<h.x&&i.x<h.x||l.x>g.x&&i.x>g.x||l.y<h.y&&i.y<h.y||l.y>g.y&&i.y>g.y)return!1;const v=Zt(l,i,o[0]);return v!==Zt(l,i,o[1])||v!==Zt(l,i,o[2])||v!==Zt(l,i,o[3])}function Yh(l,i,o){const h=i.paint.get(l).value;return h.kind==="constant"?h.value:o.programConfigurations.get(i.id).getMaxValue(l)}function Np(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Up(l,i,o,h,g){if(!i[0]&&!i[1])return l;const v=B.convert(i)._mult(g);o==="viewport"&&v._rotate(-h);const x=[];for(let w=0;w<l.length;w++)x.push(l[w].sub(v));return x}let kv,zv;Pt("CircleBucket",Xm,{omit:["layers"]});var US={get paint(){return zv=zv||new Mr({"circle-radius":new rn(be.paint_circle["circle-radius"]),"circle-color":new rn(be.paint_circle["circle-color"]),"circle-blur":new rn(be.paint_circle["circle-blur"]),"circle-opacity":new rn(be.paint_circle["circle-opacity"]),"circle-translate":new Ft(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rn(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rn(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rn(be.paint_circle["circle-stroke-opacity"])})},get layout(){return kv=kv||new Mr({"circle-sort-key":new rn(be.layout_circle["circle-sort-key"])})}};class BS extends tr{constructor(i){super(i,US)}createBucket(i){return new Xm(i)}queryRadius(i){const o=i;return Yh("circle-radius",this,o)+Yh("circle-stroke-width",this,o)+Np(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:g,transform:v,pixelsToTileUnits:x,unwrappedTileID:w,getElevation:E}){const P=Up(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-v.bearingInRadians,x),k=this.paint.get("circle-radius").evaluate(o,h)+this.paint.get("circle-stroke-width").evaluate(o,h),F=this.paint.get("circle-pitch-alignment")==="map",G=F?P:function(q,K,se,he){return q.map(ze=>Fv(ze,K,se,he))}(P,v,w,E),$=F?k*x:k;for(const q of g)for(const K of q){const se=F?K:Fv(K,v,w,E);let he=$;const ze=v.projectTileCoordinates(K.x,K.y,w,E).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=ze/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=v.cameraToCenterDistance/ze),zS(G,se,he))return!0}return!1}}function Fv(l,i,o,h){const g=i.projectTileCoordinates(l.x,l.y,o,h).point;return new B((.5*g.x+.5)*i.width,(.5*-g.y+.5)*i.height)}class Ov extends Xm{}let Nv;Pt("HeatmapBucket",Ov,{omit:["layers"]});var VS={get paint(){return Nv=Nv||new Mr({"heatmap-radius":new rn(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rn(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cl(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(be.paint_heatmap["heatmap-opacity"])})}};function Jm(l,{width:i,height:o},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*o*h)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*o*h}`)}else g=new Uint8Array(i*o*h);return l.width=i,l.height=o,l.data=g,l}function Uv(l,{width:i,height:o},h){if(i===l.width&&o===l.height)return;const g=Jm({},{width:i,height:o},h);Qm(l,g,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,i),height:Math.min(l.height,o)},h),l.width=i,l.height=o,l.data=g.data}function Qm(l,i,o,h,g,v){if(g.width===0||g.height===0)return i;if(g.width>l.width||g.height>l.height||o.x>l.width-g.width||o.y>l.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||h.x>i.width-g.width||h.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=l.data,w=i.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<g.height;E++){const P=((o.y+E)*l.width+o.x)*v,k=((h.y+E)*i.width+h.x)*v;for(let F=0;F<g.width*v;F++)w[k+F]=x[P+F]}return i}class Kh{constructor(i,o){Jm(this,i,1,o)}resize(i){Uv(this,i,1)}clone(){return new Kh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,h,g,v){Qm(i,o,h,g,v,1)}}class Ur{constructor(i,o){Jm(this,i,4,o)}resize(i){Uv(this,i,4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,h,g,v){Qm(i,o,h,g,v,4)}setPixel(i,o,h){const g=4*(i*this.width+o);this.data[g+0]=Math.round(255*h.r/h.a),this.data[g+1]=Math.round(255*h.g/h.a),this.data[g+2]=Math.round(255*h.b/h.a),this.data[g+3]=Math.round(255*h.a)}}function Bv(l){const i={},o=l.resolution||256,h=l.clips?l.clips.length:1,g=l.image||new Ur({width:o,height:h});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const v=(x,w,E)=>{i[l.evaluationKey]=E;const P=l.expression.evaluate(i);g.setPixel(x/4/o,w/4,P)};if(l.clips)for(let x=0,w=0;x<h;++x,w+=4*o)for(let E=0,P=0;E<o;E++,P+=4){const k=E/(o-1),{start:F,end:G}=l.clips[x];v(w,P,F*(1-k)+G*k)}else for(let x=0,w=0;x<o;x++,w+=4)v(0,w,x/(o-1));return g}Pt("AlphaImage",Kh),Pt("RGBAImage",Ur);const eg="big-fb";class GS extends tr{createBucket(i){return new Ov(i)}constructor(i){super(i,VS),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(eg)&&this.heatmapFbos.delete(eg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Vv;var HS={get paint(){return Vv=Vv||new Mr({"hillshade-illumination-direction":new Ft(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ft(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ft(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ft(be.paint_hillshade["hillshade-method"])})}};class jS extends tr{constructor(i){super(i,HS),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const v=Math.max(i.length,o.length,h.length,g.length);i=i.concat(Array(v-i.length).fill(i.at(-1))),o=o.concat(Array(v-o.length).fill(o.at(-1))),h=h.concat(Array(v-h.length).fill(h.at(-1))),g=g.concat(Array(v-g.length).fill(g.at(-1)));const x=o.map(Vt);return{directionRadians:i.map(Vt),altitudeRadians:x,shadowColor:g,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Gv;var $S={get paint(){return Gv=Gv||new Mr({"color-relief-opacity":new Ft(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Cl(be["paint_color-relief"]["color-relief-color"])})}};class tg{constructor(i,o,h,g){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,g)}update(i,o,h){const{width:g,height:v}=i,x=!(this.size&&this.size[0]===g&&this.size[1]===v||h),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[g,v],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ve(i)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,i):E.texImage2D(E.TEXTURE_2D,0,this.format,g,v,0,this.format,E.UNSIGNED_BYTE,i.data);else{const{x:P,y:k}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ve(i)?E.texSubImage2D(E.TEXTURE_2D,0,P,k,E.RGBA,E.UNSIGNED_BYTE,i):E.texSubImage2D(E.TEXTURE_2D,0,P,k,g,v,E.RGBA,E.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,o,h){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),h!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=v.LINEAR),i!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Hv{constructor(i,o,h,g=1,v=1,x=1,w=0){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void cn(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const E=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<E;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(E,P)]=this.data[this._idx(E-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,E)]=this.data[this._idx(P,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<E;P++)for(let k=0;k<E;k++){const F=this.get(P,k);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(i,o){const h=new Uint8Array(this.data.buffer),g=4*this._idx(i,o);return this.unpack(h[g],h[g+1],h[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}unpack(i,o,h){return i*this.redFactor+o*this.greenFactor+h*this.blueFactor-this.baseShift}pack(i){return jv(i,this.getUnpackVector())}getPixels(){return new Ur({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,o,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=o*this.dim,v=o*this.dim+this.dim,x=h*this.dim,w=h*this.dim+this.dim;switch(o){case-1:g=v-1;break;case 1:v=g+1}switch(h){case-1:x=w-1;break;case 1:w=x+1}const E=-o*this.dim,P=-h*this.dim;for(let k=x;k<w;k++)for(let F=g;F<v;F++)this.data[this._idx(F,k)]=i.data[this._idx(F+E,k+P)]}}function jv(l,i){const o=i[0],h=i[1],g=i[2],v=i[3],x=Math.min(o,h,g),w=Math.round((l+v)/x);return{r:Math.floor(w*x/o)%256,g:Math.floor(w*x/h)%256,b:Math.floor(w*x/g)%256}}Pt("DEMData",Hv);class WS extends tr{constructor(i){super(i,$S)}_createColorRamp(i){const o={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof _l&&h._styleExpression.expression instanceof wr){this.colorRampExpression=h;const x=h._styleExpression.expression;o.elevationStops=x.labels,o.colorStops=[];for(const w of o.elevationStops)o.colorStops.push(x.evaluate({globals:{elevation:w}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[An.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=i)return o;const g={elevationStops:[],colorStops:[]},v=(o.elevationStops.length-1)/(i-1);for(let x=0;x<o.elevationStops.length-.5;x+=v)g.elevationStops.push(o.elevationStops[Math.round(x)]),g.colorStops.push(o.colorStops[Math.round(x)]);return cn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,o,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(o),v=new Ur({width:g.colorStops.length,height:1}),x=new Ur({width:g.colorStops.length,height:1});for(let w=0;w<g.elevationStops.length;w++){const E=jv(g.elevationStops[w],h);x.setPixel(0,w,new An(E.r/255,E.g/255,E.b/255,1)),v.setPixel(0,w,g.colorStops[w])}return this.colorRampTextures={elevationTexture:new tg(i,x,i.gl.RGBA),colorTexture:new tg(i,v,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const qS=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZS}=qS;function ng(l,i,o){const h=o.patternDependencies;let g=!1;for(const v of i){const x=v.paint.get(`${l}-pattern`);x.isConstant()||(g=!0);const w=x.constantOr(null);w&&(g=!0,h[w.to]=!0,h[w.from]=!0)}return g}function ig(l,i,o,h,g){const v=g.patternDependencies;for(const x of i){const w=x.paint.get(`${l}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:h-1},o,{},g.availableImages),P=w.evaluate({zoom:h},o,{},g.availableImages),k=w.evaluate({zoom:h+1},o,{},g.availableImages);E=E&&E.name?E.name:E,P=P&&P.name?P.name:P,k=k&&k.name?k.name:k,v[E]=!0,v[P]=!0,v[k]=!0,o.patterns[x.id]={min:E,mid:P,max:k}}}return o}function $v(l,i,o,h,g){let v;if(g===function(x,w,E,P){let k=0;for(let F=w,G=E-P;F<E;F+=P)k+=(x[G]-x[F])*(x[F+1]+x[G+1]),G=F;return k}(l,i,o,h)>0)for(let x=i;x<o;x+=h)v=Xv(x/h|0,l[x],l[x+1],v);else for(let x=o-h;x>=i;x-=h)v=Xv(x/h|0,l[x],l[x+1],v);return v&&Xc(v,v.next)&&(td(v),v=v.next),v}function Fl(l,i){if(!l)return l;i||(i=l);let o,h=l;do if(o=!1,h.steiner||!Xc(h,h.next)&&Ri(h.prev,h,h.next)!==0)h=h.next;else{if(td(h),h=i=h.prev,h===h.next)break;o=!0}while(o||h!==i);return i}function Jh(l,i,o,h,g,v,x){if(!l)return;!x&&v&&function(E,P,k,F){let G=E;do G.z===0&&(G.z=rg(G.x,G.y,P,k,F)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==E);G.prevZ.nextZ=null,G.prevZ=null,function($){let q,K=1;do{let se,he=$;$=null;let ze=null;for(q=0;he;){q++;let Me=he,j=0;for(let Pe=0;Pe<K&&(j++,Me=Me.nextZ,Me);Pe++);let re=K;for(;j>0||re>0&&Me;)j!==0&&(re===0||!Me||he.z<=Me.z)?(se=he,he=he.nextZ,j--):(se=Me,Me=Me.nextZ,re--),ze?ze.nextZ=se:$=se,se.prevZ=ze,ze=se;he=Me}ze.nextZ=null,K*=2}while(q>1)}(G)}(l,h,g,v);let w=l;for(;l.prev!==l.next;){const E=l.prev,P=l.next;if(v?YS(l,h,g,v):XS(l))i.push(E.i,l.i,P.i),td(l),l=P.next,w=P.next;else if((l=P)===w){x?x===1?Jh(l=KS(Fl(l),i),i,o,h,g,v,2):x===2&&JS(l,i,o,h,g,v):Jh(Fl(l),i,o,h,g,v,1);break}}}function XS(l){const i=l.prev,o=l,h=l.next;if(Ri(i,o,h)>=0)return!1;const g=i.x,v=o.x,x=h.x,w=i.y,E=o.y,P=h.y,k=Math.min(g,v,x),F=Math.min(w,E,P),G=Math.max(g,v,x),$=Math.max(w,E,P);let q=h.next;for(;q!==i;){if(q.x>=k&&q.x<=G&&q.y>=F&&q.y<=$&&Qh(g,w,v,E,x,P,q.x,q.y)&&Ri(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function YS(l,i,o,h){const g=l.prev,v=l,x=l.next;if(Ri(g,v,x)>=0)return!1;const w=g.x,E=v.x,P=x.x,k=g.y,F=v.y,G=x.y,$=Math.min(w,E,P),q=Math.min(k,F,G),K=Math.max(w,E,P),se=Math.max(k,F,G),he=rg($,q,i,o,h),ze=rg(K,se,i,o,h);let Me=l.prevZ,j=l.nextZ;for(;Me&&Me.z>=he&&j&&j.z<=ze;){if(Me.x>=$&&Me.x<=K&&Me.y>=q&&Me.y<=se&&Me!==g&&Me!==x&&Qh(w,k,E,F,P,G,Me.x,Me.y)&&Ri(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,j.x>=$&&j.x<=K&&j.y>=q&&j.y<=se&&j!==g&&j!==x&&Qh(w,k,E,F,P,G,j.x,j.y)&&Ri(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;Me&&Me.z>=he;){if(Me.x>=$&&Me.x<=K&&Me.y>=q&&Me.y<=se&&Me!==g&&Me!==x&&Qh(w,k,E,F,P,G,Me.x,Me.y)&&Ri(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;j&&j.z<=ze;){if(j.x>=$&&j.x<=K&&j.y>=q&&j.y<=se&&j!==g&&j!==x&&Qh(w,k,E,F,P,G,j.x,j.y)&&Ri(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function KS(l,i){let o=l;do{const h=o.prev,g=o.next.next;!Xc(h,g)&&qv(h,o,o.next,g)&&ed(h,g)&&ed(g,h)&&(i.push(h.i,o.i,g.i),td(o),td(o.next),o=l=g),o=o.next}while(o!==l);return Fl(o)}function JS(l,i,o,h,g,v){let x=l;do{let w=x.next.next;for(;w!==x.prev;){if(x.i!==w.i&&iM(x,w)){let E=Zv(x,w);return x=Fl(x,x.next),E=Fl(E,E.next),Jh(x,i,o,h,g,v,0),void Jh(E,i,o,h,g,v,0)}w=w.next}x=x.next}while(x!==l)}function QS(l,i){let o=l.x-i.x;return o===0&&(o=l.y-i.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),o}function eM(l,i){const o=function(g,v){let x=v;const w=g.x,E=g.y;let P,k=-1/0;if(Xc(g,x))return x;do{if(Xc(g,x.next))return x.next;if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){const K=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(K<=w&&K>k&&(k=K,P=x.x<x.next.x?x:x.next,K===w))return P}x=x.next}while(x!==v);if(!P)return null;const F=P,G=P.x,$=P.y;let q=1/0;x=P;do{if(w>=x.x&&x.x>=G&&w!==x.x&&Wv(E<$?w:k,E,G,$,E<$?k:w,E,x.x,x.y)){const K=Math.abs(E-x.y)/(w-x.x);ed(x,g)&&(K<q||K===q&&(x.x>P.x||x.x===P.x&&tM(P,x)))&&(P=x,q=K)}x=x.next}while(x!==F);return P}(l,i);if(!o)return i;const h=Zv(o,l);return Fl(h,h.next),Fl(o,o.next)}function tM(l,i){return Ri(l.prev,l,i.prev)<0&&Ri(i.next,l,l.next)<0}function rg(l,i,o,h,g){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*g|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function nM(l){let i=l,o=l;do(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next;while(i!==l);return o}function Wv(l,i,o,h,g,v,x,w){return(g-x)*(i-w)>=(l-x)*(v-w)&&(l-x)*(h-w)>=(o-x)*(i-w)&&(o-x)*(v-w)>=(g-x)*(h-w)}function Qh(l,i,o,h,g,v,x,w){return!(l===x&&i===w)&&Wv(l,i,o,h,g,v,x,w)}function iM(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(o,h){let g=o;do{if(g.i!==o.i&&g.next.i!==o.i&&g.i!==h.i&&g.next.i!==h.i&&qv(g,g.next,o,h))return!0;g=g.next}while(g!==o);return!1}(l,i)&&(ed(l,i)&&ed(i,l)&&function(o,h){let g=o,v=!1;const x=(o.x+h.x)/2,w=(o.y+h.y)/2;do g.y>w!=g.next.y>w&&g.next.y!==g.y&&x<(g.next.x-g.x)*(w-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==o);return v}(l,i)&&(Ri(l.prev,l,i.prev)||Ri(l,i.prev,i))||Xc(l,i)&&Ri(l.prev,l,l.next)>0&&Ri(i.prev,i,i.next)>0)}function Ri(l,i,o){return(i.y-l.y)*(o.x-i.x)-(i.x-l.x)*(o.y-i.y)}function Xc(l,i){return l.x===i.x&&l.y===i.y}function qv(l,i,o,h){const g=Vp(Ri(l,i,o)),v=Vp(Ri(l,i,h)),x=Vp(Ri(o,h,l)),w=Vp(Ri(o,h,i));return g!==v&&x!==w||!(g!==0||!Bp(l,o,i))||!(v!==0||!Bp(l,h,i))||!(x!==0||!Bp(o,l,h))||!(w!==0||!Bp(o,i,h))}function Bp(l,i,o){return i.x<=Math.max(l.x,o.x)&&i.x>=Math.min(l.x,o.x)&&i.y<=Math.max(l.y,o.y)&&i.y>=Math.min(l.y,o.y)}function Vp(l){return l>0?1:l<0?-1:0}function ed(l,i){return Ri(l.prev,l,l.next)<0?Ri(l,i,l.next)>=0&&Ri(l,l.prev,i)>=0:Ri(l,i,l.prev)<0||Ri(l,l.next,i)<0}function Zv(l,i){const o=sg(l.i,l.x,l.y),h=sg(i.i,i.x,i.y),g=l.next,v=i.prev;return l.next=i,i.prev=l,o.next=g,g.prev=o,h.next=o,o.prev=h,v.next=h,h.prev=v,h}function Xv(l,i,o,h){const g=sg(l,i,o);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function td(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function sg(l,i,o){return{i:l,x:i,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Yc{constructor(i,o){if(o>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=o}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class Gp{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}Gp.noSubdivision=new Gp({fill:new Yc(0,0),line:new Yc(0,0),tile:new Yc(0,0),stencil:new Yc(0,0),circle:1}),Pt("SubdivisionGranularityExpression",Yc),Pt("SubdivisionGranularitySetting",Gp);const Kc=-32768,nd=32767;class rM{constructor(i,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=$t/i,this._canonical=o}_getKey(i,o){return(i+=32768)<<16|o+32768}_vertexToIndex(i,o){if(i<-32768||o<-32768||i>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(i),g=0|Math.round(o),v=this._getKey(h,g);if(this._vertexDictionary.has(v))return this._vertexDictionary.get(v);const x=this._vertexBuffer.length/2;return this._vertexDictionary.set(v,x),this._vertexBuffer.push(h,g),x}_subdivideTrianglesScanline(i){if(this._granularity<2)return function(g,v){const x=[];for(let w=0;w<v.length;w+=3){const E=v[w],P=v[w+1],k=v[w+2],F=g[2*E],G=g[2*E+1];(g[2*P]-F)*(g[2*k+1]-G)-(g[2*P+1]-G)*(g[2*k]-F)>0?(x.push(E),x.push(k),x.push(P)):(x.push(E),x.push(P),x.push(k))}return x}(this._vertexBuffer,i);const o=[],h=i.length;for(let g=0;g<h;g+=3){const v=[i[g+0],i[g+1],i[g+2]],x=[this._vertexBuffer[2*i[g+0]+0],this._vertexBuffer[2*i[g+0]+1],this._vertexBuffer[2*i[g+1]+0],this._vertexBuffer[2*i[g+1]+1],this._vertexBuffer[2*i[g+2]+0],this._vertexBuffer[2*i[g+2]+1]];let w=1/0,E=1/0,P=-1/0,k=-1/0;for(let K=0;K<3;K++){const se=x[2*K],he=x[2*K+1];w=Math.min(w,se),P=Math.max(P,se),E=Math.min(E,he),k=Math.max(k,he)}if(w===P||E===k)continue;const F=Math.floor(w/this._granularityCellSize),G=Math.ceil(P/this._granularityCellSize),$=Math.floor(E/this._granularityCellSize),q=Math.ceil(k/this._granularityCellSize);if(F!==G||$!==q)for(let K=$;K<q;K++){const se=this._scanlineGenerateVertexRingForCellRow(K,x,v);sM(this._vertexBuffer,se,o)}else o.push(...v)}return o}_scanlineGenerateVertexRingForCellRow(i,o,h){const g=i*this._granularityCellSize,v=g+this._granularityCellSize,x=[];for(let w=0;w<3;w++){const E=o[2*w],P=o[2*w+1],k=o[2*(w+1)%6],F=o[(2*(w+1)+1)%6],G=o[2*(w+2)%6],$=o[(2*(w+2)+1)%6],q=k-E,K=F-P,se=q===0,he=K===0,ze=(g-P)/K,Me=(v-P)/K,j=Math.min(ze,Me),re=Math.max(ze,Me);if(!he&&(j>=1||re<=0)||he&&(P<g||P>v)){F>=g&&F<=v&&x.push(h[(w+1)%3]);continue}!he&&j>0&&x.push(this._vertexToIndex(E+q*j,P+K*j));const Pe=E+q*Math.max(j,0),$e=E+q*Math.min(re,1);se||this._generateIntraEdgeVertices(x,E,P,k,F,Pe,$e),!he&&re<1&&x.push(this._vertexToIndex(E+q*re,P+K*re)),(he||F>=g&&F<=v)&&x.push(h[(w+1)%3]),!he&&(F<=g||F>=v)&&this._generateInterEdgeVertices(x,E,P,k,F,G,$,$e,g,v)}return x}_generateIntraEdgeVertices(i,o,h,g,v,x,w){const E=g-o,P=v-h,k=P===0,F=k?Math.min(o,g):Math.min(x,w),G=k?Math.max(o,g):Math.max(x,w),$=Math.floor(F/this._granularityCellSize)+1,q=Math.ceil(G/this._granularityCellSize)-1;if(k?o<g:x<w)for(let K=$;K<=q;K++){const se=K*this._granularityCellSize;i.push(this._vertexToIndex(se,h+P*(se-o)/E))}else for(let K=q;K>=$;K--){const se=K*this._granularityCellSize;i.push(this._vertexToIndex(se,h+P*(se-o)/E))}}_generateInterEdgeVertices(i,o,h,g,v,x,w,E,P,k){const F=v-h,G=x-g,$=w-v,q=(P-v)/$,K=(k-v)/$,se=Math.min(q,K),he=Math.max(q,K),ze=g+G*se;let Me=Math.floor(Math.min(ze,E)/this._granularityCellSize)+1,j=Math.ceil(Math.max(ze,E)/this._granularityCellSize)-1,re=E<ze;const Pe=$===0;if(Pe&&(w===P||w===k))return;if(Pe||se>=1||he<=0){const st=h-w,Ye=x+(o-x)*Math.min((P-w)/st,(k-w)/st);Me=Math.floor(Math.min(Ye,E)/this._granularityCellSize)+1,j=Math.ceil(Math.max(Ye,E)/this._granularityCellSize)-1,re=E<Ye}const $e=F>0?k:P;if(re)for(let st=Me;st<=j;st++)i.push(this._vertexToIndex(st*this._granularityCellSize,$e));else for(let st=j;st>=Me;st--)i.push(this._vertexToIndex(st*this._granularityCellSize,$e))}_generateOutline(i){const o=[];for(const h of i){const g=Ol(h,this._granularity,!0),v=this._pointArrayToIndices(g),x=[];for(let w=1;w<v.length;w++)x.push(v[w-1]),x.push(v[w]);o.push(x)}return o}_handlePoles(i){let o=!1,h=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(o||h)&&this._fillPoles(i,o,h)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let o=0;o<i.length;o+=2){const h=i[o+1];h===Kc&&(i[o+1]=-32767),h===nd&&(i[o+1]=32766)}}_generatePoleQuad(i,o,h,g,v,x){g>v!=(x===Kc)?(i.push(o),i.push(h),i.push(this._vertexToIndex(g,x)),i.push(h),i.push(this._vertexToIndex(v,x)),i.push(this._vertexToIndex(g,x))):(i.push(h),i.push(o),i.push(this._vertexToIndex(g,x)),i.push(this._vertexToIndex(v,x)),i.push(h),i.push(this._vertexToIndex(g,x)))}_fillPoles(i,o,h){const g=this._vertexBuffer,v=$t,x=i.length;for(let w=2;w<x;w+=3){const E=i[w-2],P=i[w-1],k=i[w],F=g[2*E],G=g[2*E+1],$=g[2*P],q=g[2*P+1],K=g[2*k],se=g[2*k+1];o&&(G===0&&q===0&&this._generatePoleQuad(i,E,P,F,$,Kc),q===0&&se===0&&this._generatePoleQuad(i,P,k,$,K,Kc),se===0&&G===0&&this._generatePoleQuad(i,k,E,K,F,Kc)),h&&(G===v&&q===v&&this._generatePoleQuad(i,E,P,F,$,nd),q===v&&se===v&&this._generatePoleQuad(i,P,k,$,K,nd),se===v&&G===v&&this._generatePoleQuad(i,k,E,K,F,nd))}}_initializeVertices(i){for(let o=0;o<i.length;o+=2)this._vertexToIndex(i[o],i[o+1])}subdividePolygonInternal(i,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:g}=function(w){const E=[],P=[];for(const k of w)if(k.length!==0){k!==w[0]&&E.push(P.length/2);for(let F=0;F<k.length;F++)P.push(k[F].x),P.push(k[F].y)}return{flattened:P,holeIndices:E}}(i);let v;this._initializeVertices(h);try{const w=function(P,k,F=2){const G=k&&k.length,$=G?k[0]*F:P.length;let q=$v(P,0,$,F,!0);const K=[];if(!q||q.next===q.prev)return K;let se,he,ze;if(G&&(q=function(Me,j,re,Pe){const $e=[];for(let st=0,Ye=j.length;st<Ye;st++){const Qe=$v(Me,j[st]*Pe,st<Ye-1?j[st+1]*Pe:Me.length,Pe,!1);Qe===Qe.next&&(Qe.steiner=!0),$e.push(nM(Qe))}$e.sort(QS);for(let st=0;st<$e.length;st++)re=eM($e[st],re);return re}(P,k,q,F)),P.length>80*F){se=1/0,he=1/0;let Me=-1/0,j=-1/0;for(let re=F;re<$;re+=F){const Pe=P[re],$e=P[re+1];Pe<se&&(se=Pe),$e<he&&(he=$e),Pe>Me&&(Me=Pe),$e>j&&(j=$e)}ze=Math.max(Me-se,j-he),ze=ze!==0?32767/ze:0}return Jh(q,K,F,se,he,ze,0),K}(h,g),E=this._convertIndices(h,w);v=this._subdivideTrianglesScanline(E)}catch(w){console.error(w)}let x=[];return o&&(x=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(v),{verticesFlattened:this._vertexBuffer,indicesTriangles:v,indicesLineList:x}}_convertIndices(i,o){const h=[];for(let g=0;g<o.length;g++)h.push(this._vertexToIndex(i[2*o[g]],i[2*o[g]+1]));return h}_pointArrayToIndices(i){const o=[];for(let h=0;h<i.length;h++){const g=i[h];o.push(this._vertexToIndex(g.x,g.y))}return o}}function Yv(l,i,o,h=!0){return new rM(o,i).subdividePolygonInternal(l,h)}function Ol(l,i,o=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const h=l[0],g=l[l.length-1],v=o&&(h.x!==g.x||h.y!==g.y);if(i<2)return v?[...l,l[0]]:[...l];const x=Math.floor($t/i),w=[];w.push(new B(l[0].x,l[0].y));const E=l.length,P=v?E:E-1;for(let k=0;k<P;k++){const F=l[k],G=k<E-1?l[k+1]:l[0],$=F.x,q=F.y,K=G.x,se=G.y,he=$!==K,ze=q!==se;if(!he&&!ze)continue;const Me=K-$,j=se-q,re=Math.abs(Me),Pe=Math.abs(j);let $e=$,st=q;for(;;){const Qe=Me>0?(Math.floor($e/x)+1)*x:(Math.ceil($e/x)-1)*x,gt=j>0?(Math.floor(st/x)+1)*x:(Math.ceil(st/x)-1)*x,lt=Math.abs($e-Qe),yt=Math.abs(st-gt),et=Math.abs($e-K),zt=Math.abs(st-se),en=he?lt/re:Number.POSITIVE_INFINITY,Jt=ze?yt/Pe:Number.POSITIVE_INFINITY;if((et<=lt||!he)&&(zt<=yt||!ze))break;if(en<Jt&&he||!ze){$e=Qe,st+=j*en;const jt=new B($e,Math.round(st));w[w.length-1].x===jt.x&&w[w.length-1].y===jt.y||w.push(jt)}else{$e+=Me*Jt,st=gt;const jt=new B(Math.round($e),st);w[w.length-1].x===jt.x&&w[w.length-1].y===jt.y||w.push(jt)}}const Ye=new B(K,se);w[w.length-1].x===Ye.x&&w[w.length-1].y===Ye.y||w.push(Ye)}return w}function sM(l,i,o){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,g=l[2*i[0]];for(let E=1;E<i.length;E++){const P=l[2*i[E]];P<g&&(g=P,h=E)}const v=i.length;let x=h,w=(x+1)%v;for(;;){const E=x-1>=0?x-1:v-1,P=(w+1)%v,k=l[2*i[E]],F=l[2*i[P]],G=l[2*i[x]],$=l[2*i[x]+1],q=l[2*i[w]+1];let K=!1;if(k<F)K=!0;else if(k>F)K=!1;else{const se=q-$,he=-(l[2*i[w]]-G),ze=$<q?1:-1;((k-G)*se+(l[2*i[E]+1]-$)*he)*ze>((F-G)*se+(l[2*i[P]+1]-$)*he)*ze&&(K=!0)}if(K){const se=i[E],he=i[x],ze=i[w];se!==he&&se!==ze&&he!==ze&&o.push(ze,he,se),x--,x<0&&(x=v-1)}else{const se=i[P],he=i[x],ze=i[w];se!==he&&se!==ze&&he!==ze&&o.push(ze,he,se),w++,w>=v&&(w=0)}if(E===P)break}}function Kv(l,i,o,h,g,v,x,w,E){const P=g.length/2,k=x&&w&&E;if(P<Gn.MAX_VERTEX_ARRAY_LENGTH){const F=i.prepareSegment(P,o,h),G=F.vertexLength;for(let K=0;K<v.length;K+=3)h.emplaceBack(G+v[K],G+v[K+1],G+v[K+2]);let $,q;F.vertexLength+=P,F.primitiveLength+=v.length/3,k&&(q=x.prepareSegment(P,o,w),$=q.vertexLength,q.vertexLength+=P);for(let K=0;K<g.length;K+=2)l(g[K],g[K+1]);if(k)for(let K=0;K<E.length;K++){const se=E[K];for(let he=1;he<se.length;he+=2)w.emplaceBack($+se[he-1],$+se[he]);q.primitiveLength+=se.length/2}}else(function(F,G,$,q,K,se){const he=[];for(let Pe=0;Pe<q.length/2;Pe++)he.push(-1);const ze={count:0};let Me=0,j=F.getOrCreateLatestSegment(G,$),re=j.vertexLength;for(let Pe=2;Pe<K.length;Pe+=3){const $e=K[Pe-2],st=K[Pe-1],Ye=K[Pe];let Qe=he[$e]<Me,gt=he[st]<Me,lt=he[Ye]<Me;j.vertexLength+((Qe?1:0)+(gt?1:0)+(lt?1:0))>Gn.MAX_VERTEX_ARRAY_LENGTH&&(j=F.createNewSegment(G,$),Me=ze.count,Qe=!0,gt=!0,lt=!0,re=0);const yt=id(he,q,se,ze,$e,Qe,j),et=id(he,q,se,ze,st,gt,j),zt=id(he,q,se,ze,Ye,lt,j);$.emplaceBack(re+yt-Me,re+et-Me,re+zt-Me),j.primitiveLength++}})(i,o,h,g,v,l),k&&function(F,G,$,q,K,se){const he=[];for(let Pe=0;Pe<q.length/2;Pe++)he.push(-1);const ze={count:0};let Me=0,j=F.getOrCreateLatestSegment(G,$),re=j.vertexLength;for(let Pe=0;Pe<K.length;Pe++){const $e=K[Pe];for(let st=1;st<K[Pe].length;st+=2){const Ye=$e[st-1],Qe=$e[st];let gt=he[Ye]<Me,lt=he[Qe]<Me;j.vertexLength+((gt?1:0)+(lt?1:0))>Gn.MAX_VERTEX_ARRAY_LENGTH&&(j=F.createNewSegment(G,$),Me=ze.count,gt=!0,lt=!0,re=0);const yt=id(he,q,se,ze,Ye,gt,j),et=id(he,q,se,ze,Qe,lt,j);$.emplaceBack(re+yt-Me,re+et-Me),j.primitiveLength++}}}(x,o,w,g,E,l),i.forceNewSegmentOnNextPrepare(),x==null||x.forceNewSegmentOnNextPrepare()}function id(l,i,o,h,g,v,x){if(v){const w=h.count;return o(i[2*g],i[2*g+1]),l[g]=h.count,h.count++,x.vertexLength++,w}return l[g]}class ag{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new li,this.indexArray2=new ai,this.programConfigurations=new _a(i.layers,i.zoom),this.segments=new Gn,this.segments2=new Gn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,h){this.hasPattern=ng("fill",this.layers,o);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:P,sourceLayerIndex:k}of i){const F=this.layers[0]._featureFilter.needGeometry,G=zl(w,F);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom,{globalState:this.globalState}),G,h))continue;const $=v?g.evaluate(G,{},h,o.availableImages):void 0,q={id:E,properties:w.properties,type:w.type,sourceLayerIndex:k,index:P,geometry:F?G.geometry:kl(w),patterns:{},sortKey:$};x.push(q)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:P,sourceLayerIndex:k}=w;if(this.hasPattern){const F=ig("fill",this.layers,w,this.zoom,o);this.patternFeatures.push(F)}else this.addFeature(w,E,P,h,{},o.subdivisionGranularity);o.featureIndex.insert(i[P].feature,E,P,k,this.index)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,h)}addFeatures(i,o,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ZS),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,o,h,g,v,x){for(const w of wc(o,500)){const E=Yv(w,g,x.fill.getGranularityForZoomLevel(g.z)),P=this.layoutVertexArray;Kv((k,F)=>{P.emplaceBack(k,F)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}}let Jv,Qv;Pt("FillBucket",ag,{omit:["layers","patternFeatures"]});var aM={get paint(){return Qv=Qv||new Mr({"fill-antialias":new Ft(be.paint_fill["fill-antialias"]),"fill-opacity":new rn(be.paint_fill["fill-opacity"]),"fill-color":new rn(be.paint_fill["fill-color"]),"fill-outline-color":new rn(be.paint_fill["fill-outline-color"]),"fill-translate":new Ft(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new $c(be.paint_fill["fill-pattern"])})},get layout(){return Jv=Jv||new Mr({"fill-sort-key":new rn(be.layout_fill["fill-sort-key"])})}};class oM extends tr{constructor(i){super(i,aM)}recalculate(i,o){super.recalculate(i,o);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ag(i)}queryRadius(){return Np(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:o,transform:h,pixelsToTileUnits:g}){return Rv(Up(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,g),o)}isTileClipped(){return!0}}const lM=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),cM=Ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:uM}=lM;var og,e0,lg,t0,cg,n0,i0,Hp={};function r0(){if(e0)return og;e0=1;var l=I();function i(g,v,x,w,E){this.properties={},this.extent=x,this.type=0,this._pbf=g,this._geometry=-1,this._keys=w,this._values=E,g.readFields(o,this,v)}function o(g,v,x){g==1?v.id=x.readVarint():g==2?function(w,E){for(var P=w.readVarint()+w.pos;w.pos<P;){var k=E._keys[w.readVarint()],F=E._values[w.readVarint()];E.properties[k]=F}}(x,v):g==3?v.type=x.readVarint():g==4&&(v._geometry=x.pos)}function h(g){for(var v,x,w=0,E=0,P=g.length,k=P-1;E<P;k=E++)w+=((x=g[k]).x-(v=g[E]).x)*(v.y+x.y);return w}return og=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var v,x=g.readVarint()+g.pos,w=1,E=0,P=0,k=0,F=[];g.pos<x;){if(E<=0){var G=g.readVarint();w=7&G,E=G>>3}if(E--,w===1||w===2)P+=g.readSVarint(),k+=g.readSVarint(),w===1&&(v&&F.push(v),v=[]),v.push(new l(P,k));else{if(w!==7)throw new Error("unknown command "+w);v&&v.push(v[0].clone())}}return v&&F.push(v),F},i.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var v=g.readVarint()+g.pos,x=1,w=0,E=0,P=0,k=1/0,F=-1/0,G=1/0,$=-1/0;g.pos<v;){if(w<=0){var q=g.readVarint();x=7&q,w=q>>3}if(w--,x===1||x===2)(E+=g.readSVarint())<k&&(k=E),E>F&&(F=E),(P+=g.readSVarint())<G&&(G=P),P>$&&($=P);else if(x!==7)throw new Error("unknown command "+x)}return[k,G,F,$]},i.prototype.toGeoJSON=function(g,v,x){var w,E,P=this.extent*Math.pow(2,x),k=this.extent*g,F=this.extent*v,G=this.loadGeometry(),$=i.types[this.type];function q(he){for(var ze=0;ze<he.length;ze++){var Me=he[ze];he[ze]=[360*(Me.x+k)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(Me.y+F)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(w=0;w<G.length;w++)K[w]=G[w][0];q(G=K);break;case 2:for(w=0;w<G.length;w++)q(G[w]);break;case 3:for(G=function(he){var ze=he.length;if(ze<=1)return[he];for(var Me,j,re=[],Pe=0;Pe<ze;Pe++){var $e=h(he[Pe]);$e!==0&&(j===void 0&&(j=$e<0),j===$e<0?(Me&&re.push(Me),Me=[he[Pe]]):Me.push(he[Pe]))}return Me&&re.push(Me),re}(G),w=0;w<G.length;w++)for(E=0;E<G[w].length;E++)q(G[w][E])}G.length===1?G=G[0]:$="Multi"+$;var se={type:"Feature",geometry:{type:$,coordinates:G},properties:this.properties};return"id"in this&&(se.id=this.id),se},og}function s0(){if(t0)return lg;t0=1;var l=r0();function i(h,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(o,this,g),this.length=this._features.length}function o(h,g,v){h===15?g.version=v.readVarint():h===1?g.name=v.readString():h===5?g.extent=v.readVarint():h===2?g._features.push(v.pos):h===3?g._keys.push(v.readString()):h===4&&g._values.push(function(x){for(var w=null,E=x.readVarint()+x.pos;x.pos<E;){var P=x.readVarint()>>3;w=P===1?x.readString():P===2?x.readFloat():P===3?x.readDouble():P===4?x.readVarint64():P===5?x.readVarint():P===6?x.readSVarint():P===7?x.readBoolean():null}return w}(v))}return lg=i,i.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var g=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,g,this.extent,this._keys,this._values)},lg}function a0(){return i0||(i0=1,Hp.VectorTile=function(){if(n0)return cg;n0=1;var l=s0();function i(o,h,g){if(o===3){var v=new l(g,g.readVarint()+g.pos);v.length&&(h[v.name]=v)}}return cg=function(o,h){this.layers=o.readFields(i,{},h)},cg}(),Hp.VectorTileFeature=r0(),Hp.VectorTileLayer=s0()),Hp}var rd=S(a0());const hM=rd.VectorTileFeature.types,ug=Math.pow(2,13);function sd(l,i,o,h,g,v,x,w){l.emplaceBack(i,o,2*Math.floor(h*ug)+x,g*ug*2,v*ug*2,Math.round(w))}class hg{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new St,this.centroidVertexArray=new He,this.indexArray=new li,this.programConfigurations=new _a(i.layers,i.zoom),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,h){this.features=[],this.hasPattern=ng("fill-extrusion",this.layers,o);for(const{feature:g,id:v,index:x,sourceLayerIndex:w}of i){const E=this.layers[0]._featureFilter.needGeometry,P=zl(g,E);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom,{globalState:this.globalState}),P,h))continue;const k={id:v,sourceLayerIndex:w,index:x,geometry:E?P.geometry:kl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(ig("fill-extrusion",this.layers,k,this.zoom,o)):this.addFeature(k,k.geometry,x,h,{},o.subdivisionGranularity),o.featureIndex.insert(g,k.geometry,x,w,this.index,!0)}}addFeatures(i,o,h){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,o,h,i.subdivisionGranularity)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,uM),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,cM.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,o,h,g,v,x){for(const w of wc(o,500)){const E={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(E,g,i,w,x);const k=this.layoutVertexArray.length-P,F=Math.floor(E.x/E.sampleCount),G=Math.floor(E.y/E.sampleCount);for(let $=0;$<k;$++)this.centroidVertexArray.emplaceBack(F,G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}processPolygon(i,o,h,g,v){if(g.length<1||o0(g[0]))return;for(const F of g)F.length!==0&&dM(i,F);const x={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=v.fill.getGranularityForZoomLevel(o.z),E=hM[h.type]==="Polygon";for(const F of g){if(F.length===0||o0(F))continue;const G=Ol(F,w,E);this._generateSideFaces(G,x)}if(!E)return;const P=Yv(g,o,w,!1),k=this.layoutVertexArray;Kv((F,G)=>{sd(k,F,G,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(i,o){let h=0;for(let g=1;g<i.length;g++){const v=i[g],x=i[g-1];if(pM(v,x))continue;o.segment.vertexLength+4>Gn.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=v.sub(x)._perp()._unit(),E=x.dist(v);h+E>32768&&(h=0),sd(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,h),sd(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,h),h+=E,sd(this.layoutVertexArray,x.x,x.y,w.x,w.y,0,0,h),sd(this.layoutVertexArray,x.x,x.y,w.x,w.y,0,1,h);const P=o.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function dM(l,i){for(let o=0;o<i.length;o++){const h=i[o];o===i.length-1&&i[0].x===h.x&&i[0].y===h.y||(l.x+=h.x,l.y+=h.y,l.sampleCount++)}}function pM(l,i){return l.x===i.x&&(l.x<0||l.x>$t)||l.y===i.y&&(l.y<0||l.y>$t)}function o0(l){return l.every(i=>i.x<0)||l.every(i=>i.x>$t)||l.every(i=>i.y<0)||l.every(i=>i.y>$t)}let l0;Pt("FillExtrusionBucket",hg,{omit:["layers","features"]});var fM={get paint(){return l0=l0||new Mr({"fill-extrusion-opacity":new Ft(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rn(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $c(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rn(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rn(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mM extends tr{constructor(i){super(i,fM)}createBucket(i){return new hg(i)}queryRadius(){return Np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:g,transform:v,pixelsToTileUnits:x,pixelPosMatrix:w}){const E=Up(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-v.bearingInRadians,x),P=this.paint.get("fill-extrusion-height").evaluate(o,h),k=this.paint.get("fill-extrusion-base").evaluate(o,h),F=function($,q){const K=[];for(const se of $){const he=[se.x,se.y,0,1];ft(he,he,q),K.push(new B(he[0]/he[3],he[1]/he[3]))}return K}(E,w),G=function($,q,K,se){const he=[],ze=[],Me=se[8]*q,j=se[9]*q,re=se[10]*q,Pe=se[11]*q,$e=se[8]*K,st=se[9]*K,Ye=se[10]*K,Qe=se[11]*K;for(const gt of $){const lt=[],yt=[];for(const et of gt){const zt=et.x,en=et.y,Jt=se[0]*zt+se[4]*en+se[12],jt=se[1]*zt+se[5]*en+se[13],Dn=se[2]*zt+se[6]*en+se[14],Ai=se[3]*zt+se[7]*en+se[15],Vi=Dn+re,gr=Ai+Pe,ds=Jt+$e,Br=jt+st,sr=Dn+Ye,Mi=Ai+Qe,Xi=new B((Jt+Me)/gr,(jt+j)/gr);Xi.z=Vi/gr,lt.push(Xi);const ar=new B(ds/Mi,Br/Mi);ar.z=sr/Mi,yt.push(ar)}he.push(lt),ze.push(yt)}return[he,ze]}(g,k,P,w);return function($,q,K){let se=1/0;Rv(K,q)&&(se=c0(K,q[0]));for(let he=0;he<q.length;he++){const ze=q[he],Me=$[he];for(let j=0;j<ze.length-1;j++){const re=ze[j],Pe=[re,ze[j+1],Me[j+1],Me[j],re];Iv(K,Pe)&&(se=Math.min(se,c0(K,Pe)))}}return se!==1/0&&se}(G[0],G[1],F)}}function ad(l,i){return l.x*i.x+l.y*i.y}function c0(l,i){if(l.length===1){let o=0;const h=i[o++];let g;for(;!g||h.equals(g);)if(g=i[o++],!g)return 1/0;for(;o<i.length;o++){const v=i[o],x=l[0],w=g.sub(h),E=v.sub(h),P=x.sub(h),k=ad(w,w),F=ad(w,E),G=ad(E,E),$=ad(P,w),q=ad(P,E),K=k*G-F*F,se=(G*$-F*q)/K,he=(k*q-F*$)/K,ze=h.z*(1-se-he)+g.z*se+v.z*he;if(isFinite(ze))return ze}return 1/0}{let o=1/0;for(const h of i)o=Math.min(o,h.z);return o}}const gM=Ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_M}=gM,yM=Ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vM}=yM,xM=rd.VectorTileFeature.types,bM=Math.cos(Math.PI/180*37.5),u0=Math.pow(2,14)/.5;class dg{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new xt,this.layoutVertexArray2=new at,this.indexArray=new li,this.programConfigurations=new _a(i.layers,i.zoom),this.segments=new Gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,h){this.hasPattern=ng("line",this.layers,o);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:P,sourceLayerIndex:k}of i){const F=this.layers[0]._featureFilter.needGeometry,G=zl(w,F);if(!this.layers[0]._featureFilter.filter(new yi(this.zoom,{globalState:this.globalState}),G,h))continue;const $=v?g.evaluate(G,{},h):void 0,q={id:E,properties:w.properties,type:w.type,sourceLayerIndex:k,index:P,geometry:F?G.geometry:kl(w),patterns:{},sortKey:$};x.push(q)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:P,sourceLayerIndex:k}=w;if(this.hasPattern){const F=ig("line",this.layers,w,this.zoom,o);this.patternFeatures.push(F)}else this.addFeature(w,E,P,h,{},o.subdivisionGranularity);o.featureIndex.insert(i[P].feature,E,P,k,this.index)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,h)}addFeatures(i,o,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,vM)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_M),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,h,g,v,x){const w=this.layers[0].layout,E=w.get("line-join").evaluate(i,{}),P=w.get("line-cap"),k=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of o)this.addLine(G,i,E,P,k,F,g,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}addLine(i,o,h,g,v,x,w,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=Ol(i,w?E.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Me=0;Me<i.length-1;Me++)this.totalDistance+=i[Me].dist(i[Me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=xM[o.type]==="Polygon";let k=i.length;for(;k>=2&&i[k-1].equals(i[k-2]);)k--;let F=0;for(;F<k-1&&i[F].equals(i[F+1]);)F++;if(k<(P?3:2))return;h==="bevel"&&(v=1.05);const G=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let q,K,se,he,ze;this.e1=this.e2=-1,P&&(q=i[k-2],ze=i[F].sub(q)._unit()._perp());for(let Me=F;Me<k;Me++){if(se=Me===k-1?P?i[F+1]:void 0:i[Me+1],se&&i[Me].equals(se))continue;ze&&(he=ze),q&&(K=q),q=i[Me],ze=se?se.sub(q)._unit()._perp():he,he=he||ze;let j=he.add(ze);j.x===0&&j.y===0||j._unit();const re=he.x*ze.x+he.y*ze.y,Pe=j.x*ze.x+j.y*ze.y,$e=Pe!==0?1/Pe:1/0,st=2*Math.sqrt(2-2*Pe),Ye=Pe<bM&&K&&se,Qe=he.x*ze.y-he.y*ze.x>0;if(Ye&&Me>F){const yt=q.dist(K);if(yt>2*G){const et=q.sub(q.sub(K)._mult(G/yt)._round());this.updateDistance(K,et),this.addCurrentVertex(et,he,0,0,$),K=et}}const gt=K&&se;let lt=gt?h:P?"butt":g;if(gt&&lt==="round"&&($e<x?lt="miter":$e<=2&&(lt="fakeround")),lt==="miter"&&$e>v&&(lt="bevel"),lt==="bevel"&&($e>2&&(lt="flipbevel"),$e<v&&(lt="miter")),K&&this.updateDistance(K,q),lt==="miter")j._mult($e),this.addCurrentVertex(q,j,0,0,$);else if(lt==="flipbevel"){if($e>100)j=ze.mult(-1);else{const yt=$e*he.add(ze).mag()/he.sub(ze).mag();j._perp()._mult(yt*(Qe?-1:1))}this.addCurrentVertex(q,j,0,0,$),this.addCurrentVertex(q,j.mult(-1),0,0,$)}else if(lt==="bevel"||lt==="fakeround"){const yt=-Math.sqrt($e*$e-1),et=Qe?yt:0,zt=Qe?0:yt;if(K&&this.addCurrentVertex(q,he,et,zt,$),lt==="fakeround"){const en=Math.round(180*st/Math.PI/20);for(let Jt=1;Jt<en;Jt++){let jt=Jt/en;if(jt!==.5){const Ai=jt-.5;jt+=jt*Ai*(jt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Ai*Ai+(.848013+re*(.215638*re-1.06021)))}const Dn=ze.sub(he)._mult(jt)._add(he)._unit()._mult(Qe?-1:1);this.addHalfVertex(q,Dn.x,Dn.y,!1,Qe,0,$)}}se&&this.addCurrentVertex(q,ze,-et,-zt,$)}else if(lt==="butt")this.addCurrentVertex(q,j,0,0,$);else if(lt==="square"){const yt=K?1:-1;this.addCurrentVertex(q,j,yt,yt,$)}else lt==="round"&&(K&&(this.addCurrentVertex(q,he,0,0,$),this.addCurrentVertex(q,he,1,1,$,!0)),se&&(this.addCurrentVertex(q,ze,-1,-1,$,!0),this.addCurrentVertex(q,ze,0,0,$)));if(Ye&&Me<k-1){const yt=q.dist(se);if(yt>2*G){const et=q.add(se.sub(q)._mult(G/yt)._round());this.updateDistance(q,et),this.addCurrentVertex(et,ze,0,0,$),q=et}}}}addCurrentVertex(i,o,h,g,v,x=!1){const w=o.y*g-o.x,E=-o.y-o.x*g;this.addHalfVertex(i,o.x+o.y*h,o.y-o.x*h,x,!1,h,v),this.addHalfVertex(i,w,E,x,!0,-g,v),this.distance>u0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,o,h,g,v,x))}addHalfVertex({x:i,y:o},h,g,v,x,w,E){const P=.5*(this.lineClips?this.scaledDistance*(u0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(o<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(w===0?0:w<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,k,this.e2),E.primitiveLength++),x?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,o){this.distance+=i.dist(o),this.updateScaledDistance()}}let h0,d0;Pt("LineBucket",dg,{omit:["layers","patternFeatures"]});var p0={get paint(){return d0=d0||new Mr({"line-opacity":new rn(be.paint_line["line-opacity"]),"line-color":new rn(be.paint_line["line-color"]),"line-translate":new Ft(be.paint_line["line-translate"]),"line-translate-anchor":new Ft(be.paint_line["line-translate-anchor"]),"line-width":new rn(be.paint_line["line-width"]),"line-gap-width":new rn(be.paint_line["line-gap-width"]),"line-offset":new rn(be.paint_line["line-offset"]),"line-blur":new rn(be.paint_line["line-blur"]),"line-dasharray":new Gh(be.paint_line["line-dasharray"]),"line-pattern":new $c(be.paint_line["line-pattern"]),"line-gradient":new Cl(be.paint_line["line-gradient"])})},get layout(){return h0=h0||new Mr({"line-cap":new Ft(be.layout_line["line-cap"]),"line-join":new rn(be.layout_line["line-join"]),"line-miter-limit":new Ft(be.layout_line["line-miter-limit"]),"line-round-limit":new Ft(be.layout_line["line-round-limit"]),"line-sort-key":new rn(be.layout_line["line-sort-key"])})}};class wM extends rn{possiblyEvaluate(i,o){return o=new yi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(i,o)}evaluate(i,o,h,g){return o=Vn({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(i,o,h,g)}}let jp;class SM extends tr{constructor(i){super(i,p0),this.gradientVersion=0,jp||(jp=new wM(p0.paint.properties["line-width"].specification),jp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,o){super.recalculate(i,o),this.paint._values["line-floorwidth"]=jp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new dg(i)}queryRadius(i){const o=i,h=f0(Yh("line-width",this,o),Yh("line-gap-width",this,o)),g=Yh("line-offset",this,o);return h/2+Math.abs(g)+Np(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:g,transform:v,pixelsToTileUnits:x}){const w=Up(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-v.bearingInRadians,x),E=x/2*f0(this.paint.get("line-width").evaluate(o,h),this.paint.get("line-gap-width").evaluate(o,h)),P=this.paint.get("line-offset").evaluate(o,h);return P&&(g=function(k,F){const G=[];for(let $=0;$<k.length;$++){const q=k[$],K=[];for(let se=0;se<q.length;se++){const he=q[se-1],ze=q[se],Me=q[se+1],j=se===0?new B(0,0):ze.sub(he)._unit()._perp(),re=se===q.length-1?new B(0,0):Me.sub(ze)._unit()._perp(),Pe=j._add(re)._unit(),$e=Pe.x*re.x+Pe.y*re.y;$e!==0&&Pe._mult(1/$e),K.push(Pe._mult(F)._add(ze))}G.push(K)}return G}(g,P*x)),function(k,F,G){for(let $=0;$<F.length;$++){const q=F[$];if(k.length>=3){for(let K=0;K<q.length;K++)if(Zc(k,q[K]))return!0}if(FS(k,q,G))return!0}return!1}(w,g,E)}isTileClipped(){return!0}}function f0(l,i){return i>0?i+2*l:l}const MM=Ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),TM=Ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const EM=Ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const m0=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),AM=Ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function CM(l,i,o){return l.sections.forEach(h=>{h.text=function(g,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?g=g.toLocaleUpperCase():w==="lowercase"&&(g=g.toLocaleLowerCase()),ua.applyArabicShaping&&(g=ua.applyArabicShaping(g)),g}(h.text,i,o)}),l}Ei([{name:"triangle",components:3,type:"Uint16"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ei([{type:"Float32",name:"offsetX"}]),Ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ei([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const od={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var g0,pg,_0,Zi=24,fg={};function PM(){return g0||(g0=1,fg.read=function(l,i,o,h,g){var v,x,w=8*g-h-1,E=(1<<w)-1,P=E>>1,k=-7,F=o?g-1:0,G=o?-1:1,$=l[i+F];for(F+=G,v=$&(1<<-k)-1,$>>=-k,k+=w;k>0;v=256*v+l[i+F],F+=G,k-=8);for(x=v&(1<<-k)-1,v>>=-k,k+=h;k>0;x=256*x+l[i+F],F+=G,k-=8);if(v===0)v=1-P;else{if(v===E)return x?NaN:1/0*($?-1:1);x+=Math.pow(2,h),v-=P}return($?-1:1)*x*Math.pow(2,v-h)},fg.write=function(l,i,o,h,g,v){var x,w,E,P=8*v-g-1,k=(1<<P)-1,F=k>>1,G=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=h?0:v-1,q=h?1:-1,K=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,x=k):(x=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-x))<1&&(x--,E*=2),(i+=x+F>=1?G/E:G*Math.pow(2,1-F))*E>=2&&(x++,E/=2),x+F>=k?(w=0,x=k):x+F>=1?(w=(i*E-1)*Math.pow(2,g),x+=F):(w=i*Math.pow(2,F-1)*Math.pow(2,g),x=0));g>=8;l[o+$]=255&w,$+=q,w/=256,g-=8);for(x=x<<g|w,P+=g;P>0;l[o+$]=255&x,$+=q,x/=256,P-=8);l[o+$-q]|=128*K}),fg}function y0(){if(_0)return pg;_0=1,pg=i;var l=PM();function i(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,h=1/o,g=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function v(j){return j.type===i.Bytes?j.readVarint()+j.pos:j.pos+1}function x(j,re,Pe){return Pe?4294967296*re+(j>>>0):4294967296*(re>>>0)+(j>>>0)}function w(j,re,Pe){var $e=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));Pe.realloc($e);for(var st=Pe.pos-1;st>=j;st--)Pe.buf[st+$e]=Pe.buf[st]}function E(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeVarint(j[Pe])}function P(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeSVarint(j[Pe])}function k(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeFloat(j[Pe])}function F(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeDouble(j[Pe])}function G(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeBoolean(j[Pe])}function $(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeFixed32(j[Pe])}function q(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeSFixed32(j[Pe])}function K(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeFixed64(j[Pe])}function se(j,re){for(var Pe=0;Pe<j.length;Pe++)re.writeSFixed64(j[Pe])}function he(j,re){return(j[re]|j[re+1]<<8|j[re+2]<<16)+16777216*j[re+3]}function ze(j,re,Pe){j[Pe]=re,j[Pe+1]=re>>>8,j[Pe+2]=re>>>16,j[Pe+3]=re>>>24}function Me(j,re){return(j[re]|j[re+1]<<8|j[re+2]<<16)+(j[re+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(j,re,Pe){for(Pe=Pe||this.length;this.pos<Pe;){var $e=this.readVarint(),st=$e>>3,Ye=this.pos;this.type=7&$e,j(st,re,this),this.pos===Ye&&this.skip($e)}return re},readMessage:function(j,re){return this.readFields(j,re,this.readVarint()+this.pos)},readFixed32:function(){var j=he(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=Me(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=he(this.buf,this.pos)+he(this.buf,this.pos+4)*o;return this.pos+=8,j},readSFixed64:function(){var j=he(this.buf,this.pos)+Me(this.buf,this.pos+4)*o;return this.pos+=8,j},readFloat:function(){var j=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var re,Pe,$e=this.buf;return re=127&(Pe=$e[this.pos++]),Pe<128?re:(re|=(127&(Pe=$e[this.pos++]))<<7,Pe<128?re:(re|=(127&(Pe=$e[this.pos++]))<<14,Pe<128?re:(re|=(127&(Pe=$e[this.pos++]))<<21,Pe<128?re:function(st,Ye,Qe){var gt,lt,yt=Qe.buf;if(gt=(112&(lt=yt[Qe.pos++]))>>4,lt<128||(gt|=(127&(lt=yt[Qe.pos++]))<<3,lt<128)||(gt|=(127&(lt=yt[Qe.pos++]))<<10,lt<128)||(gt|=(127&(lt=yt[Qe.pos++]))<<17,lt<128)||(gt|=(127&(lt=yt[Qe.pos++]))<<24,lt<128)||(gt|=(1&(lt=yt[Qe.pos++]))<<31,lt<128))return x(st,gt,Ye);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(Pe=$e[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,re=this.pos;return this.pos=j,j-re>=12&&g?function(Pe,$e,st){return g.decode(Pe.subarray($e,st))}(this.buf,re,j):function(Pe,$e,st){for(var Ye="",Qe=$e;Qe<st;){var gt,lt,yt,et=Pe[Qe],zt=null,en=et>239?4:et>223?3:et>191?2:1;if(Qe+en>st)break;en===1?et<128&&(zt=et):en===2?(192&(gt=Pe[Qe+1]))==128&&(zt=(31&et)<<6|63&gt)<=127&&(zt=null):en===3?(lt=Pe[Qe+2],(192&(gt=Pe[Qe+1]))==128&&(192&lt)==128&&((zt=(15&et)<<12|(63&gt)<<6|63&lt)<=2047||zt>=55296&&zt<=57343)&&(zt=null)):en===4&&(lt=Pe[Qe+2],yt=Pe[Qe+3],(192&(gt=Pe[Qe+1]))==128&&(192&lt)==128&&(192&yt)==128&&((zt=(15&et)<<18|(63&gt)<<12|(63&lt)<<6|63&yt)<=65535||zt>=1114112)&&(zt=null)),zt===null?(zt=65533,en=1):zt>65535&&(zt-=65536,Ye+=String.fromCharCode(zt>>>10&1023|55296),zt=56320|1023&zt),Ye+=String.fromCharCode(zt),Qe+=en}return Ye}(this.buf,re,j)},readBytes:function(){var j=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,j);return this.pos=j,re},readPackedVarint:function(j,re){if(this.type!==i.Bytes)return j.push(this.readVarint(re));var Pe=v(this);for(j=j||[];this.pos<Pe;)j.push(this.readVarint(re));return j},readPackedSVarint:function(j){if(this.type!==i.Bytes)return j.push(this.readSVarint());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==i.Bytes)return j.push(this.readBoolean());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==i.Bytes)return j.push(this.readFloat());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==i.Bytes)return j.push(this.readDouble());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==i.Bytes)return j.push(this.readFixed32());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==i.Bytes)return j.push(this.readSFixed32());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==i.Bytes)return j.push(this.readFixed64());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==i.Bytes)return j.push(this.readSFixed64());var re=v(this);for(j=j||[];this.pos<re;)j.push(this.readSFixed64());return j},skip:function(j){var re=7&j;if(re===i.Varint)for(;this.buf[this.pos++]>127;);else if(re===i.Bytes)this.pos=this.readVarint()+this.pos;else if(re===i.Fixed32)this.pos+=4;else{if(re!==i.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(j,re){this.writeVarint(j<<3|re)},realloc:function(j){for(var re=this.length||16;re<this.pos+j;)re*=2;if(re!==this.length){var Pe=new Uint8Array(re);Pe.set(this.buf),this.buf=Pe,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),ze(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),ze(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),ze(this.buf,-1&j,this.pos),ze(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),ze(this.buf,-1&j,this.pos),ze(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function(re,Pe){var $e,st;if(re>=0?($e=re%4294967296|0,st=re/4294967296|0):(st=~(-re/4294967296),4294967295^($e=~(-re%4294967296))?$e=$e+1|0:($e=0,st=st+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Pe.realloc(10),function(Ye,Qe,gt){gt.buf[gt.pos++]=127&Ye|128,Ye>>>=7,gt.buf[gt.pos++]=127&Ye|128,Ye>>>=7,gt.buf[gt.pos++]=127&Ye|128,Ye>>>=7,gt.buf[gt.pos++]=127&Ye|128,gt.buf[gt.pos]=127&(Ye>>>=7)}($e,0,Pe),function(Ye,Qe){var gt=(7&Ye)<<4;Qe.buf[Qe.pos++]|=gt|((Ye>>>=3)?128:0),Ye&&(Qe.buf[Qe.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(Qe.buf[Qe.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(Qe.buf[Qe.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(Qe.buf[Qe.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(Qe.buf[Qe.pos++]=127&Ye)))))}(st,Pe)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var re=this.pos;this.pos=function($e,st,Ye){for(var Qe,gt,lt=0;lt<st.length;lt++){if((Qe=st.charCodeAt(lt))>55295&&Qe<57344){if(!gt){Qe>56319||lt+1===st.length?($e[Ye++]=239,$e[Ye++]=191,$e[Ye++]=189):gt=Qe;continue}if(Qe<56320){$e[Ye++]=239,$e[Ye++]=191,$e[Ye++]=189,gt=Qe;continue}Qe=gt-55296<<10|Qe-56320|65536,gt=null}else gt&&($e[Ye++]=239,$e[Ye++]=191,$e[Ye++]=189,gt=null);Qe<128?$e[Ye++]=Qe:(Qe<2048?$e[Ye++]=Qe>>6|192:(Qe<65536?$e[Ye++]=Qe>>12|224:($e[Ye++]=Qe>>18|240,$e[Ye++]=Qe>>12&63|128),$e[Ye++]=Qe>>6&63|128),$e[Ye++]=63&Qe|128)}return Ye}(this.buf,j,this.pos);var Pe=this.pos-re;Pe>=128&&w(re,Pe,this),this.pos=re-1,this.writeVarint(Pe),this.pos+=Pe},writeFloat:function(j){this.realloc(4),l.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),l.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var re=j.length;this.writeVarint(re),this.realloc(re);for(var Pe=0;Pe<re;Pe++)this.buf[this.pos++]=j[Pe]},writeRawMessage:function(j,re){this.pos++;var Pe=this.pos;j(re,this);var $e=this.pos-Pe;$e>=128&&w(Pe,$e,this),this.pos=Pe-1,this.writeVarint($e),this.pos+=$e},writeMessage:function(j,re,Pe){this.writeTag(j,i.Bytes),this.writeRawMessage(re,Pe)},writePackedVarint:function(j,re){re.length&&this.writeMessage(j,E,re)},writePackedSVarint:function(j,re){re.length&&this.writeMessage(j,P,re)},writePackedBoolean:function(j,re){re.length&&this.writeMessage(j,G,re)},writePackedFloat:function(j,re){re.length&&this.writeMessage(j,k,re)},writePackedDouble:function(j,re){re.length&&this.writeMessage(j,F,re)},writePackedFixed32:function(j,re){re.length&&this.writeMessage(j,$,re)},writePackedSFixed32:function(j,re){re.length&&this.writeMessage(j,q,re)},writePackedFixed64:function(j,re){re.length&&this.writeMessage(j,K,re)},writePackedSFixed64:function(j,re){re.length&&this.writeMessage(j,se,re)},writeBytesField:function(j,re){this.writeTag(j,i.Bytes),this.writeBytes(re)},writeFixed32Field:function(j,re){this.writeTag(j,i.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(j,re){this.writeTag(j,i.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(j,re){this.writeTag(j,i.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(j,re){this.writeTag(j,i.Fixed64),this.writeSFixed64(re)},writeVarintField:function(j,re){this.writeTag(j,i.Varint),this.writeVarint(re)},writeSVarintField:function(j,re){this.writeTag(j,i.Varint),this.writeSVarint(re)},writeStringField:function(j,re){this.writeTag(j,i.Bytes),this.writeString(re)},writeFloatField:function(j,re){this.writeTag(j,i.Fixed32),this.writeFloat(re)},writeDoubleField:function(j,re){this.writeTag(j,i.Fixed64),this.writeDouble(re)},writeBooleanField:function(j,re){this.writeVarintField(j,!!re)}},pg}var No,mg=S(y0());function IM(l,i,o){l===1&&o.readMessage(RM,i)}function RM(l,i,o){if(l===3){const{id:h,bitmap:g,width:v,height:x,left:w,top:E,advance:P}=o.readMessage(LM,{});i.push({id:h,bitmap:new Kh({width:v+6,height:x+6},g),metrics:{width:v,height:x,left:w,top:E,advance:P}})}}function LM(l,i,o){l===1?i.id=o.readVarint():l===2?i.bitmap=o.readBytes():l===3?i.width=o.readVarint():l===4?i.height=o.readVarint():l===5?i.left=o.readSVarint():l===6?i.top=o.readSVarint():l===7&&(i.advance=o.readVarint())}function v0(l){let i=0,o=0;for(const x of l)i+=x.w*x.h,o=Math.max(o,x.w);l.sort((x,w)=>w.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let g=0,v=0;for(const x of l)for(let w=h.length-1;w>=0;w--){const E=h[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===E.w&&x.h===E.h){const P=h.pop();w<h.length&&(h[w]=P)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(h.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:g,h:v,fill:i/(g*v)||0}}class gg{constructor(i,{pixelRatio:o,version:h,stretchX:g,stretchY:v,content:x,textFitWidth:w,textFitHeight:E}){this.paddedRect=i,this.pixelRatio=o,this.stretchX=g,this.stretchY=v,this.content=x,this.version=h,this.textFitWidth=w,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class x0{constructor(i,o){const h={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,h,v),this.addImages(o,g,v);const{w:x,h:w}=v0(v),E=new Ur({width:x||1,height:w||1});for(const P in i){const k=i[P],F=h[P].paddedRect;Ur.copy(k.data,E,{x:0,y:0},{x:F.x+1,y:F.y+1},k.data)}for(const P in o){const k=o[P],F=g[P].paddedRect,G=F.x+1,$=F.y+1,q=k.data.width,K=k.data.height;Ur.copy(k.data,E,{x:0,y:0},{x:G,y:$},k.data),Ur.copy(k.data,E,{x:0,y:K-1},{x:G,y:$-1},{width:q,height:1}),Ur.copy(k.data,E,{x:0,y:0},{x:G,y:$+K},{width:q,height:1}),Ur.copy(k.data,E,{x:q-1,y:0},{x:G-1,y:$},{width:1,height:K}),Ur.copy(k.data,E,{x:0,y:0},{x:G+q,y:$},{width:1,height:K})}this.image=E,this.iconPositions=h,this.patternPositions=g}addImages(i,o,h){for(const g in i){const v=i[g],x={x:0,y:0,w:v.data.width+2,h:v.data.height+2};h.push(x),o[g]=new gg(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,o){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),o),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),o)}patchUpdatedImage(i,o,h){if(!i||!o||i.version===o.version)return;i.version=o.version;const[g,v]=i.tl;h.update(o.data,void 0,{x:g,y:v})}}Pt("ImagePosition",gg),Pt("ImageAtlas",x0),p.an=void 0,(No=p.an||(p.an={}))[No.none=0]="none",No[No.horizontal=1]="horizontal",No[No.vertical=2]="vertical",No[No.horizontalOnly=3]="horizontalOnly";class ld{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,o,h){const g=new ld;return g.scale=i||1,g.fontStack=o,g.verticalAlign=h||"bottom",g}static forImage(i,o){const h=new ld;return h.imageName=i,h.verticalAlign=o||"bottom",h}}class Jc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o){const h=new Jc;for(let g=0;g<i.sections.length;g++){const v=i.sections[g];v.image?h.addImageSection(v):h.addTextSection(v,o)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let o="";for(let h=0;h<i.length;h++){const g=i.charCodeAt(h+1)||null,v=i.charCodeAt(h-1)||null;o+=g&&Uh(g)&&!od[i[h+1]]||v&&Uh(v)&&!od[i[h-1]]||!od[i[h]]?i[h]:od[i[h]]}return o}(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&Wp[this.text.charCodeAt(h)];h++)i++;let o=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&Wp[this.text.charCodeAt(h)];h--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const h=new Jc;return h.text=this.text.substring(i,o),h.sectionIndex=this.sectionIndex.slice(i,o),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,o)=>Math.max(i,this.sections[o].scale),0)}getMaxImageSize(i){let o=0,h=0;for(let g=0;g<this.length();g++){const v=this.getSection(g);if(v.imageName){const x=i[v.imageName];if(!x)continue;const w=x.displaySize;o=Math.max(o,w[0]),h=Math.max(h,w[1])}}return{maxImageWidth:o,maxImageHeight:h}}addTextSection(i,o){this.text+=i.text,this.sections.push(ld.forText(i.scale,i.fontStack||o,i.verticalAlign));const h=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(h)}addImageSection(i){const o=i.image?i.image.name:"";if(o.length===0)return void cn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(ld.forImage(o,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):cn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $p(l,i,o,h,g,v,x,w,E,P,k,F,G,$,q){const K=Jc.fromFeature(l,g);let se;F===p.an.vertical&&K.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:ze}=ua;if(he&&K.sections.length===1){se=[];const re=he(K.toString(),_g(K,P,v,i,h,$));for(const Pe of re){const $e=new Jc;$e.text=Pe,$e.sections=K.sections;for(let st=0;st<Pe.length;st++)$e.sectionIndex.push(0);se.push($e)}}else if(ze){se=[];const re=ze(K.text,K.sectionIndex,_g(K,P,v,i,h,$));for(const Pe of re){const $e=new Jc;$e.text=Pe[0],$e.sectionIndex=Pe[1],$e.sections=K.sections,se.push($e)}}else se=function(re,Pe){const $e=[],st=re.text;let Ye=0;for(const Qe of Pe)$e.push(re.substring(Ye,Qe)),Ye=Qe;return Ye<st.length&&$e.push(re.substring(Ye,st.length)),$e}(K,_g(K,P,v,i,h,$));const Me=[],j={positionedLines:Me,text:K.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(re,Pe,$e,st,Ye,Qe,gt,lt,yt,et,zt,en){let Jt=0,jt=0,Dn=0,Ai=0;const Vi=lt==="right"?1:lt==="left"?0:.5,gr=Zi/en;let ds=0;for(const Mi of Ye){Mi.trim();const Xi=Mi.getMaxScale(),ar={positionedGlyphs:[],lineOffset:0};re.positionedLines[ds]=ar;const or=ar.positionedGlyphs;let zr=0;if(!Mi.length()){jt+=Qe,++ds;continue}const ps=FM(st,Mi,gr);for(let Vr=0;Vr<Mi.length();Vr++){const Gi=Mi.getSection(Vr),Ki=Mi.getSectionIndex(Vr),Ji=Mi.getCharCode(Vr),Oi=OM(yt,zt,Ji);let fi;if(Gi.imageName){if(re.iconsInText=!0,Gi.scale=Gi.scale*gr,fi=UM(Gi,Oi,Xi,ps,st),!fi)continue;zr=Math.max(zr,fi.imageOffset)}else if(fi=NM(Gi,Ji,Oi,ps,Pe,$e),!fi)continue;const{rect:Vs,metrics:nu,baselineOffset:Gs}=fi;or.push({glyph:Ji,imageName:Gi.imageName,x:Jt,y:jt+Gs+-17,vertical:Oi,scale:Gi.scale,fontStack:Gi.fontStack,sectionIndex:Ki,metrics:nu,rect:Vs}),Oi?(re.verticalizable=!0,Jt+=(Gi.imageName?nu.advance:Zi)*Gi.scale+et):Jt+=nu.advance*Gi.scale+et}or.length!==0&&(Dn=Math.max(Jt-et,Dn),BM(or,0,or.length-1,Vi)),Jt=0,ar.lineOffset=Math.max(zr,(Xi-1)*Zi);const Yi=Qe*Xi+zr;jt+=Yi,Ai=Math.max(Yi,Ai),++ds}const{horizontalAlign:Br,verticalAlign:sr}=yg(gt);(function(Mi,Xi,ar,or,zr,ps,Yi,Vr,Gi){const Ki=(Xi-ar)*zr;let Ji=0;Ji=ps!==Yi?-Vr*or- -17:-or*Gi*Yi+.5*Yi;for(const Oi of Mi)for(const fi of Oi.positionedGlyphs)fi.x+=Ki,fi.y+=Ji})(re.positionedLines,Vi,Br,sr,Dn,Ai,Qe,jt,Ye.length),re.top+=-sr*jt,re.bottom=re.top+jt,re.left+=-Br*Dn,re.right=re.left+Dn}(j,i,o,h,se,x,w,E,F,P,G,q),!function(re){for(const Pe of re)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(Me)&&j}const Wp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DM={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},kM={40:!0};function b0(l,i,o,h,g,v){if(i.imageName){const x=h[i.imageName];return x?x.displaySize[0]*i.scale*Zi/v+g:0}{const x=o[i.fontStack],w=x&&x[l];return w?w.metrics.advance*i.scale+g:0}}function w0(l,i,o,h){const g=Math.pow(l-i,2);return h?l<i?g/2:2*g:g+Math.abs(o)*o}function zM(l,i,o){let h=0;return l===10&&(h-=1e4),o&&(h+=150),l!==40&&l!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function S0(l,i,o,h,g,v){let x=null,w=w0(i,o,g,v);for(const E of h){const P=w0(i-E.x,o,g,v)+E.badness;P<=w&&(x=E,w=P)}return{index:l,x:i,priorBreak:x,badness:w}}function M0(l){return l?M0(l.priorBreak).concat(l.index):[]}function _g(l,i,o,h,g,v){if(!l)return[];const x=[],w=function(F,G,$,q,K,se){let he=0;for(let ze=0;ze<F.length();ze++){const Me=F.getSection(ze);he+=b0(F.getCharCode(ze),Me,q,K,G,se)}return he/Math.max(1,Math.ceil(he/$))}(l,i,o,h,g,v),E=l.text.indexOf("​")>=0;let P=0;for(let F=0;F<l.length();F++){const G=l.getSection(F),$=l.getCharCode(F);if(Wp[$]||(P+=b0($,G,h,g,i,v)),F<l.length()-1){const q=!((k=$)<11904)&&(!!Pn["CJK Compatibility Forms"](k)||!!Pn["CJK Compatibility"](k)||!!Pn["CJK Strokes"](k)||!!Pn["CJK Symbols and Punctuation"](k)||!!Pn["Enclosed CJK Letters and Months"](k)||!!Pn["Halfwidth and Fullwidth Forms"](k)||!!Pn["Ideographic Description Characters"](k)||!!Pn["Vertical Forms"](k)||Nh.test(String.fromCodePoint(k)));(DM[$]||q||G.imageName||F!==l.length()-2&&kM[l.getCharCode(F+1)])&&x.push(S0(F+1,P,w,x,zM($,l.getCharCode(F+1),q&&E),!1))}}var k;return M0(S0(l.length(),P,w,x,0,!0))}function yg(l){let i=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function FM(l,i,o){const h=i.getMaxScale()*Zi,{maxImageWidth:g,maxImageHeight:v}=i.getMaxImageSize(l),x=Math.max(h,v*o);return{verticalLineContentWidth:Math.max(h,g*o),horizontalLineContentHeight:x}}function T0(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function OM(l,i,o){return!(l===p.an.horizontal||!i&&!Gc(o)||i&&(Wp[o]||(h=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function NM(l,i,o,h,g,v){const x=v[l.fontStack],w=function(P,k,F,G){if(P&&P.rect)return P;const $=k[F.fontStack],q=$&&$[G];return q?{rect:null,metrics:q.metrics}:null}(x&&x[i],g,l,i);if(w===null)return null;let E;if(o)E=h.verticalLineContentWidth-l.scale*Zi;else{const P=T0(l.verticalAlign);E=(h.horizontalLineContentHeight-l.scale*Zi)*P}return{rect:w.rect,metrics:w.metrics,baselineOffset:E}}function UM(l,i,o,h,g){const v=g[l.imageName];if(!v)return null;const x=v.paddedRect,w=v.displaySize,E={width:w[0],height:w[1],left:1,top:-3,advance:i?w[1]:w[0]};let P;if(i)P=h.verticalLineContentWidth-w[1]*l.scale;else{const k=T0(l.verticalAlign);P=(h.horizontalLineContentHeight-w[1]*l.scale)*k}return{rect:x,metrics:E,baselineOffset:P,imageOffset:(i?w[0]:w[1])*l.scale-Zi*o}}function BM(l,i,o,h){if(h===0)return;const g=l[o],v=(l[o].x+g.metrics.advance*g.scale)*h;for(let x=i;x<=o;x++)l[x].x-=v}function VM(l,i,o){const{horizontalAlign:h,verticalAlign:g}=yg(o),v=i[0]-l.displaySize[0]*h,x=i[1]-l.displaySize[1]*g;return{image:l,top:x,bottom:x+l.displaySize[1],left:v,right:v+l.displaySize[0]}}function E0(l){var i,o;let h=l.left,g=l.top,v=l.right-h,x=l.bottom-g;const w=(i=l.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",E=(o=l.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",P=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(E==="proportional"){if(w==="stretchOnly"&&v/x<P||w==="proportional"){const k=Math.ceil(x*P);h*=k/v,v=k}}else if(w==="proportional"&&E==="stretchOnly"&&P!==0&&v/x>P){const k=Math.ceil(v/P);g*=k/x,x=k}return{x1:h,y1:g,x2:h+v,y2:g+x}}function A0(l,i,o,h,g,v){const x=l.image;let w;if(x.content){const se=x.content,he=x.pixelRatio||1;w=[se[0]/he,se[1]/he,x.displaySize[0]-se[2]/he,x.displaySize[1]-se[3]/he]}const E=i.left*v,P=i.right*v;let k,F,G,$;o==="width"||o==="both"?($=g[0]+E-h[3],F=g[0]+P+h[1]):($=g[0]+(E+P-x.displaySize[0])/2,F=$+x.displaySize[0]);const q=i.top*v,K=i.bottom*v;return o==="height"||o==="both"?(k=g[1]+q-h[0],G=g[1]+K+h[2]):(k=g[1]+(q+K-x.displaySize[1])/2,G=k+x.displaySize[1]),{image:x,top:k,right:F,bottom:G,left:$,collisionPadding:w}}const ja=128,Uo=32640;function C0(l,i){const{expression:o}=i;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new yi(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=o;let v=0;for(;v<h.length&&h[v]<=l;)v++;v=Math.max(0,v-1);let x=v;for(;x<h.length&&h[x]<l+1;)x++;x=Math.min(h.length-1,x);const w=h[v],E=h[x];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:w,maxZoom:E,minSize:o.evaluate(new yi(w)),maxSize:o.evaluate(new yi(E)),interpolationType:g}}}function vg(l,i,o){let h="never";const g=l.get(i);return g?h=g:l.get(o)&&(h="always"),h}const GM=rd.VectorTileFeature.types,HM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qp(l,i,o,h,g,v,x,w,E,P,k,F,G){const $=w?Math.min(Uo,Math.round(w[0])):0,q=w?Math.min(Uo,Math.round(w[1])):0;l.emplaceBack(i,o,Math.round(32*h),Math.round(32*g),v,x,($<<1)+(E?1:0),q,16*P,16*k,256*F,256*G)}function xg(l,i,o){l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o)}function jM(l){for(const i of l.sections)if(Bh(i.text))return!0;return!1}class bg{constructor(i){this.layoutVertexArray=new _n,this.indexArray=new li,this.programConfigurations=i,this.segments=new Gn,this.dynamicLayoutVertexArray=new Yn,this.opacityVertexArray=new wi,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,o,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,MM.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,TM.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,HM,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",bg);class wg{constructor(i,o,h){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new h,this.segments=new Gn,this.collisionVertexArray=new Si}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,EM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pt("CollisionBuffers",wg);class Qc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=C0(this.zoom,o["text-size"]),this.iconSizeData=C0(this.zoom,o["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.canOverlap=vg(h,"text-overlap","text-allow-overlap")!=="never"||vg(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(x=>p.an[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new bg(new _a(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new bg(new _a(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new we,this.lineVertexArray=new Re,this.symbolInstances=new Ae,this.textAnchorOffsets=new Se}calculateGlyphDependencies(i,o,h,g,v){for(let x=0;x<i.length;x++)if(o[i.charCodeAt(x)]=!0,(h||g)&&v){const w=od[i.charAt(x)];w&&(o[w.charCodeAt(0)]=!0)}}populate(i,o,h){const g=this.layers[0],v=g.layout,x=v.get("text-font"),w=v.get("text-field"),E=v.get("icon-image"),P=(w.value.kind!=="constant"||w.value.value instanceof pr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),k=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const G=o.iconDependencies,$=o.glyphDependencies,q=o.availableImages,K=new yi(this.zoom,{globalState:this.globalState});for(const{feature:se,id:he,index:ze,sourceLayerIndex:Me}of i){const j=g._featureFilter.needGeometry,re=zl(se,j);if(!g._featureFilter.filter(K,re,h))continue;let Pe,$e;if(j||(re.geometry=kl(se)),P){const Ye=g.getValueAndResolveTokens("text-field",re,h,q),Qe=pr.factory(Ye),gt=this.hasRTLText=this.hasRTLText||jM(Qe);(!gt||ua.getRTLTextPluginStatus()==="unavailable"||gt&&ua.isParsed())&&(Pe=CM(Qe,g,re))}if(k){const Ye=g.getValueAndResolveTokens("icon-image",re,h,q);$e=Ye instanceof Rr?Ye:Rr.fromString(Ye)}if(!Pe&&!$e)continue;const st=this.sortFeaturesByKey?F.evaluate(re,{},h):void 0;if(this.features.push({id:he,text:Pe,icon:$e,index:ze,sourceLayerIndex:Me,geometry:re.geometry,properties:se.properties,type:GM[se.type],sortKey:st}),$e&&(G[$e.name]=!0),Pe){const Ye=x.evaluate(re,{},h).join(","),Qe=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(p.an.vertical)>=0;for(const gt of Pe.sections)if(gt.image)G[gt.image.name]=!0;else{const lt=Oh(Pe.toString()),yt=gt.fontStack||Ye,et=$[yt]=$[yt]||{};this.calculateGlyphDependencies(gt.text,et,Qe,this.allowVerticalPlacement,lt)}}}v.get("symbol-placement")==="line"&&(this.features=function(se){const he={},ze={},Me=[];let j=0;function re(Ye){Me.push(se[Ye]),j++}function Pe(Ye,Qe,gt){const lt=ze[Ye];return delete ze[Ye],ze[Qe]=lt,Me[lt].geometry[0].pop(),Me[lt].geometry[0]=Me[lt].geometry[0].concat(gt[0]),lt}function $e(Ye,Qe,gt){const lt=he[Qe];return delete he[Qe],he[Ye]=lt,Me[lt].geometry[0].shift(),Me[lt].geometry[0]=gt[0].concat(Me[lt].geometry[0]),lt}function st(Ye,Qe,gt){const lt=gt?Qe[0][Qe[0].length-1]:Qe[0][0];return`${Ye}:${lt.x}:${lt.y}`}for(let Ye=0;Ye<se.length;Ye++){const Qe=se[Ye],gt=Qe.geometry,lt=Qe.text?Qe.text.toString():null;if(!lt){re(Ye);continue}const yt=st(lt,gt),et=st(lt,gt,!0);if(yt in ze&&et in he&&ze[yt]!==he[et]){const zt=$e(yt,et,gt),en=Pe(yt,et,Me[zt].geometry);delete he[yt],delete ze[et],ze[st(lt,Me[en].geometry,!0)]=en,Me[zt].geometry=null}else yt in ze?Pe(yt,et,gt):et in he?$e(yt,et,gt):(re(Ye),he[yt]=j-1,ze[et]=j-1)}return Me.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,he)=>se.sortKey-he.sortKey)}update(i,o,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,o,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,o,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const h=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(o[i.segment+1]),v=i.dist(o[i.segment]);const x={};for(let w=i.segment+1;w<o.length;w++)x[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:g},w<o.length-1&&(g+=o[w+1].dist(o[w]));for(let w=i.segment||0;w>=0;w--)x[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=o[w-1].dist(o[w]));for(let w=0;w<o.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,o,h,g,v,x,w,E,P,k,F,G){const $=i.indexArray,q=i.layoutVertexArray,K=i.segments.prepareSegment(4*o.length,q,$,this.canOverlap?x.sortKey:void 0),se=this.glyphOffsetArray.length,he=K.vertexLength,ze=this.allowVerticalPlacement&&w===p.an.vertical?Math.PI/2:0,Me=x.text&&x.text.sections;for(let j=0;j<o.length;j++){const{tl:re,tr:Pe,bl:$e,br:st,tex:Ye,pixelOffsetTL:Qe,pixelOffsetBR:gt,minFontScaleX:lt,minFontScaleY:yt,glyphOffset:et,isSDF:zt,sectionIndex:en}=o[j],Jt=K.vertexLength,jt=et[1];qp(q,E.x,E.y,re.x,jt+re.y,Ye.x,Ye.y,h,zt,Qe.x,Qe.y,lt,yt),qp(q,E.x,E.y,Pe.x,jt+Pe.y,Ye.x+Ye.w,Ye.y,h,zt,gt.x,Qe.y,lt,yt),qp(q,E.x,E.y,$e.x,jt+$e.y,Ye.x,Ye.y+Ye.h,h,zt,Qe.x,gt.y,lt,yt),qp(q,E.x,E.y,st.x,jt+st.y,Ye.x+Ye.w,Ye.y+Ye.h,h,zt,gt.x,gt.y,lt,yt),xg(i.dynamicLayoutVertexArray,E,ze),$.emplaceBack(Jt,Jt+2,Jt+1),$.emplaceBack(Jt+1,Jt+2,Jt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),j!==o.length-1&&en===o[j+1].sectionIndex||i.programConfigurations.populatePaintArrays(q.length,x,x.index,{},G,Me&&Me[en])}i.placedSymbolArray.emplaceBack(E.x,E.y,se,this.glyphOffsetArray.length-se,he,P,k,E.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],w,0,!1,0,F)}_addCollisionDebugVertex(i,o,h,g,v,x){return o.emplaceBack(0,0),i.emplaceBack(h.x,h.y,g,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,o,h,g,v,x,w){const E=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),P=E.vertexLength,k=v.layoutVertexArray,F=v.collisionVertexArray,G=w.anchorX,$=w.anchorY;this._addCollisionDebugVertex(k,F,x,G,$,new B(i,o)),this._addCollisionDebugVertex(k,F,x,G,$,new B(h,o)),this._addCollisionDebugVertex(k,F,x,G,$,new B(h,g)),this._addCollisionDebugVertex(k,F,x,G,$,new B(i,g)),E.vertexLength+=4;const q=v.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),E.primitiveLength+=4}addDebugCollisionBoxes(i,o,h,g){for(let v=i;v<o;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wg(si,m0.members,ai),this.iconCollisionBox=new wg(si,m0.members,ai);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(i,o,h,g,v,x,w,E,P){const k={};for(let F=o;F<h;F++){const G=i.get(F);k.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},k.textFeatureIndex=G.featureIndex;break}for(let F=g;F<v;F++){const G=i.get(F);k.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},k.verticalTextFeatureIndex=G.featureIndex;break}for(let F=x;F<w;F++){const G=i.get(F);k.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},k.iconFeatureIndex=G.featureIndex;break}for(let F=E;F<P;F++){const G=i.get(F);k.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},k.verticalIconFeatureIndex=G.featureIndex;break}return k}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,o){const h=i.placedSymbolArray.get(o),g=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<g;v+=4)i.indexArray.emplaceBack(v,v+2,v+1),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(i),h=Math.cos(i),g=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);g.push(0|Math.round(o*E.anchorX+h*E.anchorY)),v.push(E.featureIndex)}return x.sort((w,E)=>g[w]-g[E]||v[E]-v[w]),x}addToSortKeyRanges(i,o){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===o?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const h=this.symbolInstances.get(o);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,v,x)=>{g>=0&&x.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let P0,I0;Pt("SymbolBucket",Qc,{omit:["layers","collisionBoxArray","features","compareText"]}),Qc.MAX_GLYPHS=65535,Qc.addDynamicAttributes=xg;var Sg={get paint(){return I0=I0||new Mr({"icon-opacity":new rn(be.paint_symbol["icon-opacity"]),"icon-color":new rn(be.paint_symbol["icon-color"]),"icon-halo-color":new rn(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new rn(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rn(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new rn(be.paint_symbol["text-opacity"]),"text-color":new rn(be.paint_symbol["text-color"],{runtimeType:vr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new rn(be.paint_symbol["text-halo-color"]),"text-halo-width":new rn(be.paint_symbol["text-halo-width"]),"text-halo-blur":new rn(be.paint_symbol["text-halo-blur"]),"text-translate":new Ft(be.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(be.paint_symbol["text-translate-anchor"])})},get layout(){return P0=P0||new Mr({"symbol-placement":new Ft(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rn(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new rn(be.layout_symbol["icon-size"]),"icon-text-fit":new Ft(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new rn(be.layout_symbol["icon-image"]),"icon-rotate":new rn(be.layout_symbol["icon-rotate"]),"icon-padding":new rn(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(be.layout_symbol["icon-keep-upright"]),"icon-offset":new rn(be.layout_symbol["icon-offset"]),"icon-anchor":new rn(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(be.layout_symbol["text-rotation-alignment"]),"text-field":new rn(be.layout_symbol["text-field"]),"text-font":new rn(be.layout_symbol["text-font"]),"text-size":new rn(be.layout_symbol["text-size"]),"text-max-width":new rn(be.layout_symbol["text-max-width"]),"text-line-height":new Ft(be.layout_symbol["text-line-height"]),"text-letter-spacing":new rn(be.layout_symbol["text-letter-spacing"]),"text-justify":new rn(be.layout_symbol["text-justify"]),"text-radial-offset":new rn(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new rn(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new rn(be.layout_symbol["text-anchor"]),"text-max-angle":new Ft(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(be.layout_symbol["text-writing-mode"]),"text-rotate":new rn(be.layout_symbol["text-rotate"]),"text-padding":new Ft(be.layout_symbol["text-padding"]),"text-keep-upright":new Ft(be.layout_symbol["text-keep-upright"]),"text-transform":new rn(be.layout_symbol["text-transform"]),"text-offset":new rn(be.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(be.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(be.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(be.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(be.layout_symbol["text-optional"])})}};class R0{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Ss,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",R0,{omit:["defaultValue"]});class Zp extends tr{constructor(i){super(i,Sg)}recalculate(i,o){if(super.recalculate(i,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const v of h)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,o,h,g){const v=this.layout.get(i).evaluate(o,{},h,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Ic(x.value)||!v?v:function(w,E){return E.replace(/{([^{}]+)}/g,(P,k)=>w&&k in w?String(w[k]):"")}(o.properties,v)}createBucket(i){return new Qc(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Sg.paint.overridableProperties){if(!Zp.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),h=new R0(o),g=new Pc(h,o.property.specification);let v=null;v=o.value.kind==="constant"||o.value.kind==="source"?new _l("source",g):new Lc("composite",g,o.value.zoomStops),this.paint._values[i]=new As(o.property,v,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,h){return!(!this.layout||o.isDataDriven()||h.isDataDriven())&&Zp.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const h=i.get("text-field"),g=Sg.paint.properties[o];let v=!1;const x=w=>{for(const E of w)if(g.overrides&&g.overrides.hasOverride(E))return void(v=!0)};if(h.value.kind==="constant"&&h.value.value instanceof pr)x(h.value.value.sections);else if(h.value.kind==="source"){const w=P=>{v||(P instanceof br&&an(P.value)===Ke?x(P.value.sections):P instanceof ul?x(P.sections):P.eachChild(w))},E=h.value;E._styleExpression&&w(E._styleExpression.expression)}return v}}let L0;var $M={get paint(){return L0=L0||new Mr({"background-color":new Ft(be.paint_background["background-color"]),"background-pattern":new Gh(be.paint_background["background-pattern"]),"background-opacity":new Ft(be.paint_background["background-opacity"])})}};class WM extends tr{constructor(i){super(i,$M)}}let D0;var qM={get paint(){return D0=D0||new Mr({"raster-opacity":new Ft(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(be.paint_raster["raster-saturation"]),"raster-contrast":new Ft(be.paint_raster["raster-contrast"]),"raster-resampling":new Ft(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(be.paint_raster["raster-fade-duration"])})}};class ZM extends tr{constructor(i){super(i,qM)}}class XM extends tr{constructor(i){super(i,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class YM{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const KM={once:!0},Mg=63710088e-1;class Bo{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bo(yn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,h=this.lat*o,g=i.lat*o,v=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((i.lng-this.lng)*o);return Mg*Math.acos(Math.min(v,1))}static convert(i){if(i instanceof Bo)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Bo(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Bo(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const k0=2*Math.PI*Mg;function z0(l){return k0*Math.cos(l*Math.PI/180)}function F0(l){return(180+l)/360}function O0(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function N0(l,i){return l/z0(i)}function Tg(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function U0(l,i){return l*z0(Tg(i))}class cd{constructor(i,o,h=0){this.x=+i,this.y=+o,this.z=+h}static fromLngLat(i,o=0){const h=Bo.convert(i);return new cd(F0(h.lng),O0(h.lat),N0(o,h.lat))}toLngLat(){return new Bo(360*this.x-180,Tg(this.y))}toAltitude(){return U0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k0*(i=Tg(this.y),1/Math.cos(i*Math.PI/180));var i}}function B0(l,i,o){var h=2*Math.PI*6378137/256/Math.pow(2,o);return[l*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class Eg{constructor(i,o,h){if(!function(g,v,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||v<0||v>=Math.pow(2,g))}(i,o,h))throw new Error(`x=${o}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=o,this.y=h,this.key=eu(0,i,i,o,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,o,h){const g=(x=this.y,w=this.z,E=B0(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),P=B0(256*(v+1),256*(x+1),w),E[0]+","+E[1]+","+P[0]+","+P[1]);var v,x,w,E,P;const k=function(F,G,$){let q,K="";for(let se=F;se>0;se--)q=1<<se-1,K+=(G&q?1:0)+($&q?2:0);return K}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const o=this.z-i.z;return o>0&&i.x===this.x>>o&&i.y===this.y>>o}getTilePoint(i){const o=Math.pow(2,this.z);return new B((i.x*o-this.x)*$t,(i.y*o-this.y)*$t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class V0{constructor(i,o){this.wrap=i,this.canonical=o,this.key=eu(i,o.z,o.z,o.x,o.y)}}class hs{constructor(i,o,h,g,v){if(this.terrainRttPosMatrix32f=null,i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=o,this.canonical=new Eg(h,+g,+v),this.key=eu(o,i,h,g,v)}clone(){return new hs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-i;return i>this.canonical.z?new hs(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(i,o){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?eu(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y):eu(this.wrap*+o,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const o=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new hs(o,this.wrap,o,h,g),new hs(o,this.wrap,o,h+1,g),new hs(o,this.wrap,o,h,g+1),new hs(o,this.wrap,o,h+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new hs(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new V0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new cd(i.x-this.wrap,i.y))}}function eu(l,i,o,h,g){(l*=2)<0&&(l=-1*l-1);const v=1<<o;return(v*v*l+v*g+h).toString(36)+o.toString(36)+i.toString(36)}Pt("CanonicalTileID",Eg),Pt("OverscaledTileID",hs,{omit:["terrainRttPosMatrix32f"]});class Nl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){const o=new Nl;return o.extend(i(new B(this.minX,this.minY))),o.extend(i(new B(this.maxX,this.minY))),o.extend(i(new B(this.minX,this.maxY))),o.extend(i(new B(this.maxX,this.maxY))),o}static fromPoints(i){const o=new Nl;for(const h of i)o.extend(h);return o}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class G0{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const h=i[o];this._stringToNumber[h]=o,this._numberToString[o]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class H0{constructor(i,o,h,g,v){this.type="Feature",this._vectorTileFeature=i,i._z=o,i._x=h,i._y=g,this.properties=i.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(i[o]=this[o]);return i}}class j0{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ko($t,16,0),this.grid3D=new ko($t,16,0),this.featureIndexArray=new qe,this.promoteId=o}insert(i,o,h,g,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,v);const E=x?this.grid3D:this.grid;for(let P=0;P<o.length;P++){const k=o[P],F=[1/0,1/0,-1/0,-1/0];for(let G=0;G<k.length;G++){const $=k[G];F[0]=Math.min(F[0],$.x),F[1]=Math.min(F[1],$.y),F[2]=Math.max(F[2],$.x),F[3]=Math.max(F[3],$.y)}F[0]<$t&&F[1]<$t&&F[2]>=0&&F[3]>=0&&E.insert(w,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new rd.VectorTile(new mg(this.rawTileData)).layers,this.sourceLayerCoder=new G0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,o,h,g){this.loadVTLayers();const v=i.params,x=$t/i.tileSize/i.scale,w=la(v.filter),E=i.queryGeometry,P=i.queryPadding*x,k=Nl.fromPoints(E),F=this.grid.query(k.minX-P,k.minY-P,k.maxX+P,k.maxY+P),G=Nl.fromPoints(i.cameraQueryGeometry).expandBy(P),$=this.grid3D.query(G.minX,G.minY,G.maxX,G.maxY,(se,he,ze,Me)=>function(j,re,Pe,$e,st){for(const Qe of j)if(re<=Qe.x&&Pe<=Qe.y&&$e>=Qe.x&&st>=Qe.y)return!0;const Ye=[new B(re,Pe),new B(re,st),new B($e,st),new B($e,Pe)];if(j.length>2){for(const Qe of Ye)if(Zc(j,Qe))return!0}for(let Qe=0;Qe<j.length-1;Qe++)if(NS(j[Qe],j[Qe+1],Ye))return!0;return!1}(i.cameraQueryGeometry,se-P,he-P,ze+P,Me+P));for(const se of $)F.push(se);F.sort(JM);const q={};let K;for(let se=0;se<F.length;se++){const he=F[se];if(he===K)continue;K=he;const ze=this.featureIndexArray.get(he);let Me=null;this.loadMatchingFeature(q,ze.bucketIndex,ze.sourceLayerIndex,ze.featureIndex,w,v.layers,v.availableImages,o,h,g,(j,re,Pe)=>(Me||(Me=kl(j)),re.queryIntersectsFeature({queryGeometry:E,feature:j,featureState:Pe,geometry:Me,zoom:this.z,transform:i.transform,pixelsToTileUnits:x,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation})))}return q}loadMatchingFeature(i,o,h,g,v,x,w,E,P,k,F){const G=this.bucketLayerIDs[o];if(x&&!G.some(se=>x.has(se)))return;const $=this.sourceLayerCoder.decode(h),q=this.vtLayers[$].feature(g);if(v.needGeometry){const se=zl(q,!0);if(!v.filter(new yi(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!v.filter(new yi(this.tileID.overscaledZ),q))return;const K=this.getId(q,$);for(let se=0;se<G.length;se++){const he=G[se];if(x&&!x.has(he))continue;const ze=E[he];if(!ze)continue;let Me={};K&&k&&(Me=k.getState(ze.sourceLayer||"_geojsonTileLayer",K));const j=Vn({},P[he]);j.paint=$0(j.paint,ze.paint,q,Me,w),j.layout=$0(j.layout,ze.layout,q,Me,w);const re=!F||F(q,ze,Me);if(!re)continue;const Pe=new H0(q,this.z,this.x,this.y,K);Pe.layer=j;let $e=i[he];$e===void 0&&($e=i[he]=[]),$e.push({featureIndex:g,feature:Pe,intersectionZ:re})}}lookupSymbolFeatures(i,o,h,g,v,x,w,E){const P={};this.loadVTLayers();const k=la(v);for(const F of i)this.loadMatchingFeature(P,h,g,F,k,x,w,E,o);return P}hasLayer(i){for(const o of this.bucketLayerIDs)for(const h of o)if(i===h)return!0;return!1}getId(i,o){var h;let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((h=i.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(g=Number(i.properties.cluster_id))),g}}function $0(l,i,o,h,g){return pn(l,(v,x)=>{const w=i instanceof jc?i.get(x):null;return w&&w.evaluate?w.evaluate(o,h,g):w})}function JM(l,i){return i-l}function W0(l,i,o,h,g){const v=[];for(let x=0;x<l.length;x++){const w=l[x];let E;for(let P=0;P<w.length-1;P++){let k=w[P],F=w[P+1];k.x<i&&F.x<i||(k.x<i?k=new B(i,k.y+(i-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x<i&&(F=new B(i,k.y+(i-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y<o&&F.y<o||(k.y<o?k=new B(k.x+(o-k.y)/(F.y-k.y)*(F.x-k.x),o)._round():F.y<o&&(F=new B(k.x+(o-k.y)/(F.y-k.y)*(F.x-k.x),o)._round()),k.x>=h&&F.x>=h||(k.x>=h?k=new B(h,k.y+(h-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x>=h&&(F=new B(h,k.y+(h-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y>=g&&F.y>=g||(k.y>=g?k=new B(k.x+(g-k.y)/(F.y-k.y)*(F.x-k.x),g)._round():F.y>=g&&(F=new B(k.x+(g-k.y)/(F.y-k.y)*(F.x-k.x),g)._round()),E&&k.equals(E[E.length-1])||(E=[k],v.push(E)),E.push(F)))))}}return v}Pt("FeatureIndex",j0,{omit:["rawTileData","sourceLayerCoder"]});class Vo extends B{constructor(i,o,h,g){super(i,o),this.angle=h,g!==void 0&&(this.segment=g)}clone(){return new Vo(this.x,this.y,this.angle,this.segment)}}function q0(l,i,o,h,g){if(i.segment===void 0||o===0)return!0;let v=i,x=i.segment+1,w=0;for(;w>-o/2;){if(x--,x<0)return!1;w-=l[x].dist(v),v=l[x]}w+=l[x].dist(l[x+1]),x++;const E=[];let P=0;for(;w<o/2;){const k=l[x],F=l[x+1];if(!F)return!1;let G=l[x-1].angleTo(k)-k.angleTo(F);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:G}),P+=G;w-E[0].distance>h;)P-=E.shift().angleDelta;if(P>g)return!1;x++,w+=k.dist(F)}return!0}function Z0(l){let i=0;for(let o=0;o<l.length-1;o++)i+=l[o].dist(l[o+1]);return i}function X0(l,i,o){return l?.6*i*o:0}function Y0(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function QM(l,i,o,h,g,v){const x=X0(o,g,v),w=Y0(o,h)*v;let E=0;const P=Z0(l)/2;for(let k=0;k<l.length-1;k++){const F=l[k],G=l[k+1],$=F.dist(G);if(E+$>P){const q=(P-E)/$,K=Nr.number(F.x,G.x,q),se=Nr.number(F.y,G.y,q),he=new Vo(K,se,G.angleTo(F),k);return he._round(),!x||q0(l,he,w,x,i)?he:void 0}E+=$}}function eT(l,i,o,h,g,v,x,w,E){const P=X0(h,v,x),k=Y0(h,g),F=k*x,G=l[0].x===0||l[0].x===E||l[0].y===0||l[0].y===E;return i-F<i/4&&(i=F+i/4),K0(l,G?i/2*w%i:(k/2+2*v)*x*w%i,i,P,o,F,G,!1,E)}function K0(l,i,o,h,g,v,x,w,E){const P=v/2,k=Z0(l);let F=0,G=i-o,$=[];for(let q=0;q<l.length-1;q++){const K=l[q],se=l[q+1],he=K.dist(se),ze=se.angleTo(K);for(;G+o<F+he;){G+=o;const Me=(G-F)/he,j=Nr.number(K.x,se.x,Me),re=Nr.number(K.y,se.y,Me);if(j>=0&&j<E&&re>=0&&re<E&&G-P>=0&&G+P<=k){const Pe=new Vo(j,re,ze,q);Pe._round(),h&&!q0(l,Pe,v,h,g)||$.push(Pe)}}F+=he}return w||$.length||x||($=K0(l,F/2,o,h,g,v,x,!0,E)),$}function J0(l,i,o,h){const g=[],v=l.image,x=v.pixelRatio,w=v.paddedRect.w-2,E=v.paddedRect.h-2;let P={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const k=v.stretchX||[[0,w]],F=v.stretchY||[[0,E]],G=(et,zt)=>et+zt[1]-zt[0],$=k.reduce(G,0),q=F.reduce(G,0),K=w-$,se=E-q;let he=0,ze=$,Me=0,j=q,re=0,Pe=K,$e=0,st=se;if(v.content&&h){const et=v.content,zt=et[2]-et[0],en=et[3]-et[1];(v.textFitWidth||v.textFitHeight)&&(P=E0(l)),he=Xp(k,0,et[0]),Me=Xp(F,0,et[1]),ze=Xp(k,et[0],et[2]),j=Xp(F,et[1],et[3]),re=et[0]-he,$e=et[1]-Me,Pe=zt-ze,st=en-j}const Ye=P.x1,Qe=P.y1,gt=P.x2-Ye,lt=P.y2-Qe,yt=(et,zt,en,Jt)=>{const jt=Yp(et.stretch-he,ze,gt,Ye),Dn=Kp(et.fixed-re,Pe,et.stretch,$),Ai=Yp(zt.stretch-Me,j,lt,Qe),Vi=Kp(zt.fixed-$e,st,zt.stretch,q),gr=Yp(en.stretch-he,ze,gt,Ye),ds=Kp(en.fixed-re,Pe,en.stretch,$),Br=Yp(Jt.stretch-Me,j,lt,Qe),sr=Kp(Jt.fixed-$e,st,Jt.stretch,q),Mi=new B(jt,Ai),Xi=new B(gr,Ai),ar=new B(gr,Br),or=new B(jt,Br),zr=new B(Dn/x,Vi/x),ps=new B(ds/x,sr/x),Yi=i*Math.PI/180;if(Yi){const Ki=Math.sin(Yi),Ji=Math.cos(Yi),Oi=[Ji,-Ki,Ki,Ji];Mi._matMult(Oi),Xi._matMult(Oi),or._matMult(Oi),ar._matMult(Oi)}const Vr=et.stretch+et.fixed,Gi=zt.stretch+zt.fixed;return{tl:Mi,tr:Xi,bl:or,br:ar,tex:{x:v.paddedRect.x+1+Vr,y:v.paddedRect.y+1+Gi,w:en.stretch+en.fixed-Vr,h:Jt.stretch+Jt.fixed-Gi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zr,pixelOffsetBR:ps,minFontScaleX:Pe/x/gt,minFontScaleY:st/x/lt,isSDF:o}};if(h&&(v.stretchX||v.stretchY)){const et=Q0(k,K,$),zt=Q0(F,se,q);for(let en=0;en<et.length-1;en++){const Jt=et[en],jt=et[en+1];for(let Dn=0;Dn<zt.length-1;Dn++)g.push(yt(Jt,zt[Dn],jt,zt[Dn+1]))}}else g.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return g}function Xp(l,i,o){let h=0;for(const g of l)h+=Math.max(i,Math.min(o,g[1]))-Math.max(i,Math.min(o,g[0]));return h}function Q0(l,i,o){const h=[{fixed:-1,stretch:0}];for(const[g,v]of l){const x=h[h.length-1];h.push({fixed:g-x.stretch,stretch:x.stretch}),h.push({fixed:g-x.stretch,stretch:x.stretch+(v-g)})}return h.push({fixed:i+1,stretch:o}),h}function Yp(l,i,o,h){return l/i*o+h}function Kp(l,i,o,h){return l-i*o/h}Pt("Anchor",Vo);class Jp{constructor(i,o,h,g,v,x,w,E,P,k){var F;if(this.boxStartIndex=i.length,P){let G=x.top,$=x.bottom;const q=x.collisionPadding;q&&(G-=q[1],$+=q[3]);let K=$-G;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{const G=!((F=x.image)===null||F===void 0)&&F.content&&(x.image.textFitWidth||x.image.textFitHeight)?E0(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};G.y1=G.y1*w-E[0],G.y2=G.y2*w+E[2],G.x1=G.x1*w-E[3],G.x2=G.x2*w+E[1];const $=x.collisionPadding;if($&&(G.x1-=$[0]*w,G.y1-=$[1]*w,G.x2+=$[2]*w,G.y2+=$[3]*w),k){const q=new B(G.x1,G.y1),K=new B(G.x2,G.y1),se=new B(G.x1,G.y2),he=new B(G.x2,G.y2),ze=k*Math.PI/180;q._rotate(ze),K._rotate(ze),se._rotate(ze),he._rotate(ze),G.x1=Math.min(q.x,K.x,se.x,he.x),G.x2=Math.max(q.x,K.x,se.x,he.x),G.y1=Math.min(q.y,K.y,se.y,he.y),G.y2=Math.max(q.y,K.y,se.y,he.y)}i.emplaceBack(o.x,o.y,G.x1,G.y1,G.x2,G.y2,h,g,v)}this.boxEndIndex=i.length}}class tT{constructor(i=[],o=(h,g)=>h<g?-1:h>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:h}=this,g=o[i];for(;i>0;){const v=i-1>>1,x=o[v];if(h(g,x)>=0)break;o[i]=x,i=v}o[i]=g}_down(i){const{data:o,compare:h}=this,g=this.length>>1,v=o[i];for(;i<g;){let x=1+(i<<1);const w=x+1;if(w<this.length&&h(o[w],o[x])<0&&(x=w),h(o[x],v)>=0)break;o[i]=o[x],i=x}o[i]=v}}function nT(l,i=1,o=!1){const h=Nl.fromPoints(l[0]),g=Math.min(h.width(),h.height());let v=g/2;const x=new tT([],iT),{minX:w,minY:E,maxX:P,maxY:k}=h;if(g===0)return new B(w,E);for(let $=w;$<P;$+=g)for(let q=E;q<k;q+=g)x.push(new tu($+v,q+v,v,l));let F=function($){let q=0,K=0,se=0;const he=$[0];for(let ze=0,Me=he.length,j=Me-1;ze<Me;j=ze++){const re=he[ze],Pe=he[j],$e=re.x*Pe.y-Pe.x*re.y;K+=(re.x+Pe.x)*$e,se+=(re.y+Pe.y)*$e,q+=3*$e}return new tu(K/q,se/q,0,$)}(l),G=x.length;for(;x.length;){const $=x.pop();($.d>F.d||!F.d)&&(F=$,o&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,G)),$.max-F.d<=i||(v=$.h/2,x.push(new tu($.p.x-v,$.p.y-v,v,l)),x.push(new tu($.p.x+v,$.p.y-v,v,l)),x.push(new tu($.p.x-v,$.p.y+v,v,l)),x.push(new tu($.p.x+v,$.p.y+v,v,l)),G+=4)}return o&&(console.log(`num probes: ${G}`),console.log(`best distance: ${F.d}`)),F.p}function iT(l,i){return i.max-l.max}function tu(l,i,o,h){this.p=new B(l,i),this.h=o,this.d=function(g,v){let x=!1,w=1/0;for(let E=0;E<v.length;E++){const P=v[E];for(let k=0,F=P.length,G=F-1;k<F;G=k++){const $=P[k],q=P[G];$.y>g.y!=q.y>g.y&&g.x<(q.x-$.x)*(g.y-$.y)/(q.y-$.y)+$.x&&(x=!x),w=Math.min(w,Lv(g,$,q))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var mr;p.aD=void 0,(mr=p.aD||(p.aD={}))[mr.center=1]="center",mr[mr.left=2]="left",mr[mr.right=3]="right",mr[mr.top=4]="top",mr[mr.bottom=5]="bottom",mr[mr["top-left"]=6]="top-left",mr[mr["top-right"]=7]="top-right",mr[mr["bottom-left"]=8]="bottom-left",mr[mr["bottom-right"]=9]="bottom-right";const Ag=Number.POSITIVE_INFINITY;function ex(l,i){return i[1]!==Ag?function(o,h,g){let v=0,x=0;switch(h=Math.abs(h),g=Math.abs(g),o){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(o){case"top-right":case"bottom-right":case"right":v=-h;break;case"top-left":case"bottom-left":case"left":v=h}return[v,x]}(l,i[0],i[1]):function(o,h){let g=0,v=0;h<0&&(h=0);const x=h/Math.SQRT2;switch(o){case"top-right":case"top-left":v=x-7;break;case"bottom-right":case"bottom-left":v=7-x;break;case"bottom":v=7-h;break;case"top":v=h-7}switch(o){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=h;break;case"right":g=-h}return[g,v]}(l,i[0])}function tx(l,i,o){var h;const g=l.layout,v=(h=g.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(i,{},o);if(v){const w=v.values,E=[];for(let P=0;P<w.length;P+=2){const k=E[P]=w[P],F=w[P+1].map(G=>G*Zi);k.startsWith("top")?F[1]-=7:k.startsWith("bottom")&&(F[1]+=7),E[P+1]=F}return new Nn(E)}const x=g.get("text-variable-anchor");if(x){let w;w=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},o)*Zi,Ag]:g.get("text-offset").evaluate(i,{},o).map(P=>P*Zi);const E=[];for(const P of x)E.push(P,ex(P,w));return new Nn(E)}return null}function Cg(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rT(l,i,o,h,g,v,x,w,E,P,k,F){let G=v.textMaxSize.evaluate(i,{});G===void 0&&(G=x);const $=l.layers[0].layout,q=$.get("icon-offset").evaluate(i,{},k),K=ix(o.horizontal),se=x/24,he=l.tilePixelRatio*se,ze=l.tilePixelRatio*G/24,Me=l.tilePixelRatio*w,j=l.tilePixelRatio*$.get("symbol-spacing"),re=$.get("text-padding")*l.tilePixelRatio,Pe=function(en,Jt,jt,Dn=1){const Ai=en.get("icon-padding").evaluate(Jt,{},jt),Vi=Ai&&Ai.values;return[Vi[0]*Dn,Vi[1]*Dn,Vi[2]*Dn,Vi[3]*Dn]}($,i,k,l.tilePixelRatio),$e=$.get("text-max-angle")/180*Math.PI,st=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Ye=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Qe=$.get("symbol-placement"),gt=j/2,lt=$.get("icon-text-fit");let yt;h&&lt!=="none"&&(l.allowVerticalPlacement&&o.vertical&&(yt=A0(h,o.vertical,lt,$.get("icon-text-fit-padding"),q,se)),K&&(h=A0(h,K,lt,$.get("icon-text-fit-padding"),q,se)));const et=k?F.line.getGranularityForZoomLevel(k.z):1,zt=(en,Jt)=>{Jt.x<0||Jt.x>=$t||Jt.y<0||Jt.y>=$t||function(jt,Dn,Ai,Vi,gr,ds,Br,sr,Mi,Xi,ar,or,zr,ps,Yi,Vr,Gi,Ki,Ji,Oi,fi,Vs,nu,Gs,oT){const iu=jt.addToLineVertexArray(Dn,Ai);let Ul,ru,su,au,ox=0,lx=0,cx=0,ux=0,Fg=-1,Og=-1;const $a={};let hx=kr("");if(jt.allowVerticalPlacement&&Vi.vertical){const Er=sr.layout.get("text-rotate").evaluate(fi,{},Gs)+90;su=new Jp(Mi,Dn,Xi,ar,or,Vi.vertical,zr,ps,Yi,Er),Br&&(au=new Jp(Mi,Dn,Xi,ar,or,Br,Gi,Ki,Yi,Er))}if(gr){const Er=sr.layout.get("icon-rotate").evaluate(fi,{}),fs=sr.layout.get("icon-text-fit")!=="none",Bl=J0(gr,Er,nu,fs),js=Br?J0(Br,Er,nu,fs):void 0;ru=new Jp(Mi,Dn,Xi,ar,or,gr,Gi,Ki,!1,Er),ox=4*Bl.length;const Vl=jt.iconSizeData;let ya=null;Vl.kind==="source"?(ya=[ja*sr.layout.get("icon-size").evaluate(fi,{})],ya[0]>Uo&&cn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Vl.kind==="composite"&&(ya=[ja*Vs.compositeIconSizes[0].evaluate(fi,{},Gs),ja*Vs.compositeIconSizes[1].evaluate(fi,{},Gs)],(ya[0]>Uo||ya[1]>Uo)&&cn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Bl,ya,Oi,Ji,fi,p.an.none,Dn,iu.lineStartIndex,iu.lineLength,-1,Gs),Fg=jt.icon.placedSymbolArray.length-1,js&&(lx=4*js.length,jt.addSymbols(jt.icon,js,ya,Oi,Ji,fi,p.an.vertical,Dn,iu.lineStartIndex,iu.lineLength,-1,Gs),Og=jt.icon.placedSymbolArray.length-1)}const dx=Object.keys(Vi.horizontal);for(const Er of dx){const fs=Vi.horizontal[Er];if(!Ul){hx=kr(fs.text);const js=sr.layout.get("text-rotate").evaluate(fi,{},Gs);Ul=new Jp(Mi,Dn,Xi,ar,or,fs,zr,ps,Yi,js)}const Bl=fs.positionedLines.length===1;if(cx+=nx(jt,Dn,fs,ds,sr,Yi,fi,Vr,iu,Vi.vertical?p.an.horizontal:p.an.horizontalOnly,Bl?dx:[Er],$a,Fg,Vs,Gs),Bl)break}Vi.vertical&&(ux+=nx(jt,Dn,Vi.vertical,ds,sr,Yi,fi,Vr,iu,p.an.vertical,["vertical"],$a,Og,Vs,Gs));const lT=Ul?Ul.boxStartIndex:jt.collisionBoxArray.length,cT=Ul?Ul.boxEndIndex:jt.collisionBoxArray.length,uT=su?su.boxStartIndex:jt.collisionBoxArray.length,hT=su?su.boxEndIndex:jt.collisionBoxArray.length,dT=ru?ru.boxStartIndex:jt.collisionBoxArray.length,pT=ru?ru.boxEndIndex:jt.collisionBoxArray.length,fT=au?au.boxStartIndex:jt.collisionBoxArray.length,mT=au?au.boxEndIndex:jt.collisionBoxArray.length;let Hs=-1;const ef=(Er,fs)=>Er&&Er.circleDiameter?Math.max(Er.circleDiameter,fs):fs;Hs=ef(Ul,Hs),Hs=ef(su,Hs),Hs=ef(ru,Hs),Hs=ef(au,Hs);const px=Hs>-1?1:0;px&&(Hs*=oT/Zi),jt.glyphOffsetArray.length>=Qc.MAX_GLYPHS&&cn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,fi.sortKey);const gT=tx(sr,fi,Gs),[_T,yT]=function(Er,fs){const Bl=Er.length,js=fs==null?void 0:fs.values;if((js==null?void 0:js.length)>0)for(let Vl=0;Vl<js.length;Vl+=2){const ya=js[Vl+1];Er.emplaceBack(p.aD[js[Vl]],ya[0],ya[1])}return[Bl,Er.length]}(jt.textAnchorOffsets,gT);jt.symbolInstances.emplaceBack(Dn.x,Dn.y,$a.right>=0?$a.right:-1,$a.center>=0?$a.center:-1,$a.left>=0?$a.left:-1,$a.vertical||-1,Fg,Og,hx,lT,cT,uT,hT,dT,pT,fT,mT,Xi,cx,ux,ox,lx,px,0,zr,Hs,_T,yT)}(l,Jt,en,o,h,g,yt,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,he,[re,re,re,re],st,E,Me,Pe,Ye,q,i,v,P,k,x)};if(Qe==="line")for(const en of W0(i.geometry,0,0,$t,$t)){const Jt=Ol(en,et),jt=eT(Jt,j,$e,o.vertical||K,h,24,ze,l.overscaling,$t);for(const Dn of jt)K&&sT(l,K.text,gt,Dn)||zt(Jt,Dn)}else if(Qe==="line-center"){for(const en of i.geometry)if(en.length>1){const Jt=Ol(en,et),jt=QM(Jt,$e,o.vertical||K,h,24,ze);jt&&zt(Jt,jt)}}else if(i.type==="Polygon")for(const en of wc(i.geometry,0)){const Jt=nT(en,16);zt(Ol(en[0],et,!0),new Vo(Jt.x,Jt.y,0))}else if(i.type==="LineString")for(const en of i.geometry){const Jt=Ol(en,et);zt(Jt,new Vo(Jt[0].x,Jt[0].y,0))}else if(i.type==="Point")for(const en of i.geometry)for(const Jt of en)zt([Jt],new Vo(Jt.x,Jt.y,0))}function nx(l,i,o,h,g,v,x,w,E,P,k,F,G,$,q){const K=function(ze,Me,j,re,Pe,$e,st,Ye){const Qe=re.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,gt=[];for(const lt of Me.positionedLines)for(const yt of lt.positionedGlyphs){if(!yt.rect)continue;const et=yt.rect||{};let zt=4,en=!0,Jt=1,jt=0;const Dn=(Pe||Ye)&&yt.vertical,Ai=yt.metrics.advance*yt.scale/2;if(Ye&&Me.verticalizable&&(jt=lt.lineOffset/2-(yt.imageName?-(Zi-yt.metrics.width*yt.scale)/2:(yt.scale-1)*Zi)),yt.imageName){const Ki=st[yt.imageName];en=Ki.sdf,Jt=Ki.pixelRatio,zt=1/Jt}const Vi=Pe?[yt.x+Ai,yt.y]:[0,0];let gr=Pe?[0,0]:[yt.x+Ai+j[0],yt.y+j[1]-jt],ds=[0,0];Dn&&(ds=gr,gr=[0,0]);const Br=yt.metrics.isDoubleResolution?2:1,sr=(yt.metrics.left-zt)*yt.scale-Ai+gr[0],Mi=(-yt.metrics.top-zt)*yt.scale+gr[1],Xi=sr+et.w/Br*yt.scale/Jt,ar=Mi+et.h/Br*yt.scale/Jt,or=new B(sr,Mi),zr=new B(Xi,Mi),ps=new B(sr,ar),Yi=new B(Xi,ar);if(Dn){const Ki=new B(-Ai,Ai- -17),Ji=-Math.PI/2,Oi=12-Ai,fi=new B(22-Oi,-(yt.imageName?Oi:0)),Vs=new B(...ds);or._rotateAround(Ji,Ki)._add(fi)._add(Vs),zr._rotateAround(Ji,Ki)._add(fi)._add(Vs),ps._rotateAround(Ji,Ki)._add(fi)._add(Vs),Yi._rotateAround(Ji,Ki)._add(fi)._add(Vs)}if(Qe){const Ki=Math.sin(Qe),Ji=Math.cos(Qe),Oi=[Ji,-Ki,Ki,Ji];or._matMult(Oi),zr._matMult(Oi),ps._matMult(Oi),Yi._matMult(Oi)}const Vr=new B(0,0),Gi=new B(0,0);gt.push({tl:or,tr:zr,bl:ps,br:Yi,tex:et,writingMode:Me.writingMode,glyphOffset:Vi,sectionIndex:yt.sectionIndex,isSDF:en,pixelOffsetTL:Vr,pixelOffsetBR:Gi,minFontScaleX:0,minFontScaleY:0})}return gt}(0,o,w,g,v,x,h,l.allowVerticalPlacement),se=l.textSizeData;let he=null;se.kind==="source"?(he=[ja*g.layout.get("text-size").evaluate(x,{})],he[0]>Uo&&cn(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(he=[ja*$.compositeTextSizes[0].evaluate(x,{},q),ja*$.compositeTextSizes[1].evaluate(x,{},q)],(he[0]>Uo||he[1]>Uo)&&cn(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,K,he,w,v,x,P,i,E.lineStartIndex,E.lineLength,G,q);for(const ze of k)F[ze]=l.text.placedSymbolArray.length-1;return 4*K.length}function ix(l){for(const i in l)return l[i];return null}function sT(l,i,o,h){const g=l.compareText;if(i in g){const v=g[i];for(let x=v.length-1;x>=0;x--)if(h.dist(v[x])<o)return!0}else g[i]=[];return g[i].push(h),!1}const rx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pg{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,h]=new Uint8Array(i,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=rx[15&h];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new Pg(w,x,v,i)}constructor(i,o=64,h=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=rx.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=i)}add(i,o){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=o,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Ig(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,o,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,E=[0,v.length-1,0],P=[];for(;E.length;){const k=E.pop()||0,F=E.pop()||0,G=E.pop()||0;if(F-G<=w){for(let se=G;se<=F;se++){const he=x[2*se],ze=x[2*se+1];he>=i&&he<=h&&ze>=o&&ze<=g&&P.push(v[se])}continue}const $=G+F>>1,q=x[2*$],K=x[2*$+1];q>=i&&q<=h&&K>=o&&K<=g&&P.push(v[$]),(k===0?i<=q:o<=K)&&(E.push(G),E.push($-1),E.push(1-k)),(k===0?h>=q:g>=K)&&(E.push($+1),E.push(F),E.push(1-k))}return P}within(i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:x}=this,w=[0,g.length-1,0],E=[],P=h*h;for(;w.length;){const k=w.pop()||0,F=w.pop()||0,G=w.pop()||0;if(F-G<=x){for(let se=G;se<=F;se++)ax(v[2*se],v[2*se+1],i,o)<=P&&E.push(g[se]);continue}const $=G+F>>1,q=v[2*$],K=v[2*$+1];ax(q,K,i,o)<=P&&E.push(g[$]),(k===0?i-h<=q:o-h<=K)&&(w.push(G),w.push($-1),w.push(1-k)),(k===0?i+h>=q:o+h>=K)&&(w.push($+1),w.push(F),w.push(1-k))}return E}}function Ig(l,i,o,h,g,v){if(g-h<=o)return;const x=h+g>>1;sx(l,i,x,h,g,v),Ig(l,i,o,h,x-1,1-v),Ig(l,i,o,x+1,g,1-v)}function sx(l,i,o,h,g,v){for(;g>h;){if(g-h>600){const P=g-h+1,k=o-h+1,F=Math.log(P),G=.5*Math.exp(2*F/3),$=.5*Math.sqrt(F*G*(P-G)/P)*(k-P/2<0?-1:1);sx(l,i,o,Math.max(h,Math.floor(o-k*G/P+$)),Math.min(g,Math.floor(o+(P-k)*G/P+$)),v)}const x=i[2*o+v];let w=h,E=g;for(ud(l,i,h,o),i[2*g+v]>x&&ud(l,i,h,g);w<E;){for(ud(l,i,w,E),w++,E--;i[2*w+v]<x;)w++;for(;i[2*E+v]>x;)E--}i[2*h+v]===x?ud(l,i,h,E):(E++,ud(l,i,E,g)),E<=o&&(h=E+1),o<=E&&(g=E-1)}}function ud(l,i,o,h){Rg(l,o,h),Rg(i,2*o,2*h),Rg(i,2*o+1,2*h+1)}function Rg(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}function ax(l,i,o,h){const g=l-o,v=i-h;return g*g+v*v}var Lg;p.cw=void 0,(Lg=p.cw||(p.cw={})).create="create",Lg.load="load",Lg.fullLoad="fullLoad";let Qp=null,hd=[];const Dg=1e3/60,kg="loadTime",zg="fullLoadTime",aT={mark(l){performance.mark(l)},frame(l){const i=l;Qp!=null&&hd.push(i-Qp),Qp=i},clearMetrics(){Qp=null,hd=[],performance.clearMeasures(kg),performance.clearMeasures(zg);for(const l in p.cw)performance.clearMarks(p.cw[l])},getPerformanceMetrics(){performance.measure(kg,p.cw.create,p.cw.load),performance.measure(zg,p.cw.create,p.cw.fullLoad);const l=performance.getEntriesByName(kg)[0].duration,i=performance.getEntriesByName(zg)[0].duration,o=hd.length,h=1/(hd.reduce((v,x)=>v+x,0)/o/1e3),g=hd.filter(v=>v>Dg).reduce((v,x)=>v+(x-Dg)/Dg,0);return{loadTime:l,fullLoadTime:i,fps:h,percentDroppedFrames:g/(o+g)*100,totalFrames:o}}};p.$=$t,p.A=fe,p.B=function([l,i,o]){return i+=90,i*=Math.PI/180,o*=Math.PI/180,{x:l*Math.cos(i)*Math.sin(o),y:l*Math.sin(i)*Math.sin(o),z:l*Math.cos(o)}},p.C=Nr,p.D=Ft,p.E=Ue,p.F=yi,p.G=Bc,p.H=function(l){if(Yt==null){const i=l.navigator?l.navigator.userAgent:null;Yt=!!l.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Yt},p.I=gg,p.J=class{constructor(l,i){this.target=l,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new YM(()=>this.process()),this.subscription=rt(this.target,"message",o=>this.receive(o),!1),this.globalScope=Tn(self)?l:window}registerMessageHandler(l,i){this.messageHandlers[l]=i}sendAsync(l,i){return new Promise((o,h)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),v=i?rt(i.signal,"abort",()=>{v==null||v.unsubscribe(),delete this.resolveRejects[g];const E={id:g,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},KM):null;this.resolveRejects[g]={resolve:E=>{v==null||v.unsubscribe(),o(E)},reject:E=>{v==null||v.unsubscribe(),h(E)}};const x=[],w=Object.assign(Object.assign({},l),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Tl(l.data,x)});this.target.postMessage(w,{transfer:x})})}receive(l){const i=l.data,o=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[o];const h=this.abortControllers[o];return delete this.abortControllers[o],void(h&&h.abort())}if(Tn(self)||i.mustQueue)return this.tasks[o]=i,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,i)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),i=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(l,i)}processTask(l,i){return s(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[l];return delete this.resolveRejects[l],g?void(i.error?g.reject(zo(i.error)):g.resolve(zo(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=zo(i.data),h=new AbortController;this.abortControllers[l]=h;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,o,h);this.completeTask(l,null,g)}catch(g){this.completeTask(l,g)}})}completeTask(l,i,o){const h=[];delete this.abortControllers[l];const g={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Tl(i):null,data:Tl(o,h)};this.target.postMessage(g,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},p.K=J,p.L=function(){var l=new fe(16);return fe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},p.M=function(l,i,o){var h,g,v,x,w,E,P,k,F,G,$,q,K=o[0],se=o[1],he=o[2];return i===l?(l[12]=i[0]*K+i[4]*se+i[8]*he+i[12],l[13]=i[1]*K+i[5]*se+i[9]*he+i[13],l[14]=i[2]*K+i[6]*se+i[10]*he+i[14],l[15]=i[3]*K+i[7]*se+i[11]*he+i[15]):(g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],P=i[6],k=i[7],F=i[8],G=i[9],$=i[10],q=i[11],l[0]=h=i[0],l[1]=g,l[2]=v,l[3]=x,l[4]=w,l[5]=E,l[6]=P,l[7]=k,l[8]=F,l[9]=G,l[10]=$,l[11]=q,l[12]=h*K+w*se+F*he+i[12],l[13]=g*K+E*se+G*he+i[13],l[14]=v*K+P*se+$*he+i[14],l[15]=x*K+k*se+q*he+i[15]),l},p.N=function(l,i,o){var h=o[0],g=o[1],v=o[2];return l[0]=i[0]*h,l[1]=i[1]*h,l[2]=i[2]*h,l[3]=i[3]*h,l[4]=i[4]*g,l[5]=i[5]*g,l[6]=i[6]*g,l[7]=i[7]*g,l[8]=i[8]*v,l[9]=i[9]*v,l[10]=i[10]*v,l[11]=i[11]*v,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},p.O=function(l,i,o){var h=i[0],g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],P=i[6],k=i[7],F=i[8],G=i[9],$=i[10],q=i[11],K=i[12],se=i[13],he=i[14],ze=i[15],Me=o[0],j=o[1],re=o[2],Pe=o[3];return l[0]=Me*h+j*w+re*F+Pe*K,l[1]=Me*g+j*E+re*G+Pe*se,l[2]=Me*v+j*P+re*$+Pe*he,l[3]=Me*x+j*k+re*q+Pe*ze,l[4]=(Me=o[4])*h+(j=o[5])*w+(re=o[6])*F+(Pe=o[7])*K,l[5]=Me*g+j*E+re*G+Pe*se,l[6]=Me*v+j*P+re*$+Pe*he,l[7]=Me*x+j*k+re*q+Pe*ze,l[8]=(Me=o[8])*h+(j=o[9])*w+(re=o[10])*F+(Pe=o[11])*K,l[9]=Me*g+j*E+re*G+Pe*se,l[10]=Me*v+j*P+re*$+Pe*he,l[11]=Me*x+j*k+re*q+Pe*ze,l[12]=(Me=o[12])*h+(j=o[13])*w+(re=o[14])*F+(Pe=o[15])*K,l[13]=Me*g+j*E+re*G+Pe*se,l[14]=Me*v+j*P+re*$+Pe*he,l[15]=Me*x+j*k+re*q+Pe*ze,l},p.P=B,p.Q=function(l,i){const o={};for(let h=0;h<i.length;h++){const g=i[h];g in l&&(o[g]=l[g])}return o},p.R=Ur,p.S=Bo,p.T=tg,p.U=O0,p.V=F0,p.W=me,p.X=Q,p.Y=Ze,p.Z=hs,p._=s,p.a=W,p.a$=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l[2]=i[2]*o,l[3]=i[3]*o,l},p.a0=cd,p.a1=Nl,p.a2=25,p.a3=Eg,p.a4=l=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(o=>{i.onloadstart=()=>{o(i)};for(const h of l){const g=window.document.createElement("source");ne(h)||(i.crossOrigin="Anonymous"),g.src=h,i.appendChild(g)}})},p.a5=_t,p.a6=function(){return Ln++},p.a7=oe,p.a8=Qc,p.a9=la,p.aA=Zi,p.aB=Rn,p.aC=function(l,i,o,h,g=!1){if(!o[0]&&!o[1])return[0,0];const v=g?h==="map"?-l.bearingInRadians:0:h==="viewport"?l.bearingInRadians:0;if(v){const x=Math.sin(v),w=Math.cos(v);o=[o[0]*w-o[1]*x,o[0]*x+o[1]*w]}return[g?o[0]:Rn(i,o[0],l.zoom),g?o[1]:Rn(i,o[1],l.zoom)]},p.aE=vg,p.aF=Cg,p.aG=yg,p.aH=Pg,p.aI=Ei,p.aJ=Gp,p.aK=He,p.aL=Gn,p.aM=li,p.aN=yn,p.aO=At,p.aP=U0,p.aQ=Je,p.aR=nt,p.aS=function(l){var i=new fe(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i},p.aT=function(l,i,o){return l[0]=i[0]-o[0],l[1]=i[1]-o[1],l[2]=i[2]-o[2],l},p.aU=function(l,i){var o=i[0],h=i[1],g=i[2],v=o*o+h*h+g*g;return v>0&&(v=1/Math.sqrt(v)),l[0]=i[0]*v,l[1]=i[1]*v,l[2]=i[2]*v,l},p.aV=ut,p.aW=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]},p.aX=function(l,i,o){return l[0]=i[0]*o[0],l[1]=i[1]*o[1],l[2]=i[2]*o[2],l[3]=i[3]*o[3],l},p.aY=ie,p.aZ=function(l,i,o){const h=i[0]*o[0]+i[1]*o[1]+i[2]*o[2];return h===0?null:(-(l[0]*o[0]+l[1]*o[1]+l[2]*o[2])-o[3])/h},p.a_=ot,p.aa=zl,p.ab=H0,p.ac=function(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,h,g,v)=>{const x=g||v;return i[h]=!x||x.toLowerCase(),""}),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i},p.ad=Vt,p.ae=function(l){return Math.pow(2,l)},p.af=ke,p.ag=Xt,p.ah=85.051129,p.ai=N0,p.aj=function(l){return Math.log(l)/Math.LN2},p.ak=function(l){var i=l[0],o=l[1];return i*i+o*o},p.al=function(l,i){const o=[];for(const h in l)h in i||o.push(h);return o},p.am=function(l,i){let o=0,h=0;if(l.kind==="constant")h=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:x}=l,w=g?Xt(wr.interpolationFactor(g,i,v,x),0,1):0;l.kind==="camera"?h=Nr.number(l.minSize,l.maxSize,w):o=w}return{uSizeT:o,uSize:h}},p.ao=function(l,{uSize:i,uSizeT:o},{lowerSize:h,upperSize:g}){return l.kind==="source"?h/ja:l.kind==="composite"?Nr.number(h/ja,g/ja,o):i},p.ap=function(l,i){var o=i[0],h=i[1],g=i[2],v=i[3],x=i[4],w=i[5],E=i[6],P=i[7],k=i[8],F=i[9],G=i[10],$=i[11],q=i[12],K=i[13],se=i[14],he=i[15],ze=o*w-h*x,Me=o*E-g*x,j=o*P-v*x,re=h*E-g*w,Pe=h*P-v*w,$e=g*P-v*E,st=k*K-F*q,Ye=k*se-G*q,Qe=k*he-$*q,gt=F*se-G*K,lt=F*he-$*K,yt=G*he-$*se,et=ze*yt-Me*lt+j*gt+re*Qe-Pe*Ye+$e*st;return et?(l[0]=(w*yt-E*lt+P*gt)*(et=1/et),l[1]=(g*lt-h*yt-v*gt)*et,l[2]=(K*$e-se*Pe+he*re)*et,l[3]=(G*Pe-F*$e-$*re)*et,l[4]=(E*Qe-x*yt-P*Ye)*et,l[5]=(o*yt-g*Qe+v*Ye)*et,l[6]=(se*j-q*$e-he*Me)*et,l[7]=(k*$e-G*j+$*Me)*et,l[8]=(x*lt-w*Qe+P*st)*et,l[9]=(h*Qe-o*lt-v*st)*et,l[10]=(q*Pe-K*j+he*ze)*et,l[11]=(F*j-k*Pe-$*ze)*et,l[12]=(w*Ye-x*gt-E*st)*et,l[13]=(o*gt-h*Ye+g*st)*et,l[14]=(K*Me-q*re-se*ze)*et,l[15]=(k*re-F*Me+G*ze)*et,l):null},p.aq=Ut,p.ar=function(l){return Math.hypot(l[0],l[1])},p.as=function(l){return l[0]=0,l[1]=0,l},p.at=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l},p.au=xg,p.av=ft,p.aw=function(l,i,o,h){const g=i.y-l.y,v=i.x-l.x,x=h.y-o.y,w=h.x-o.x,E=x*v-w*g;if(E===0)return null;const P=(w*(l.y-o.y)-x*(l.x-o.x))/E;return new B(l.x+P*v,l.y+P*g)},p.ax=W0,p.ay=Iv,p.az=function(l){let i=1/0,o=1/0,h=-1/0,g=-1/0;for(const v of l)i=Math.min(i,v.x),o=Math.min(o,v.y),h=Math.max(h,v.x),g=Math.max(g,v.y);return[i,o,h,g]},p.b=ve,p.b$=AM,p.b0=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]+l[3]},p.b1=V0,p.b2=eu,p.b3=function(l,i,o,h,g){var v,x=1/Math.tan(i/2);return l[0]=x/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=x,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,g!=null&&g!==1/0?(l[10]=(g+h)*(v=1/(h-g)),l[14]=2*g*h*v):(l[10]=-1,l[14]=-2*h),l},p.b4=function(l){var i=new fe(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},p.b5=function(l,i,o){var h=Math.sin(o),g=Math.cos(o),v=i[0],x=i[1],w=i[2],E=i[3],P=i[4],k=i[5],F=i[6],G=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=v*g+P*h,l[1]=x*g+k*h,l[2]=w*g+F*h,l[3]=E*g+G*h,l[4]=P*g-v*h,l[5]=k*g-x*h,l[6]=F*g-w*h,l[7]=G*g-E*h,l},p.b6=function(l,i,o){var h=Math.sin(o),g=Math.cos(o),v=i[4],x=i[5],w=i[6],E=i[7],P=i[8],k=i[9],F=i[10],G=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=v*g+P*h,l[5]=x*g+k*h,l[6]=w*g+F*h,l[7]=E*g+G*h,l[8]=P*g-v*h,l[9]=k*g-x*h,l[10]=F*g-w*h,l[11]=G*g-E*h,l},p.b7=function(){const l=new Float32Array(16);return ke(l),l},p.b8=function(){const l=new Float64Array(16);return ke(l),l},p.b9=function(){return new Float64Array(16)},p.bA=function(l){return l[0]=0,l[1]=0,l[2]=0,l},p.bB=function(l,i,o,h){const g=Math.sqrt(l*l+i*i),v=Math.sqrt(o*o+h*h);l/=g,i/=g,o/=v,h/=v;const x=Math.acos(l*o+i*h);return-i*o+l*h>0?x:-x},p.bC=function(l,i){const o=it(l,2*Math.PI),h=it(i,2*Math.PI);return Math.min(Math.abs(o-h),Math.abs(o-h+2*Math.PI),Math.abs(o-h-2*Math.PI))},p.bD=function(){const l={},i=be.$version;for(const o in be.$root){const h=be.$root[o];if(h.required){let g=null;g=o==="version"?i:h.type==="array"?[]:{},g!=null&&(l[o]=g)}}return l},p.bE=Fh,p.bF=Te,p.bG=function l(i,o){if(Array.isArray(i)){if(!Array.isArray(o)||i.length!==o.length)return!1;for(let h=0;h<i.length;h++)if(!l(i[h],o[h]))return!1;return!0}if(typeof i=="object"&&i!==null&&o!==null){if(typeof o!="object"||Object.keys(i).length!==Object.keys(o).length)return!1;for(const h in i)if(!l(i[h],o[h]))return!1;return!0}return i===o},p.bH=function(l){l=l.slice();const i=Object.create(null);for(let o=0;o<l.length;o++)i[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=Nt(l[o],i[l[o].ref]));return l},p.bI=function(l){if(l.type==="custom")return new XM(l);switch(l.type){case"background":return new WM(l);case"circle":return new BS(l);case"color-relief":return new WS(l);case"fill":return new oM(l);case"fill-extrusion":return new mM(l);case"heatmap":return new GS(l);case"hillshade":return new jS(l);case"line":return new SM(l);case"raster":return new ZM(l);case"symbol":return new Zp(l)}},p.bJ=gi,p.bK=function(l,i){if(!l)return[{command:"setStyle",args:[i]}];let o=[];try{if(!pt(l.version,i.version))return[{command:"setStyle",args:[i]}];pt(l.center,i.center)||o.push({command:"setCenter",args:[i.center]}),pt(l.state,i.state)||o.push({command:"setGlobalState",args:[i.state]}),pt(l.centerAltitude,i.centerAltitude)||o.push({command:"setCenterAltitude",args:[i.centerAltitude]}),pt(l.zoom,i.zoom)||o.push({command:"setZoom",args:[i.zoom]}),pt(l.bearing,i.bearing)||o.push({command:"setBearing",args:[i.bearing]}),pt(l.pitch,i.pitch)||o.push({command:"setPitch",args:[i.pitch]}),pt(l.roll,i.roll)||o.push({command:"setRoll",args:[i.roll]}),pt(l.sprite,i.sprite)||o.push({command:"setSprite",args:[i.sprite]}),pt(l.glyphs,i.glyphs)||o.push({command:"setGlyphs",args:[i.glyphs]}),pt(l.transition,i.transition)||o.push({command:"setTransition",args:[i.transition]}),pt(l.light,i.light)||o.push({command:"setLight",args:[i.light]}),pt(l.terrain,i.terrain)||o.push({command:"setTerrain",args:[i.terrain]}),pt(l.sky,i.sky)||o.push({command:"setSky",args:[i.sky]}),pt(l.projection,i.projection)||o.push({command:"setProjection",args:[i.projection]});const h={},g=[];(function(x,w,E,P){let k;for(k in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,k)&&(Object.prototype.hasOwnProperty.call(w,k)||ni(k,E,P));for(k in w)Object.prototype.hasOwnProperty.call(w,k)&&(Object.prototype.hasOwnProperty.call(x,k)?pt(x[k],w[k])||(x[k].type==="geojson"&&w[k].type==="geojson"&&xn(x,w,k)?Dt(E,{command:"setGeoJSONSourceData",args:[k,w[k].data]}):qn(k,w,E,P)):Kt(k,w,E))})(l.sources,i.sources,g,h);const v=[];l.layers&&l.layers.forEach(x=>{"source"in x&&h[x.source]?o.push({command:"removeLayer",args:[x.id]}):v.push(x)}),o=o.concat(g),function(x,w,E){w=w||[];const P=(x=x||[]).map(wn),k=w.map(wn),F=x.reduce(Ii,{}),G=w.reduce(Ii,{}),$=P.slice(),q=Object.create(null);let K,se,he,ze,Me;for(let j=0,re=0;j<P.length;j++)K=P[j],Object.prototype.hasOwnProperty.call(G,K)?re++:(Dt(E,{command:"removeLayer",args:[K]}),$.splice($.indexOf(K,re),1));for(let j=0,re=0;j<k.length;j++)K=k[k.length-1-j],$[$.length-1-j]!==K&&(Object.prototype.hasOwnProperty.call(F,K)?(Dt(E,{command:"removeLayer",args:[K]}),$.splice($.lastIndexOf(K,$.length-re),1)):re++,ze=$[$.length-j],Dt(E,{command:"addLayer",args:[G[K],ze]}),$.splice($.length-j,0,K),q[K]=!0);for(let j=0;j<k.length;j++)if(K=k[j],se=F[K],he=G[K],!q[K]&&!pt(se,he))if(pt(se.source,he.source)&&pt(se["source-layer"],he["source-layer"])&&pt(se.type,he.type)){for(Me in nn(se.layout,he.layout,E,K,null,"setLayoutProperty"),nn(se.paint,he.paint,E,K,null,"setPaintProperty"),pt(se.filter,he.filter)||Dt(E,{command:"setFilter",args:[K,he.filter]}),pt(se.minzoom,he.minzoom)&&pt(se.maxzoom,he.maxzoom)||Dt(E,{command:"setLayerZoomRange",args:[K,he.minzoom,he.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?nn(se[Me],he[Me],E,K,Me.slice(6),"setPaintProperty"):pt(se[Me],he[Me])||Dt(E,{command:"setLayerProperty",args:[K,Me,he[Me]]}));for(Me in he)Object.prototype.hasOwnProperty.call(he,Me)&&!Object.prototype.hasOwnProperty.call(se,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?nn(se[Me],he[Me],E,K,Me.slice(6),"setPaintProperty"):pt(se[Me],he[Me])||Dt(E,{command:"setLayerProperty",args:[K,Me,he[Me]]}))}else Dt(E,{command:"removeLayer",args:[K]}),ze=$[$.lastIndexOf(K)+1],Dt(E,{command:"addLayer",args:[he,ze]})}(v,i.layers,o)}catch(h){console.warn("Unable to compute style diff:",h),o=[{command:"setStyle",args:[i]}]}return o},p.bL=function(l){const i=[],o=l.id;return o===void 0&&i.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},p.bM=pn,p.bN=Fe,p.bO=class extends pi{constructor(l,i){super(l,i),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.bP=Op,p.bQ=class extends pi{constructor(l,i){super(l,i),this.current=Zm}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let i=1;i<16;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},p.bR=Bi,p.bS=class extends pi{constructor(l,i){super(l,i),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},p.bT=class extends pi{constructor(l,i){super(l,i),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},p.bU=ye,p.bV=function(l,i){var o=Math.sin(i),h=Math.cos(i);return l[0]=h,l[1]=o,l[2]=0,l[3]=-o,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},p.bW=function(l,i,o){var h=i[0],g=i[1],v=i[2];return l[0]=h*o[0]+g*o[3]+v*o[6],l[1]=h*o[1]+g*o[4]+v*o[7],l[2]=h*o[2]+g*o[5]+v*o[8],l},p.bX=function(l,i,o,h,g,v,x){var w=1/(i-o),E=1/(h-g),P=1/(v-x);return l[0]=-2*w,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*E,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*P,l[11]=0,l[12]=(i+o)*w,l[13]=(g+h)*E,l[14]=(x+v)*P,l[15]=1,l},p.bY=class extends pi{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(4*l.length);for(let o=0;o<l.length;o++)i[4*o]=l[o].r,i[4*o+1]=l[o].g,i[4*o+2]=l[o].b,i[4*o+3]=l[o].a;this.gl.uniform4fv(this.location,i)}}},p.bZ=class extends pi{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(l);this.gl.uniform1fv(this.location,i)}}},p.b_=class extends d{},p.ba=function(l,i,o){const h=new Float64Array(4);return It(h,l,i-90,o),h},p.bb=function(l,i,o,h){var g,v,x,w,E,P=i[0],k=i[1],F=i[2],G=i[3],$=o[0],q=o[1],K=o[2],se=o[3];return(v=P*$+k*q+F*K+G*se)<0&&(v=-v,$=-$,q=-q,K=-K,se=-se),1-v>de?(g=Math.acos(v),x=Math.sin(g),w=Math.sin((1-h)*g)/x,E=Math.sin(h*g)/x):(w=1-h,E=h),l[0]=w*P+E*$,l[1]=w*k+E*q,l[2]=w*F+E*K,l[3]=w*G+E*se,l},p.bc=function(l){const i=new Float64Array(9);var o,h,g,v,x,w,E,P,k,F,G,$,q,K,se,he,ze,Me;F=(g=(h=l)[0])*(E=g+g),G=(v=h[1])*E,q=(x=h[2])*E,K=x*(P=v+v),he=(w=h[3])*E,ze=w*P,Me=w*(k=x+x),(o=i)[0]=1-($=v*P)-(se=x*k),o[3]=G-Me,o[6]=q+ze,o[1]=G+Me,o[4]=1-F-se,o[7]=K-he,o[2]=q-ze,o[5]=K+he,o[8]=1-F-$;const j=At(-Math.asin(Xt(i[2],-1,1)));let re,Pe;return Math.hypot(i[5],i[8])<.001?(re=0,Pe=-At(Math.atan2(i[3],i[4]))):(re=At(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),Pe=At(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:re,pitch:j+90,bearing:Pe}},p.bd=function(l,i){return l.roll==i.roll&&l.pitch==i.pitch&&l.bearing==i.bearing},p.be=An,p.bf=Tr,p.bg=Kc,p.bh=nd,p.bi=Yc,p.bj=Tt,p.bk=qt,p.bl=hn,p.bm=function(l,i,o,h,g){return Tt(h,g,Xt((l-i)/(o-i),0,1))},p.bn=it,p.bo=function(){return new Float64Array(3)},p.bp=function(l,i,o,h){return l[0]=i[0]+o[0]*h,l[1]=i[1]+o[1]*h,l[2]=i[2]+o[2]*h,l},p.bq=It,p.br=function(l,i,o){var h=o[0],g=o[1],v=o[2],x=i[0],w=i[1],E=i[2],P=g*E-v*w,k=v*x-h*E,F=h*w-g*x,G=g*F-v*k,$=v*P-h*F,q=h*k-g*P,K=2*o[3];return k*=K,F*=K,$*=2,q*=2,l[0]=x+(P*=K)+(G*=2),l[1]=w+k+$,l[2]=E+F+q,l},p.bs=function(l,i,o){const h=(g=[l[0],l[1],l[2],i[0],i[1],i[2],o[0],o[1],o[2]])[0]*((k=g[8])*(x=g[4])-(w=g[5])*(P=g[7]))+g[1]*(-k*(v=g[3])+w*(E=g[6]))+g[2]*(P*v-x*E);var g,v,x,w,E,P,k;if(h===0)return null;const F=ut([],[i[0],i[1],i[2]],[o[0],o[1],o[2]]),G=ut([],[o[0],o[1],o[2]],[l[0],l[1],l[2]]),$=ut([],[l[0],l[1],l[2]],[i[0],i[1],i[2]]),q=Je([],F,-l[3]);return nt(q,q,Je([],G,-i[3])),nt(q,q,Je([],$,-o[3])),Je(q,q,1/h),q},p.bt=Mg,p.bu=function(){return new Float64Array(4)},p.bv=function(l,i,o,h){var g=[],v=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],v[0]=g[0]*Math.cos(h)-g[1]*Math.sin(h),v[1]=g[0]*Math.sin(h)+g[1]*Math.cos(h),v[2]=g[2],l[0]=v[0]+o[0],l[1]=v[1]+o[1],l[2]=v[2]+o[2],l},p.bw=function(l,i,o,h){var g=[],v=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],v[0]=g[0],v[1]=g[1]*Math.cos(h)-g[2]*Math.sin(h),v[2]=g[1]*Math.sin(h)+g[2]*Math.cos(h),l[0]=v[0]+o[0],l[1]=v[1]+o[1],l[2]=v[2]+o[2],l},p.bx=function(l,i,o,h){var g=[],v=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],v[0]=g[2]*Math.sin(h)+g[0]*Math.cos(h),v[1]=g[1],v[2]=g[2]*Math.cos(h)-g[0]*Math.sin(h),l[0]=v[0]+o[0],l[1]=v[1]+o[1],l[2]=v[2]+o[2],l},p.by=function(l,i,o){var h=Math.sin(o),g=Math.cos(o),v=i[0],x=i[1],w=i[2],E=i[3],P=i[8],k=i[9],F=i[10],G=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=v*g-P*h,l[1]=x*g-k*h,l[2]=w*g-F*h,l[3]=E*g-G*h,l[8]=v*h+P*g,l[9]=x*h+k*g,l[10]=w*h+F*g,l[11]=E*h+G*g,l},p.bz=function(l,i){const o=it(l,360),h=it(i,360),g=h-o,v=h>o?g-360:g+360;return Math.abs(g)<Math.abs(v)?g:v},p.c=Ce,p.c0=class extends y{},p.c1=eg,p.c2=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},p.c3=Bv,p.c4=function(l,i,o){var h=i[0],g=i[1],v=i[2],x=o[3]*h+o[7]*g+o[11]*v+o[15];return l[0]=(o[0]*h+o[4]*g+o[8]*v+o[12])/(x=x||1),l[1]=(o[1]*h+o[5]*g+o[9]*v+o[13])/x,l[2]=(o[2]*h+o[6]*g+o[10]*v+o[14])/x,l},p.c5=class extends Hh{},p.c6=class extends N{},p.c7=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]&&l[4]===i[4]&&l[5]===i[5]&&l[6]===i[6]&&l[7]===i[7]&&l[8]===i[8]&&l[9]===i[9]&&l[10]===i[10]&&l[11]===i[11]&&l[12]===i[12]&&l[13]===i[13]&&l[14]===i[14]&&l[15]===i[15]},p.c8=function(l,i){var o=l[0],h=l[1],g=l[2],v=l[3],x=l[4],w=l[5],E=l[6],P=l[7],k=l[8],F=l[9],G=l[10],$=l[11],q=l[12],K=l[13],se=l[14],he=l[15],ze=i[0],Me=i[1],j=i[2],re=i[3],Pe=i[4],$e=i[5],st=i[6],Ye=i[7],Qe=i[8],gt=i[9],lt=i[10],yt=i[11],et=i[12],zt=i[13],en=i[14],Jt=i[15];return Math.abs(o-ze)<=de*Math.max(1,Math.abs(o),Math.abs(ze))&&Math.abs(h-Me)<=de*Math.max(1,Math.abs(h),Math.abs(Me))&&Math.abs(g-j)<=de*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(v-re)<=de*Math.max(1,Math.abs(v),Math.abs(re))&&Math.abs(x-Pe)<=de*Math.max(1,Math.abs(x),Math.abs(Pe))&&Math.abs(w-$e)<=de*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(E-st)<=de*Math.max(1,Math.abs(E),Math.abs(st))&&Math.abs(P-Ye)<=de*Math.max(1,Math.abs(P),Math.abs(Ye))&&Math.abs(k-Qe)<=de*Math.max(1,Math.abs(k),Math.abs(Qe))&&Math.abs(F-gt)<=de*Math.max(1,Math.abs(F),Math.abs(gt))&&Math.abs(G-lt)<=de*Math.max(1,Math.abs(G),Math.abs(lt))&&Math.abs($-yt)<=de*Math.max(1,Math.abs($),Math.abs(yt))&&Math.abs(q-et)<=de*Math.max(1,Math.abs(q),Math.abs(et))&&Math.abs(K-zt)<=de*Math.max(1,Math.abs(K),Math.abs(zt))&&Math.abs(se-en)<=de*Math.max(1,Math.abs(se),Math.abs(en))&&Math.abs(he-Jt)<=de*Math.max(1,Math.abs(he),Math.abs(Jt))},p.c9=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},p.cA=function(l){delete W.REGISTERED_PROTOCOLS[l]},p.cB=function(l,i){const o={};for(let g=0;g<l.length;g++){const v=i&&i[l[g].id]||zc(l[g]);i&&(i[l[g].id]=v);let x=o[v];x||(x=o[v]=[]),x.push(l[g])}const h=[];for(const g in o)h.push(o[g]);return h},p.cC=Pt,p.cD=G0,p.cE=j0,p.cF=x0,p.cG=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=$t/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const i=l.bucket.layers[0],o=i.layout,h=i._unevaluatedLayout._values,g={layoutIconSize:h["icon-size"].possiblyEvaluate(new yi(l.bucket.zoom+1),l.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new yi(l.bucket.zoom+1),l.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new yi(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=l.bucket.textSizeData;g.compositeTextSizes=[h["text-size"].possiblyEvaluate(new yi(P),l.canonical),h["text-size"].possiblyEvaluate(new yi(k),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=l.bucket.iconSizeData;g.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new yi(P),l.canonical),h["icon-size"].possiblyEvaluate(new yi(k),l.canonical)]}const v=o.get("text-line-height")*Zi,x=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",w=o.get("text-keep-upright"),E=o.get("text-size");for(const P of l.bucket.features){const k=o.get("text-font").evaluate(P,{},l.canonical).join(","),F=E.evaluate(P,{},l.canonical),G=g.layoutTextSize.evaluate(P,{},l.canonical),$=g.layoutIconSize.evaluate(P,{},l.canonical),q={horizontal:{},vertical:void 0},K=P.text;let se,he=[0,0];if(K){const j=K.toString(),re=o.get("text-letter-spacing").evaluate(P,{},l.canonical)*Zi,Pe=Ip(j)?re:0,$e=o.get("text-anchor").evaluate(P,{},l.canonical),st=tx(i,P,l.canonical);if(!st){const lt=o.get("text-radial-offset").evaluate(P,{},l.canonical);he=lt?ex($e,[lt*Zi,Ag]):o.get("text-offset").evaluate(P,{},l.canonical).map(yt=>yt*Zi)}let Ye=x?"center":o.get("text-justify").evaluate(P,{},l.canonical);const Qe=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(P,{},l.canonical)*Zi:1/0,gt=()=>{l.bucket.allowVerticalPlacement&&Oh(j)&&(q.vertical=$p(K,l.glyphMap,l.glyphPositions,l.imagePositions,k,Qe,v,$e,"left",Pe,he,p.an.vertical,!0,G,F))};if(!x&&st){const lt=new Set;if(Ye==="auto")for(let et=0;et<st.values.length;et+=2)lt.add(Cg(st.values[et]));else lt.add(Ye);let yt=!1;for(const et of lt)if(!q.horizontal[et])if(yt)q.horizontal[et]=q.horizontal[0];else{const zt=$p(K,l.glyphMap,l.glyphPositions,l.imagePositions,k,Qe,v,"center",et,Pe,he,p.an.horizontal,!1,G,F);zt&&(q.horizontal[et]=zt,yt=zt.positionedLines.length===1)}gt()}else{Ye==="auto"&&(Ye=Cg($e));const lt=$p(K,l.glyphMap,l.glyphPositions,l.imagePositions,k,Qe,v,$e,Ye,Pe,he,p.an.horizontal,!1,G,F);lt&&(q.horizontal[Ye]=lt),gt(),Oh(j)&&x&&w&&(q.vertical=$p(K,l.glyphMap,l.glyphPositions,l.imagePositions,k,Qe,v,$e,Ye,Pe,he,p.an.vertical,!1,G,F))}}let ze=!1;if(P.icon&&P.icon.name){const j=l.imageMap[P.icon.name];j&&(se=VM(l.imagePositions[P.icon.name],o.get("icon-offset").evaluate(P,{},l.canonical),o.get("icon-anchor").evaluate(P,{},l.canonical)),ze=!!j.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=ze:l.bucket.sdfIcons!==ze&&cn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==l.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const Me=ix(q.horizontal)||q.vertical;l.bucket.iconsInText=!!Me&&Me.iconsInText,(Me||se)&&rT(l.bucket,P,q,se,l.imageMap,g,G,$,he,ze,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},p.cH=dg,p.cI=ag,p.cJ=hg,p.cK=rd,p.cL=mg,p.cM=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},p.cN=function(l,i,o,h,g){return s(this,void 0,void 0,function*(){if(Q())try{return yield Ze(l,i,o,h,g)}catch{}return function(v,x,w,E,P){const k=v.width,F=v.height;ct&&mt||(ct=new OffscreenCanvas(k,F),mt=ct.getContext("2d",{willReadFrequently:!0})),ct.width=k,ct.height=F,mt.drawImage(v,0,0,k,F);const G=mt.getImageData(x,w,E,P);return mt.clearRect(0,0,k,F),G.data}(l,i,o,h,g)})},p.cO=Hv,p.cP=S,p.cQ=I,p.cR=a0,p.cS=y0,p.cT=Rc,p.cU=ua,p.ca=l=>l.type==="symbol",p.cb=l=>l.type==="circle",p.cc=l=>l.type==="heatmap",p.cd=l=>l.type==="line",p.ce=l=>l.type==="fill",p.cf=l=>l.type==="fill-extrusion",p.cg=l=>l.type==="hillshade",p.ch=l=>l.type==="color-relief",p.ci=l=>l.type==="raster",p.cj=l=>l.type==="background",p.ck=l=>l.type==="custom",p.cl=Rt,p.cm=function(l,i,o){const h=Wt(i.x-o.x,i.y-o.y),g=Wt(l.x-o.x,l.y-o.y);var v,x;return At(Math.atan2(h[0]*g[1]-h[1]*g[0],(v=h)[0]*(x=g)[0]+v[1]*x[1]))},p.cn=on,p.co=function(l,i){return zn[i]&&(l instanceof MouseEvent||l instanceof WheelEvent)},p.cp=function(l,i){return Gt[i]&&"touches"in l},p.cq=function(l){return Gt[l]||zn[l]},p.cr=function(l,i,o){var h=i[0],g=i[1];return l[0]=o[0]*h+o[4]*g+o[12],l[1]=o[1]*h+o[5]*g+o[13],l},p.cs=function(l,i){const{x:o,y:h}=cd.fromLngLat(i);return!(l<0||l>25||h<0||h>=1||o<0||o>=1)},p.ct=function(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},p.cu=class extends da{},p.cv=aT,p.cx=function(l){return l.message===bt},p.cy=ue,p.cz=function(l,i){W.REGISTERED_PROTOCOLS[l]=i},p.d=ne,p.e=Vn,p.f=l=>s(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(i)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),p.g=X,p.h=l=>new Promise((i,o)=>{const h=new Image;h.onload=()=>{i(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=te})},h.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(l)],{type:"image/png"});h.src=l.byteLength?URL.createObjectURL(g):te}),p.i=Tn,p.j=(l,i)=>De(Vn(l,{type:"json"}),i),p.k=Ie,p.l=Ee,p.m=De,p.n=(l,i)=>De(Vn(l,{type:"arrayBuffer"}),i),p.o=function(l){return new mg(l).readFields(IM,[])},p.p=v0,p.q=Kh,p.r=Mr,p.s=rt,p.t=Vh,p.u=Pn,p.v=be,p.w=cn,p.x=Gm,p.y=Sl,p.z=Do}),u("worker",["./shared"],function(p){class s{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const ue of W){this._layerConfigs[ue.id]=ue;const Te=this._layers[ue.id]=p.bI(ue);Te._featureFilter=p.a9(Te.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of X)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const J=p.cB(Object.values(this._layerConfigs),this.keyCache);for(const ue of J){const Te=ue.map(Ie=>this._layers[Ie.id]),De=Te[0];if(De.visibility==="none")continue;const ne=De.source||"";let _e=this.familiesBySource[ne];_e||(_e=this.familiesBySource[ne]={});const xe=De.sourceLayer||"_geojsonTileLayer";let Ee=_e[xe];Ee||(Ee=_e[xe]=[]),Ee.push(Te)}}}class S{constructor(W){const X={},J=[];for(const ne in W){const _e=W[ne],xe=X[ne]={};for(const Ee in _e){const Ie=_e[+Ee];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ue={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};J.push(Ue),xe[Ee]={rect:Ue,metrics:Ie.metrics}}}const{w:ue,h:Te}=p.p(J),De=new p.q({width:ue||1,height:Te||1});for(const ne in W){const _e=W[ne];for(const xe in _e){const Ee=_e[+xe];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const Ie=X[ne][xe].rect;p.q.copy(Ee.bitmap,De,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Ee.bitmap)}}this.image=De,this.positions=X}}p.cC("GlyphAtlas",S);class M{constructor(W){this.tileID=new p.Z(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[],this.globalState=W.globalState}parse(W,X,J,ue,Te){return p._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new p.a7;const De=new p.cD(Object.keys(W.layers).sort()),ne=new p.cE(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const _e={},xe={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J,subdivisionGranularity:Te},Ee=X.familiesBySource[this.source];for(const nn in Ee){const wn=W.layers[nn];if(!wn)continue;wn.version===1&&p.w(`Vector tile source "${this.source}" layer "${nn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ii=De.encode(nn),_t=[];for(let ki=0;ki<wn.length;ki++){const ii=wn.feature(ki),as=ne.getId(ii,nn);_t.push({feature:ii,id:as,index:ki,sourceLayerIndex:Ii})}for(const ki of Ee[nn]){const ii=ki[0];ii.source!==this.source&&p.w(`layer.source = ${ii.source} does not equal this.source = ${this.source}`),ii.minzoom&&this.zoom<Math.floor(ii.minzoom)||ii.maxzoom&&this.zoom>=ii.maxzoom||ii.visibility!=="none"&&(C(ki,this.zoom,J),(_e[ii.id]=ii.createBucket({index:ne.bucketLayerIDs.length,layers:ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ii,sourceID:this.source,globalState:this.globalState})).populate(_t,xe,this.tileID.canonical),ne.bucketLayerIDs.push(ki.map(as=>as.id)))}}const Ie=p.bM(xe.glyphDependencies,nn=>Object.keys(nn).map(Number));this.inFlightDependencies.forEach(nn=>nn==null?void 0:nn.abort()),this.inFlightDependencies=[];let Ue=Promise.resolve({});if(Object.keys(Ie).length){const nn=new AbortController;this.inFlightDependencies.push(nn),Ue=ue.sendAsync({type:"GG",data:{stacks:Ie,source:this.source,tileID:this.tileID,type:"glyphs"}},nn)}const be=Object.keys(xe.iconDependencies);let dt=Promise.resolve({});if(be.length){const nn=new AbortController;this.inFlightDependencies.push(nn),dt=ue.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},nn)}const Nt=Object.keys(xe.patternDependencies);let pt=Promise.resolve({});if(Nt.length){const nn=new AbortController;this.inFlightDependencies.push(nn),pt=ue.sendAsync({type:"GI",data:{icons:Nt,source:this.source,tileID:this.tileID,type:"patterns"}},nn)}const[Dt,Kt,ni]=yield Promise.all([Ue,dt,pt]),qn=new S(Dt),xn=new p.cF(Kt,ni);for(const nn in _e){const wn=_e[nn];wn instanceof p.a8?(C(wn.layers,this.zoom,J),p.cG({bucket:wn,glyphMap:Dt,glyphPositions:qn.positions,imageMap:Kt,imagePositions:xn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:xe.subdivisionGranularity})):wn.hasPattern&&(wn instanceof p.cH||wn instanceof p.cI||wn instanceof p.cJ)&&(C(wn.layers,this.zoom,J),wn.addFeatures(xe,this.tileID.canonical,xn.patternPositions))}return this.status="done",{buckets:Object.values(_e).filter(nn=>!nn.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qn.image,imageAtlas:xn,glyphMap:this.returnDependencies?Dt:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?qn.positions:null}})}}function C(Ce,W,X){const J=new p.F(W);for(const ue of Ce)ue.recalculate(J,X)}class I{constructor(W,X,J){this.actor=W,this.layerIndex=X,this.availableImages=J,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return p._(this,void 0,void 0,function*(){const J=yield p.n(W.request,X);try{return{vectorTile:new p.cK.VectorTile(new p.cL(J.data)),rawData:J.data,cacheControl:J.cacheControl,expires:J.expires}}catch(ue){const Te=new Uint8Array(J.data);let De=`Unable to parse the tile at ${W.request.url}, `;throw De+=Te[0]===31&&Te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(De)}})}loadTile(W){return p._(this,void 0,void 0,function*(){const X=W.uid,J=!!(W&&W.request&&W.request.collectResourceTiming)&&new p.cM(W.request),ue=new M(W);this.loading[X]=ue;const Te=new AbortController;ue.abort=Te;try{const De=yield this.loadVectorTile(W,Te);if(delete this.loading[X],!De)return null;const ne=De.rawData,_e={};De.expires&&(_e.expires=De.expires),De.cacheControl&&(_e.cacheControl=De.cacheControl);const xe={};if(J){const Ie=J.finish();Ie&&(xe.resourceTiming=JSON.parse(JSON.stringify(Ie)))}ue.vectorTile=De.vectorTile;const Ee=ue.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[X]=ue,this.fetching[X]={rawTileData:ne,cacheControl:_e,resourceTiming:xe};try{const Ie=yield Ee;return p.e({rawTileData:ne.slice(0)},Ie,_e,xe)}finally{delete this.fetching[X]}}catch(De){throw delete this.loading[X],ue.status="done",this.loaded[X]=ue,De}})}reloadTile(W){return p._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const J=this.loaded[X];if(J.showCollisionBoxes=W.showCollisionBoxes,J.globalState=W.globalState,J.status==="parsing"){const ue=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Te;if(this.fetching[X]){const{rawTileData:De,cacheControl:ne,resourceTiming:_e}=this.fetching[X];delete this.fetching[X],Te=p.e({rawTileData:De.slice(0)},ue,ne,_e)}else Te=ue;return Te}if(J.status==="done"&&J.vectorTile)return J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return p._(this,void 0,void 0,function*(){const X=this.loading,J=W.uid;X&&X[J]&&X[J].abort&&(X[J].abort.abort(),delete X[J])})}removeTile(W){return p._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class L{constructor(){this.loaded={}}loadTile(W){return p._(this,void 0,void 0,function*(){const{uid:X,encoding:J,rawImageData:ue,redFactor:Te,greenFactor:De,blueFactor:ne,baseShift:_e}=W,xe=ue.width+2,Ee=ue.height+2,Ie=p.b(ue)?new p.R({width:xe,height:Ee},yield p.cN(ue,-1,-1,xe,Ee)):ue,Ue=new p.cO(X,Ie,J,Te,De,ne,_e);return this.loaded=this.loaded||{},this.loaded[X]=Ue,Ue})}removeTile(W){const X=this.loaded,J=W.uid;X&&X[J]&&delete X[J]}}var R,B,Z=function(){if(B)return R;function Ce(X,J){if(X.length!==0){W(X[0],J);for(var ue=1;ue<X.length;ue++)W(X[ue],!J)}}function W(X,J){for(var ue=0,Te=0,De=0,ne=X.length,_e=ne-1;De<ne;_e=De++){var xe=(X[De][0]-X[_e][0])*(X[_e][1]+X[De][1]),Ee=ue+xe;Te+=Math.abs(ue)>=Math.abs(xe)?ue-Ee+xe:xe-Ee+ue,ue=Ee}ue+Te>=0!=!!J&&X.reverse()}return B=1,R=function X(J,ue){var Te,De=J&&J.type;if(De==="FeatureCollection")for(Te=0;Te<J.features.length;Te++)X(J.features[Te],ue);else if(De==="GeometryCollection")for(Te=0;Te<J.geometries.length;Te++)X(J.geometries[Te],ue);else if(De==="Feature")X(J.geometry,ue);else if(De==="Polygon")Ce(J.coordinates,ue);else if(De==="MultiPolygon")for(Te=0;Te<J.coordinates.length;Te++)Ce(J.coordinates[Te],ue);return J}}(),V=p.cP(Z);const O=p.cK.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(W){this._feature=W,this.extent=p.$,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const X of this._feature.geometry)W.push([new p.P(X[0],X[1])]);return W}{const W=[];for(const X of this._feature.geometry){const J=[];for(const ue of X)J.push(new p.P(ue[0],ue[1]));W.push(J)}return W}}toGeoJSON(W,X,J){return O.call(this,W,X,J)}}class me{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.$,this.length=W.length,this._features=W}feature(W){return new ge(this._features[W])}}var Q,de,fe,ye={exports:{}},ke=function(){if(fe)return ye.exports;fe=1;var Ce=p.cS(),W=function(){if(de)return Q;de=1;var Ee=p.cQ(),Ie=p.cR().VectorTileFeature;function Ue(dt,Nt){this.options=Nt||{},this.features=dt,this.length=dt.length}function be(dt,Nt){this.id=typeof dt.id=="number"?dt.id:void 0,this.type=dt.type,this.rawGeometry=dt.type===1?[dt.geometry]:dt.geometry,this.properties=dt.tags,this.extent=Nt||4096}return Q=Ue,Ue.prototype.feature=function(dt){return new be(this.features[dt],this.options.extent)},be.prototype.loadGeometry=function(){var dt=this.rawGeometry;this.geometry=[];for(var Nt=0;Nt<dt.length;Nt++){for(var pt=dt[Nt],Dt=[],Kt=0;Kt<pt.length;Kt++)Dt.push(new Ee(pt[Kt][0],pt[Kt][1]));this.geometry.push(Dt)}return this.geometry},be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var dt=this.geometry,Nt=1/0,pt=-1/0,Dt=1/0,Kt=-1/0,ni=0;ni<dt.length;ni++)for(var qn=dt[ni],xn=0;xn<qn.length;xn++){var nn=qn[xn];Nt=Math.min(Nt,nn.x),pt=Math.max(pt,nn.x),Dt=Math.min(Dt,nn.y),Kt=Math.max(Kt,nn.y)}return[Nt,Dt,pt,Kt]},be.prototype.toGeoJSON=Ie.prototype.toGeoJSON,Q}();function X(Ee){var Ie=new Ce;return function(Ue,be){for(var dt in Ue.layers)be.writeMessage(3,J,Ue.layers[dt])}(Ee,Ie),Ie.finish()}function J(Ee,Ie){var Ue;Ie.writeVarintField(15,Ee.version||1),Ie.writeStringField(1,Ee.name||""),Ie.writeVarintField(5,Ee.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(Ue=0;Ue<Ee.length;Ue++)be.feature=Ee.feature(Ue),Ie.writeMessage(2,ue,be);var dt=be.keys;for(Ue=0;Ue<dt.length;Ue++)Ie.writeStringField(3,dt[Ue]);var Nt=be.values;for(Ue=0;Ue<Nt.length;Ue++)Ie.writeMessage(4,xe,Nt[Ue])}function ue(Ee,Ie){var Ue=Ee.feature;Ue.id!==void 0&&Ie.writeVarintField(1,Ue.id),Ie.writeMessage(2,Te,Ee),Ie.writeVarintField(3,Ue.type),Ie.writeMessage(4,_e,Ue)}function Te(Ee,Ie){var Ue=Ee.feature,be=Ee.keys,dt=Ee.values,Nt=Ee.keycache,pt=Ee.valuecache;for(var Dt in Ue.properties){var Kt=Ue.properties[Dt],ni=Nt[Dt];if(Kt!==null){ni===void 0&&(be.push(Dt),Nt[Dt]=ni=be.length-1),Ie.writeVarint(ni);var qn=typeof Kt;qn!=="string"&&qn!=="boolean"&&qn!=="number"&&(Kt=JSON.stringify(Kt));var xn=qn+":"+Kt,nn=pt[xn];nn===void 0&&(dt.push(Kt),pt[xn]=nn=dt.length-1),Ie.writeVarint(nn)}}}function De(Ee,Ie){return(Ie<<3)+(7&Ee)}function ne(Ee){return Ee<<1^Ee>>31}function _e(Ee,Ie){for(var Ue=Ee.loadGeometry(),be=Ee.type,dt=0,Nt=0,pt=Ue.length,Dt=0;Dt<pt;Dt++){var Kt=Ue[Dt],ni=1;be===1&&(ni=Kt.length),Ie.writeVarint(De(1,ni));for(var qn=be===3?Kt.length-1:Kt.length,xn=0;xn<qn;xn++){xn===1&&be!==1&&Ie.writeVarint(De(2,qn-1));var nn=Kt[xn].x-dt,wn=Kt[xn].y-Nt;Ie.writeVarint(ne(nn)),Ie.writeVarint(ne(wn)),dt+=nn,Nt+=wn}be===3&&Ie.writeVarint(De(7,1))}}function xe(Ee,Ie){var Ue=typeof Ee;Ue==="string"?Ie.writeStringField(1,Ee):Ue==="boolean"?Ie.writeBooleanField(7,Ee):Ue==="number"&&(Ee%1!=0?Ie.writeDoubleField(3,Ee):Ee<0?Ie.writeSVarintField(6,Ee):Ie.writeVarintField(5,Ee))}return ye.exports=X,ye.exports.fromVectorTileJs=X,ye.exports.fromGeojsonVt=function(Ee,Ie){Ie=Ie||{};var Ue={};for(var be in Ee)Ue[be]=new W(Ee[be].features,Ie),Ue[be].name=be,Ue[be].version=Ie.version,Ue[be].extent=Ie.extent;return X({layers:Ue})},ye.exports.GeoJSONWrapper=W,ye.exports}(),ce=p.cP(ke);const ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},Oe=Math.fround||(nt=new Float32Array(1),Ce=>(nt[0]=+Ce,nt[0]));var nt;class Je{constructor(W){this.options=Object.assign(Object.create(ie),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:J,maxZoom:ue}=this.options;X&&console.time("total time");const Te=`prepare ${W.length} points`;X&&console.time(Te),this.points=W;const De=[];for(let _e=0;_e<W.length;_e++){const xe=W[_e];if(!xe.geometry)continue;const[Ee,Ie]=xe.geometry.coordinates,Ue=Oe(ot(Ee)),be=Oe(ft(Ie));De.push(Ue,be,1/0,_e,-1,1),this.options.reduce&&De.push(0)}let ne=this.trees[ue+1]=this._createTree(De);X&&console.timeEnd(Te);for(let _e=ue;_e>=J;_e--){const xe=+Date.now();ne=this.trees[_e]=this._createTree(this._cluster(ne,_e)),X&&console.log("z%d: %d clusters in %dms",_e,ne.numItems,+Date.now()-xe)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let J=((W[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,W[1]));let Te=W[2]===180?180:((W[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)J=-180,Te=180;else if(J>Te){const Ie=this.getClusters([J,ue,180,De],X),Ue=this.getClusters([-180,ue,Te,De],X);return Ie.concat(Ue)}const ne=this.trees[this._limitZoom(X)],_e=ne.range(ot(J),ft(De),ot(Te),ft(ue)),xe=ne.data,Ee=[];for(const Ie of _e){const Ue=this.stride*Ie;Ee.push(xe[Ue+5]>1?ut(xe,Ue,this.clusterProps):this.points[xe[Ue+3]])}return Ee}getChildren(W){const X=this._getOriginId(W),J=this._getOriginZoom(W),ue="No cluster with the specified id.",Te=this.trees[J];if(!Te)throw new Error(ue);const De=Te.data;if(X*this.stride>=De.length)throw new Error(ue);const ne=this.options.radius/(this.options.extent*Math.pow(2,J-1)),_e=Te.within(De[X*this.stride],De[X*this.stride+1],ne),xe=[];for(const Ee of _e){const Ie=Ee*this.stride;De[Ie+4]===W&&xe.push(De[Ie+5]>1?ut(De,Ie,this.clusterProps):this.points[De[Ie+3]])}if(xe.length===0)throw new Error(ue);return xe}getLeaves(W,X,J){const ue=[];return this._appendLeaves(ue,W,X=X||10,J=J||0,0),ue}getTile(W,X,J){const ue=this.trees[this._limitZoom(W)],Te=Math.pow(2,W),{extent:De,radius:ne}=this.options,_e=ne/De,xe=(J-_e)/Te,Ee=(J+1+_e)/Te,Ie={features:[]};return this._addTileFeatures(ue.range((X-_e)/Te,xe,(X+1+_e)/Te,Ee),ue.data,X,J,Te,Ie),X===0&&this._addTileFeatures(ue.range(1-_e/Te,xe,1,Ee),ue.data,Te,J,Te,Ie),X===Te-1&&this._addTileFeatures(ue.range(0,xe,_e/Te,Ee),ue.data,-1,J,Te,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const J=this.getChildren(W);if(X++,J.length!==1)break;W=J[0].properties.cluster_id}return X}_appendLeaves(W,X,J,ue,Te){const De=this.getChildren(X);for(const ne of De){const _e=ne.properties;if(_e&&_e.cluster?Te+_e.point_count<=ue?Te+=_e.point_count:Te=this._appendLeaves(W,_e.cluster_id,J,ue,Te):Te<ue?Te++:W.push(ne),W.length===J)break}return Te}_createTree(W){const X=new p.aH(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<W.length;J+=this.stride)X.add(W[J],W[J+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,J,ue,Te,De){for(const ne of W){const _e=ne*this.stride,xe=X[_e+5]>1;let Ee,Ie,Ue;if(xe)Ee=ht(X,_e,this.clusterProps),Ie=X[_e],Ue=X[_e+1];else{const Nt=this.points[X[_e+3]];Ee=Nt.properties;const[pt,Dt]=Nt.geometry.coordinates;Ie=ot(pt),Ue=ft(Dt)}const be={type:1,geometry:[[Math.round(this.options.extent*(Ie*Te-J)),Math.round(this.options.extent*(Ue*Te-ue))]],tags:Ee};let dt;dt=xe||this.options.generateId?X[_e+3]:this.points[X[_e+3]].id,dt!==void 0&&(be.id=dt),De.features.push(be)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:J,extent:ue,reduce:Te,minPoints:De}=this.options,ne=J/(ue*Math.pow(2,X)),_e=W.data,xe=[],Ee=this.stride;for(let Ie=0;Ie<_e.length;Ie+=Ee){if(_e[Ie+2]<=X)continue;_e[Ie+2]=X;const Ue=_e[Ie],be=_e[Ie+1],dt=W.within(_e[Ie],_e[Ie+1],ne),Nt=_e[Ie+5];let pt=Nt;for(const Dt of dt){const Kt=Dt*Ee;_e[Kt+2]>X&&(pt+=_e[Kt+5])}if(pt>Nt&&pt>=De){let Dt,Kt=Ue*Nt,ni=be*Nt,qn=-1;const xn=(Ie/Ee<<5)+(X+1)+this.points.length;for(const nn of dt){const wn=nn*Ee;if(_e[wn+2]<=X)continue;_e[wn+2]=X;const Ii=_e[wn+5];Kt+=_e[wn]*Ii,ni+=_e[wn+1]*Ii,_e[wn+4]=xn,Te&&(Dt||(Dt=this._map(_e,Ie,!0),qn=this.clusterProps.length,this.clusterProps.push(Dt)),Te(Dt,this._map(_e,wn)))}_e[Ie+4]=xn,xe.push(Kt/pt,ni/pt,1/0,xn,-1,pt),Te&&xe.push(qn)}else{for(let Dt=0;Dt<Ee;Dt++)xe.push(_e[Ie+Dt]);if(pt>1)for(const Dt of dt){const Kt=Dt*Ee;if(!(_e[Kt+2]<=X)){_e[Kt+2]=X;for(let ni=0;ni<Ee;ni++)xe.push(_e[Kt+ni])}}}}return xe}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,J){if(W[X+5]>1){const De=this.clusterProps[W[X+6]];return J?Object.assign({},De):De}const ue=this.points[W[X+3]].properties,Te=this.options.map(ue);return J&&Te===ue?Object.assign({},Te):Te}}function ut(Ce,W,X){return{type:"Feature",id:Ce[W+3],properties:ht(Ce,W,X),geometry:{type:"Point",coordinates:[(J=Ce[W],360*(J-.5)),tt(Ce[W+1])]}};var J}function ht(Ce,W,X){const J=Ce[W+5],ue=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,Te=Ce[W+6],De=Te===-1?{}:Object.assign({},X[Te]);return Object.assign(De,{cluster:!0,cluster_id:Ce[W+3],point_count:J,point_count_abbreviated:ue})}function ot(Ce){return Ce/360+.5}function ft(Ce){const W=Math.sin(Ce*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function tt(Ce){const W=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function It(Ce,W,X,J){let ue=J;const Te=W+(X-W>>1);let De,ne=X-W;const _e=Ce[W],xe=Ce[W+1],Ee=Ce[X],Ie=Ce[X+1];for(let Ue=W+3;Ue<X;Ue+=3){const be=Ut(Ce[Ue],Ce[Ue+1],_e,xe,Ee,Ie);if(be>ue)De=Ue,ue=be;else if(be===ue){const dt=Math.abs(Ue-Te);dt<ne&&(De=Ue,ne=dt)}}ue>J&&(De-W>3&&It(Ce,W,De,J),Ce[De+2]=ue,X-De>3&&It(Ce,De,X,J))}function Ut(Ce,W,X,J,ue,Te){let De=ue-X,ne=Te-J;if(De!==0||ne!==0){const _e=((Ce-X)*De+(W-J)*ne)/(De*De+ne*ne);_e>1?(X=ue,J=Te):_e>0&&(X+=De*_e,J+=ne*_e)}return De=Ce-X,ne=W-J,De*De+ne*ne}function Wt(Ce,W,X,J){const ue={id:Ce??null,type:W,geometry:X,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")$t(ue,X);else if(W==="Polygon")$t(ue,X[0]);else if(W==="MultiLineString")for(const Te of X)$t(ue,Te);else if(W==="MultiPolygon")for(const Te of X)$t(ue,Te[0]);return ue}function $t(Ce,W){for(let X=0;X<W.length;X+=3)Ce.minX=Math.min(Ce.minX,W[X]),Ce.minY=Math.min(Ce.minY,W[X+1]),Ce.maxX=Math.max(Ce.maxX,W[X]),Ce.maxY=Math.max(Ce.maxY,W[X+1])}function Rn(Ce,W,X,J){if(!W.geometry)return;const ue=W.geometry.coordinates;if(ue&&ue.length===0)return;const Te=W.geometry.type,De=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let ne=[],_e=W.id;if(X.promoteId?_e=W.properties[X.promoteId]:X.generateId&&(_e=J||0),Te==="Point")it(ue,ne);else if(Te==="MultiPoint")for(const xe of ue)it(xe,ne);else if(Te==="LineString")Tt(ue,ne,De,!1);else if(Te==="MultiLineString"){if(X.lineMetrics){for(const xe of ue)ne=[],Tt(xe,ne,De,!1),Ce.push(Wt(_e,"LineString",ne,W.properties));return}qt(ue,ne,De,!1)}else if(Te==="Polygon")qt(ue,ne,De,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(const xe of W.geometry.geometries)Rn(Ce,{id:_e,geometry:xe,properties:W.properties},X,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const xe of ue){const Ee=[];qt(xe,Ee,De,!0),ne.push(Ee)}}Ce.push(Wt(_e,Te,ne,W.properties))}function it(Ce,W){W.push(Rt(Ce[0]),on(Ce[1]),0)}function Tt(Ce,W,X,J){let ue,Te,De=0;for(let _e=0;_e<Ce.length;_e++){const xe=Rt(Ce[_e][0]),Ee=on(Ce[_e][1]);W.push(xe,Ee,0),_e>0&&(De+=J?(ue*Ee-xe*Te)/2:Math.sqrt(Math.pow(xe-ue,2)+Math.pow(Ee-Te,2))),ue=xe,Te=Ee}const ne=W.length-3;W[2]=1,It(W,0,ne,X),W[ne+2]=1,W.size=Math.abs(De),W.start=0,W.end=W.size}function qt(Ce,W,X,J){for(let ue=0;ue<Ce.length;ue++){const Te=[];Tt(Ce[ue],Te,X,J),W.push(Te)}}function Rt(Ce){return Ce/360+.5}function on(Ce){const W=Math.sin(Ce*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function Xt(Ce,W,X,J,ue,Te,De,ne){if(J/=W,Te>=(X/=W)&&De<J)return Ce;if(De<X||Te>=J)return null;const _e=[];for(const xe of Ce){const Ee=xe.geometry;let Ie=xe.type;const Ue=ue===0?xe.minX:xe.minY,be=ue===0?xe.maxX:xe.maxY;if(Ue>=X&&be<J){_e.push(xe);continue}if(be<X||Ue>=J)continue;let dt=[];if(Ie==="Point"||Ie==="MultiPoint")yn(Ee,dt,X,J,ue);else if(Ie==="LineString")Vn(Ee,dt,X,J,ue,!1,ne.lineMetrics);else if(Ie==="MultiLineString")pn(Ee,dt,X,J,ue,!1);else if(Ie==="Polygon")pn(Ee,dt,X,J,ue,!0);else if(Ie==="MultiPolygon")for(const Nt of Ee){const pt=[];pn(Nt,pt,X,J,ue,!0),pt.length&&dt.push(pt)}if(dt.length){if(ne.lineMetrics&&Ie==="LineString"){for(const Nt of dt)_e.push(Wt(xe.id,Ie,Nt,xe.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(dt.length===1?(Ie="LineString",dt=dt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=dt.length===3?"Point":"MultiPoint"),_e.push(Wt(xe.id,Ie,dt,xe.tags))}}return _e.length?_e:null}function yn(Ce,W,X,J,ue){for(let Te=0;Te<Ce.length;Te+=3){const De=Ce[Te+ue];De>=X&&De<=J&&Fe(W,Ce[Te],Ce[Te+1],Ce[Te+2])}}function Vn(Ce,W,X,J,ue,Te,De){let ne=Ln(Ce);const _e=ue===0?gi:bn;let xe,Ee,Ie=Ce.start;for(let pt=0;pt<Ce.length-3;pt+=3){const Dt=Ce[pt],Kt=Ce[pt+1],ni=Ce[pt+2],qn=Ce[pt+3],xn=Ce[pt+4],nn=ue===0?Dt:Kt,wn=ue===0?qn:xn;let Ii=!1;De&&(xe=Math.sqrt(Math.pow(Dt-qn,2)+Math.pow(Kt-xn,2))),nn<X?wn>X&&(Ee=_e(ne,Dt,Kt,qn,xn,X),De&&(ne.start=Ie+xe*Ee)):nn>J?wn<J&&(Ee=_e(ne,Dt,Kt,qn,xn,J),De&&(ne.start=Ie+xe*Ee)):Fe(ne,Dt,Kt,ni),wn<X&&nn>=X&&(Ee=_e(ne,Dt,Kt,qn,xn,X),Ii=!0),wn>J&&nn<=J&&(Ee=_e(ne,Dt,Kt,qn,xn,J),Ii=!0),!Te&&Ii&&(De&&(ne.end=Ie+xe*Ee),W.push(ne),ne=Ln(Ce)),De&&(Ie+=xe)}let Ue=Ce.length-3;const be=Ce[Ue],dt=Ce[Ue+1],Nt=ue===0?be:dt;Nt>=X&&Nt<=J&&Fe(ne,be,dt,Ce[Ue+2]),Ue=ne.length-3,Te&&Ue>=3&&(ne[Ue]!==ne[0]||ne[Ue+1]!==ne[1])&&Fe(ne,ne[0],ne[1],ne[2]),ne.length&&W.push(ne)}function Ln(Ce){const W=[];return W.size=Ce.size,W.start=Ce.start,W.end=Ce.end,W}function pn(Ce,W,X,J,ue,Te){for(const De of Ce)Vn(De,W,X,J,ue,Te,!1)}function Fe(Ce,W,X,J){Ce.push(W,X,J)}function gi(Ce,W,X,J,ue,Te){const De=(Te-W)/(J-W);return Fe(Ce,Te,X+(ue-X)*De,1),De}function bn(Ce,W,X,J,ue,Te){const De=(Te-X)/(ue-X);return Fe(Ce,W+(J-W)*De,Te,1),De}function cn(Ce,W){const X=[];for(let J=0;J<Ce.length;J++){const ue=Ce[J],Te=ue.type;let De;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")De=Zt(ue.geometry,W);else if(Te==="MultiLineString"||Te==="Polygon"){De=[];for(const ne of ue.geometry)De.push(Zt(ne,W))}else if(Te==="MultiPolygon"){De=[];for(const ne of ue.geometry){const _e=[];for(const xe of ne)_e.push(Zt(xe,W));De.push(_e)}}X.push(Wt(ue.id,Te,De,ue.tags))}return X}function Zt(Ce,W){const X=[];X.size=Ce.size,Ce.start!==void 0&&(X.start=Ce.start,X.end=Ce.end);for(let J=0;J<Ce.length;J+=3)X.push(Ce[J]+W,Ce[J+1],Ce[J+2]);return X}function Tn(Ce,W){if(Ce.transformed)return Ce;const X=1<<Ce.z,J=Ce.x,ue=Ce.y;for(const Te of Ce.features){const De=Te.geometry,ne=Te.type;if(Te.geometry=[],ne===1)for(let _e=0;_e<De.length;_e+=2)Te.geometry.push(Yt(De[_e],De[_e+1],W,X,J,ue));else for(let _e=0;_e<De.length;_e++){const xe=[];for(let Ee=0;Ee<De[_e].length;Ee+=2)xe.push(Yt(De[_e][Ee],De[_e][Ee+1],W,X,J,ue));Te.geometry.push(xe)}}return Ce.transformed=!0,Ce}function Yt(Ce,W,X,J,ue,Te){return[Math.round(X*(Ce*J-ue)),Math.round(X*(W*J-Te))]}function ve(Ce,W,X,J,ue){const Te=W===ue.maxZoom?0:ue.tolerance/((1<<W)*ue.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:X,y:J,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ne of Ce)te(De,ne,Te,ue);return De}function te(Ce,W,X,J){const ue=W.geometry,Te=W.type,De=[];if(Ce.minX=Math.min(Ce.minX,W.minX),Ce.minY=Math.min(Ce.minY,W.minY),Ce.maxX=Math.max(Ce.maxX,W.maxX),Ce.maxY=Math.max(Ce.maxY,W.maxY),Te==="Point"||Te==="MultiPoint")for(let ne=0;ne<ue.length;ne+=3)De.push(ue[ne],ue[ne+1]),Ce.numPoints++,Ce.numSimplified++;else if(Te==="LineString")Ze(De,ue,Ce,X,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(let ne=0;ne<ue.length;ne++)Ze(De,ue[ne],Ce,X,Te==="Polygon",ne===0);else if(Te==="MultiPolygon")for(let ne=0;ne<ue.length;ne++){const _e=ue[ne];for(let xe=0;xe<_e.length;xe++)Ze(De,_e[xe],Ce,X,!0,xe===0)}if(De.length){let ne=W.tags||null;if(Te==="LineString"&&J.lineMetrics){ne={};for(const xe in W.tags)ne[xe]=W.tags[xe];ne.mapbox_clip_start=ue.start/ue.size,ne.mapbox_clip_end=ue.end/ue.size}const _e={geometry:De,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:ne};W.id!==null&&(_e.id=W.id),Ce.features.push(_e)}}function Ze(Ce,W,X,J,ue,Te){const De=J*J;if(J>0&&W.size<(ue?De:J))return void(X.numPoints+=W.length/3);const ne=[];for(let _e=0;_e<W.length;_e+=3)(J===0||W[_e+2]>De)&&(X.numSimplified++,ne.push(W[_e],W[_e+1])),X.numPoints++;ue&&function(_e,xe){let Ee=0;for(let Ie=0,Ue=_e.length,be=Ue-2;Ie<Ue;be=Ie,Ie+=2)Ee+=(_e[Ie]-_e[be])*(_e[Ie+1]+_e[be+1]);if(Ee>0===xe)for(let Ie=0,Ue=_e.length;Ie<Ue/2;Ie+=2){const be=_e[Ie],dt=_e[Ie+1];_e[Ie]=_e[Ue-2-Ie],_e[Ie+1]=_e[Ue-1-Ie],_e[Ue-2-Ie]=be,_e[Ue-1-Ie]=dt}}(ne,Te),Ce.push(ne)}const ct={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class mt{constructor(W,X){const J=(X=this.options=function(Te,De){for(const ne in De)Te[ne]=De[ne];return Te}(Object.create(ct),X)).debug;if(J&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(Te,De){const ne=[];if(Te.type==="FeatureCollection")for(let _e=0;_e<Te.features.length;_e++)Rn(ne,Te.features[_e],De,_e);else Rn(ne,Te.type==="Feature"?Te:{geometry:Te},De);return ne}(W,X);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(Te,De){const ne=De.buffer/De.extent;let _e=Te;const xe=Xt(Te,1,-1-ne,ne,0,-1,2,De),Ee=Xt(Te,1,1-ne,2+ne,0,-1,2,De);return(xe||Ee)&&(_e=Xt(Te,1,-ne,1+ne,0,-1,2,De)||[],xe&&(_e=cn(xe,1).concat(_e)),Ee&&(_e=_e.concat(cn(Ee,-1)))),_e}(ue,X),ue.length&&this.splitTile(ue,0,0,0),J&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,X,J,ue,Te,De,ne){const _e=[W,X,J,ue],xe=this.options,Ee=xe.debug;for(;_e.length;){ue=_e.pop(),J=_e.pop(),X=_e.pop(),W=_e.pop();const Ie=1<<X,Ue=rt(X,J,ue);let be=this.tiles[Ue];if(!be&&(Ee>1&&console.time("creation"),be=this.tiles[Ue]=ve(W,X,J,ue,xe),this.tileCoords.push({z:X,x:J,y:ue}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,J,ue,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));const Ii=`z${X}`;this.stats[Ii]=(this.stats[Ii]||0)+1,this.total++}if(be.source=W,Te==null){if(X===xe.indexMaxZoom||be.numPoints<=xe.indexMaxPoints)continue}else{if(X===xe.maxZoom||X===Te)continue;if(Te!=null){const Ii=Te-X;if(J!==De>>Ii||ue!==ne>>Ii)continue}}if(be.source=null,W.length===0)continue;Ee>1&&console.time("clipping");const dt=.5*xe.buffer/xe.extent,Nt=.5-dt,pt=.5+dt,Dt=1+dt;let Kt=null,ni=null,qn=null,xn=null,nn=Xt(W,Ie,J-dt,J+pt,0,be.minX,be.maxX,xe),wn=Xt(W,Ie,J+Nt,J+Dt,0,be.minX,be.maxX,xe);W=null,nn&&(Kt=Xt(nn,Ie,ue-dt,ue+pt,1,be.minY,be.maxY,xe),ni=Xt(nn,Ie,ue+Nt,ue+Dt,1,be.minY,be.maxY,xe),nn=null),wn&&(qn=Xt(wn,Ie,ue-dt,ue+pt,1,be.minY,be.maxY,xe),xn=Xt(wn,Ie,ue+Nt,ue+Dt,1,be.minY,be.maxY,xe),wn=null),Ee>1&&console.timeEnd("clipping"),_e.push(Kt||[],X+1,2*J,2*ue),_e.push(ni||[],X+1,2*J,2*ue+1),_e.push(qn||[],X+1,2*J+1,2*ue),_e.push(xn||[],X+1,2*J+1,2*ue+1)}}getTile(W,X,J){W=+W,X=+X,J=+J;const ue=this.options,{extent:Te,debug:De}=ue;if(W<0||W>24)return null;const ne=1<<W,_e=rt(W,X=X+ne&ne-1,J);if(this.tiles[_e])return Tn(this.tiles[_e],Te);De>1&&console.log("drilling down to z%d-%d-%d",W,X,J);let xe,Ee=W,Ie=X,Ue=J;for(;!xe&&Ee>0;)Ee--,Ie>>=1,Ue>>=1,xe=this.tiles[rt(Ee,Ie,Ue)];return xe&&xe.source?(De>1&&(console.log("found parent tile z%d-%d-%d",Ee,Ie,Ue),console.time("drilling down")),this.splitTile(xe.source,Ee,Ie,Ue,W,X,J),De>1&&console.timeEnd("drilling down"),this.tiles[_e]?Tn(this.tiles[_e],Te):null):null}}function rt(Ce,W,X){return 32*((1<<Ce)*X+W)+Ce}function Vt(Ce,W){return W?Ce.properties[W]:Ce.id}function At(Ce,W){if(Ce==null)return!0;if(Ce.type==="Feature")return Vt(Ce,W)!=null;if(Ce.type==="FeatureCollection"){const X=new Set;for(const J of Ce.features){const ue=Vt(J,W);if(ue==null||X.has(ue))return!1;X.add(ue)}return!0}return!1}function Gt(Ce,W){const X=new Map;if(Ce!=null)if(Ce.type==="Feature")X.set(Vt(Ce,W),Ce);else for(const J of Ce.features)X.set(Vt(J,W),J);return X}class zn extends I{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return p._(this,void 0,void 0,function*(){const J=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!ue)return null;const Te=new me(ue.features);let De=ce(Te);return De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),{vectorTile:Te,rawData:De.buffer}})}loadData(W){return p._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const J=!!(W&&W.request&&W.request.collectResourceTiming)&&new p.cM(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new Je(function({superclusterOptions:De,clusterProperties:ne}){if(!ne||!De)return De;const _e={},xe={},Ee={accumulated:null,zoom:0},Ie={properties:null},Ue=Object.keys(ne);for(const be of Ue){const[dt,Nt]=ne[be],pt=p.cT(Nt),Dt=p.cT(typeof dt=="string"?[dt,["accumulated"],["get",be]]:dt);_e[be]=pt.value,xe[be]=Dt.value}return De.map=be=>{Ie.properties=be;const dt={};for(const Nt of Ue)dt[Nt]=_e[Nt].evaluate(Ee,Ie);return dt},De.reduce=(be,dt)=>{Ie.properties=dt;for(const Nt of Ue)Ee.accumulated=be[Nt],be[Nt]=xe[Nt].evaluate(Ee,Ie)},De}(W)).load((yield this._pendingData).features):(ue=yield this._pendingData,new mt(ue,W.geojsonVtOptions)),this.loaded={};const Te={};if(J){const De=J.finish();De&&(Te.resourceTiming={},Te.resourceTiming[W.source]=JSON.parse(JSON.stringify(De)))}return Te}catch(Te){if(delete this._pendingRequest,p.cx(Te))return{abandoned:!0};throw Te}var ue})}getData(){return p._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,X){return p._(this,void 0,void 0,function*(){let J=yield this.loadGeoJSON(W,X);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(V(J,!0),W.filter){const ue=p.cT(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(De=>`${De.key}: ${De.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(De=>ue.value.evaluate({zoom:0},De))}}return J})}loadGeoJSON(W,X){return p._(this,void 0,void 0,function*(){const{promoteId:J}=W;if(W.request){const ue=yield p.j(W.request,X);return this._dataUpdateable=At(ue.data,J)?Gt(ue.data,J):void 0,ue.data}if(typeof W.data=="string")try{const ue=JSON.parse(W.data);return this._dataUpdateable=At(ue,J)?Gt(ue,J):void 0,ue}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(ue,Te,De){var ne,_e,xe,Ee;if(Te.removeAll&&ue.clear(),Te.remove)for(const Ie of Te.remove)ue.delete(Ie);if(Te.add)for(const Ie of Te.add){const Ue=Vt(Ie,De);Ue!=null&&ue.set(Ue,Ie)}if(Te.update)for(const Ie of Te.update){let Ue=ue.get(Ie.id);if(Ue==null)continue;const be=!Ie.removeAllProperties&&(((ne=Ie.removeProperties)===null||ne===void 0?void 0:ne.length)>0||((_e=Ie.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||be)&&(Ue=Object.assign({},Ue),ue.set(Ie.id,Ue),be&&(Ue.properties=Object.assign({},Ue.properties))),Ie.newGeometry&&(Ue.geometry=Ie.newGeometry),Ie.removeAllProperties)Ue.properties={};else if(((xe=Ie.removeProperties)===null||xe===void 0?void 0:xe.length)>0)for(const dt of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Ue.properties,dt)&&delete Ue.properties[dt];if(((Ee=Ie.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const{key:dt,value:Nt}of Ie.addOrUpdateProperties)Ue.properties[dt]=Nt}}(this._dataUpdateable,W.dataDiff,J),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return p._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class bt{constructor(W){this.self=W,this.actor=new p.J(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,J)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=J},this.self.addProtocol=p.cz,this.self.removeProtocol=p.cA,this.self.registerRTLTextPlugin=X=>{p.cU.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,J)=>this._getDEMWorkerSource(X,J.source).loadTile(J)),this.actor.registerMessageHandler("RDT",(X,J)=>p._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,J.source).removeTile(J)})),this.actor.registerMessageHandler("GCEZ",(X,J)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(X,J.type,J.source).getClusterExpansionZoom(J)})),this.actor.registerMessageHandler("GCC",(X,J)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(X,J.type,J.source).getClusterChildren(J)})),this.actor.registerMessageHandler("GCL",(X,J)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(X,J.type,J.source).getClusterLeaves(J)})),this.actor.registerMessageHandler("LD",(X,J)=>this._getWorkerSource(X,J.type,J.source).loadData(J)),this.actor.registerMessageHandler("GD",(X,J)=>this._getWorkerSource(X,J.type,J.source).getData()),this.actor.registerMessageHandler("LT",(X,J)=>this._getWorkerSource(X,J.type,J.source).loadTile(J)),this.actor.registerMessageHandler("RT",(X,J)=>this._getWorkerSource(X,J.type,J.source).reloadTile(J)),this.actor.registerMessageHandler("AT",(X,J)=>this._getWorkerSource(X,J.type,J.source).abortTile(J)),this.actor.registerMessageHandler("RMT",(X,J)=>this._getWorkerSource(X,J.type,J.source).removeTile(J)),this.actor.registerMessageHandler("RS",(X,J)=>p._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][J.type]||!this.workerSources[X][J.type][J.source])return;const ue=this.workerSources[X][J.type][J.source];delete this.workerSources[X][J.type][J.source],ue.removeSource!==void 0&&ue.removeSource(J)})),this.actor.registerMessageHandler("RM",X=>p._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,J)=>p._(this,void 0,void 0,function*(){this.referrer=J})),this.actor.registerMessageHandler("SRPS",(X,J)=>this._syncRTLPluginState(X,J)),this.actor.registerMessageHandler("IS",(X,J)=>p._(this,void 0,void 0,function*(){this.self.importScripts(J)})),this.actor.registerMessageHandler("SI",(X,J)=>this._setImages(X,J)),this.actor.registerMessageHandler("UL",(X,J)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(J.layers,J.removedIds)})),this.actor.registerMessageHandler("SL",(X,J)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(J)}))}_setImages(W,X){return p._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const J in this.workerSources[W]){const ue=this.workerSources[W][J];for(const Te in ue)ue[Te].availableImages=X}})}_syncRTLPluginState(W,X){return p._(this,void 0,void 0,function*(){return yield p.cU.syncState(X,this.self.importScripts)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new s),X}_getWorkerSource(W,X,J){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][J]){const ue={sendAsync:(Te,De)=>(Te.targetMapId=W,this.actor.sendAsync(Te,De))};switch(X){case"vector":this.workerSources[W][X][J]=new I(ue,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][J]=new zn(ue,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][J]=new this.externalWorkerSourceTypes[X](ue,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][J]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new L),this.demWorkerSources[W][X]}}return p.i(self)&&(self.worker=new bt(self)),bt}),u("index",["exports","./shared"],function(p,s){var S="5.6.0";function M(){var _=new s.A(4);return s.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let C,I;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,t,a){const d=requestAnimationFrame(y=>{m(),t(y)}),{unsubscribe:m}=s.s(_.signal,"abort",()=>{m(),cancelAnimationFrame(d),a(s.c())},!1)},frameAsync(_){return new Promise((t,a)=>{this.frame(_,t,a)})},getImageData(_,t=0){return this.getImageCanvasContext(_).getImageData(-t,-t,_.width+2*t,_.height+2*t)},getImageCanvasContext(_){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=_.width,t.height=_.height,a.drawImage(_,0,0,_.width,_.height),a},resolveURL:_=>(C||(C=document.createElement("a")),C.href=_,C.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(I==null&&(I=matchMedia("(prefers-reduced-motion: reduce)")),I.matches)}};class R{static testProp(t){if(!R.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in R.docStyle)return t[a];return t[0]}static create(t,a,d){const m=window.document.createElement(t);return a!==void 0&&(m.className=a),d&&d.appendChild(m),m}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(t,a){t.style[R.transformProp]=a}static addEventListener(t,a,d,m={}){t.addEventListener(a,d,"passive"in m?m:m.capture)}static removeEventListener(t,a,d,m={}){t.removeEventListener(a,d,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,d){const m=a.boundingClientRect;return new s.P((d.clientX-m.left)/a.x-t.clientLeft,(d.clientY-m.top)/a.y-t.clientTop)}static mousePos(t,a){const d=R.getScale(t);return R.getPoint(t,d,a)}static touchPos(t,a){const d=[],m=R.getScale(t);for(let y=0;y<a.length;y++)d.push(R.getPoint(t,m,a[y]));return d}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),d=a.querySelectorAll("script");for(const m of d)m.remove();return R.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const d=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!d.includes("javascript:")&&!d.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const d of a)R.removeAttributes(d),R.clean(d)}static removeAttributes(t){for(const{name:a,value:d}of t.attributes)R.isPossiblyDangerous(a,d)&&t.removeAttribute(a)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(_){!O&&V&&(ge?me(_):Z=_)}};let Z,V,O=!1,ge=!1;function me(_){const t=_.createTexture();_.bindTexture(_.TEXTURE_2D,t);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,V),_.isContextLost())return;B.supported=!0}catch{}_.deleteTexture(t),O=!0}var Q;typeof document<"u"&&(V=document.createElement("img"),V.onload=()=>{Z&&me(Z),Z=null,ge=!0},V.onerror=()=>{O=!0,Z=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let t,a,d,m;_.resetRequestQueue=()=>{t=[],a=0,d=0,m={}},_.addThrottleControl=A=>{const D=d++;return m[D]=A,D},_.removeThrottleControl=A=>{delete m[A],b()},_.getImage=(A,D,z=!0)=>new Promise((U,N)=>{B.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),s.e(A,{type:"image"}),t.push({abortController:D,requestParameters:A,supportImageRefresh:z,state:"queued",onError:H=>{N(H)},onSuccess:H=>{U(H)}}),b()});const y=A=>s._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:D,supportImageRefresh:z,onError:U,onSuccess:N,abortController:H}=A,Y=z===!1&&!s.i(self)&&!s.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((le,pe)=>le&&pe==="accept",!0));a++;const oe=Y?T(D,H):s.m(D,H);try{const le=yield oe;delete A.abortController,A.state="completed",le.data instanceof HTMLImageElement||s.b(le.data)?N(le):le.data&&N({data:yield(ae=le.data,typeof createImageBitmap=="function"?s.f(ae):s.h(ae)),cacheControl:le.cacheControl,expires:le.expires})}catch(le){delete A.abortController,U(le)}finally{a--,b()}var ae}),b=()=>{const A=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=a;D<A&&t.length>0;D++){const z=t.shift();z.abortController.signal.aborted?D--:y(z)}},T=(A,D)=>new Promise((z,U)=>{const N=new Image,H=A.url,Y=A.credentials;Y&&Y==="include"?N.crossOrigin="use-credentials":(Y&&Y==="same-origin"||!s.d(H))&&(N.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{N.src="",U(s.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,z({data:N})},N.onerror=()=>{N.onerror=N.onload=null,D.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=H})}(Q||(Q={})),Q.resetRequestQueue();class de{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function fe(_){const t=[];if(typeof _=="string")t.push({id:"default",url:_});else if(_&&_.length>0){const a=[];for(const{id:d,url:m}of _){const y=`${d}${m}`;a.indexOf(y)===-1&&(a.push(y),t.push({id:d,url:m}))}}return t}function ye(_,t,a){try{const d=new URL(_);return d.pathname+=`${t}${a}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ke(_){const{userImage:t}=_;return!!(t&&t.render&&t.render())&&(_.data.replace(new Uint8Array(t.data.buffer)),!0)}class ce extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:d}of this.requestors)d(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const d=a.spriteData;a.data=new s.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let d=!0;const m=a.data||a.spriteData;return this._validateStretch(a.stretchX,m&&m.width)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,m&&m.height)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||a<m[1])return!1;d=m[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const d=a.spriteData,m=d&&d.width||a.data.width,y=d&&d.height||a.data.height;return!(t[0]<0||m<t[0]||t[1]<0||y<t[1]||t[2]<0||m<t[2]||t[3]<0||y<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,d=!0){const m=this.getImage(t);if(d&&(m.data.width!==a.data.width||m.data.height!==a.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=m.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((a,d)=>{let m=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(m=!1);this.isLoaded()||m?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})})}_getImagesForIds(t){const a={};for(const d of t){let m=this.getImage(d);m||(this.fire(new s.l("styleimagemissing",{id:d})),m=this.getImage(d)),m?a[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:s.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],d=this.getImage(t);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new s.I(m,d);this.patterns[t]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:a,h:d}=s.p(t),m=this.atlasImage;m.resize({width:a||1,height:d||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],T=b.x+1,A=b.y+1,D=this.getImage(y).data,z=D.width,U=D.height;s.R.copy(D,m,{x:0,y:0},{x:T,y:A},{width:z,height:U}),s.R.copy(D,m,{x:0,y:U-1},{x:T,y:A-1},{width:z,height:1}),s.R.copy(D,m,{x:0,y:0},{x:T,y:A+U},{width:z,height:1}),s.R.copy(D,m,{x:z-1,y:0},{x:T-1,y:A},{width:1,height:U}),s.R.copy(D,m,{x:0,y:0},{x:T+z,y:A},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.getImage(a);d||s.w(`Image with ID: "${a}" was not found`),ke(d)&&this.updateImage(a,d)}}}const ie=1e20;function Oe(_,t,a,d,m,y,b,T,A){for(let D=t;D<t+d;D++)nt(_,a*y+D,y,m,b,T,A);for(let D=a;D<a+m;D++)nt(_,D*y+t,1,d,b,T,A)}function nt(_,t,a,d,m,y,b){y[0]=0,b[0]=-1e20,b[1]=ie,m[0]=_[t];for(let T=1,A=0,D=0;T<d;T++){m[T]=_[t+T*a];const z=T*T;do{const U=y[A];D=(m[T]-m[U]+z-U*U)/(T-U)/2}while(D<=b[A]&&--A>-1);A++,y[A]=T,b[A]=D,b[A+1]=ie}for(let T=0,A=0;T<d;T++){for(;b[A+1]<T;)A++;const D=y[A],z=T-D;_[t+T*a]=m[D]+z*z}}class Je{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return s._(this,void 0,void 0,function*(){const a=[];for(const y in t)for(const b of t[y])a.push(this._getAndCacheGlyphsPromise(y,b));const d=yield Promise.all(a),m={};for(const{stack:y,id:b,glyph:T}of d)m[y]||(m[y]={}),m[y][b]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return m})}_getAndCacheGlyphsPromise(t,a){return s._(this,void 0,void 0,function*(){let d=this.entries[t];d||(d=this.entries[t]={glyphs:{},requests:{},ranges:{}});let m=d.glyphs[a];if(m!==void 0)return{stack:t,id:a,glyph:m};if(m=this._tinySDF(d,t,a),m)return d.glyphs[a]=m,{stack:t,id:a,glyph:m};const y=Math.floor(a/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[y])return{stack:t,id:a,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[y]){const T=Je.loadGlyphRange(t,y,this.url,this.requestManager);d.requests[y]=T}const b=yield d.requests[y];for(const T in b)this._doesCharSupportLocalGlyph(+T)||(d.glyphs[+T]=b[+T]);return d.ranges[y]=!0,{stack:t,id:a,glyph:b[a]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t)||s.u["CJK Symbols and Punctuation"](t)||s.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,a,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let y=t.tinySDF;if(!y){let T="400";/bold/i.test(a)?T="900":/medium/i.test(a)?T="500":/light/i.test(a)&&(T="200"),y=t.tinySDF=new Je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:T})}const b=y.draw(String.fromCharCode(d));return{id:d,bitmap:new s.q({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Je.loadGlyphRange=function(_,t,a,d){return s._(this,void 0,void 0,function*(){const m=256*t,y=m+255,b=d.transformRequest(a.replace("{fontstack}",_).replace("{range}",`${m}-${y}`),"Glyphs"),T=yield s.n(b,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${t}, ${m}-${y}`);const A={};for(const D of s.o(T.data))A[D.id]=D;return A})},Je.TinySDF=class{constructor({fontSize:_=24,buffer:t=3,radius:a=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=d,this.radius=a;const T=this.size=_+4*t,A=this._createCanvas(T),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${b} ${y} ${_}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(_){const t=document.createElement("canvas");return t.width=t.height=_,t}draw(_){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(_),b=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),A=Math.min(this.size-this.buffer,b+Math.ceil(d)),D=T+2*this.buffer,z=A+2*this.buffer,U=Math.max(D*z,0),N=new Uint8ClampedArray(U),H={data:N,width:D,height:z,glyphWidth:T,glyphHeight:A,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(T===0||A===0)return H;const{ctx:Y,buffer:oe,gridInner:ae,gridOuter:le}=this;Y.clearRect(oe,oe,T,A),Y.fillText(_,oe,oe+b);const pe=Y.getImageData(oe,oe,T,A);le.fill(ie,0,U),ae.fill(0,0,U);for(let Ae=0;Ae<A;Ae++)for(let we=0;we<T;we++){const Re=pe.data[4*(Ae*T+we)+3]/255;if(Re===0)continue;const Le=(Ae+oe)*D+we+oe;if(Re===1)le[Le]=0,ae[Le]=ie;else{const Se=.5-Re;le[Le]=Se>0?Se*Se:0,ae[Le]=Se<0?Se*Se:0}}Oe(le,0,0,D,z,D,this.f,this.v,this.z),Oe(ae,oe,oe,T,A,D,this.f,this.v,this.z);for(let Ae=0;Ae<U;Ae++){const we=Math.sqrt(le[Ae])-Math.sqrt(ae[Ae]);N[Ae]=Math.round(255-255*(we/this.radius+this.cutoff))}return H}};class ut{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,a){return s.B(t.expression.evaluate(a))}interpolate(t,a,d){return{x:s.C.number(t.x,a.x,d),y:s.C.number(t.y,a.y,d),z:s.C.number(t.z,a.z,d)}}}let ht;class ot extends s.E{constructor(t){super(),ht=ht||new s.r({anchor:new s.D(s.v.light.anchor),position:new ut,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.t(ht),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(s.x,t,a))for(const d in t){const m=t[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&s.y(this,t.call(s.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const ft=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class tt extends s.E{constructor(t){super(),this._transitionable=new s.t(ft),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0))}setSky(t,a={}){if(!this._validate(s.G,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in t){const m=t[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d={}){return(d==null?void 0:d.validate)!==!1&&s.y(this,t.call(s.z,s.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class It{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const d=t.join(",")+String(a);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(t,a)),this.dashEntry[d]}getDashRanges(t,a,d){const m=[];let y=t.length%2==1?-t[t.length-1]*d:0,b=t[0]*d,T=!0;m.push({left:y,right:b,isDash:T,zeroLength:t[0]===0});let A=t[0];for(let D=1;D<t.length;D++){T=!T;const z=t[D];y=A*d,A+=z,b=A*d,m.push({left:y,right:b,isDash:T,zeroLength:z===0})}return m}addRoundDash(t,a,d){const m=a/2;for(let y=-d;y<=d;y++){const b=this.width*(this.nextRow+d+y);let T=0,A=t[T];for(let D=0;D<this.width;D++){D/A.right>1&&(A=t[++T]);const z=Math.abs(D-A.left),U=Math.abs(D-A.right),N=Math.min(z,U);let H;const Y=y/d*(m+1);if(A.isDash){const oe=m-Math.abs(Y);H=Math.sqrt(N*N+oe*oe)}else H=m-Math.sqrt(N*N+Y*Y);this.data[b+D]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let T=t.length-1;T>=0;--T){const A=t[T],D=t[T+1];A.zeroLength?t.splice(T,1):D&&D.isDash===A.isDash&&(D.left=A.left,t.splice(T,1))}const a=t[0],d=t[t.length-1];a.isDash===d.isDash&&(a.left=d.left-this.width,d.right=a.right+this.width);const m=this.width*this.nextRow;let y=0,b=t[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=t[++y]);const A=Math.abs(T-b.left),D=Math.abs(T-b.right),z=Math.min(A,D);this.data[m+T]=Math.max(0,Math.min(255,(b.isDash?z:-z)+128))}}addDash(t,a){const d=a?7:0,m=2*d+1;if(this.nextRow+m>this.height)return s.w("LineAtlas out of space"),null;let y=0;for(let T=0;T<t.length;T++)y+=t[T];if(y!==0){const T=this.width/y,A=this.getDashRanges(t,this.width,T);a?this.addRoundDash(A,T,d):this.addRegularDash(A)}const b={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:y};return this.nextRow+=m,this.dirty=!0,b}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ut="maplibre_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ut]}numActive(){return Object.keys(this.active).length}}const $t=Math.floor(L.hardwareConcurrency/2);let Rn,it;function Tt(){return Rn||(Rn=new Wt),Rn}Wt.workerCount=s.H(globalThis)?Math.max(Math.min($t,3),1):1;class qt{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const d=this.workerPool.acquire(a);for(let m=0;m<d.length;m++){const y=new s.J(d[m],a);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const d=[];for(const m of this.actors)d.push(m.sendAsync({type:t,data:a}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const d of this.actors)d.registerMessageHandler(t,a)}}function Rt(){return it||(it=new qt(Tt(),s.K),it.registerMessageHandler("GR",(_,t,a)=>s.m(t,a))),it}function on(_,t){const a=s.L();return s.M(a,a,[1,1,0]),s.N(a,a,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?s.O(a,a,_.calculatePosMatrix(t.toUnwrapped())):a}function Xt(_,t,a,d,m,y,b){var T;const A=function(N,H,Y){if(N)for(const oe of N){const ae=H[oe];if(ae&&ae.source===Y&&ae.type==="fill-extrusion")return!0}else for(const oe in H){const ae=H[oe];if(ae.source===Y&&ae.type==="fill-extrusion")return!0}return!1}((T=m==null?void 0:m.layers)!==null&&T!==void 0?T:null,t,_.id),D=y.maxPitchScaleFactor(),z=_.tilesIn(d,D,A);z.sort(yn);const U=[];for(const N of z)U.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,a,_._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,D,on(_.transform,N.tileID),b?(H,Y)=>b(N.tileID,H,Y):void 0)});return function(N,H){for(const Y in N)for(const oe of N[Y])Vn(oe,H);return N}(function(N){const H={},Y={};for(const oe of N){const ae=oe.queryResults,le=oe.wrappedTileID,pe=Y[le]=Y[le]||{};for(const Ae in ae){const we=ae[Ae],Re=pe[Ae]=pe[Ae]||{},Le=H[Ae]=H[Ae]||[];for(const Se of we)Re[Se.featureIndex]||(Re[Se.featureIndex]=!0,Le.push(Se))}}return H}(U),_)}function yn(_,t){const a=_.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Vn(_,t){const a=_.feature,d=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=d}function Ln(_,t,a){return s._(this,void 0,void 0,function*(){let d=_;if(_.url?d=(yield s.j(t.transformRequest(_.url,"Source"),a)).data:yield L.frameAsync(a),!d)return null;const m=s.Q(s.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(m.vectorLayerIds=d.vector_layers.map(y=>y.id)),m})}class pn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.S?new s.S(t.lng,t.lat):s.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.S?new s.S(t.lng,t.lat):s.S.convert(t),this}extend(t){const a=this._sw,d=this._ne;let m,y;if(t instanceof s.S)m=t,y=t;else{if(!(t instanceof pn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(pn.convert(t)):this.extend(s.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.S.convert(t)):this;if(m=t._sw,y=t._ne,!m||!y)return this}return a||d?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new s.S(m.lng,m.lat),this._ne=new s.S(y.lng,y.lat)),this}getCenter(){return new s.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.S(this.getWest(),this.getNorth())}getSouthEast(){return new s.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:d}=s.S.convert(t);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(t){return t instanceof pn?t:t&&new pn(t)}static fromLngLat(t,a=0){const d=360*a/40075017,m=d/Math.cos(Math.PI/180*t.lat);return new pn(new s.S(t.lng-m,t.lat-d),new s.S(t.lng+m,t.lat+d))}adjustAntiMeridian(){const t=new s.S(this._sw.lng,this._sw.lat),a=new s.S(this._ne.lng,this._ne.lat);return new pn(t,t.lng>a.lng?new s.S(a.lng+360,a.lat):a)}}class Fe{constructor(t,a,d){this.bounds=pn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),d=Math.floor(s.V(this.bounds.getWest())*a),m=Math.floor(s.U(this.bounds.getNorth())*a),y=Math.ceil(s.V(this.bounds.getEast())*a),b=Math.ceil(s.U(this.bounds.getSouth())*a);return t.x>=d&&t.x<y&&t.y>=m&&t.y<b}}class gi extends s.E{constructor(t,a,d,m){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.Q(a,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ln(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(s.e(this,t),t.bounds&&(this.tileBounds=new Fe(t.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new s.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(t){return s._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};d.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((y,b)=>{t.reloadPromise={resolve:y,reject:b}})}else t.actor=this.dispatcher.getActor(),m="LT";t.abortController=new AbortController;try{const y=yield t.actor.sendAsync({type:m,data:d},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,y)}catch(y){if(delete t.abortController,t.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const d=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(d.resolve).catch(d.reject)}}abortTile(t){return s._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return s._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class bn extends s.E{constructor(t,a,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},a),s.e(this,s.Q(a,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ln(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(s.e(this,a),a.bounds&&(this.tileBounds=new Fe(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this.fire(new s.k(a))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return s._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const d=yield Q.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const m=this.map.painter.context,y=m.gl,b=d.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new s.T(m,b,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}})}abortTile(t){return s._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return s._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class cn extends bn{constructor(t,a,d,m){super(t,a,d,m),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return s._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const m=yield Q.getImage(d,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const b=s.b(y)&&s.W()?y:yield this.readImageNow(y),T={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:T});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}})}readImageNow(t){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.X()){const a=t.width+2,d=t.height+2;try{return new s.R({width:a,height:d},yield s.Y(t,-1,-1,a,d))}catch{}}return L.getImageData(t,1)})}_getNeighboringTiles(t){const a=t.canonical,d=Math.pow(2,a.z),m=(a.x-1+d)%d,y=a.x===0?t.wrap-1:t.wrap,b=(a.x+1+d)%d,T=a.x+1===d?t.wrap+1:t.wrap,A={};return A[new s.Z(t.overscaledZ,y,a.z,m,a.y).key]={backfilled:!1},A[new s.Z(t.overscaledZ,T,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(A[new s.Z(t.overscaledZ,y,a.z,m,a.y-1).key]={backfilled:!1},A[new s.Z(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new s.Z(t.overscaledZ,T,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<d&&(A[new s.Z(t.overscaledZ,y,a.z,m,a.y+1).key]={backfilled:!1},A[new s.Z(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new s.Z(t.overscaledZ,T,a.z,b,a.y+1).key]={backfilled:!1}),A}unloadTile(t){return s._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Zt extends s.E{constructor(t,a,d,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=a.data,this._options=s.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:s.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:s.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(s.$/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return s._(this,void 0,void 0,function*(){const t=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(a=>a.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,function*(){const t=new pn,a=yield this.getData();let d;switch(a.type){case"FeatureCollection":d=a.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":d=this.getCoordinatesFromGeometry(a.geometry);break;default:d=this.getCoordinatesFromGeometry(a)}if(d.length==0)return t;for(let m=0;m<d.length-1;m+=2)t.extend([d[m],d[m+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:d}})}_updateWorkerData(t){return s._(this,void 0,void 0,function*(){const a=s.e({type:this.type},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(L.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));let m=null;d.resourceTiming&&d.resourceTiming[this.id]&&(m=d.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&s.e(y,{resourceTiming:m}),this.fire(new s.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(d))}})}loaded(){return this._pendingLoads===0}loadTile(t){return s._(this,void 0,void 0,function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const d={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const m=yield this.actor.sendAsync({type:a,data:d},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(m,this.map.painter,a==="RT")})}abortTile(t){return s._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return s._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Tn extends s.E{constructor(t,a,d,m){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(t){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield Q.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new s.k(a))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(s.a0.fromLngLat);var d;return this.tileID=function(m){const y=s.a1.fromPoints(m),b=y.width(),T=y.height(),A=Math.max(b,T),D=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,D);return new s.a3(D,Math.floor((y.minX+y.maxX)/2*z),Math.floor((y.minY+y.maxY)/2*z))}(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new s.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:d,maxX:m,maxY:y}=s.a1.fromPoints(t),b={};for(let T=0;T<=s.a2;T++){const A=Math.pow(2,T),D=Math.floor(a*A),z=Math.floor(d*A),U=Math.floor(m*A),N=Math.floor(y*A);b[T]={minTileX:D,minTileY:z,maxTileX:U,maxTileY:N}}return b}}class Yt extends Tn{constructor(t,a,d,m){super(t,a,d,m),this.roundZoom=!0,this.type="video",this.options=a}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield s.a4(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new s.k(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new s.k(new s.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ve extends Tn{constructor(t,a,d,m){super(t,a,d,m),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new s.k(new s.a5(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a5(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new s.k(new s.a5(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a5(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a5(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,d=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(a,this.canvas,d.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const te={},Ze=_=>{switch(_){case"geojson":return Zt;case"image":return Tn;case"raster":return bn;case"raster-dem":return cn;case"vector":return gi;case"video":return Yt;case"canvas":return ve}return te[_]},ct="RTLPluginLoaded";class mt extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Rt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return s._(this,arguments,void 0,function*(a,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let rt=null;function Vt(){return rt||(rt=new mt),rt}class At{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a6(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,y){const b={};if(!y)return b;for(const T of m){const A=T.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(A.length!==0){T.layers=A,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(D=>A.filter(z=>z.id===D)[0]));for(const D of A)b[D.id]=T}}return b}(t.buckets,a==null?void 0:a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.a8){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.a8&&y.hasRTLText){this.hasRTLText=!0,Vt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a7}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,d,m,y,b,T,A,D,z,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:A,params:T,queryPadding:this.queryPadding*D,getElevation:U},t,a,d):{}}querySourceFeatures(t,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),y=a&&a.sourceLayer?a.sourceLayer:"",b=m._geojsonTileLayer||m[y];if(!b)return;const T=s.a9(a&&a.filter),{z:A,x:D,y:z}=this.tileID.canonical,U={z:A,x:D,y:z};for(let N=0;N<b.length;N++){const H=b.feature(N);if(T.needGeometry){const ae=s.aa(H,!0);if(!T.filter(new s.F(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!T.filter(new s.F(this.tileID.overscaledZ),H))continue;const Y=d.getId(H,y),oe=new s.ab(H,A,D,z,Y);oe.tile=U,t.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const d=s.ac(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const y=this.expirationTime-a;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const y=this.buckets[m],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=d[b],A=t[b];if(!T||!A||Object.keys(A).length===0)continue;y.update(A,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=a&&a.style&&a.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=L.now()+t}setDependencies(t,a){const d={};for(const m of a)d[m]=!0;this.dependencies[t]=d}hasDependency(t,a){for(const d of t){const m=this.dependencies[d];if(m){for(const y of a)if(m[y])return!0}}return!1}}class Gt{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,d){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:a,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const d=t.wrapped().key,m=a===void 0?0:this.data[d].indexOf(a),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const d in this.data)for(const m of this.data[d])t(m.value)||a.push(m);for(const d of a)this.remove(d.value.tileID,d)}}class zn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,d){const m=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},s.e(this.stateChanges[t][m],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])d[y]||(this.deletedStates[t][m][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,a,d){if(this.deletedStates[t]===null)return;const m=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&a!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][d]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(d in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][d]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,a){const d=String(a),m=s.e({},(this.state[t]||{})[d],(this.stateChanges[t]||{})[d]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][a];if(y===null)return{};for(const b in y)delete m[b]}return m}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),s.e(this.state[m][b],this.stateChanges[m][b]),y[b]=this.state[m][b];d[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const b in this.state[m])y[b]={},this.state[m][b]={};else for(const b in this.deletedStates[m]){if(this.deletedStates[m][b]===null)this.state[m][b]={};else for(const T of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][T];y[b]=this.state[m][b]}d[m]=d[m]||{},s.e(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in t)t[m].setFeatureState(d,a)}}const bt=89.25;function Ce(_,t){const a=s.ag(t.lat,-85.051129,s.ah);return new s.P(s.V(t.lng)*_,s.U(a)*_)}function W(_,t){return new s.a0(t.x/_,t.y/_).toLngLat()}function X(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(s.ad(90-_.pitch)),Math.tan(s.ad(bt-_.pitch)))}function J(_,t){const a=_.canonical,d=t/s.ae(a.z),m=a.x+Math.pow(2,a.z)*_.wrap,y=s.af(new Float64Array(16));return s.M(y,y,[m*d,a.y*d,0]),s.N(y,y,[d/s.$,d/s.$,1]),y}function ue(_,t,a,d,m){const y=s.a0.fromLngLat(_,t),b=m*s.ai(1,_.lat),T=b*Math.cos(s.ad(a)),A=Math.sqrt(b*b-T*T),D=A*Math.sin(s.ad(-d)),z=A*Math.cos(s.ad(-d));return new s.a0(y.x+D,y.y+z,y.z+T)}function Te(_,t,a){const d=t.intersectsFrustum(_);if(!a||d===0)return d;const m=t.intersectsPlane(a);return m===0?0:d===2&&m===2?2:1}function De(_,t,a){let d=0;const m=(a-t)/10;for(let y=0;y<10;y++)d+=m*Math.pow(Math.cos(t+(y+.5)/10*(a-t)),_);return d}function ne(_,t){return function(a,d,m,y,b){const T=2*((_-1)/s.aj(Math.cos(s.ad(bt-b))/Math.cos(s.ad(bt)))-1),A=Math.acos(m/y),D=2*De(T-1,0,s.ad(b/2)),z=Math.min(s.ad(bt),A+s.ad(b/2)),U=De(T-1,Math.min(z,A-s.ad(b/2)),z),N=Math.atan(d/m),H=Math.hypot(d,m);let Y=a;return Y+=s.aj(y/H/Math.max(.5,Math.cos(s.ad(b/2)))),Y+=T*s.aj(Math.cos(N))/2,Y-=s.aj(Math.max(1,U/D/t))/2,Y}}const _e=ne(9.314,3);function xe(_,t){const a=(t.roundZoom?Math.round:Math.floor)(_.zoom+s.aj(_.tileSize/t.tileSize));return Math.max(0,a)}function Ee(_,t){const a=_.getCameraFrustum(),d=_.getClippingPlane(),m=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=s.a0.fromLngLat(_.center,_.elevation);m.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const b=_.getCoveringTilesDetailsProvider(),T=b.allowVariableZoom(_,t),A=xe(_,t),D=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:_.maxZoom,U=Math.min(Math.max(0,A),z),N=Math.pow(2,U),H=[N*m.x,N*m.y,0],Y=[N*y.x,N*y.y,0],oe=Math.hypot(y.x-m.x,y.y-m.y),ae=Math.abs(y.z-m.z),le=Math.hypot(oe,ae),pe=Re=>({zoom:0,x:0,y:0,wrap:Re,fullyVisible:!1}),Ae=[],we=[];if(_.renderWorldCopies&&b.allowWorldCopies())for(let Re=1;Re<=3;Re++)Ae.push(pe(-Re)),Ae.push(pe(Re));for(Ae.push(pe(0));Ae.length>0;){const Re=Ae.pop(),Le=Re.x,Se=Re.y;let Ne=Re.fullyVisible;const qe={x:Le,y:Se,z:Re.zoom},He=b.getTileBoundingVolume(qe,Re.wrap,_.elevation,t);if(!Ne){const xt=Te(a,He,d);if(xt===0)continue;Ne=xt===2}const je=b.distanceToTile2d(m.x,m.y,qe,He);let Xe=A;T&&(Xe=(t.calculateTileZoom||_e)(_.zoom+s.aj(_.tileSize/t.tileSize),je,ae,le,_.fov)),Xe=(t.roundZoom?Math.round:Math.floor)(Xe),Xe=Math.max(0,Xe);const St=Math.min(Xe,z);if(Re.wrap=b.getWrap(y,qe,Re.wrap),Re.zoom>=St){if(Re.zoom<D)continue;const xt=U-Re.zoom,at=H[0]-.5-(Le<<xt),kt=H[1]-.5-(Se<<xt),_n=t.reparseOverscaled?Math.max(Re.zoom,Xe):Re.zoom;we.push({tileID:new s.Z(Re.zoom===z?_n:Re.zoom,Re.wrap,Re.zoom,Le,Se),distanceSq:s.ak([Y[0]-.5-Le,Y[1]-.5-Se]),tileDistanceToCamera:Math.sqrt(at*at+kt*kt)})}else for(let xt=0;xt<4;xt++)Ae.push({zoom:Re.zoom+1,x:(Le<<1)+xt%2,y:(Se<<1)+(xt>>1),wrap:Re.wrap,fullyVisible:Ne})}return we.sort((Re,Le)=>Re.distanceSq-Le.distanceSq).map(Re=>Re.tileID)}const Ie=s.a1.fromPoints([new s.P(0,0),new s.P(s.$,s.$)]);class Ue extends s.E{constructor(t,a,d){super(),this.id=t,this.dispatcher=d,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,b,T)=>{const A=new(Ze(y.type))(m,y,b,T);if(A.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${A.id}`);return A})(t,a,d,this),this._tiles={},this._cache=new Gt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new zn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,d){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,d)}catch(m){t.state="errored",m.status!==404?this._source.fire(new s.k(m,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new s.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(t),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(be).map(t=>t.key)}getRenderableIds(t){const a=[];for(const d in this._tiles)this._isIdRenderable(d,t)&&a.push(this._tiles[d]);return t?a.sort((d,m)=>{const y=d.tileID,b=m.tileID,T=new s.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),A=new s.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-b.overscaledZ||A.y-T.y||A.x-T.x}).map(d=>d.tileID.key):a.map(d=>d.tileID).sort(be).map(d=>d.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)t?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(t,a){return s._(this,void 0,void 0,function*(){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=a),yield this._loadTile(d,t,a))})}_tileLoaded(t,a,d){t.timeAdded=L.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const y=a[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const b=this.getTileByID(y);d(t,b),d(b,t)}}function d(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let b=y.tileID.canonical.x-m.tileID.canonical.x;const T=y.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;b===0&&T===0||Math.abs(T)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,b,T),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,d,m){for(const y in this._tiles){let b=this._tiles[y];if(m[y]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>d)continue;let T=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(T=D)}let A=T;for(;A.overscaledZ>a;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]||t[A.canonical.key]){m[T.key]=T;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=t.overscaledZ-1;d>=a;d--){const m=t.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,d=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(a*d*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const d={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),d[y.tileID.key]=y}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(t,a,d,m,y,b){const T={},A={},D=Object.keys(t),z=L.now();for(const U of D){const N=t[U],H=this._tiles[U];if(!H||H.fadeEndTime!==0&&H.fadeEndTime<=z)continue;const Y=this.findLoadedParent(N,a),oe=this.findLoadedSibling(N),ae=Y||oe||null;ae&&(this._addTile(ae.tileID),T[ae.tileID.key]=ae.tileID),A[U]=N}this._retainLoadedChildren(A,m,d,t);for(const U in T)t[U]||(this._coveredTiles[U]=!0,t[U]=T[U]);if(b){const U={},N={};for(const H of y)this._tiles[H.key].hasData()?U[H.key]=H:N[H.key]=H;for(const H in N){const Y=N[H].children(this._source.maxzoom);this._tiles[Y[0].key]&&this._tiles[Y[1].key]&&this._tiles[Y[2].key]&&this._tiles[Y[3].key]&&(U[Y[0].key]=t[Y[0].key]=Y[0],U[Y[1].key]=t[Y[1].key]=Y[1],U[Y[2].key]=t[Y[2].key]=Y[2],U[Y[3].key]=t[Y[3].key]=Y[3],delete N[H])}for(const H in N){const Y=N[H],oe=this.findLoadedParent(Y,this._source.minzoom),ae=this.findLoadedSibling(Y),le=oe||ae||null;if(le){U[le.tileID.key]=t[le.tileID.key]=le.tileID;for(const pe in U)U[pe].isChildOf(le.tileID)&&delete U[pe]}}for(const H in this._tiles)U[H]||(this._coveredTiles[H]=!0)}}update(t,a){if(!this._sourceLoaded||this._paused)return;let d;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new s.Z(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(d=Ee(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter(z=>this._source.hasTile(z)))):d=[];const m=xe(t,this._source),y=Math.max(m-Ue.maxOverzooming,this._source.minzoom),b=Math.max(m+Ue.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const U of d)if(U.canonical.z>this._source.minzoom){const N=U.scaledTo(U.canonical.z-1);z[N.key]=N;const H=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));z[H.key]=H}d=d.concat(Object.values(z))}const T=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(d,m);dt(this._source.type)&&this._updateCoveredAndRetainedTiles(A,y,b,m,d,a);for(const z in A)this._tiles[z].clearFadeHold();const D=s.al(this._tiles,A);for(const z of D){const U=this._tiles[z];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var d;const m={},y={},b=Math.max(a-Ue.maxOverzooming,this._source.minzoom),T=Math.max(a+Ue.maxUnderzooming,this._source.minzoom),A={};for(const D of t){const z=this._addTile(D);m[D.key]=D,z.hasData()||a<this._source.maxzoom&&(A[D.key]=D)}this._retainLoadedChildren(A,a,T,m);for(const D of t){let z=this._tiles[D.key];if(z.hasData())continue;if(a+1>this._source.maxzoom){const N=D.children(this._source.maxzoom)[0],H=this.getTile(N);if(H&&H.hasData()){m[N.key]=N;continue}}else{const N=D.children(this._source.maxzoom);if(m[N[0].key]&&m[N[1].key]&&m[N[2].key]&&m[N[3].key])continue}let U=z.wasRequested();for(let N=D.overscaledZ-1;N>=b;--N){const H=D.scaledTo(N);if(y[H.key])break;if(y[H.key]=!0,z=this.getTile(H),!z&&U&&(z=this._addTile(H)),z){const Y=z.hasData();if((Y||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||U)&&(m[H.key]=H),U=z.wasRequested(),Y)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let d,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}a.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(const y of a)this._loadedParentTiles[y]=d}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const a=this._tiles[t].tileID,d=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=d}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const d=a;return a||(a=new At(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._tiles[t.key]=a,d||this._source.fire(new s.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=a.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}refreshTiles(t){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&t.some(d=>d.equals(this._tiles[a].tileID.canonical))&&this._reloadTile(a,"expired")}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){const a=t.sourceDataType;t.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&a==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,d){const m=[],y=this.transform;if(!y)return m;const b=y.getCoveringTilesDetailsProvider().allowWorldCopies(),T=d?y.getCameraQueryGeometry(t):t,A=H=>y.screenPointToMercatorCoordinate(H,this.terrain),D=this.transformBbox(t,A,!b),z=this.transformBbox(T,A,!b),U=this.getIds(),N=s.a1.fromPoints(z);for(let H=0;H<U.length;H++){const Y=this._tiles[U[H]];if(Y.holdingForFade())continue;const oe=b?[Y.tileID]:[Y.tileID.unwrapTo(-1),Y.tileID.unwrapTo(0)],ae=Math.pow(2,y.zoom-Y.tileID.overscaledZ),le=a*Y.queryPadding*s.$/Y.tileSize/ae;for(const pe of oe){const Ae=N.map(we=>pe.getTilePoint(new s.a0(we.x,we.y)));if(Ae.expandBy(le),Ae.intersects(Ie)){const we=D.map(Le=>pe.getTilePoint(Le)),Re=z.map(Le=>pe.getTilePoint(Le));m.push({tile:Y,tileID:b?pe:pe.unwrapTo(0),queryGeometry:we,cameraQueryGeometry:Re,scale:ae})}}}return m}transformBbox(t,a,d){let m=t.map(a);if(d){const y=s.a1.fromPoints(t);y.shrinkBy(.001*Math.min(y.width(),y.height()));const b=y.map(a);s.a1.fromPoints(m).covers(b)||(m=m.map(T=>T.x>.5?new s.a0(T.x-1,T.y,T.z):T))}return m}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(d=>this._tiles[d].tileID);return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(dt(this._source.type)){const t=L.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,d){this._state.updateState(t=t||"_geojsonTileLayer",a,d)}removeFeatureState(t,a,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,d)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,d){const m=this._tiles[t];m&&m.setDependencies(a,d)}reloadTilesForDependencies(t,a){for(const d in this._tiles)this._tiles[d].hasDependency(t,a)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(t,a))}}function be(_,t){const a=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return _.overscaledZ-t.overscaledZ||d-a||t.canonical.y-_.canonical.y||t.canonical.x-_.canonical.x}function dt(_){return _==="raster"||_==="image"||_==="video"}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;class Nt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ag(t,0,1);let a=1,d=this._distances[a];const m=t*this.paddedLength+this.padding;for(;d<m&&a<this._distances.length;)d=this._distances[++a];const y=a-1,b=this._distances[y],T=d-b,A=T>0?(m-b)/T:0;return this.points[y].mult(1-A).add(this.points[a].mult(A))}}function pt(_,t){let a=!0;return _==="always"||_!=="never"&&t!=="never"||(a=!1),a}class Dt{constructor(t,a,d){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,m,y){this._forEachCell(a,d,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,a,d,m){this._forEachCell(a-m,d-m,a+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,a,d,m,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,a,d,m,y,b){this.circleCells[y].push(b)}_query(t,a,d,m,y,b,T){if(d<0||t>this.width||m<0||a>this.height)return[];const A=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=m){if(y)return[{key:null,x1:t,y1:a,x2:d,y2:m}];for(let D=0;D<this.boxKeys.length;D++)A.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const z=this.circles[3*D],U=this.circles[3*D+1],N=this.circles[3*D+2];A.push({key:this.circleKeys[D],x1:z-N,y1:U-N,x2:z+N,y2:U+N})}}else this._forEachCell(t,a,d,m,this._queryCell,A,{hitTest:y,overlapMode:b,seenUids:{box:{},circle:{}}},T);return A}query(t,a,d,m){return this._query(t,a,d,m,!1,null)}hitTest(t,a,d,m,y,b){return this._query(t,a,d,m,!0,y,b).length>0}hitTestCircle(t,a,d,m,y){const b=t-d,T=t+d,A=a-d,D=a+d;if(T<0||b>this.width||D<0||A>this.height)return!1;const z=[];return this._forEachCell(b,A,T,D,this._queryCellCircle,z,{hitTest:!0,overlapMode:m,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},y),z.length>0}_queryCell(t,a,d,m,y,b,T,A){const{seenUids:D,hitTest:z,overlapMode:U}=T,N=this.boxCells[y];if(N!==null){const Y=this.bboxes;for(const oe of N)if(!D.box[oe]){D.box[oe]=!0;const ae=4*oe,le=this.boxKeys[oe];if(t<=Y[ae+2]&&a<=Y[ae+3]&&d>=Y[ae+0]&&m>=Y[ae+1]&&(!A||A(le))&&(!z||!pt(U,le.overlapMode))&&(b.push({key:le,x1:Y[ae],y1:Y[ae+1],x2:Y[ae+2],y2:Y[ae+3]}),z))return!0}}const H=this.circleCells[y];if(H!==null){const Y=this.circles;for(const oe of H)if(!D.circle[oe]){D.circle[oe]=!0;const ae=3*oe,le=this.circleKeys[oe];if(this._circleAndRectCollide(Y[ae],Y[ae+1],Y[ae+2],t,a,d,m)&&(!A||A(le))&&(!z||!pt(U,le.overlapMode))){const pe=Y[ae],Ae=Y[ae+1],we=Y[ae+2];if(b.push({key:le,x1:pe-we,y1:Ae-we,x2:pe+we,y2:Ae+we}),z)return!0}}}return!1}_queryCellCircle(t,a,d,m,y,b,T,A){const{circle:D,seenUids:z,overlapMode:U}=T,N=this.boxCells[y];if(N!==null){const Y=this.bboxes;for(const oe of N)if(!z.box[oe]){z.box[oe]=!0;const ae=4*oe,le=this.boxKeys[oe];if(this._circleAndRectCollide(D.x,D.y,D.radius,Y[ae+0],Y[ae+1],Y[ae+2],Y[ae+3])&&(!A||A(le))&&!pt(U,le.overlapMode))return b.push(!0),!0}}const H=this.circleCells[y];if(H!==null){const Y=this.circles;for(const oe of H)if(!z.circle[oe]){z.circle[oe]=!0;const ae=3*oe,le=this.circleKeys[oe];if(this._circlesCollide(Y[ae],Y[ae+1],Y[ae+2],D.x,D.y,D.radius)&&(!A||A(le))&&!pt(U,le.overlapMode))return b.push(!0),!0}}}_forEachCell(t,a,d,m,y,b,T,A){const D=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),U=this._convertToXCellCoord(d),N=this._convertToYCellCoord(m);for(let H=D;H<=U;H++)for(let Y=z;Y<=N;Y++)if(y.call(this,t,a,d,m,this.xCellCount*Y+H,b,T,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,m,y,b){const T=m-t,A=y-a,D=d+b;return D*D>T*T+A*A}_circleAndRectCollide(t,a,d,m,y,b,T){const A=(b-m)/2,D=Math.abs(t-(m+A));if(D>A+d)return!1;const z=(T-y)/2,U=Math.abs(a-(y+z));if(U>z+d)return!1;if(D<=A||U<=z)return!0;const N=D-A,H=U-z;return N*N+H*H<=d*d}}function Kt(_,t,a){const d=s.L();if(!_){const{vecSouth:U,vecEast:N}=qn(t),H=M();H[0]=N[0],H[1]=N[1],H[2]=U[0],H[3]=U[1],m=H,(z=(b=(y=H)[0])*(D=y[3])-(A=y[2])*(T=y[1]))&&(m[0]=D*(z=1/z),m[1]=-T*z,m[2]=-A*z,m[3]=b*z),d[0]=H[0],d[1]=H[1],d[4]=H[2],d[5]=H[3]}var m,y,b,T,A,D,z;return s.N(d,d,[1/a,1/a,1]),d}function ni(_,t,a,d){if(_){const m=s.L();if(!t){const{vecSouth:y,vecEast:b}=qn(a);m[0]=b[0],m[1]=b[1],m[4]=y[0],m[5]=y[1]}return s.N(m,m,[d,d,1]),m}return a.pixelsToClipSpaceMatrix}function qn(_){const t=Math.cos(_.rollInRadians),a=Math.sin(_.rollInRadians),d=Math.cos(_.pitchInRadians),m=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),b=s.aq();b[0]=-m*d*a-y*t,b[1]=-y*d*a+m*t;const T=s.ar(b);T<1e-9?s.as(b):s.at(b,b,1/T);const A=s.aq();A[0]=m*d*t-y*a,A[1]=y*d*t+m*a;const D=s.ar(A);return D<1e-9?s.as(A):s.at(A,A,1/D),{vecEast:A,vecSouth:b}}function xn(_,t,a,d){let m;d?(m=[_,t,d(_,t),1],s.av(m,m,a)):(m=[_,t,0,1],Ke(m,m,a));const y=m[3];return{point:new s.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function nn(_,t){return .5+_/t*.5}function wn(_,t){return _.x>=-t[0]&&_.x<=t[0]&&_.y>=-t[1]&&_.y<=t[1]}function Ii(_,t,a,d,m,y,b,T,A,D,z,U,N){const H=a?_.textSizeData:_.iconSizeData,Y=s.am(H,t.transform.zoom),oe=[256/t.width*2+1,256/t.height*2+1],ae=a?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ae.clear();const le=_.lineVertexArray,pe=a?_.text.placedSymbolArray:_.icon.placedSymbolArray,Ae=t.transform.width/t.transform.height;let we=!1;for(let Re=0;Re<pe.length;Re++){const Le=pe.get(Re);if(Le.hidden||Le.writingMode===s.an.vertical&&!we){Be(Le.numGlyphs,ae);continue}we=!1;const Se=new s.P(Le.anchorX,Le.anchorY),Ne={getElevation:N,pitchedLabelPlaneMatrix:d,lineVertexArray:le,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Se,unwrappedTileID:A,width:D,height:z,translation:U},qe=mn(Le.anchorX,Le.anchorY,Ne);if(!wn(qe.point,oe)){Be(Le.numGlyphs,ae);continue}const He=nn(t.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),je=s.ao(H,Y,Le),Xe=y?je*t.transform.getPitchedTextCorrection(Le.anchorX,Le.anchorY,A)/He:je*He,St=ii({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:m,symbol:Le,fontSize:Xe,flip:!1,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:Ae,rotateToLine:T});we=St.useVertical,(St.notEnoughRoom||we||St.needsFlipping&&ii({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:m,symbol:Le,fontSize:Xe,flip:!0,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:Ae,rotateToLine:T}).notEnoughRoom)&&Be(Le.numGlyphs,ae)}a?_.text.dynamicLayoutVertexBuffer.updateData(ae):_.icon.dynamicLayoutVertexBuffer.updateData(ae)}function _t(_,t,a,d,m,y,b,T){const A=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,z=y.lineStartIndex+y.lineLength,U=t.getoffsetX(y.glyphStartIndex),N=t.getoffsetX(A-1),H=Xr(_*U,a,d,m,y.segment,D,z,T,b);if(!H)return null;const Y=Xr(_*N,a,d,m,y.segment,D,z,T,b);return Y?T.projectionCache.anyProjectionOccluded?null:{first:H,last:Y}:null}function ki(_,t,a,d){return _===s.an.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*d?{useVertical:!0}:(_===s.an.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function ii(_){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:d,fontSize:m,flip:y,keepUpright:b,glyphOffsetArray:T,dynamicLayoutVertexArray:A,aspectRatio:D,rotateToLine:z}=_,U=m/24,N=d.lineOffsetX*U,H=d.lineOffsetY*U;let Y;if(d.numGlyphs>1){const oe=d.glyphStartIndex+d.numGlyphs,ae=d.lineStartIndex,le=d.lineStartIndex+d.lineLength,pe=_t(U,T,N,H,y,d,z,t);if(!pe)return{notEnoughRoom:!0};const Ae=fn(pe.first.point.x,pe.first.point.y,t,a),we=fn(pe.last.point.x,pe.last.point.y,t,a);if(b&&!y){const Re=ki(d.writingMode,Ae,we,D);if(Re)return Re}Y=[pe.first];for(let Re=d.glyphStartIndex+1;Re<oe-1;Re++){const Le=Xr(U*T.getoffsetX(Re),N,H,y,d.segment,ae,le,t,z);if(!Le)return{notEnoughRoom:!0};Y.push(Le)}Y.push(pe.last)}else{if(b&&!y){const ae=wt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,le=d.lineStartIndex+d.segment+1,pe=new s.P(t.lineVertexArray.getx(le),t.lineVertexArray.gety(le)),Ae=wt(pe.x,pe.y,t),we=Ae.signedDistanceFromCamera>0?Ae.point:as(t.tileAnchorPoint,pe,ae,1,t),Re=fn(ae.x,ae.y,t,a),Le=fn(we.x,we.y,t,a),Se=ki(d.writingMode,Re,Le,D);if(Se)return Se}const oe=Xr(U*T.getoffsetX(d.glyphStartIndex),N,H,y,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,t,z);if(!oe||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Y=[oe]}for(const oe of Y)s.au(A,oe.point,oe.angle);return{}}function as(_,t,a,d,m){const y=_.add(_.sub(t)._unit()),b=wt(y.x,y.y,m).point,T=a.sub(b);return a.add(T._mult(d/T.mag()))}function Ss(_,t,a){const d=t.projectionCache;if(d.projections[_])return d.projections[_];const m=new s.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),y=wt(m.x,m.y,t);if(y.signedDistanceFromCamera>0)return d.projections[_]=y.point,d.anyProjectionOccluded=d.anyProjectionOccluded||y.isOccluded,y.point;const b=_-a.direction;return as(a.distanceFromAnchor===0?t.tileAnchorPoint:new s.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),m,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function wt(_,t,a){const d=_+a.translation[0],m=t+a.translation[1];let y;return a.pitchWithMap?(y=xn(d,m,a.pitchedLabelPlaneMatrix,a.getElevation),y.isOccluded=!1):(y=a.transform.projectTileCoordinates(d,m,a.unwrappedTileID,a.getElevation),y.point.x=(.5*y.point.x+.5)*a.width,y.point.y=(.5*-y.point.y+.5)*a.height),y}function fn(_,t,a,d){if(a.pitchWithMap){const m=[_,t,0,1];return s.av(m,m,d),a.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],a.unwrappedTileID,a.getElevation).point}return{x:_/a.width*2-1,y:t/a.height*2-1}}function mn(_,t,a){return a.transform.projectTileCoordinates(_,t,a.unwrappedTileID,a.getElevation)}function vr(_,t,a){return _._unit()._perp()._mult(t*a)}function uo(_,t,a,d,m,y,b,T,A){if(T.projectionCache.offsets[_])return T.projectionCache.offsets[_];const D=a.add(t);if(_+A.direction<d||_+A.direction>=m)return T.projectionCache.offsets[_]=D,D;const z=Ss(_+A.direction,T,A),U=vr(z.sub(a),b,A.direction),N=a.add(U),H=z.add(U);return T.projectionCache.offsets[_]=s.aw(y,D,N,H)||D,T.projectionCache.offsets[_]}function Xr(_,t,a,d,m,y,b,T,A){const D=d?_-t:_+t;let z=D>0?1:-1,U=0;d&&(z*=-1,U=Math.PI),z<0&&(U+=Math.PI);let N,H=z>0?y+m:y+m+1;T.projectionCache.cachedAnchorPoint?N=T.projectionCache.cachedAnchorPoint:(N=wt(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=N);let Y,oe,ae=N,le=N,pe=0,Ae=0;const we=Math.abs(D),Re=[];let Le;for(;pe+Ae<=we;){if(H+=z,H<y||H>=b)return null;pe+=Ae,le=ae,oe=Y;const qe={absOffsetX:we,direction:z,distanceFromAnchor:pe,previousVertex:le};if(ae=Ss(H,T,qe),a===0)Re.push(le),Le=ae.sub(le);else{let He;const je=ae.sub(le);He=je.mag()===0?vr(Ss(H+z,T,qe).sub(ae),a,z):vr(je,a,z),oe||(oe=le.add(He)),Y=uo(H,He,ae,y,b,oe,a,T,qe),Re.push(oe),Le=Y.sub(oe)}Ae=Le.mag()}const Se=Le._mult((we-pe)/Ae)._add(oe||le),Ne=U+Math.atan2(ae.y-le.y,ae.x-le.x);return Re.push(Se),{point:Se,angle:A?Ne:0,path:Re}}const ee=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Be(_,t){for(let a=0;a<_;a++){const d=t.length;t.resize(d+4),t.float32.set(ee,3*d)}}function Ke(_,t,a){const d=t[0],m=t[1];return _[0]=a[0]*d+a[4]*m+a[12],_[1]=a[1]*d+a[5]*m+a[13],_[3]=a[3]*d+a[7]*m+a[15],_}const We=100;class Ve{constructor(t,a=new Dt(t.width+200,t.height+200,25),d=new Dt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=d,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+We,this.screenBottomBoundary=t.height+We,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,d,m,y,b,T,A,D,z,U,N){const H=this.projectAndGetPerspectiveRatio(t.anchorPointX+A[0],t.anchorPointY+A[1],y,z,N),Y=d*H.perspectiveRatio;let oe;if(b||T)oe=this._projectCollisionBox(t,Y,m,y,b,T,A,H,z,U,N);else{const Le=H.x+(U?U.x*Y:0),Se=H.y+(U?U.y*Y:0);oe={allPointsOccluded:!1,box:[Le+t.x1*Y,Se+t.y1*Y,Le+t.x2*Y,Se+t.y2*Y]}}const[ae,le,pe,Ae]=oe.box,we=b?oe.allPointsOccluded:H.isOccluded;let Re=we;return Re||(Re=H.perspectiveRatio<this.perspectiveRatioCutoff),Re||(Re=!this.isInsideGrid(ae,le,pe,Ae)),Re||a!=="always"&&this.grid.hitTest(ae,le,pe,Ae,a,D)?{box:[ae,le,pe,Ae],placeable:!1,offscreen:!1,occluded:we}:{box:[ae,le,pe,Ae],placeable:!0,offscreen:this.isOffscreen(ae,le,pe,Ae),occluded:we}}placeCollisionCircles(t,a,d,m,y,b,T,A,D,z,U,N,H,Y){const oe=[],ae=new s.P(a.anchorX,a.anchorY),le=this.getPerspectiveRatio(ae.x,ae.y,b,Y),pe=(D?y*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,b)/le:y*le)/s.aA,Ae={getElevation:Y,pitchedLabelPlaneMatrix:T,lineVertexArray:d,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:H},we=_t(pe,m,a.lineOffsetX*pe,a.lineOffsetY*pe,!1,a,!1,Ae);let Re=!1,Le=!1,Se=!0;if(we){const Ne=.5*U*le+N,qe=new s.P(-100,-100),He=new s.P(this.screenRightBoundary,this.screenBottomBoundary),je=new Nt,Xe=we.first,St=we.last;let xt=[];for(let _n=Xe.path.length-1;_n>=1;_n--)xt.push(Xe.path[_n]);for(let _n=1;_n<St.path.length;_n++)xt.push(St.path[_n]);const at=2.5*Ne;if(D){const _n=this.projectPathToScreenSpace(xt,Ae);xt=_n.some(Yn=>Yn.signedDistanceFromCamera<=0)?[]:_n.map(Yn=>Yn.point)}let kt=[];if(xt.length>0){const _n=xt[0].clone(),Yn=xt[0].clone();for(let wi=1;wi<xt.length;wi++)_n.x=Math.min(_n.x,xt[wi].x),_n.y=Math.min(_n.y,xt[wi].y),Yn.x=Math.max(Yn.x,xt[wi].x),Yn.y=Math.max(Yn.y,xt[wi].y);kt=_n.x>=qe.x&&Yn.x<=He.x&&_n.y>=qe.y&&Yn.y<=He.y?[xt]:Yn.x<qe.x||_n.x>He.x||Yn.y<qe.y||_n.y>He.y?[]:s.ax([xt],qe.x,qe.y,He.x,He.y)}for(const _n of kt){je.reset(_n,.25*Ne);let Yn=0;Yn=je.length<=.5*Ne?1:Math.ceil(je.paddedLength/at)+1;for(let wi=0;wi<Yn;wi++){const si=wi/Math.max(Yn-1,1),Si=je.lerp(si),li=Si.x+We,ai=Si.y+We;oe.push(li,ai,Ne,0);const ci=li-Ne,nr=ai-Ne,Gn=li+Ne,qi=ai+Ne;if(Se=Se&&this.isOffscreen(ci,nr,Gn,qi),Le=Le||this.isInsideGrid(ci,nr,Gn,qi),t!=="always"&&this.grid.hitTestCircle(li,ai,Ne,t,z)&&(Re=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!A&&Re||!Le||le<this.perspectiveRatioCutoff?[]:oe,offscreen:Se,collisionDetected:Re}}projectPathToScreenSpace(t,a){const d=function(m,y){const b=s.L();return s.ap(b,y.pitchedLabelPlaneMatrix),m.map(T=>{const A=xn(T.x,T.y,b,y.getElevation),D=y.transform.projectTileCoordinates(A.point.x,A.point.y,y.unwrappedTileID,y.getElevation);return D.point.x=(.5*D.point.x+.5)*y.width,D.point.y=(.5*-D.point.y+.5)*y.height,D})}(t,a);return function(m){let y=0,b=0,T=0,A=0;for(let D=0;D<m.length;D++)m[D].isOccluded?(T=D+1,A=0):(A++,A>b&&(b=A,y=T));return m.slice(y,y+b)}(d)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],d=new s.a1;for(const U of t){const N=new s.P(U.x+We,U.y+We);d.extend(N),a.push(N)}const{minX:m,minY:y,maxX:b,maxY:T}=d,A=this.grid.query(m,y,b,T).concat(this.ignoredGrid.query(m,y,b,T)),D={},z={};for(const U of A){const N=U.key;if(D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]={}),D[N.bucketInstanceId][N.featureIndex])continue;const H=[new s.P(U.x1,U.y1),new s.P(U.x2,U.y1),new s.P(U.x2,U.y2),new s.P(U.x1,U.y2)];s.ay(a,H)&&(D[N.bucketInstanceId][N.featureIndex]=!0,z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]=[]),z[N.bucketInstanceId].push(N.featureIndex))}return z}insertCollisionBox(t,a,d,m,y,b){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:b,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,m,y,b){const T=d?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:y,collisionGroupID:b,overlapMode:a};for(let D=0;D<t.length;D+=4)T.insertCircle(A,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,a,d,m,y){if(y){let b;m?(b=[t,a,m(t,a),1],s.av(b,b,y)):(b=[t,a,0,1],Ke(b,b,y));const T=b[3];return{x:(b[0]/T+1)/2*this.transform.width+We,y:(-b[1]/T+1)/2*this.transform.height+We,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const b=this.transform.projectTileCoordinates(t,a,d,m);return{x:(b.point.x+1)/2*this.transform.width+We,y:(1-b.point.y)/2*this.transform.height+We,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,d,m){const y=this.transform.projectTileCoordinates(t,a,d,m);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(t,a,d,m){return d<We||t>=this.screenRightBoundary||m<We||a>this.screenBottomBoundary}isInsideGrid(t,a,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=s.af([]);return s.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,d,m,y,b,T,A,D,z,U){let N=1,H=0,Y=0,oe=1;const ae=t.anchorPointX+T[0],le=t.anchorPointY+T[1];if(b&&!y){const xt=this.projectAndGetPerspectiveRatio(ae+1,le,m,D,U),at=xt.x-A.x,kt=Math.atan((xt.y-A.y)/at)+(at<0?Math.PI:0),_n=Math.sin(kt),Yn=Math.cos(kt);N=Yn,H=_n,Y=-_n,oe=Yn}else if(!b&&y){const xt=qn(this.transform);N=xt.vecEast[0],H=xt.vecEast[1],Y=xt.vecSouth[0],oe=xt.vecSouth[1]}let pe=A.x,Ae=A.y,we=a;y&&(pe=ae,Ae=le,we=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),we*=this.transform.getPitchedTextCorrection(ae,le,m),z||(we*=s.ag(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(pe+=N*z.x*we+Y*z.y*we,Ae+=H*z.x*we+oe*z.y*we);const Re=t.x1*we,Le=t.x2*we,Se=(Re+Le)/2,Ne=t.y1*we,qe=t.y2*we,He=(Ne+qe)/2,je=[{offsetX:Re,offsetY:Ne},{offsetX:Se,offsetY:Ne},{offsetX:Le,offsetY:Ne},{offsetX:Le,offsetY:He},{offsetX:Le,offsetY:qe},{offsetX:Se,offsetY:qe},{offsetX:Re,offsetY:qe},{offsetX:Re,offsetY:He}];let Xe=[];for(const{offsetX:xt,offsetY:at}of je)Xe.push(new s.P(pe+N*xt+Y*at,Ae+H*xt+oe*at));let St=!1;if(y){const xt=Xe.map(at=>this.projectAndGetPerspectiveRatio(at.x,at.y,m,D,U));St=xt.some(at=>!at.isOccluded),Xe=xt.map(at=>new s.P(at.x,at.y))}else St=!0;return{box:s.az(Xe),allPointsOccluded:!St}}}class vt{constructor(t,a,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Ct{constructor(t,a,d,m,y){this.text=new vt(t?t.text:null,a,d,y),this.icon=new vt(t?t.icon:null,a,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bt{constructor(t,a,d){this.text=t,this.icon=a,this.skipFade=d}}class Lt{constructor(t,a,d,m,y){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=y}}class Ht{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function un(_,t,a,d,m){const{horizontalAlign:y,verticalAlign:b}=s.aG(_);return new s.P(-(y-.5)*t+d[0]*m,-(b-.5)*a+d[1]*m)}class tn{constructor(t,a,d,m,y){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Ve(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ht(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(d,m)=>a.getElevation(t,d,m):null}getBucketParts(t,a,d,m){const y=d.getBucket(a),b=d.latestFeatureIndex;if(!y||!b||a.id!==y.layerIds[0])return;const T=d.collisionBoxArray,A=y.layers[0].layout,D=y.layers[0].paint,z=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),U=d.tileSize/s.$,N=d.tileID.toUnwrapped(),H=A.get("text-rotation-alignment")==="map",Y=s.aB(d,1,this.transform.zoom),oe=s.aC(this.collisionIndex.transform,d,D.get("text-translate"),D.get("text-translate-anchor")),ae=s.aC(this.collisionIndex.transform,d,D.get("icon-translate"),D.get("icon-translate-anchor")),le=Kt(H,this.transform,Y);this.retainedQueryData[y.bucketInstanceId]=new Lt(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,d.tileID);const pe={bucket:y,layout:A,translationText:oe,translationIcon:ae,unwrappedTileID:N,pitchedLabelPlaneMatrix:le,scale:z,textPixelRatio:U,holdingForFade:d.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:s.am(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const Ae of y.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:Le}=Ae;t.push({sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:Le,parameters:pe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(t,a,d,m,y,b,T,A,D,z,U,N,H,Y,oe,ae,le,pe,Ae,we){const Re=s.aD[t.textAnchor],Le=[t.textOffset0,t.textOffset1],Se=un(Re,d,m,Le,y),Ne=this.collisionIndex.placeCollisionBox(a,N,A,D,z,T,b,ae,U.predicate,Ae,Se,we);if((!pe||this.collisionIndex.placeCollisionBox(pe,N,A,D,z,T,b,le,U.predicate,Ae,Se,we).placeable)&&Ne.placeable){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Le,width:d,height:m,anchor:Re,textBoxScale:y,prevAnchor:qe},this.markUsedJustification(Y,Re,H,oe),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,oe,H),this.placedOrientations[H.crossTileID]=oe),{shift:Se,placedGlyphBoxes:Ne}}}placeLayerBucketPart(t,a,d){const{bucket:m,layout:y,translationText:b,translationIcon:T,unwrappedTileID:A,pitchedLabelPlaneMatrix:D,textPixelRatio:z,holdingForFade:U,collisionBoxArray:N,partiallyEvaluatedTextSize:H,collisionGroup:Y}=t.parameters,oe=y.get("text-optional"),ae=y.get("icon-optional"),le=s.aE(y,"text-overlap","text-allow-overlap"),pe=le==="always",Ae=s.aE(y,"icon-overlap","icon-allow-overlap"),we=Ae==="always",Re=y.get("text-rotation-alignment")==="map",Le=y.get("text-pitch-alignment")==="map",Se=y.get("icon-text-fit")!=="none",Ne=y.get("symbol-z-order")==="viewport-y",qe=pe&&(we||!m.hasIconData()||ae),He=we&&(pe||!m.hasTextData()||oe);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const je=this.retainedQueryData[m.bucketInstanceId].tileID,Xe=this._getTerrainElevationFunc(je),St=this.transform.getFastPathSimpleProjectionMatrix(je),xt=(at,kt,_n)=>{var Yn,wi;if(a[at.crossTileID])return;if(U)return void(this.placements[at.crossTileID]=new Bt(!1,!1,!1));let si=!1,Si=!1,li=!0,ai=null,ci={box:null,placeable:!1,offscreen:null,occluded:!1},nr={placeable:!1},Gn=null,qi=null,ir=null,pa=0,fa=0,ma=0;kt.textFeatureIndex?pa=kt.textFeatureIndex:at.useRuntimeCollisionCircles&&(pa=at.featureIndex),kt.verticalTextFeatureIndex&&(fa=kt.verticalTextFeatureIndex);const Cs=kt.textBox;if(Cs){const kr=Ci=>{let pi=s.an.horizontal;if(m.allowVerticalPlacement&&!Ci&&this.prevPlacement){const Tr=this.prevPlacement.placedOrientations[at.crossTileID];Tr&&(this.placedOrientations[at.crossTileID]=Tr,pi=Tr,this.markUsedOrientation(m,pi,at))}return pi},us=(Ci,pi)=>{if(m.allowVerticalPlacement&&at.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const Tr of m.writingModes)if(Tr===s.an.vertical?(ci=pi(),nr=ci):ci=Ci(),ci&&ci.placeable)break}else ci=Ci()},ga=at.textAnchorOffsetStartIndex,Ha=at.textAnchorOffsetEndIndex;if(Ha===ga){const Ci=(pi,Tr)=>{const Bi=this.collisionIndex.placeCollisionBox(pi,le,z,je,A,Le,Re,b,Y.predicate,Xe,void 0,St);return Bi&&Bi.placeable&&(this.markUsedOrientation(m,Tr,at),this.placedOrientations[at.crossTileID]=Tr),Bi};us(()=>Ci(Cs,s.an.horizontal),()=>{const pi=kt.verticalTextBox;return m.allowVerticalPlacement&&at.numVerticalGlyphVertices>0&&pi?Ci(pi,s.an.vertical):{box:null,offscreen:null}}),kr(ci&&ci.placeable)}else{let Ci=s.aD[(wi=(Yn=this.prevPlacement)===null||Yn===void 0?void 0:Yn.variableOffsets[at.crossTileID])===null||wi===void 0?void 0:wi.anchor];const pi=(Bi,Op,Zm)=>{const Wh=Bi.x2-Bi.x1,Ll=Bi.y2-Bi.y1,Oo=at.textBoxScale,Us=Se&&Ae==="never"?Op:null;let rr=null,Bs=le==="never"?1:2,qh="never";Ci&&Bs++;for(let _a=0;_a<Bs;_a++){for(let Zh=ga;Zh<Ha;Zh++){const Xh=m.textAnchorOffsets.get(Zh);if(Ci&&Xh.textAnchor!==Ci)continue;const Dl=this.attemptAnchorPlacement(Xh,Bi,Wh,Ll,Oo,Re,Le,z,je,A,Y,qh,at,m,Zm,b,T,Us,Xe);if(Dl&&(rr=Dl.placedGlyphBoxes,rr&&rr.placeable))return si=!0,ai=Dl.shift,rr}Ci?Ci=null:qh=le}return d&&!rr&&(rr={box:this.collisionIndex.placeCollisionBox(Cs,"always",z,je,A,Le,Re,b,Y.predicate,Xe,void 0,St).box,offscreen:!1,placeable:!1,occluded:!1}),rr};us(()=>pi(Cs,kt.iconBox,s.an.horizontal),()=>{const Bi=kt.verticalTextBox;return m.allowVerticalPlacement&&(!ci||!ci.placeable)&&at.numVerticalGlyphVertices>0&&Bi?pi(Bi,kt.verticalIconBox,s.an.vertical):{box:null,occluded:!0,offscreen:null}}),ci&&(si=ci.placeable,li=ci.offscreen);const Tr=kr(ci&&ci.placeable);if(!si&&this.prevPlacement){const Bi=this.prevPlacement.variableOffsets[at.crossTileID];Bi&&(this.variableOffsets[at.crossTileID]=Bi,this.markUsedJustification(m,Bi.anchor,at,Tr))}}}if(Gn=ci,si=Gn&&Gn.placeable,li=Gn&&Gn.offscreen,at.useRuntimeCollisionCircles){const kr=m.text.placedSymbolArray.get(at.centerJustifiedTextSymbolIndex),us=s.ao(m.textSizeData,H,kr),ga=y.get("text-padding");qi=this.collisionIndex.placeCollisionCircles(le,kr,m.lineVertexArray,m.glyphOffsetArray,us,A,D,d,Le,Y.predicate,at.collisionCircleDiameter,ga,b,Xe),qi.circles.length&&qi.collisionDetected&&!d&&s.w("Collisions detected, but collision boxes are not shown"),si=pe||qi.circles.length>0&&!qi.collisionDetected,li=li&&qi.offscreen}if(kt.iconFeatureIndex&&(ma=kt.iconFeatureIndex),kt.iconBox){const kr=us=>this.collisionIndex.placeCollisionBox(us,Ae,z,je,A,Le,Re,T,Y.predicate,Xe,Se&&ai?ai:void 0,St);nr&&nr.placeable&&kt.verticalIconBox?(ir=kr(kt.verticalIconBox),Si=ir.placeable):(ir=kr(kt.iconBox),Si=ir.placeable),li=li&&ir.offscreen}const Il=oe||at.numHorizontalGlyphVertices===0&&at.numVerticalGlyphVertices===0,Rl=ae||at.numIconVertices===0;Il||Rl?Rl?Il||(Si=Si&&si):si=Si&&si:Si=si=Si&&si;const Fo=Si&&ir.placeable;if(si&&Gn.placeable&&this.collisionIndex.insertCollisionBox(Gn.box,le,y.get("text-ignore-placement"),m.bucketInstanceId,nr&&nr.placeable&&fa?fa:pa,Y.ID),Fo&&this.collisionIndex.insertCollisionBox(ir.box,Ae,y.get("icon-ignore-placement"),m.bucketInstanceId,ma,Y.ID),qi&&si&&this.collisionIndex.insertCollisionCircles(qi.circles,le,y.get("text-ignore-placement"),m.bucketInstanceId,pa,Y.ID),d&&this.storeCollisionData(m.bucketInstanceId,_n,kt,Gn,ir,qi),at.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[at.crossTileID]=new Bt((si||qe)&&!(Gn!=null&&Gn.occluded),(Si||He)&&!(ir!=null&&ir.occluded),li||m.justReloaded),a[at.crossTileID]=!0};if(Ne){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const at=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let kt=at.length-1;kt>=0;--kt){const _n=at[kt];xt(m.symbolInstances.get(_n),m.collisionArrays[_n],_n)}}else for(let at=t.symbolInstanceStart;at<t.symbolInstanceEnd;at++)xt(m.symbolInstances.get(at),m.collisionArrays[at],at);m.justReloaded=!1}storeCollisionData(t,a,d,m,y,b){if(d.textBox||d.iconBox){let T,A;this.collisionBoxArrays.has(t)?T=this.collisionBoxArrays.get(t):(T=new Map,this.collisionBoxArrays.set(t,T)),T.has(a)?A=T.get(a):(A={text:null,icon:null},T.set(a,A)),d.textBox&&(A.text=m.box),d.iconBox&&(A.icon=y.box)}if(b){let T=this.collisionCircleArrays[t];T===void 0&&(T=this.collisionCircleArrays[t]=[]);for(let A=0;A<b.circles.length;A+=4)T.push(b.circles[A+0]-We),T.push(b.circles[A+1]-We),T.push(b.circles[A+2]),T.push(b.collisionDetected?1:0)}}markUsedJustification(t,a,d,m){let y;y=m===s.an.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.aF(a)];const b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of b)T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=y>=0&&T!==y?0:d.crossTileID)}markUsedOrientation(t,a,d){const m=a===s.an.horizontal||a===s.an.horizontalOnly?a:0,y=a===s.an.vertical?a:0,b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of b)t.text.placedSymbolArray.get(T).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(t):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],z=y[A];z?(this.opacities[A]=new Ct(z,m,D.text,D.icon),d=d||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[A]=new Ct(null,m,D.text,D.icon,D.skipFade),d=d||D.text||D.icon)}for(const A in y){const D=y[A];if(!this.opacities[A]){const z=new Ct(D,m,!1,!1);z.isHidden()||(this.opacities[A]=z,d=d||D.text.placed||D.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in T)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=T[A]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const d={};for(const m of a){const y=m.getBucket(t);y&&m.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,d,m.collisionBoxArray)}}updateBucketOpacities(t,a,d,m){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0],b=y.layout,T=new Ct(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),D=b.get("icon-allow-overlap"),z=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=b.get("text-rotation-alignment")==="map",N=b.get("text-pitch-alignment")==="map",H=b.get("icon-text-fit")!=="none",Y=new Ct(null,0,A&&(D||!t.hasIconData()||b.get("icon-optional")),D&&(A||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const oe=(le,pe,Ae)=>{for(let we=0;we<pe/4;we++)le.opacityVertexArray.emplaceBack(Ae);le.hasVisibleVertices=le.hasVisibleVertices||Ae!==Yr},ae=this.collisionBoxArrays.get(t.bucketInstanceId);for(let le=0;le<t.symbolInstances.length;le++){const pe=t.symbolInstances.get(le),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:we,crossTileID:Re}=pe;let Le=this.opacities[Re];d[Re]?Le=T:Le||(Le=Y,this.opacities[Re]=Le),d[Re]=!0;const Se=pe.numIconVertices>0,Ne=this.placedOrientations[pe.crossTileID],qe=Ne===s.an.vertical,He=Ne===s.an.horizontal||Ne===s.an.horizontalOnly;if(Ae>0||we>0){const Xe=Ir(Le.text);oe(t.text,Ae,qe?Yr:Xe),oe(t.text,we,He?Yr:Xe);const St=Le.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(kt=>{kt>=0&&(t.text.placedSymbolArray.get(kt).hidden=St||qe?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=St||He?1:0);const xt=this.variableOffsets[pe.crossTileID];xt&&this.markUsedJustification(t,xt.anchor,pe,Ne);const at=this.placedOrientations[pe.crossTileID];at&&(this.markUsedJustification(t,"left",pe,at),this.markUsedOrientation(t,at,pe))}if(Se){const Xe=Ir(Le.icon),St=!(H&&pe.verticalPlacedIconSymbolIndex&&qe);pe.placedIconSymbolIndex>=0&&(oe(t.icon,pe.numIconVertices,St?Xe:Yr),t.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Le.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(oe(t.icon,pe.numVerticalIconVertices,St?Yr:Xe),t.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}const je=ae&&ae.has(le)?ae.get(le):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Xe=t.collisionArrays[le];if(Xe){let St=new s.P(0,0);if(Xe.textBox||Xe.verticalTextBox){let xt=!0;if(z){const at=this.variableOffsets[Re];at?(St=un(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale),U&&St._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):xt=!1}if(Xe.textBox||Xe.verticalTextBox){let at;Xe.textBox&&(at=qe),Xe.verticalTextBox&&(at=He),Fn(t.textCollisionBox.collisionVertexArray,Le.text.placed,!xt||at,je.text,St.x,St.y)}}if(Xe.iconBox||Xe.verticalIconBox){const xt=!!(!He&&Xe.verticalIconBox);let at;Xe.iconBox&&(at=xt),Xe.verticalIconBox&&(at=!xt),Fn(t.iconCollisionBox.collisionVertexArray,Le.icon.placed,at,je.icon,H?St.x:0,H?St.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Fn(_,t,a,d,m,y){d&&d.length!==0||(d=[0,0,0,0]);const b=d[0]-We,T=d[1]-We,A=d[2]-We,D=d[3]-We;_.emplaceBack(t?1:0,a?1:0,m||0,y||0,b,T),_.emplaceBack(t?1:0,a?1:0,m||0,y||0,A,T),_.emplaceBack(t?1:0,a?1:0,m||0,y||0,A,D),_.emplaceBack(t?1:0,a?1:0,m||0,y||0,b,D)}const On=Math.pow(2,25),ri=Math.pow(2,24),_i=Math.pow(2,17),Hn=Math.pow(2,16),sn=Math.pow(2,9),vi=Math.pow(2,8),Zn=Math.pow(2,1);function Ir(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const t=_.placed?1:0,a=Math.floor(127*_.opacity);return a*On+t*ri+a*_i+t*Hn+a*sn+t*vi+a*Zn+t}const Yr=0;class xr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,d,m,y){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(b,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((T,A)=>T.sortKey-A.sortKey));this._currentPartIndex<b.length;)if(a.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,y())return!0;return!1}}class sa{constructor(t,a,d,m,y,b,T,A){this.placement=new tn(t,a,b,T,A),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d){const m=L.now(),y=()=>!this._forceFullPlacement&&L.now()-m>2;for(;this._currentPlacementIndex>=0;){const b=a[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=T)&&(!b.maxzoom||b.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new xr(b)),this._inProgressLayer.continuePlacement(d[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ti=512/s.$/2;class hr{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let y=0;y<a.length;y++){const b=a.get(y),T=b.key,A=m.get(T);A?A.push(b):m.set(T,[b])}for(const[y,b]of m){const T={positions:b.map(A=>({x:Math.floor(A.anchorX*ti),y:Math.floor(A.anchorY*ti)})),crossTileIDs:b.map(A=>A.crossTileID)};if(T.positions.length>128){const A=new s.aH(T.positions.length,16,Uint16Array);for(const{x:D,y:z}of T.positions)A.add(D,z);A.finish(),delete T.positions,T.index=A}this._symbolsByKey[y]=T}}getScaledCoordinates(t,a){const{x:d,y:m,z:y}=this.tileID.canonical,{x:b,y:T,z:A}=a.canonical,D=ti/Math.pow(2,A-y),z=(T*s.$+t.anchorY)*D,U=m*s.$*ti;return{x:Math.floor((b*s.$+t.anchorX)*D-d*s.$*ti),y:Math.floor(z-U)}}findMatches(t,a,d){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let y=0;y<t.length;y++){const b=t.get(y);if(b.crossTileID)continue;const T=this._symbolsByKey[b.key];if(!T)continue;const A=this.getScaledCoordinates(b,a);if(T.index){const D=T.index.range(A.x-m,A.y-m,A.x+m,A.y+m).sort();for(const z of D){const U=T.crossTileIDs[z];if(!d[U]){d[U]=!0,b.crossTileID=U;break}}}else if(T.positions)for(let D=0;D<T.positions.length;D++){const z=T.positions[D],U=T.crossTileIDs[D];if(Math.abs(z.x-A.x)<=m&&Math.abs(z.y-A.y)<=m&&!d[U]){d[U]=!0,b.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class dr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const m=this.indexes[d],y={};for(const b in m){const T=m[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),y[T.tileID.key]=T}this.indexes[d]=y}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const T in b){const A=b[T];A.tileID.isChildOf(t)&&A.findMatches(a.symbolInstances,t,m)}else{const T=b[t.scaledTo(Number(y)).key];T&&T.findMatches(a.symbolInstances,t,m)}}for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=d.generate(),m[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new hr(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[t][m]}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const m=this.indexes[d];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[y]),delete m[y],a=!0)}return a}}class Ui{constructor(){this.layerIndexes={},this.crossTileIDs=new dr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Hi);let y=!1;const b={};m.handleWrapJump(d);for(const T of a){const A=T.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,A,this.crossTileIDs)&&(y=!0),b[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(t){const a={};t.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}var aa="void main() {fragColor=vec4(1.0);}";const ji={prelude:En(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:En("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:En("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:En(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:En(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:En(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:En(aa,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:En(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:En(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:En("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:En("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:En(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:En("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:En(aa,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:En(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:En(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:En(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:En(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:En(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:En(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:En(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:En(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:En(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:En(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:En(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:En(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:En(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:En(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:En(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:En(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:En("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:En("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:En("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:En("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:En(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:En("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function En(_,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=t.match(/in ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=y?y.concat(m):m,T={};return{fragmentSource:_=_.replace(a,(A,D,z,U,N)=>(T[N]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${z} ${U} ${N};
#else
uniform ${z} ${U} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${z} ${U} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(a,(A,D,z,U,N)=>{const H=U==="float"?"vec2":"vec4",Y=N.match(/color/)?"color":H;return T[N]?D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${H} a_${N};
out ${z} ${U} ${N};
#else
uniform ${z} ${U} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${z} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${z} ${U} ${N} = u_${N};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${H} a_${N};
#else
uniform ${z} ${U} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${U} ${N} = a_${N};
#else
    ${z} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${U} ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${z} ${U} ${N} = u_${N};
#endif
`}),staticAttributes:d,staticUniforms:b}}class zs{constructor(t,a,d){this.vertexBuffer=t,this.indexBuffer=a,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Fs=s.aI([{name:"a_pos",type:"Int16",components:2}]);const Da="#define PROJECTION_MERCATOR",ih="mercator";class rh{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ih}get shaderDefine(){return Da}get shaderPreludeCode(){return ji.projectionMercator}get vertexShaderPreludeCode(){return ji.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,d,m,y){if(this._cachedMesh)return this._cachedMesh;const b=new s.aK;b.emplaceBack(0,0),b.emplaceBack(s.$,0),b.emplaceBack(0,s.$),b.emplaceBack(s.$,s.$);const T=t.createVertexBuffer(b,Fs.members),A=s.aL.simpleSegment(0,0,4,2),D=new s.aM;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3);const z=t.createIndexBuffer(D);return this._cachedMesh=new zs(T,z,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Kr{constructor(t=0,a=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=m}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=s.C.number(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=s.C.number(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=s.C.number(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=s.C.number(t.right,a.right,d)),this}getCenter(t,a){const d=s.ag((this.left+t-this.right)/2,0,t),m=s.ag((this.top+a-this.bottom)/2,0,a);return new s.P(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Kr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Os(_,t){if(!_.renderWorldCopies||_.lngRange)return;const a=t.lng-_.center.lng;t.lng+=a>180?-360:a<-180?360:0}function An(_){return Math.max(0,Math.floor(_))}class il{constructor(t,a,d,m,y,b){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=An(this._zoom),this._scale=s.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Kr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,d){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=An(this._zoom),this._scale=s.ae(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Kr(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!d&&t.autoCalculateNearFarZ,a&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=s.aN(t,-180,180)*Math.PI/180;var d,m,y,b,T,A,D,z,U;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=M(),d=this._rotationMatrix,y=-this._bearingInRadians,b=(m=this._rotationMatrix)[0],T=m[1],A=m[2],D=m[3],z=Math.sin(y),U=Math.cos(y),d[0]=b*U+A*z,d[1]=T*U+D*z,d[2]=b*-z+A*U,d[3]=T*-z+D*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=s.ag(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aO(this._fovInRadians)}setFov(t){t=s.ag(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=s.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.getConstrained(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=s.ae(a),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}resize(t,a,d=!0){this._width=t,this._height=a,d&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new pn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.ah])}getConstrained(t,a){return this._callbacks.getConstrained(t,a)}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:d,minY:m,maxX:y,maxY:b}=s.a1.fromPoints(a).extend(t);return[new s.P(d,m),new s.P(y,m),new s.P(y,b),new s.P(d,b),new s.P(d,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:d}=this.getConstrained(this.center,this.zoom);this.setCenter(a),this.setZoom(d),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=s.af(new Float64Array(16));s.N(t,t,[this._width/2,-this._height/2,1]),s.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=s.af(new Float64Array(16)),s.N(t,t,[1,-1,1]),s.M(t,t,[-1,-1,0]),s.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,d,m){const y=d!==void 0?d:this.bearing,b=m=m!==void 0?m:this.pitch,T=s.a0.fromLngLat(t,a),A=-Math.cos(s.ad(b)),D=Math.sin(s.ad(b)),z=D*Math.sin(s.ad(y)),U=-D*Math.cos(s.ad(y));let N=this.elevation;const H=a-N;let Y;A*H>=0||Math.abs(A)<.1?(Y=1e4,N=a+Y*A):Y=-H/A;let oe,ae,le=s.aP(1,T.y),pe=0;do{if(pe+=1,pe>10)break;ae=Y/le,oe=new s.a0(T.x+z*ae,T.y+U*ae),le=1/oe.meterInMercatorCoordinateUnits()}while(Math.abs(Y-ae*le)>1e-12);return{center:oe.toLngLat(),elevation:N,zoom:s.aj(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=s.ai(1,this.center.lat)*this.worldSize,d=this.cameraToCenterDistance/a,m=s.a0.fromLngLat(this.center,this.elevation),y=ue(this.center,this.elevation,this.pitch,this.bearing,d);this._elevation=t;const b=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),s.aP(y.z,m.y),this.bearing,this.pitch);this._elevation=b.elevation,this._center=b.center,this.setZoom(b.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=s.ai(1,this.center.lat)*this.worldSize;return ue(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/s.$,1/a/s.$]}}class mc{constructor(t,a){this.min=t,this.max=a,this.center=s.aQ([],s.aR([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],d=s.aS(this.min),m=s.aS(this.max);for(let y=0;y<a.length;y++)d[y]=a[y]?this.min[y]:this.center[y],m[y]=a[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new mc(d,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let d=0;d<t.planes.length;d++){const m=this.intersectsPlane(t.planes[d]);if(m===0)return 0;m===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],d=t[3];for(let m=0;m<3;m++)t[m]>0?(a+=t[m]*this.min[m],d+=t[m]*this.max[m]):(d+=t[m]*this.min[m],a+=t[m]*this.max[m]);return a>=0?2:d<0?0:1}}class sh{distanceToTile2d(t,a,d,m){const y=m.distanceX([t,a]),b=m.distanceY([t,a]);return Math.hypot(y,b)}getWrap(t,a,d){return d}getTileBoundingVolume(t,a,d,m){var y,b;let T=d,A=d;if(m!=null&&m.terrain){const z=new s.Z(t.z,a,t.z,t.x,t.y),U=m.terrain.getMinMaxElevation(z);T=(y=U.minElevation)!==null&&y!==void 0?y:d,A=(b=U.maxElevation)!==null&&b!==void 0?b:d}const D=1<<t.z;return new mc([a+t.x/D,t.y/D,T],[a+(t.x+1)/D,(t.y+1)/D,A])}allowVariableZoom(t,a){const d=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,m=s.ag(78.5-d/2,0,60);return!!a.terrain||t.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class pr{constructor(t,a,d){this.points=t,this.planes=a,this.aabb=d}static fromInvProjectionMatrix(t,a=1,d=0,m,y){const b=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,d),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>function(H,Y,oe,ae){const le=s.av([],H,Y),pe=1/le[3]/oe*ae;return s.aX(le,le,[pe,pe,1/le[3],pe])}(N,t,a,T));m&&function(N,H,Y,oe){const ae=oe?4:0,le=oe?0:4;let pe=0;const Ae=[],we=[];for(let Se=0;Se<4;Se++){const Ne=s.aT([],N[Se+le],N[Se+ae]),qe=s.aY(Ne);s.aQ(Ne,Ne,1/qe),Ae.push(qe),we.push(Ne)}for(let Se=0;Se<4;Se++){const Ne=s.aZ(N[Se+ae],we[Se],Y);pe=Ne!==null&&Ne>=0?Math.max(pe,Ne):Math.max(pe,Ae[Se])}const Re=function(Se,Ne){const qe=s.aT([],Se[Ne[0]],Se[Ne[1]]),He=s.aT([],Se[Ne[2]],Se[Ne[1]]),je=[0,0,0,0];return s.aU(je,s.aV([],qe,He)),je[3]=-s.aW(je,Se[Ne[0]]),je}(N,H),Le=function(Se,Ne){const qe=s.a_(Se),He=s.a$([],Se,1/qe),je=s.aT([],Ne,s.aQ([],He,s.aW(Ne,He))),Xe=s.a_(je);if(Xe>0){const St=Math.sqrt(1-He[3]*He[3]),xt=s.aQ([],He,-He[3]),at=s.aR([],xt,s.aQ([],je,St/Xe));return s.b0(Ne,at)}return null}(Y,Re);if(Le!==null){const Se=Le/s.aW(we[0],Re);pe=Math.min(pe,Se)}for(let Se=0;Se<4;Se++){const Ne=Math.min(pe,Ae[Se]);N[Se+le]=[N[Se+ae][0]+we[Se][0]*Ne,N[Se+ae][1]+we[Se][1]*Ne,N[Se+ae][2]+we[Se][2]*Ne,1]}}(A,b[0],m,y);const D=b.map(N=>{const H=s.aT([],A[N[0]],A[N[1]]),Y=s.aT([],A[N[2]],A[N[1]]),oe=s.aU([],s.aV([],H,Y)),ae=-s.aW(oe,A[N[1]]);return oe.concat(ae)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of A)for(let H=0;H<3;H++)z[H]=Math.min(z[H],N[H]),U[H]=Math.max(U[H],N[H]);return new pr(A,D,new mc(z,U))}}class zi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,d){return this._helper.interpolatePadding(t,a,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,d=!0){this._helper.resize(t,a,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t,a,d,m,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new il({calcMatrices:()=>{this._calcMatrices()},getConstrained:(b,T)=>this.getConstrained(b,T)},t,a,d,m,y),this._coveringTilesDetailsProvider=new sh}clone(){const t=new zi;return t.apply(this),t}apply(t,a,d){this._helper.apply(t,a,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new s.b1(0,t)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new s.P(0,0)),m=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),T=Math.floor(Math.min(d.x,m.x,y.x,b.x)),A=Math.floor(Math.max(d.x,m.x,y.x,b.x)),D=1;for(let z=T-D;z<=A+D;z++)z!==0&&a.push(new s.b1(z,t))}return a}getCameraFrustum(){return pr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),d=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(t,a){const d=s.ai(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(a,d),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),b=s.a0.fromLngLat(t),T=new s.a0(b.x-(m.x-y.x),b.y-(m.y-y.y));this.setCenter(T==null?void 0:T.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(s.a0.fromLngLat(t),a.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.a0.fromLngLat(t))}screenPointToLocation(t,a){var d;return(d=this.screenPointToMercatorCoordinate(t,a))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const d=a.pointCoordinate(t);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const d=a||0,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];s.av(m,m,this._pixelMatrixInverse),s.av(y,y,this._pixelMatrixInverse);const b=m[3],T=y[3],A=m[1]/b,D=y[1]/T,z=m[2]/b,U=y[2]/T,N=z===U?0:(d-z)/(U-z);return new s.a0(s.C.number(m[0]/b,y[0]/T,N)/this.worldSize,s.C.number(A,D,N)/this.worldSize,d)}coordinatePoint(t,a=0,d=this._pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,a,1];return s.av(m,m,d),new s.P(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this._helper._height/2-X(this));return new pn().extend(this.screenPointToLocation(new s.P(0,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-X(this)}calculatePosMatrix(t,a=!1,d){var m;const y=(m=t.key)!==null&&m!==void 0?m:s.b2(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=a?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(y)){const D=b.get(y);return d?D.f32:D.f64}const T=J(t,this.worldSize);s.O(T,a?this._alignedProjMatrix:this._viewProjMatrix,T);const A={f64:T,f32:new Float32Array(T)};return b.set(y,A),d?A.f32:A.f64}calculateFogMatrix(t){const a=t.key,d=this._fogMatrixCacheF32;if(d.has(a))return d.get(a);const m=J(t,this.worldSize);return s.O(m,this._fogMatrix,m),d.set(a,new Float32Array(m)),d.get(a)}getConstrained(t,a){a=s.ag(+a,this.minZoom,this.maxZoom);const d={center:new s.S(t.lng,t.lat),zoom:a};let m=this._helper._lngRange;this._helper._renderWorldCopies||m!==null||(m=[-179.9999999999,180-1e-10]);const y=this.tileSize*s.ae(d.zoom);let b=0,T=y,A=0,D=y,z=0,U=0;const{x:N,y:H}=this.size;if(this._helper._latRange){const Ae=this._helper._latRange;b=s.U(Ae[1])*y,T=s.U(Ae[0])*y,T-b<H&&(z=H/(T-b))}m&&(A=s.aN(s.V(m[0])*y,0,y),D=s.aN(s.V(m[1])*y,0,y),D<A&&(D+=y),D-A<N&&(U=N/(D-A)));const{x:Y,y:oe}=Ce(y,t);let ae,le;const pe=Math.max(U||0,z||0);if(pe){const Ae=new s.P(U?(D+A)/2:Y,z?(T+b)/2:oe);return d.center=W(y,Ae).wrap(),d.zoom+=s.aj(pe),d}if(this._helper._latRange){const Ae=H/2;oe-Ae<b&&(le=b+Ae),oe+Ae>T&&(le=T-Ae)}if(m){const Ae=(A+D)/2;let we=Y;this._helper._renderWorldCopies&&(we=s.aN(Y,Ae-y/2,Ae+y/2));const Re=N/2;we-Re<A&&(ae=A+Re),we+Re>D&&(ae=D-Re)}if(ae!==void 0||le!==void 0){const Ae=new s.P(ae??Y,le??oe);d.center=W(y,Ae).wrap()}return d}calculateCenterFromCameraLngLatAlt(t,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,d,m)}_calculateNearFarZIfNeeded(t,a,d){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=t-m*this._helper._pixelPerMeter/Math.cos(a),b=m<0?y:t,T=Math.PI/2+this.pitchInRadians,A=s.ad(this.fov)*(Math.abs(Math.cos(s.ad(this.roll)))*this.height+Math.abs(Math.sin(s.ad(this.roll)))*this.width)/this.height*(.5+d.y/this.height),D=Math.sin(A)*b/Math.sin(s.ag(Math.PI-T-A,.01,Math.PI-.01)),z=X(this),U=Math.atan(z/this._helper.cameraToCenterDistance),N=s.ad(.75),H=U>N?2*U*(.5+d.y/(2*z)):N,Y=Math.sin(H)*b/Math.sin(s.ag(Math.PI-T-H,.01,Math.PI-.01)),oe=Math.min(D,Y);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*oe+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Ce(this.worldSize,this.center),d=a.x,m=a.y;this._helper._pixelPerMeter=s.ai(1,this.center.lat)*this.worldSize;const y=s.ad(Math.min(this.pitch,bt)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let T;this._calculateNearFarZIfNeeded(b,y,t),T=new Float64Array(16),s.b3(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.ap(this._invProjMatrix,T),T[8]=2*-t.x/this._helper._width,T[9]=2*t.y/this._helper._height,this._projectionMatrix=s.b4(T),s.N(T,T,[1,-1,1]),s.M(T,T,[0,0,-this._helper.cameraToCenterDistance]),s.b5(T,T,-this.rollInRadians),s.b6(T,T,this.pitchInRadians),s.b5(T,T,-this.bearingInRadians),s.M(T,T,[-d,-m,0]),this._mercatorMatrix=s.N([],T,[this.worldSize,this.worldSize,this.worldSize]),s.N(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),s.M(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=s.ap([],T);const A=[0,0,-1,1];s.av(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),s.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,s.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.M(this._fogMatrix,this._fogMatrix,[-d,-m,0]),s.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const D=this._helper._width%2/2,z=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),H=d-Math.round(d)+U*D+N*z,Y=m-Math.round(m)+U*z+N*D,oe=new Float64Array(T);if(s.M(oe,oe,[H>.5?H-1:H,Y>.5?Y-1:Y,0]),this._alignedProjMatrix=oe,T=s.ap(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new s.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.av(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=s.ai(1,this.center.lat)*this.worldSize;return ue(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const d=s.a0.fromLngLat(t),m=[d.x*this.worldSize,d.y*this.worldSize,a,1];return s.av(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(t){const{overscaledTileID:a,aligned:d,applyTerrainMatrix:m}=t,y=this._helper.getMercatorTileCoordinates(a),b=a?this.calculatePosMatrix(a,d,!0):null;let T;return T=a&&a.terrainRttPosMatrix32f&&m?a.terrainRttPosMatrix32f:b||s.b7(),{mainMatrix:T,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,d){return 1}transformLightDirection(t){return s.aS(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,d,m){const y=this.calculatePosMatrix(d);let b;m?(b=[t,a,m(t,a),1],s.av(b,b,y)):(b=[t,a,0,1],Ke(b,b,y));const T=b[3];return{point:new s.P(b[0]/T,b[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const d=s.a0.fromLngLat(t,a),m=d.meterInMercatorCoordinateUnits(),y=s.b8();return s.M(y,y,[d.x,d.y,d.z]),s.b5(y,y,Math.PI),s.b6(y,y,Math.PI/2),s.N(y,y,[-m,m,m]),y}getProjectionDataForCustomLayer(t=!0){const a=new s.Z(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),m=J(a,this.worldSize);s.O(m,this._viewProjMatrix,m),d.tileMercatorCoords=[0,0,1,1];const y=[s.$,s.$,this.worldSize/this._helper.pixelsPerMeter],b=s.b9();return s.N(b,m,y),d.fallbackMatrix=b,d.mainMatrix=b,d}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function fr(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function $i(_){if(_.useSlerp)if(_.k<1){const t=s.ba(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),a=s.ba(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),d=new Float64Array(4);s.bb(d,t,a,_.k);const m=s.bc(d);_.tr.setRoll(m.roll),_.tr.setPitch(m.pitch),_.tr.setBearing(m.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(s.C.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(s.C.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(s.C.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function xi(_,t,a,d,m){const y=m.padding,b=Ce(m.worldSize,a.getNorthWest()),T=Ce(m.worldSize,a.getNorthEast()),A=Ce(m.worldSize,a.getSouthEast()),D=Ce(m.worldSize,a.getSouthWest()),z=s.ad(-d),U=b.rotate(z),N=T.rotate(z),H=A.rotate(z),Y=D.rotate(z),oe=new s.P(Math.max(U.x,N.x,Y.x,H.x),Math.max(U.y,N.y,Y.y,H.y)),ae=new s.P(Math.min(U.x,N.x,Y.x,H.x),Math.min(U.y,N.y,Y.y,H.y)),le=oe.sub(ae),pe=(m.width-(y.left+y.right+t.left+t.right))/le.x,Ae=(m.height-(y.top+y.bottom+t.top+t.bottom))/le.y;if(Ae<0||pe<0)return void fr();const we=Math.min(s.aj(m.scale*Math.min(pe,Ae)),_.maxZoom),Re=s.P.convert(_.offset),Le=new s.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(s.ad(d)),Se=Re.add(Le).mult(m.scale/s.ae(we));return{center:W(m.worldSize,b.add(A).div(2).sub(Se)),zoom:we,bearing:d}}class gc{get useGlobeControls(){return!1}handlePanInertia(t,a){return{easingOffset:t,easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,d){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(d,t.around)}cameraForBoxAndBearing(t,a,d,m,y){return xi(t,a,d,m,y)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(s.S.convert(a.center))}handleEaseTo(t,a){const d=t.zoom,m=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},T=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let D=!1;const z=T?+a.zoom:t.zoom;let U=t.centerPoint.add(a.offsetAsPoint);const N=t.screenPointToLocation(U),{center:H,zoom:Y}=t.getConstrained(s.S.convert(a.center||N),z??d);Os(t,H);const oe=Ce(t.worldSize,N),ae=Ce(t.worldSize,H).sub(oe),le=s.ae(Y-d);return D=Y!==d,{easeFunc:pe=>{if(D&&t.setZoom(s.C.number(d,Y,pe)),s.bd(y,b)||$i({startEulerAngles:y,endEulerAngles:b,tr:t,k:pe,useSlerp:y.roll!=b.roll}),A&&(t.interpolatePadding(m,a.padding,pe),U=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Ae=s.ae(t.zoom-d),we=Y>d?Math.min(2,le):Math.max(.5,le),Re=Math.pow(we,1-pe),Le=W(t.worldSize,oe.add(ae.mult(pe*Re)).mult(Ae));t.setLocationAtPoint(t.renderWorldCopies?Le.wrap():Le,U)}},isZooming:D,elevationCenter:H}}handleFlyTo(t,a){const d=a.zoom!==void 0,m=t.zoom,y=t.getConstrained(s.S.convert(a.center||a.locationAtOffset),d?+a.zoom:m),b=y.center,T=y.zoom;Os(t,b);const A=Ce(t.worldSize,a.locationAtOffset),D=Ce(t.worldSize,b).sub(A),z=D.mag(),U=s.ae(T-m);let N;if(a.minZoom!==void 0){const H=Math.min(+a.minZoom,m,T),Y=t.getConstrained(b,H).zoom;N=s.ae(Y-m)}return{easeFunc:(H,Y,oe,ae)=>{t.setZoom(H===1?T:m+s.aj(Y));const le=H===1?b:W(t.worldSize,A.add(D.mult(oe)).mult(Y));t.setLocationAtPoint(t.renderWorldCopies?le.wrap():le,ae)},scaleOfZoom:U,targetCenter:b,scaleOfMinZoom:N,pixelPathLength:z}}}class Nn{constructor(t,a,d){this.blendFunction=t,this.blendColor=a,this.mask=d}}Nn.Replace=[1,0],Nn.disabled=new Nn(Nn.Replace,s.be.transparent,[!1,!1,!1,!1]),Nn.unblended=new Nn(Nn.Replace,s.be.transparent,[!0,!0,!0,!0]),Nn.alphaBlended=new Nn([1,771],s.be.transparent,[!0,!0,!0,!0]);const Rr=2305;class hn{constructor(t,a,d){this.enable=t,this.mode=a,this.frontFace=d}}hn.disabled=new hn(!1,1029,Rr),hn.backCCW=new hn(!0,1029,Rr),hn.frontCCW=new hn(!0,1028,Rr);class gn{constructor(t,a,d){this.func=t,this.mask=a,this.range=d}}gn.ReadOnly=!1,gn.ReadWrite=!0,gn.disabled=new gn(519,gn.ReadOnly,[0,1]);const ka=7680;class an{constructor(t,a,d,m,y,b){this.test=t,this.ref=a,this.mask=d,this.fail=m,this.depthFail=y,this.pass=b}}an.disabled=new an({func:519,mask:0},0,0,ka,ka,ka);const za=new WeakMap;function br(_){var t;if(za.has(_))return za.get(_);{const a=(t=_.getParameter(_.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return za.set(_,a),a}}class ho{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,d=a.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const m=new s.aK;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const y=new s.aM;y.emplaceBack(0,1,2),this._fullscreenTriangle=new zs(a.createVertexBuffer(m,Fs.members),a.createIndexBuffer(y),s.aL.simpleSegment(0,0,m.length,y.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(d.TEXTURE1);const b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),br(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const d=this._cachedRenderContext.context,m=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:s.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,m.TRIANGLES,gn.disabled,an.disabled,Nn.unblended,hn.disabled,((y,b)=>({u_input:y,u_output_expected:b}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&br(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const y=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&br(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ho._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Jr=s.$/128;function ah(_,t){const a=_.granularity!==void 0?Math.max(_.granularity,1):1,d=a+(_.generateBorders?2:0),m=a+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=d+1,b=m+1,T=_.generateBorders?-1:0,A=_.generateBorders||_.extendToNorthPole?-1:0,D=a+(_.generateBorders?1:0),z=a+(_.generateBorders||_.extendToSouthPole?1:0),U=y*b,N=d*m*6,H=y*b>65536;if(H&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Y=H||t==="32bit",oe=new Int16Array(2*U);let ae=0;for(let Ae=A;Ae<=z;Ae++)for(let we=T;we<=D;we++){let Re=we/a*s.$;we===-1&&(Re=-64),we===a+1&&(Re=s.$+Jr);let Le=Ae/a*s.$;Ae===-1&&(Le=_.extendToNorthPole?s.bg:-64),Ae===a+1&&(Le=_.extendToSouthPole?s.bh:s.$+Jr),oe[ae++]=Re,oe[ae++]=Le}const le=Y?new Uint32Array(N):new Uint16Array(N);let pe=0;for(let Ae=0;Ae<m;Ae++)for(let we=0;we<d;we++){const Re=we+1+Ae*y,Le=we+(Ae+1)*y,Se=we+1+(Ae+1)*y;le[pe++]=we+Ae*y,le[pe++]=Le,le[pe++]=Re,le[pe++]=Re,le[pe++]=Le,le[pe++]=Se}return{vertices:oe.buffer.slice(0),indices:le.buffer.slice(0),uses32bitIndices:Y}}const Ms=new s.aJ({fill:new s.bi(128,2),line:new s.bi(512,0),tile:new s.bi(128,32),stencil:new s.bi(128,1),circle:3});class Jd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ji.projectionGlobe}get vertexShaderPreludeCode(){return ji.projectionMercator.vertexSource}get subdivisionGranularity(){return Ms}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ho(t));const a=s.U(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(a,d),y=L.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=y);const b=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bk(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,d,m,y){const b=(y==="stencil"?Ms.stencil:Ms.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:b,generateBorders:d,extendToNorthPole:a.y===0&&m,extendToSouthPole:a.y===(1<<a.z)-1&&m})}_getMesh(t,a){const d=this._getMeshKey(a);if(d in this._tileMeshCache)return this._tileMeshCache[d];const m=function(y,b){const T=ah(b,"16bit"),A=s.aK.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),D=s.aM.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new zs(y.createVertexBuffer(A,Fs.members),y.createIndexBuffer(D),s.aL.simpleSegment(0,0,A.length,D.length))}(t,a);return this._tileMeshCache[d]=m,m}recalculate(t){}hasTransition(){const t=L.now();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Qd=new s.r({type:new s.D(s.v.projection.type)});class rl extends s.E{constructor(t){super(),this._transitionable=new s.t(Qd),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0)),this._mercatorProjection=new rh,this._verticalPerspectiveProjection=new Jd}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof s.bl){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,d,m,y){return this.currentProjection.getMeshFromTileID(t,a,d,m,y)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function sl(_){const t=po(_.worldSize,_.center.lat);return 2*Math.PI*t}function os(_,t,a,d,m){const y=1/(1<<m),b=t/s.$*y+d*y,T=s.bn((_/s.$*y+a*y)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,D=Math.cos(A),z=new Float64Array(3);return z[0]=Math.sin(T)*D,z[1]=Math.sin(A),z[2]=Math.cos(T)*D,z}function Wi(_){return function(t,a){const d=Math.cos(a),m=new Float64Array(3);return m[0]=Math.sin(t)*d,m[1]=Math.sin(a),m[2]=Math.cos(t)*d,m}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function po(_,t){return _/(2*Math.PI)/Math.cos(t*Math.PI/180)}function al(_){const t=Math.asin(_[1])/Math.PI*180,a=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(a>1e-6){const d=_[0]/a,m=Math.acos(_[2]/a),y=(d>0?m:-m)/Math.PI*180;return new s.S(s.aN(y,-180,180),t)}return new s.S(0,t)}function fo(_){return Math.cos(_*Math.PI/180)}function Fi(_,t){const a=fo(_),d=fo(t);return s.aj(d/a)}function ol(_,t){const a=_.rotate(t.bearingInRadians),d=t.zoom+Fi(t.center.lat,0),m=s.bj(1/fo(t.center.lat),1/fo(Math.min(Math.abs(t.center.lat),60)),s.bm(d,7,3,0,1)),y=360/sl({worldSize:t.worldSize,center:{lat:t.center.lat}});return new s.S(t.center.lng-a.x*y*m,s.ag(t.center.lat+a.y*y,-85.051129,s.ah))}function mo(_){const t=.5*_,a=Math.sin(t),d=Math.cos(t);return Math.log(a+d)-Math.log(d-a)}function go(_,t,a,d){const m=_.lat+a*d;if(Math.abs(a)>1){const y=(Math.sign(_.lat+a)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,b=Math.abs(_.lat+a)*Math.PI/180,T=mo(y+d*(b-y)),A=mo(y),D=mo(b);return new s.S(_.lng+t*((T-A)/(D-A)),m)}return new s.S(_.lng+t*d,m)}class Sm{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,d,m){const y=`${t.z}_${t.x}_${t.y}_${m!=null&&m.terrain?"t":""}`,b=this._cache.get(y);if(b)return b;const T=this._cachePrevious.get(y);if(T)return this._cache.set(y,T),T;const A=this._boundingVolumeFactory(t,a,d,m);return this._cache.set(y,A),this._hadAnyChanges=!0,A}}class oa{constructor(t,a,d,m){this.min=d,this.max=m,this.points=t,this.planes=a}static fromAabb(t,a){const d=[];for(let m=0;m<8;m++)d.push([1&~m?t[0]:a[0],(m>>1&1)==1?a[1]:t[1],(m>>2&1)==1?a[2]:t[2]]);return new oa(d,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,d){const m=s.bq([],d[0],d[1],d[2]),y=s.br([],[a[0],0,0],m),b=s.br([],[0,a[1],0],m),T=s.br([],[0,0,a[2]],m),A=[...t],D=[...t];for(let U=0;U<8;U++)for(let N=0;N<3;N++){const H=t[N]+y[N]*(1&~U?-1:1)+b[N]*((U>>1&1)==1?1:-1)+T[N]*((U>>2&1)==1?1:-1);A[N]=Math.min(A[N],H),D[N]=Math.max(D[N],H)}const z=[];for(let U=0;U<8;U++){const N=[...t];s.aR(N,N,s.aQ([],y,1&~U?-1:1)),s.aR(N,N,s.aQ([],b,(U>>1&1)==1?1:-1)),s.aR(N,N,s.aQ([],T,(U>>2&1)==1?1:-1)),z.push(N)}return new oa(z,[[...y,-s.aW(y,z[0])],[...b,-s.aW(b,z[0])],[...T,-s.aW(T,z[0])],[-y[0],-y[1],-y[2],-s.aW(y,z[7])],[-b[0],-b[1],-b[2],-s.aW(b,z[7])],[-T[0],-T[1],-T[2],-s.aW(T,z[7])]],A,D)}intersectsFrustum(t){let a=!0;const d=this.points.length,m=this.planes.length,y=t.planes.length,b=t.points.length;for(let T=0;T<y;T++){const A=t.planes[T];let D=0;for(let z=0;z<d;z++){const U=this.points[z];A[0]*U[0]+A[1]*U[1]+A[2]*U[2]+A[3]>=0&&D++}if(D===0)return 0;D<d&&(a=!1)}if(a)return 2;for(let T=0;T<m;T++){const A=this.planes[T];let D=0;for(let z=0;z<b;z++){const U=t.points[z];A[0]*U[0]+A[1]*U[1]+A[2]*U[2]+A[3]>=0&&D++}if(D===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let d=0;for(let m=0;m<a;m++){const y=this.points[m];t[0]*y[0]+t[1]*y[1]+t[2]*y[2]+t[3]>=0&&d++}return d===a?2:d===0?0:1}}function ll(_,t,a){const d=_-t;return d<0?-d:Math.max(0,d-a)}function oh(_,t,a,d,m){const y=_-a;let b;return b=y<0?Math.min(-y,1+y-m):y>1?Math.min(Math.max(y-m,0),1-y):0,Math.max(b,ll(t,d,m))}class Mm{constructor(){this._boundingVolumeCache=new Sm(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,d,m){const y=1<<d.z,b=1/y,T=d.x/y,A=d.y/y;let D=2;return D=Math.min(D,oh(t,a,T,A,b)),D=Math.min(D,oh(t,a,T+.5,-A-b,b)),D=Math.min(D,oh(t,a,T+.5,2-A-b,b)),D}getWrap(t,a,d){const m=1<<a.z,y=1/m,b=a.x/m,T=ll(t.x,b,y),A=ll(t.x,b-1,y),D=ll(t.x,b+1,y),z=Math.min(T,A,D);return z===D?1:z===A?-1:0}allowVariableZoom(t,a){return xe(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,d,m){return this._boundingVolumeCache.getTileBoundingVolume(t,a,d,m)}_computeTileBoundingVolume(t,a,d,m){var y,b;let T=d,A=d;if(m!=null&&m.terrain){const D=new s.Z(t.z,a,t.z,t.x,t.y),z=m.terrain.getMinMaxElevation(D);T=(y=z.minElevation)!==null&&y!==void 0?y:d,A=(b=z.maxElevation)!==null&&b!==void 0?b:d}if(T/=s.bt,A/=s.bt,T+=1,A+=1,t.z<=0)return oa.fromAabb([-A,-A,-A],[A,A,A]);if(t.z===1)return oa.fromAabb([t.x===0?-A:0,t.y===0?0:-A,-A],[t.x===0?0:A,t.y===0?A:0,A]);{const D=[os(0,0,t.x,t.y,t.z),os(s.$,0,t.x,t.y,t.z),os(s.$,s.$,t.x,t.y,t.z),os(0,s.$,t.x,t.y,t.z)],z=[];for(const je of D)z.push(s.aQ([],je,A));if(A!==T)for(const je of D)z.push(s.aQ([],je,T));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const U=[1,1,1],N=[-1,-1,-1];for(const je of z)for(let Xe=0;Xe<3;Xe++)U[Xe]=Math.min(U[Xe],je[Xe]),N[Xe]=Math.max(N[Xe],je[Xe]);const H=os(s.$/2,s.$/2,t.x,t.y,t.z),Y=s.aV([],[0,1,0],H);s.aU(Y,Y);const oe=s.aV([],H,Y);s.aU(oe,oe);const ae=s.aV([],D[2],D[1]);s.aU(ae,ae);const le=s.aV([],D[0],D[3]);s.aU(le,le),z.push(s.aQ([],H,A)),t.y>=(1<<t.z)/2&&z.push(s.aQ([],os(s.$/2,0,t.x,t.y,t.z),A)),t.y<(1<<t.z)/2&&z.push(s.aQ([],os(s.$/2,s.$,t.x,t.y,t.z),A));const pe=wr(H,z),Ae=wr(oe,z),we=[-H[0],-H[1],-H[2],pe.max],Re=[H[0],H[1],H[2],-pe.min],Le=[-oe[0],-oe[1],-oe[2],Ae.max],Se=[oe[0],oe[1],oe[2],-Ae.min],Ne=[...ae,0],qe=[...le,0],He=[];return t.y===0?He.push(s.bs(qe,Ne,we),s.bs(qe,Ne,Re)):He.push(s.bs(Le,Ne,we),s.bs(Le,Ne,Re),s.bs(Le,qe,we),s.bs(Le,qe,Re)),t.y===(1<<t.z)-1?He.push(s.bs(qe,Ne,we),s.bs(qe,Ne,Re)):He.push(s.bs(Se,Ne,we),s.bs(Se,Ne,Re),s.bs(Se,qe,we),s.bs(Se,qe,Re)),new oa(He,[we,Re,Le,Se,Ne,qe],U,N)}}}function wr(_,t){let a=1/0,d=-1/0;for(const m of t){const y=s.aW(_,m);a=Math.min(a,y),d=Math.max(d,y)}return{min:a,max:d}}class _o{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,d){return this._helper.interpolatePadding(t,a,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=s.bu(),this._projectionMatrix=s.b8(),this._globeViewProjMatrix32f=s.b7(),this._globeViewProjMatrixNoCorrection=s.b8(),this._globeViewProjMatrixNoCorrectionInverted=s.b8(),this._globeProjMatrixInverted=s.b8(),this._cameraPosition=s.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new il({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,a)=>this.getConstrained(t,a)}),this._coveringTilesDetailsProvider=new Mm}clone(){const t=new _o;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=s.bo();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:d}=t,m=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,d=this.cameraToCenterDistance/t,m=Math.sin(a)*d,y=Math.cos(a)*d+1,b=1/Math.sqrt(m*m+y*y)*1;let T=-m,A=y;const D=Math.sqrt(T*T+A*A);T/=D,A/=D;const z=[0,T,A];s.bv(z,z,[0,0,0],-this.bearingInRadians),s.bw(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),s.bx(z,z,[0,0,0],this.center.lng*Math.PI/180);const U=1/s.aY(z);return s.aQ(z,z,U),[...z,-b*U]}isLocationOccluded(t){return!this.isSurfacePointVisible(Wi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,m=Math.cos(d),y=[Math.sin(a)*m,Math.sin(d),Math.cos(a)*m],b=[y[2],0,-y[0]],T=[0,0,0];s.aV(T,b,y),s.aU(b,b),s.aU(T,T);const A=[0,0,0];return s.aU(A,[b[0]*t[0]+T[0]*t[1]+y[0]*t[2],b[1]*t[0]+T[1]*t[1]+y[1]*t[2],b[2]*t[0]+T[2]*t[1]+y[2]*t[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,d){const m=function(T,A,D){const z=1/(1<<D.z);return new s.a0(T/s.$*z+D.x*z,A/s.$*z+D.y*z)}(t,a,d.canonical),y=(b=m.y,[s.bn(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(t,a,d,m){const y=d.canonical,b=os(t,a,y.x,y.y,y.z),T=1+(m?m(t,a):0)/s.bt,A=[b[0]*T,b[1]*T,b[2]*T,1];s.av(A,A,this._globeViewProjMatrixNoCorrection);const D=this._cachedClippingPlane,z=D[0]*b[0]+D[1]*b[1]+D[2]*b[2]+D[3]<0;return{point:new s.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=po(this.worldSize,this.center.lat),a=s.b9(),d=s.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),s.b3(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;a[8]=2*-m.x/this._helper._width,a[9]=2*m.y/this._helper._height,this._projectionMatrix=s.b4(a),this._globeProjMatrixInverted=s.b9(),s.ap(this._globeProjMatrixInverted,a),s.M(a,a,[0,0,-this.cameraToCenterDistance]),s.b5(a,a,this.rollInRadians),s.b6(a,a,-this.pitchInRadians),s.b5(a,a,this.bearingInRadians),s.M(a,a,[0,0,-t]);const y=s.bo();y[0]=t,y[1]=t,y[2]=t,s.b6(d,a,this.center.lat*Math.PI/180),s.by(d,d,-this.center.lng*Math.PI/180),s.N(d,d,y),this._globeViewProjMatrixNoCorrection=d,s.b6(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.by(a,a,-this.center.lng*Math.PI/180),s.N(a,a,y),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=s.b9(),s.ap(this._globeViewProjMatrixNoCorrectionInverted,d);const b=s.bo();this._cameraPosition=s.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/t,s.bv(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),s.bw(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),s.bv(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),s.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bw(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),s.bx(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const T=s.b4(this._globeViewProjMatrixNoCorrectionInverted);s.N(T,T,[1,1,-1]),this._cachedFrustum=pr.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){s.w("calculateFogMatrix is not supported on globe projection.");const a=s.b9();return s.af(a),a}getVisibleUnwrappedCoordinates(t){return[new s.b1(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=Wi(t);s.aQ(d,d,1+a/s.bt);const m=s.bu();return s.av(m,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,d=[new s.P(0,0),new s.P(t,0),new s.P(this.width,0),new s.P(this.width,a),new s.P(this.width,this.height),new s.P(t,this.height),new s.P(0,this.height),new s.P(0,a)],m=[];for(const U of d)m.push(this.unprojectScreenPoint(U));let y=0,b=0,T=0,A=0;const D=this.center;for(const U of m){const N=s.bz(D.lng,U.lng),H=s.bz(D.lat,U.lat);N<b&&(b=N),N>y&&(y=N),H<A&&(A=H),H>T&&(T=H)}const z=[D.lng+b,D.lat+A,D.lng+y,D.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new pn(z)}getConstrained(t,a){const d=s.ag(t.lat,-85.051129,s.ah),m=s.ag(+a,this.minZoom+Fi(0,d),this.maxZoom);return{center:new s.S(t.lng,d),zoom:m}}calculateCenterFromCameraLngLatAlt(t,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,d,m)}setLocationAtPoint(t,a){const d=Wi(this.unprojectScreenPoint(a)),m=Wi(t),y=s.bo();s.bA(y);const b=s.bo();s.bx(b,d,y,-this.center.lng*Math.PI/180),s.bw(b,b,y,this.center.lat*Math.PI/180);const T=m[0]*m[0]+m[2]*m[2],A=b[0]*b[0];if(T<A)return;const D=Math.sqrt(T-A),z=-D,U=s.bB(m[0],m[2],b[0],D),N=s.bB(m[0],m[2],b[0],z),H=s.bo();s.bx(H,m,y,-U);const Y=s.bB(H[1],H[2],b[1],b[2]),oe=s.bo();s.bx(oe,m,y,-N);const ae=s.bB(oe[1],oe[2],b[1],b[2]),le=.5*Math.PI,pe=Y>=-le&&Y<=le,Ae=ae>=-le&&ae<=le;let we,Re;if(pe&&Ae){const qe=this.center.lng*Math.PI/180,He=this.center.lat*Math.PI/180;s.bC(U,qe)+s.bC(Y,He)<s.bC(N,qe)+s.bC(ae,He)?(we=U,Re=Y):(we=N,Re=ae)}else if(pe)we=U,Re=Y;else{if(!Ae)return;we=N,Re=ae}const Le=we/Math.PI*180,Se=Re/Math.PI*180,Ne=this.center.lat;this.setCenter(new s.S(Le,s.ag(Se,-90,90))),this.setZoom(this.zoom+Fi(Ne,this.center.lat))}locationToScreenPoint(t,a){const d=Wi(t);if(a){const m=a.getElevationForLngLatZoom(t,this._helper._tileZoom);s.aQ(d,d,1+m/s.bt)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(t){const a=s.bu();return s.av(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new s.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const d=a.pointCoordinate(t);if(d)return d}return s.a0.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var d;return(d=this.screenPointToMercatorCoordinate(t,a))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(t,a){const d=this._cameraPosition,m=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(d,m)}getRayDirectionFromPixel(t){const a=s.bu();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,s.av(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const d=s.bo();d[0]=a[0]-this._cameraPosition[0],d[1]=a[1]-this._cameraPosition[1],d[2]=a[2]-this._cameraPosition[2];const m=s.bo();return s.aU(m,d),m}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=s.bu();return s.av(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const d=s.aW(t,a),m=s.bo(),y=s.bo();s.aQ(y,a,d),s.aT(m,t,y);const b=1-s.aW(m,m);if(b<0)return null;const T=s.aW(t,t)-1,A=-d+(d<0?1:-1)*Math.sqrt(b),D=T/A,z=A;return{tMin:Math.min(D,z),tMax:Math.max(D,z)}}unprojectScreenPoint(t){const a=this._cameraPosition,d=this.getRayDirectionFromPixel(t),m=this.rayPlanetIntersection(a,d);if(m){const z=s.bo();s.aR(z,a,[d[0]*m.tMin,d[1]*m.tMin,d[2]*m.tMin]);const U=s.bo();return s.aU(U,z),al(U)}const y=this._cachedClippingPlane,b=y[0]*d[0]+y[1]*d[1]+y[2]*d[2],T=-s.b0(y,a)/b,A=s.bo();if(T>0)s.aR(A,a,[d[0]*T,d[1]*T,d[2]*T]);else{const z=s.bo();s.aR(z,a,[2*d[0],2*d[1],2*d[2]]);const U=s.b0(this._cachedClippingPlane,z);s.aT(A,z,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const D=function(z){const U=s.bo();return U[0]=z[0]*-z[3],U[1]=z[1]*-z[3],U[2]=z[2]*-z[3],{center:U,radius:Math.sqrt(1-z[3]*z[3])}}(y);return al(function(z,U,N){const H=s.bo();s.aT(H,N,z);const Y=s.bo();return s.bp(Y,z,H,U/s.a_(H)),Y}(D.center,D.radius,A))}getMatrixForModel(t,a){const d=s.S.convert(t),m=1/s.bt,y=s.b8();return s.by(y,y,d.lng/180*Math.PI),s.b6(y,y,-d.lat/180*Math.PI),s.M(y,y,[0,0,1+a/s.bt]),s.b6(y,y,.5*Math.PI),s.N(y,y,[m,m,m]),y}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new s.Z(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Nr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,d){return this._helper.interpolatePadding(t,a,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,d=!0){this._helper.resize(t,a,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new il({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,a)=>this.getConstrained(t,a)}),this._globeness=1,this._mercatorTransform=new zi,this._verticalPerspectiveTransform=new _o}clone(){const t=new Nr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),d=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:a.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return s.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,d){const m=this._mercatorTransform.getPitchedTextCorrection(t,a,d),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,d);return s.bj(m,y,this._globeness)}projectTileCoordinates(t,a,d,m){return this.currentTransform.projectTileCoordinates(t,a,d,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,a){return this.currentTransform.getConstrained(t,a)}calculateCenterFromCameraLngLatAlt(t,a,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,d,m)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return d.fallbackMatrix=a.mainMatrix,d}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Lr{get useGlobeControls(){return!0}handlePanInertia(t,a){const d=ol(t,a);return Math.abs(d.lng-a.center.lng)>180&&(d.lng=a.center.lng+179.5*Math.sign(d.lng-a.center.lng)),{easingCenter:d,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const d=t.around,m=a.screenPointToLocation(d);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const y=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const b=a.zoom-y;if(b===0)return;const T=s.bz(a.center.lng,m.lng),A=T/(Math.abs(T/180)+1),D=s.bz(a.center.lat,m.lat),z=a.getRayDirectionFromPixel(d),U=a.cameraPosition,N=-1*s.aW(U,z),H=s.bo();s.aR(H,U,[z[0]*N,z[1]*N,z[2]*N]);const Y=s.aY(H)-1,oe=Math.exp(.5*-Math.max(Y-.3,0)),ae=po(a.worldSize,a.center.lat)/Math.min(a.width,a.height),le=s.bm(ae,.9,.5,1,.25),pe=(1-s.ae(-b))*Math.min(oe,le),Ae=a.center.lat,we=a.zoom,Re=new s.S(a.center.lng+A*pe,s.ag(a.center.lat+D*pe,-85.051129,s.ah));a.setLocationAtPoint(m,d);const Le=a.center,Se=s.bm(Math.abs(T),45,85,0,1),Ne=s.bm(ae,.75,.35,0,1),qe=Math.pow(Math.max(Se,Ne),.25),He=s.bz(Le.lng,Re.lng),je=s.bz(Le.lat,Re.lat);a.setCenter(new s.S(Le.lng+He*qe,Le.lat+je*qe).wrap()),a.setZoom(we+Fi(Ae,a.center.lat))}handleMapControlsPan(t,a,d){if(!t.panDelta)return;const m=a.center.lat,y=a.zoom;a.setCenter(ol(t.panDelta,a).wrap()),a.setZoom(y+Fi(m,a.center.lat))}cameraForBoxAndBearing(t,a,d,m,y){const b=xi(t,a,d,m,y),T=a.left/y.width*2-1,A=(y.width-a.right)/y.width*2-1,D=a.top/y.height*-2+1,z=(y.height-a.bottom)/y.height*-2+1,U=s.bz(d.getWest(),d.getEast())<0,N=U?d.getEast():d.getWest(),H=U?d.getWest():d.getEast(),Y=Math.max(d.getNorth(),d.getSouth()),oe=Math.min(d.getNorth(),d.getSouth()),ae=N+.5*s.bz(N,H),le=Y+.5*s.bz(Y,oe),pe=y.clone();pe.setCenter(b.center),pe.setBearing(b.bearing),pe.setPitch(0),pe.setRoll(0),pe.setZoom(b.zoom);const Ae=pe.modelViewProjectionMatrix,we=[Wi(d.getNorthWest()),Wi(d.getNorthEast()),Wi(d.getSouthWest()),Wi(d.getSouthEast()),Wi(new s.S(H,le)),Wi(new s.S(N,le)),Wi(new s.S(ae,Y)),Wi(new s.S(ae,oe))],Re=Wi(b.center);let Le=Number.POSITIVE_INFINITY;for(const Se of we)T<0&&(Le=Lr.getLesserNonNegativeNonNull(Le,Lr.solveVectorScale(Se,Re,Ae,"x",T))),A>0&&(Le=Lr.getLesserNonNegativeNonNull(Le,Lr.solveVectorScale(Se,Re,Ae,"x",A))),D>0&&(Le=Lr.getLesserNonNegativeNonNull(Le,Lr.solveVectorScale(Se,Re,Ae,"y",D))),z<0&&(Le=Lr.getLesserNonNegativeNonNull(Le,Lr.solveVectorScale(Se,Re,Ae,"y",z)));if(Number.isFinite(Le)&&Le!==0)return b.zoom=pe.zoom+s.aj(Le),b;fr()}handleJumpToCenterZoom(t,a){const d=t.center.lat,m=t.getConstrained(a.center?s.S.convert(a.center):t.center,t.zoom).center;t.setCenter(m.wrap());const y=a.zoom!==void 0?+a.zoom:t.zoom+Fi(d,m.lat);t.zoom!==y&&t.setZoom(y)}handleEaseTo(t,a){const d=t.zoom,m=t.center,y=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},T={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},A=a.zoom!==void 0,D=!t.isPaddingEqual(a.padding);let z=!1;const U=a.center?s.S.convert(a.center):m,N=t.getConstrained(U,d).center;Os(t,N);const H=t.clone();H.setCenter(N),H.setZoom(A?+a.zoom:d+Fi(m.lat,U.lat)),H.setBearing(a.bearing);const Y=new s.P(s.ag(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),s.ag(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));H.setLocationAtPoint(N,Y);const oe=(a.offset&&a.offsetAsPoint.mag())>0?H.center:N,ae=A?+a.zoom:d+Fi(m.lat,oe.lat),le=d+Fi(m.lat,0),pe=ae+Fi(oe.lat,0),Ae=s.bz(m.lng,oe.lng),we=s.bz(m.lat,oe.lat),Re=s.ae(pe-le);return z=ae!==d,{easeFunc:Le=>{if(s.bd(b,T)||$i({startEulerAngles:b,endEulerAngles:T,tr:t,k:Le,useSlerp:b.roll!=T.roll}),D&&t.interpolatePadding(y,a.padding,Le),a.around)s.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const Se=pe>le?Math.min(2,Re):Math.max(.5,Re),Ne=Math.pow(Se,1-Le),qe=go(m,Ae,we,Le*Ne);t.setCenter(qe.wrap())}if(z){const Se=s.C.number(le,pe,Le)+Fi(0,t.center.lat);t.setZoom(Se)}},isZooming:z,elevationCenter:oe}}handleFlyTo(t,a){const d=a.zoom!==void 0,m=t.center,y=t.zoom,b=t.padding,T=!t.isPaddingEqual(a.padding),A=t.getConstrained(s.S.convert(a.center||a.locationAtOffset),y).center,D=d?+a.zoom:t.zoom+Fi(t.center.lat,A.lat),z=t.clone();z.setCenter(A),z.setZoom(D),z.setBearing(a.bearing);const U=new s.P(s.ag(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),s.ag(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(A,U);const N=z.center;Os(t,N);const H=function(we,Re,Le){const Se=Wi(Re),Ne=Wi(Le),qe=s.aW(Se,Ne),He=Math.acos(qe),je=sl(we);return He/(2*Math.PI)*je}(t,m,N),Y=y+Fi(m.lat,0),oe=D+Fi(N.lat,0),ae=s.ae(oe-Y);let le;if(typeof a.minZoom=="number"){const we=+a.minZoom+Fi(N.lat,0),Re=Math.min(we,Y,oe)+Fi(0,N.lat),Le=t.getConstrained(N,Re).zoom+Fi(N.lat,0);le=s.ae(Le-Y)}const pe=s.bz(m.lng,N.lng),Ae=s.bz(m.lat,N.lat);return{easeFunc:(we,Re,Le,Se)=>{const Ne=go(m,pe,Ae,Le);T&&t.interpolatePadding(b,a.padding,we);const qe=we===1?N:Ne;t.setCenter(qe.wrap());const He=Y+s.aj(Re);t.setZoom(we===1?D:He+Fi(0,qe.lat))},scaleOfZoom:ae,targetCenter:N,scaleOfMinZoom:le,pixelPathLength:H}}static solveVectorScale(t,a,d,m,y){const b=m==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],T=[d[3],d[7],d[11],d[15]],A=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],D=t[0]*T[0]+t[1]*T[1]+t[2]*T[2],z=a[0]*b[0]+a[1]*b[1]+a[2]*b[2],U=a[0]*T[0]+a[1]*T[1]+a[2]*T[2];return z+y*D===A+y*U||T[3]*(A-z)+b[3]*(U-D)+A*U==z*D?null:(z+b[3]-y*U-y*T[3])/(z-A-y*U+y*D)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class lh{constructor(t){this._globe=t,this._mercatorCameraHelper=new gc,this._verticalPerspectiveCameraHelper=new Lr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,d){this.currentHelper.handleMapControlsPan(t,a,d)}cameraForBoxAndBearing(t,a,d,m,y){return this.currentHelper.cameraForBoxAndBearing(t,a,d,m,y)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const cl=(_,t)=>s.y(_,t&&t.filter(a=>a.identifier!=="source.canvas")),yo=s.bD();class ch extends s.E{constructor(t,a={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const m=this.sourceCaches[d].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[d].reload()}},this.map=t,this.dispatcher=new qt(Tt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,m)=>this.getGlyphs(d,m)),this.dispatcher.registerMessageHandler("GI",(d,m)=>this.getImages(d,m)),this.imageManager=new ce,this.imageManager.setEventedParent(this),this.glyphManager=new Je(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new It(256,512),this.crossTileSymbolIndex=new Ui,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",s.bF()),Vt().on(ct,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const m=this.sourceCaches[d.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const b in this._layers){const T=this._layers[b];T.source===y.id&&this._validateLayer(T)}})}setGlobalStateProperty(t,a){var d,m,y;this._checkLoaded();const b=a===null?(y=(m=(d=this.stylesheet.state)===null||d===void 0?void 0:d[t])===null||m===void 0?void 0:m.default)!==null&&y!==void 0?y:null:a;if(s.bG(b,this._globalState[t]))return this;this._globalState[t]=b;const T=this._findGlobalStateAffectedSources([t]);for(const A in this.sourceCaches)T.has(A)&&(this._reloadSource(A),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const m in t)!s.bG(this._globalState[m],t[m].default)&&(a.push(m),this._globalState[m]=t[m].default);const d=this._findGlobalStateAffectedSources(a);for(const m in this.sourceCaches)d.has(m)&&(this._reloadSource(m),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;const a=new Set;for(const d in this._layers){const m=this._layers[d],y=m.getLayoutAffectingGlobalStateRefs();for(const b of t)y.has(b)&&a.add(m.source)}return a}loadURL(t,a={},d){this.fire(new s.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const m=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;s.j(m,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,a,d)}).catch(b=>{this._loadStyleRequest=null,b&&!y.signal.aborted&&this.fire(new s.k(b))})}loadJSON(t,a={},d){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,d)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(yo,{validate:!1})}_load(t,a,d){var m,y,b;const T=a.transformStyle?a.transformStyle(d,t):t;if(!a.validate||!cl(this,s.z(T))){this._loaded=!0,this.stylesheet=T;for(const A in T.sources)this.addSource(A,T.sources[A],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new ot(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new tt(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.setGlobalState((b=this.stylesheet.state)!==null&&b!==void 0?b:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){const t=s.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const d=s.bI(a);d.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=d}}_loadSprite(t,a=!1,d=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,b,T,A){return s._(this,void 0,void 0,function*(){const D=fe(y),z=T>1?"@2x":"",U={},N={};for(const{id:H,url:Y}of D){const oe=b.transformRequest(ye(Y,z,".json"),"SpriteJSON");U[H]=s.j(oe,A);const ae=b.transformRequest(ye(Y,z,".png"),"SpriteImage");N[H]=Q.getImage(ae,A)}return yield Promise.all([...Object.values(U),...Object.values(N)]),function(H,Y){return s._(this,void 0,void 0,function*(){const oe={};for(const ae in H){oe[ae]={};const le=L.getImageCanvasContext((yield Y[ae]).data),pe=(yield H[ae]).data;for(const Ae in pe){const{width:we,height:Re,x:Le,y:Se,sdf:Ne,pixelRatio:qe,stretchX:He,stretchY:je,content:Xe,textFitWidth:St,textFitHeight:xt}=pe[Ae];oe[ae][Ae]={data:null,pixelRatio:qe,sdf:Ne,stretchX:He,stretchY:je,content:Xe,textFitWidth:St,textFitHeight:xt,spriteData:{width:we,height:Re,x:Le,y:Se,context:le}}}}return oe})}(U,N)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const b in y){this._spritesImagesIds[b]=[];const T=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(A=>!(A in y)):[];for(const A of T)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in y[b]){const D=b==="default"?A:`${b}:${A}`;this._spritesImagesIds[b].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,y[b][A],!1):this.imageManager.addImage(D,y[b][A]),a&&(this._changedImages[D]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new s.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const d=t.sourceLayer;if(!d)return;const m=a.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.k(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const d=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?s.bJ(d):d);const m=[];for(const y of t)if(d[y]){const b=a?s.bJ(d[y]):d[y];m.push(b)}return m}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const d of a){const m=this._layers[d];m.type!=="custom"&&(t[d]=m.serialize())}return t}hasTransitions(){var t,a,d;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const b in this._updatedSources){const T=this._updatedSources[b];if(T==="reload")this._reloadSource(b);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];d[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in d){const y=this.sourceCaches[m];!!d[m]!=!!y.used&&y.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var d;this._checkLoaded();const m=this.serialize();if(t=a.transformStyle?a.transformStyle(m,t):t,((d=a.validate)===null||d===void 0||d)&&cl(this,s.z(t)))return!1;(t=s.bJ(t)).layers=s.bH(t.layers);const y=s.bK(m,t),b=this._getOperationsToPerform(y);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const T of b.operations)T();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],d=[];for(const m of t)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":a.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":a.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":a.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":a.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":a.push(()=>{});break;default:d.push(m.command)}return{operations:a,unimplemented:d}}addImage(t,a){if(this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,d={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.z.source,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=this.sourceCaches[t]=new Ue(t,a,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new s.k(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const d=this.sourceCaches[t].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,d={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new s.k(new Error(`Layer "${m}" already exists on this map.`)));let y;if(t.type==="custom"){if(cl(this,s.bL(t)))return;y=s.bI(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(m,t.source),t=s.bJ(t),t=s.e(t,{source:m})),this._validate(s.z.layer,`layers.${m}`,t,{arrayIndex:-1},d))return;y=s.bI(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)this.fire(new s.k(new Error(`Cannot add layer "${m}" before non-existing layer "${a}".`)));else{if(this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const T=this._removedLayers[m];delete this._removedLayers[m],T.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const d=this._order.indexOf(t);this._order.splice(d,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new s.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,d){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===a&&m.maxzoom===d||(a!=null&&(m.minzoom=a),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,d={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!s.bG(m.filter,a))return a==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(s.z.filter,`layers.${m.id}.filter`,a,null,d)||(m.setFilter(s.bJ(a)),this._updateLayer(m)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.bJ(this.getLayer(t).filter)}setLayoutProperty(t,a,d,m={}){this._checkLoaded();const y=this.getLayer(t);y?s.bG(y.getLayoutProperty(a),d)||(y.setLayoutProperty(a,d,m),this._updateLayer(y)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const d=this.getLayer(t);if(d)return d.getLayoutProperty(a);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,d,m={}){this._checkLoaded();const y=this.getLayer(t);y?s.bG(y.getPaintProperty(a),d)||(y.setPaintProperty(a,d,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const d=t.source,m=t.sourceLayer,y=this.sourceCaches[d];if(y===void 0)return void this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)));const b=y.getSource().type;b==="geojson"&&m?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||m?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,t.id,a)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const d=t.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)));const y=m.getSource().type,b=y==="vector"?t.sourceLayer:void 0;y!=="vector"||b?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(b,t.id,a):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,d=t.sourceLayer,m=this.sourceCaches[a];if(m!==void 0)return m.getSource().type!=="vector"||d?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,t.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.bM(this.sourceCaches,y=>y.serialize()),a=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,m=this.stylesheet;return s.bN({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:t,layers:a,terrain:d},y=>y!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=b=>this._layers[b].type==="fill-extrusion",d={},m=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(a(T)){d[T]=b;for(const A of t){const D=A[T];if(D)for(const z of D)m.push(z)}}}m.sort((b,T)=>T.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(a(T))for(let A=m.length-1;A>=0;A--){const D=m[A].feature;if(d[D.layer.id]<b)break;y.push(D),m.pop()}else for(const A of t){const D=A[T];if(D)for(const z of D)y.push(z.feature)}}return y}queryRenderedFeatures(t,a,d){a&&a.filter&&this._validate(s.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const D of a.layers){const z=this._layers[D];if(!z)return this.fire(new s.k(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];m[z.source]=!0}}const y=[];a.availableImages=this._availableImages;const b=this._serializedAllLayers(),T=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,A=Object.assign(Object.assign({},a),{layers:T});for(const D in this.sourceCaches)a.layers&&!m[D]||y.push(Xt(this.sourceCaches[D],this._layers,b,t,A,d,this.map.terrain?(z,U,N)=>this.map.terrain.getElevation(z,U,N):void 0));return this.placement&&y.push(function(D,z,U,N,H,Y,oe){const ae={},le=Y.queryRenderedSymbols(N),pe=[];for(const Ae of Object.keys(le).map(Number))pe.push(oe[Ae]);pe.sort(yn);for(const Ae of pe){const we=Ae.featureIndex.lookupSymbolFeatures(le[Ae.bucketInstanceId],z,Ae.bucketIndex,Ae.sourceLayerIndex,H.filter,H.layers,H.availableImages,D);for(const Re in we){const Le=ae[Re]=ae[Re]||[],Se=we[Re];Se.sort((Ne,qe)=>{const He=Ae.featureSortOrder;if(He){const je=He.indexOf(Ne.featureIndex);return He.indexOf(qe.featureIndex)-je}return qe.featureIndex-Ne.featureIndex});for(const Ne of Se)Le.push(Ne)}}return function(Ae,we,Re){for(const Le in Ae)for(const Se of Ae[Le])Vn(Se,Re[we[Le].source]);return Ae}(ae,D,U)}(this._layers,b,this.sourceCaches,t,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,a){a&&a.filter&&this._validate(s.z.filter,"querySourceFeatures.filter",a.filter,null,a);const d=this.sourceCaches[t];return d?function(m,y){const b=m.getRenderableIds().map(D=>m.getTileByID(D)),T=[],A={};for(let D=0;D<b.length;D++){const z=b[D],U=z.tileID.canonical.key;A[U]||(A[U]=!0,z.querySourceFeatures(T,y))}return T}(d,a):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const b in t)if(!s.bG(t[b],d[b])){m=!0;break}if(!m)return;const y={now:L.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(y)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const d=this.getSky();let m=!1;if(!t&&!d)return;if(t&&!d)m=!0;else if(!t&&d)m=!0;else for(const b in t)if(!s.bG(t[b],d[b])){m=!0;break}if(!m)return;const y={now:L.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(y)}_setProjectionInternal(t){const a=function(d){if(Array.isArray(d)){const m=new rl({type:d});return{projection:m,transform:new Nr,cameraHelper:new lh(m)}}switch(d){case"mercator":return{projection:new rh,transform:new zi,cameraHelper:new gc};case"globe":{const m=new rl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new Nr,cameraHelper:new lh(m)}}case"vertical-perspective":return{projection:new Jd,transform:new _o,cameraHelper:new Lr};default:return s.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new rh,transform:new zi,cameraHelper:new gc}}}(t);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const d in this.sourceCaches)this.sourceCaches[d].reload()}_validate(t,a,d,m,y={}){return(!y||y.validate!==!1)&&cl(this,t.call(s.z,s.e({key:a,style:this.serialize(),value:d,styleSpec:s.v},m)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Vt().off(ct,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const d=this.sourceCaches[a];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,d,m,y=!1){let b=!1,T=!1;const A={};for(const D of this._order){const z=this._layers[D];if(z.type!=="symbol")continue;if(!A[z.source]){const N=this.sourceCaches[z.source];A[z.source]=N.getRenderableIds(!0).map(H=>N.getTileByID(H)).sort((H,Y)=>Y.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Y.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(z,A[z.source],t.center.lng);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),t.zoom))&&(this.pauseablePlacement=new sa(t,this.map.terrain,this._order,y,a,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),T=!0),b&&this.pauseablePlacement.placement.setStale()),T||b)for(const D of this._order){const z=this._layers[D];z.type==="symbol"&&this.placement.updateLayerOpacities(z,A[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a){return s._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,a.icons),d})}getGlyphs(t,a){return s._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(a.stacks),m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(s.z.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,d={},m){this._checkLoaded();const y=[{id:t,url:a}],b=[...fe(this.stylesheet.sprite),...y];this._validate(s.z.sprite,"sprite",b,null,d)||(this.stylesheet.sprite=b,this._loadSprite(y,!0,m))}removeSprite(t){this._checkLoaded();const a=fe(this.stylesheet.sprite);if(a.find(d=>d.id===t)){if(this._spritesImagesIds[t])for(const d of this._spritesImagesIds[t])this.imageManager.removeImage(d),this._changedImages[d]=!0;a.splice(a.findIndex(d=>d.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return fe(this.stylesheet.sprite)}setSprite(t,a={},d){this._checkLoaded(),t&&this._validate(s.z.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,d):(this._unloadSprite(),d&&d(null)))}}var Tm=s.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Em{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,d,m,y,b,T,A,D){this.context=t;let z=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!z&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||z||this.boundIndexBuffer!==y||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==D?this.freshBind(a,d,m,y,b,T,A,D):(t.bindVertexArray.set(this.vao),T&&T.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),D&&D.bind())}freshBind(t,a,d,m,y,b,T,A){const D=t.numAttributes,z=this.context,U=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=A,a.enableAttributes(U,t);for(const N of d)N.enableAttributes(U,t);b&&b.enableAttributes(U,t),T&&T.enableAttributes(U,t),A&&A.enableAttributes(U,t),a.bind(),a.setVertexAttribPointers(U,t,y);for(const N of d)N.bind(),N.setVertexAttribPointers(U,t,y);b&&(b.bind(),b.setVertexAttribPointers(U,t,y)),m&&m.bind(),T&&(T.bind(),T.setVertexAttribPointers(U,t,y)),A&&(A.bind(),A.setVertexAttribPointers(U,t,y)),z.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Am=(_,t,a,d,m)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):s.be.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:a?a.calculateFogBlendOpacity(d):0,u_horizon_color:a?a.properties.get("horizon-color"):s.be.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),Cm={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function _c(_){const t=[];for(let a=0;a<_.length;a++){if(_[a]===null)continue;const d=_[a].split(" ");t.push(d.pop())}return t}class yc{constructor(t,a,d,m,y,b,T,A,D=[]){const z=t.gl;this.program=z.createProgram();const U=_c(a.staticAttributes),N=d?d.getBinderAttributes():[],H=U.concat(N),Y=ji.prelude.staticUniforms?_c(ji.prelude.staticUniforms):[],oe=T.staticUniforms?_c(T.staticUniforms):[],ae=a.staticUniforms?_c(a.staticUniforms):[],le=d?d.getBinderUniforms():[],pe=Y.concat(oe).concat(ae).concat(le),Ae=[];for(const He of pe)Ae.indexOf(He)<0&&Ae.push(He);const we=d?d.defines():[];br(z)&&we.unshift("#version 300 es"),y&&we.push("#define OVERDRAW_INSPECTOR;"),b&&we.push("#define TERRAIN3D;"),A&&we.push(A),D&&we.push(...D);let Re=we.concat(ji.prelude.fragmentSource,T.fragmentSource,a.fragmentSource).join(`
`),Le=we.concat(ji.prelude.vertexSource,T.vertexSource,a.vertexSource).join(`
`);br(z)||(Re=function(He){return He.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Re),Le=function(He){return He.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Le));const Se=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Se,Re),z.compileShader(Se),!z.getShaderParameter(Se,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(Se)}`);z.attachShader(this.program,Se);const Ne=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Ne,Le),z.compileShader(Ne),!z.getShaderParameter(Ne,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Ne)}`);z.attachShader(this.program,Ne),this.attributes={};const qe={};this.numAttributes=H.length;for(let He=0;He<this.numAttributes;He++)H[He]&&(z.bindAttribLocation(this.program,He,H[He]),this.attributes[H[He]]=He);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Ne),z.deleteShader(Se);for(let He=0;He<Ae.length;He++){const je=Ae[He];if(je&&!qe[je]){const Xe=z.getUniformLocation(this.program,je);Xe&&(qe[je]=Xe)}}this.fixedUniforms=m(t,qe),this.terrainUniforms=((He,je)=>({u_depth:new s.bO(He,je.u_depth),u_terrain:new s.bO(He,je.u_terrain),u_terrain_dim:new s.bf(He,je.u_terrain_dim),u_terrain_matrix:new s.bQ(He,je.u_terrain_matrix),u_terrain_unpack:new s.bR(He,je.u_terrain_unpack),u_terrain_exaggeration:new s.bf(He,je.u_terrain_exaggeration)}))(t,qe),this.projectionUniforms=((He,je)=>({u_projection_matrix:new s.bQ(He,je.u_projection_matrix),u_projection_tile_mercator_coords:new s.bR(He,je.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bR(He,je.u_projection_clipping_plane),u_projection_transition:new s.bf(He,je.u_projection_transition),u_projection_fallback_matrix:new s.bQ(He,je.u_projection_fallback_matrix)}))(t,qe),this.binderUniforms=d?d.getUniforms(t,qe):[]}draw(t,a,d,m,y,b,T,A,D,z,U,N,H,Y,oe,ae,le,pe,Ae){const we=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(m),t.setColorMode(y),t.setCullFace(b),A){t.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,A.depthTexture),t.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,A.texture);for(const Le in this.terrainUniforms)this.terrainUniforms[Le].set(A[Le])}if(D)for(const Le in D)this.projectionUniforms[Cm[Le]].set(D[Le]);if(T)for(const Le in this.fixedUniforms)this.fixedUniforms[Le].set(T[Le]);ae&&ae.setUniforms(t,this.binderUniforms,Y,{zoom:oe});let Re=0;switch(a){case we.LINES:Re=2;break;case we.TRIANGLES:Re=3;break;case we.LINE_STRIP:Re=1}for(const Le of H.get()){const Se=Le.vaos||(Le.vaos={});(Se[z]||(Se[z]=new Em)).bind(t,this,U,ae?ae.getPaintVertexBuffers():[],N,Le.vertexOffset,le,pe,Ae),we.drawElements(a,Le.primitiveLength*Re,we.UNSIGNED_SHORT,Le.primitiveOffset*Re*2)}}}function vc(_,t,a){const d=1/s.aB(a,1,t.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,t.transform.tileZoom)/m,b=y*(a.tileID.canonical.x+a.tileID.wrap*m),T=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const ul=(_,t,a,d)=>{const m=_.style.light,y=m.properties.get("position"),b=[y.x,y.y,y.z],T=s.bU();m.properties.get("anchor")==="viewport"&&s.bV(T,_.transform.bearingInRadians),s.bW(b,b,T);const A=_.transform.transformLightDirection(b),D=m.properties.get("color");return{u_lightpos:b,u_lightpos_globe:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:d}},uh=(_,t,a,d,m,y,b)=>s.e(ul(_,t,a,d),vc(y,_,b),{u_height_factor:-Math.pow(2,m.overscaledZ)/b.tileSize/8}),xc=(_,t,a,d)=>s.e(vc(t,_,a),{u_fill_translate:d}),Ts=(_,t)=>({u_world:_,u_fill_translate:t}),Pm=(_,t,a,d,m)=>s.e(xc(_,t,a,m),{u_world:d}),hh=(_,t,a,d,m)=>{const y=_.transform;let b,T,A=0;if(a.paint.get("circle-pitch-alignment")==="map"){const D=s.aB(t,1,y.zoom);b=!0,T=[D,D],A=D/(s.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*m}else b=!1,T=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:A,u_translate:d}},hl=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),dl=_=>({u_viewport_size:[_.width,_.height]}),ep=(_,t=1)=>({u_color:_,u_overlay:0,u_overlay_scale:t}),pl=(_,t,a,d)=>{const m=s.aB(_,1,t)/(s.$*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:s.aB(_,1,t),u_intensity:a,u_globe_extrude_scale:m}},tp=(_,t,a,d)=>{const m=s.L();s.bX(m,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:a,u_color_ramp:d,u_opacity:t.paint.get("heatmap-opacity")}},vo=(_,t,a)=>{const d=a.paint.get("hillshade-accent-color");let m;switch(a.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const y=a.getIlluminationProperties();for(let b=0;b<y.directionRadians.length;b++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[b]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:np(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:d,u_method:m,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Im=(_,t)=>{const a=t.stride,d=s.L();return s.bX(d,0,s.$,-8192,0,0,1),s.M(d,d,[0,-8192,0]),{u_matrix:d,u_image:1,u_dimension:[a,a],u_zoom:_.overscaledZ,u_unpack:t.getUnpackVector()}};function np(_,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new s.a0(0,d/a).toLngLat().lat,new s.a0(0,(d+1)/a).toLngLat().lat]}const Rm=(_,t)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:_.paint.get("color-relief-opacity")}),bc=(_,t,a,d)=>{const m=_.transform;return{u_translation:fh(_,t,a),u_ratio:d/s.aB(t,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},dh=(_,t,a,d,m)=>s.e(bc(_,t,a,d),{u_image:0,u_image_height:m}),ip=(_,t,a,d,m)=>{const y=_.transform,b=ph(t,y);return{u_translation:fh(_,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:d/s.aB(t,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[b,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},rp=(_,t,a,d,m,y)=>{const b=_.lineAtlas,T=ph(t,_.transform),A=a.layout.get("line-cap")==="round",D=b.getDash(m.from,A),z=b.getDash(m.to,A),U=D.width*y.fromScale,N=z.width*y.toScale;return s.e(bc(_,t,a,d),{u_patternscale_a:[T/U,-D.height/2],u_patternscale_b:[T/N,-z.height/2],u_sdfgamma:b.width/(256*Math.min(U,N)*_.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:z.y,u_mix:y.t})};function ph(_,t){return 1/s.aB(_,1,t.tileZoom)}function fh(_,t,a){return s.aC(_.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Fa=(_,t,a,d,m)=>{return{u_tl_parent:_,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(b=d.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:sp(d.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var y,b};function sp(_){_*=Math.PI/180;const t=Math.sin(_),a=Math.cos(_);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const mh=(_,t,a,d,m,y,b,T,A,D,z,U,N)=>{const H=b.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+z,u_pitch_with_map:+d,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:U,u_texture:0,u_translation:D,u_pitched_scale:N}},xo=(_,t,a,d,m,y,b,T,A,D,z,U,N,H)=>{const Y=b.transform;return s.e(mh(_,t,a,d,m,y,b,T,A,D,z,U,H),{u_gamma_scale:d?Math.cos(Y.pitch*Math.PI/180)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},Lm=(_,t,a,d,m,y,b,T,A,D,z,U,N)=>s.e(xo(_,t,a,d,m,y,b,T,A,D,!0,z,0,N),{u_texsize_icon:U,u_texture_icon:1}),wc=(_,t)=>({u_opacity:_,u_color:t}),Dm=(_,t,a,d,m)=>s.e(function(y,b,T,A){const D=T.imageManager.getPattern(y.from.toString()),z=T.imageManager.getPattern(y.to.toString()),{width:U,height:N}=T.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),Y=A.tileSize*Math.pow(2,T.transform.tileZoom)/H,oe=Y*(A.tileID.canonical.x+A.tileID.wrap*H),ae=Y*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[U,N],u_mix:b.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/s.aB(A,1,T.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ae>>16],u_pixel_coord_lower:[65535&oe,65535&ae]}}(a,m,t,d),{u_opacity:_}),ap=(_,t)=>{},op={fillExtrusion:(_,t)=>({u_lightpos:new s.bS(_,t.u_lightpos),u_lightpos_globe:new s.bS(_,t.u_lightpos_globe),u_lightintensity:new s.bf(_,t.u_lightintensity),u_lightcolor:new s.bS(_,t.u_lightcolor),u_vertical_gradient:new s.bf(_,t.u_vertical_gradient),u_opacity:new s.bf(_,t.u_opacity),u_fill_translate:new s.bT(_,t.u_fill_translate)}),fillExtrusionPattern:(_,t)=>({u_lightpos:new s.bS(_,t.u_lightpos),u_lightpos_globe:new s.bS(_,t.u_lightpos_globe),u_lightintensity:new s.bf(_,t.u_lightintensity),u_lightcolor:new s.bS(_,t.u_lightcolor),u_vertical_gradient:new s.bf(_,t.u_vertical_gradient),u_height_factor:new s.bf(_,t.u_height_factor),u_opacity:new s.bf(_,t.u_opacity),u_fill_translate:new s.bT(_,t.u_fill_translate),u_image:new s.bO(_,t.u_image),u_texsize:new s.bT(_,t.u_texsize),u_pixel_coord_upper:new s.bT(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.bT(_,t.u_pixel_coord_lower),u_scale:new s.bS(_,t.u_scale),u_fade:new s.bf(_,t.u_fade)}),fill:(_,t)=>({u_fill_translate:new s.bT(_,t.u_fill_translate)}),fillPattern:(_,t)=>({u_image:new s.bO(_,t.u_image),u_texsize:new s.bT(_,t.u_texsize),u_pixel_coord_upper:new s.bT(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.bT(_,t.u_pixel_coord_lower),u_scale:new s.bS(_,t.u_scale),u_fade:new s.bf(_,t.u_fade),u_fill_translate:new s.bT(_,t.u_fill_translate)}),fillOutline:(_,t)=>({u_world:new s.bT(_,t.u_world),u_fill_translate:new s.bT(_,t.u_fill_translate)}),fillOutlinePattern:(_,t)=>({u_world:new s.bT(_,t.u_world),u_image:new s.bO(_,t.u_image),u_texsize:new s.bT(_,t.u_texsize),u_pixel_coord_upper:new s.bT(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.bT(_,t.u_pixel_coord_lower),u_scale:new s.bS(_,t.u_scale),u_fade:new s.bf(_,t.u_fade),u_fill_translate:new s.bT(_,t.u_fill_translate)}),circle:(_,t)=>({u_camera_to_center_distance:new s.bf(_,t.u_camera_to_center_distance),u_scale_with_map:new s.bO(_,t.u_scale_with_map),u_pitch_with_map:new s.bO(_,t.u_pitch_with_map),u_extrude_scale:new s.bT(_,t.u_extrude_scale),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_globe_extrude_scale:new s.bf(_,t.u_globe_extrude_scale),u_translate:new s.bT(_,t.u_translate)}),collisionBox:(_,t)=>({u_pixel_extrude_scale:new s.bT(_,t.u_pixel_extrude_scale)}),collisionCircle:(_,t)=>({u_viewport_size:new s.bT(_,t.u_viewport_size)}),debug:(_,t)=>({u_color:new s.bP(_,t.u_color),u_overlay:new s.bO(_,t.u_overlay),u_overlay_scale:new s.bf(_,t.u_overlay_scale)}),depth:ap,clippingMask:ap,heatmap:(_,t)=>({u_extrude_scale:new s.bf(_,t.u_extrude_scale),u_intensity:new s.bf(_,t.u_intensity),u_globe_extrude_scale:new s.bf(_,t.u_globe_extrude_scale)}),heatmapTexture:(_,t)=>({u_matrix:new s.bQ(_,t.u_matrix),u_world:new s.bT(_,t.u_world),u_image:new s.bO(_,t.u_image),u_color_ramp:new s.bO(_,t.u_color_ramp),u_opacity:new s.bf(_,t.u_opacity)}),hillshade:(_,t)=>({u_image:new s.bO(_,t.u_image),u_latrange:new s.bT(_,t.u_latrange),u_exaggeration:new s.bf(_,t.u_exaggeration),u_altitudes:new s.bZ(_,t.u_altitudes),u_azimuths:new s.bZ(_,t.u_azimuths),u_accent:new s.bP(_,t.u_accent),u_method:new s.bO(_,t.u_method),u_shadows:new s.bY(_,t.u_shadows),u_highlights:new s.bY(_,t.u_highlights)}),hillshadePrepare:(_,t)=>({u_matrix:new s.bQ(_,t.u_matrix),u_image:new s.bO(_,t.u_image),u_dimension:new s.bT(_,t.u_dimension),u_zoom:new s.bf(_,t.u_zoom),u_unpack:new s.bR(_,t.u_unpack)}),colorRelief:(_,t)=>({u_image:new s.bO(_,t.u_image),u_unpack:new s.bR(_,t.u_unpack),u_dimension:new s.bT(_,t.u_dimension),u_elevation_stops:new s.bO(_,t.u_elevation_stops),u_color_stops:new s.bO(_,t.u_color_stops),u_opacity:new s.bf(_,t.u_opacity)}),line:(_,t)=>({u_translation:new s.bT(_,t.u_translation),u_ratio:new s.bf(_,t.u_ratio),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_units_to_pixels:new s.bT(_,t.u_units_to_pixels)}),lineGradient:(_,t)=>({u_translation:new s.bT(_,t.u_translation),u_ratio:new s.bf(_,t.u_ratio),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_units_to_pixels:new s.bT(_,t.u_units_to_pixels),u_image:new s.bO(_,t.u_image),u_image_height:new s.bf(_,t.u_image_height)}),linePattern:(_,t)=>({u_translation:new s.bT(_,t.u_translation),u_texsize:new s.bT(_,t.u_texsize),u_ratio:new s.bf(_,t.u_ratio),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_image:new s.bO(_,t.u_image),u_units_to_pixels:new s.bT(_,t.u_units_to_pixels),u_scale:new s.bS(_,t.u_scale),u_fade:new s.bf(_,t.u_fade)}),lineSDF:(_,t)=>({u_translation:new s.bT(_,t.u_translation),u_ratio:new s.bf(_,t.u_ratio),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_units_to_pixels:new s.bT(_,t.u_units_to_pixels),u_patternscale_a:new s.bT(_,t.u_patternscale_a),u_patternscale_b:new s.bT(_,t.u_patternscale_b),u_sdfgamma:new s.bf(_,t.u_sdfgamma),u_image:new s.bO(_,t.u_image),u_tex_y_a:new s.bf(_,t.u_tex_y_a),u_tex_y_b:new s.bf(_,t.u_tex_y_b),u_mix:new s.bf(_,t.u_mix)}),raster:(_,t)=>({u_tl_parent:new s.bT(_,t.u_tl_parent),u_scale_parent:new s.bf(_,t.u_scale_parent),u_buffer_scale:new s.bf(_,t.u_buffer_scale),u_fade_t:new s.bf(_,t.u_fade_t),u_opacity:new s.bf(_,t.u_opacity),u_image0:new s.bO(_,t.u_image0),u_image1:new s.bO(_,t.u_image1),u_brightness_low:new s.bf(_,t.u_brightness_low),u_brightness_high:new s.bf(_,t.u_brightness_high),u_saturation_factor:new s.bf(_,t.u_saturation_factor),u_contrast_factor:new s.bf(_,t.u_contrast_factor),u_spin_weights:new s.bS(_,t.u_spin_weights),u_coords_top:new s.bR(_,t.u_coords_top),u_coords_bottom:new s.bR(_,t.u_coords_bottom)}),symbolIcon:(_,t)=>({u_is_size_zoom_constant:new s.bO(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bO(_,t.u_is_size_feature_constant),u_size_t:new s.bf(_,t.u_size_t),u_size:new s.bf(_,t.u_size),u_camera_to_center_distance:new s.bf(_,t.u_camera_to_center_distance),u_pitch:new s.bf(_,t.u_pitch),u_rotate_symbol:new s.bO(_,t.u_rotate_symbol),u_aspect_ratio:new s.bf(_,t.u_aspect_ratio),u_fade_change:new s.bf(_,t.u_fade_change),u_label_plane_matrix:new s.bQ(_,t.u_label_plane_matrix),u_coord_matrix:new s.bQ(_,t.u_coord_matrix),u_is_text:new s.bO(_,t.u_is_text),u_pitch_with_map:new s.bO(_,t.u_pitch_with_map),u_is_along_line:new s.bO(_,t.u_is_along_line),u_is_variable_anchor:new s.bO(_,t.u_is_variable_anchor),u_texsize:new s.bT(_,t.u_texsize),u_texture:new s.bO(_,t.u_texture),u_translation:new s.bT(_,t.u_translation),u_pitched_scale:new s.bf(_,t.u_pitched_scale)}),symbolSDF:(_,t)=>({u_is_size_zoom_constant:new s.bO(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bO(_,t.u_is_size_feature_constant),u_size_t:new s.bf(_,t.u_size_t),u_size:new s.bf(_,t.u_size),u_camera_to_center_distance:new s.bf(_,t.u_camera_to_center_distance),u_pitch:new s.bf(_,t.u_pitch),u_rotate_symbol:new s.bO(_,t.u_rotate_symbol),u_aspect_ratio:new s.bf(_,t.u_aspect_ratio),u_fade_change:new s.bf(_,t.u_fade_change),u_label_plane_matrix:new s.bQ(_,t.u_label_plane_matrix),u_coord_matrix:new s.bQ(_,t.u_coord_matrix),u_is_text:new s.bO(_,t.u_is_text),u_pitch_with_map:new s.bO(_,t.u_pitch_with_map),u_is_along_line:new s.bO(_,t.u_is_along_line),u_is_variable_anchor:new s.bO(_,t.u_is_variable_anchor),u_texsize:new s.bT(_,t.u_texsize),u_texture:new s.bO(_,t.u_texture),u_gamma_scale:new s.bf(_,t.u_gamma_scale),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_is_halo:new s.bO(_,t.u_is_halo),u_translation:new s.bT(_,t.u_translation),u_pitched_scale:new s.bf(_,t.u_pitched_scale)}),symbolTextAndIcon:(_,t)=>({u_is_size_zoom_constant:new s.bO(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bO(_,t.u_is_size_feature_constant),u_size_t:new s.bf(_,t.u_size_t),u_size:new s.bf(_,t.u_size),u_camera_to_center_distance:new s.bf(_,t.u_camera_to_center_distance),u_pitch:new s.bf(_,t.u_pitch),u_rotate_symbol:new s.bO(_,t.u_rotate_symbol),u_aspect_ratio:new s.bf(_,t.u_aspect_ratio),u_fade_change:new s.bf(_,t.u_fade_change),u_label_plane_matrix:new s.bQ(_,t.u_label_plane_matrix),u_coord_matrix:new s.bQ(_,t.u_coord_matrix),u_is_text:new s.bO(_,t.u_is_text),u_pitch_with_map:new s.bO(_,t.u_pitch_with_map),u_is_along_line:new s.bO(_,t.u_is_along_line),u_is_variable_anchor:new s.bO(_,t.u_is_variable_anchor),u_texsize:new s.bT(_,t.u_texsize),u_texsize_icon:new s.bT(_,t.u_texsize_icon),u_texture:new s.bO(_,t.u_texture),u_texture_icon:new s.bO(_,t.u_texture_icon),u_gamma_scale:new s.bf(_,t.u_gamma_scale),u_device_pixel_ratio:new s.bf(_,t.u_device_pixel_ratio),u_is_halo:new s.bO(_,t.u_is_halo),u_translation:new s.bT(_,t.u_translation),u_pitched_scale:new s.bf(_,t.u_pitched_scale)}),background:(_,t)=>({u_opacity:new s.bf(_,t.u_opacity),u_color:new s.bP(_,t.u_color)}),backgroundPattern:(_,t)=>({u_opacity:new s.bf(_,t.u_opacity),u_image:new s.bO(_,t.u_image),u_pattern_tl_a:new s.bT(_,t.u_pattern_tl_a),u_pattern_br_a:new s.bT(_,t.u_pattern_br_a),u_pattern_tl_b:new s.bT(_,t.u_pattern_tl_b),u_pattern_br_b:new s.bT(_,t.u_pattern_br_b),u_texsize:new s.bT(_,t.u_texsize),u_mix:new s.bf(_,t.u_mix),u_pattern_size_a:new s.bT(_,t.u_pattern_size_a),u_pattern_size_b:new s.bT(_,t.u_pattern_size_b),u_scale_a:new s.bf(_,t.u_scale_a),u_scale_b:new s.bf(_,t.u_scale_b),u_pixel_coord_upper:new s.bT(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.bT(_,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bf(_,t.u_tile_units_to_pixels)}),terrain:(_,t)=>({u_texture:new s.bO(_,t.u_texture),u_ele_delta:new s.bf(_,t.u_ele_delta),u_fog_matrix:new s.bQ(_,t.u_fog_matrix),u_fog_color:new s.bP(_,t.u_fog_color),u_fog_ground_blend:new s.bf(_,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bf(_,t.u_fog_ground_blend_opacity),u_horizon_color:new s.bP(_,t.u_horizon_color),u_horizon_fog_blend:new s.bf(_,t.u_horizon_fog_blend),u_is_globe_mode:new s.bf(_,t.u_is_globe_mode)}),terrainDepth:(_,t)=>({u_ele_delta:new s.bf(_,t.u_ele_delta)}),terrainCoords:(_,t)=>({u_texture:new s.bO(_,t.u_texture),u_terrain_coords_id:new s.bf(_,t.u_terrain_coords_id),u_ele_delta:new s.bf(_,t.u_ele_delta)}),projectionErrorMeasurement:(_,t)=>({u_input:new s.bf(_,t.u_input),u_output_expected:new s.bf(_,t.u_output_expected)}),atmosphere:(_,t)=>({u_sun_pos:new s.bS(_,t.u_sun_pos),u_atmosphere_blend:new s.bf(_,t.u_atmosphere_blend),u_globe_position:new s.bS(_,t.u_globe_position),u_globe_radius:new s.bf(_,t.u_globe_radius),u_inv_proj_matrix:new s.bQ(_,t.u_inv_proj_matrix)}),sky:(_,t)=>({u_sky_color:new s.bP(_,t.u_sky_color),u_horizon_color:new s.bP(_,t.u_horizon_color),u_horizon:new s.bT(_,t.u_horizon),u_horizon_normal:new s.bT(_,t.u_horizon_normal),u_sky_horizon_blend:new s.bf(_,t.u_sky_horizon_blend),u_sky_blend:new s.bf(_,t.u_sky_blend)})};class lp{constructor(t,a,d){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gh{constructor(t,a,d,m){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const m=a.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,a,d){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],b=a.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[cp[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sc extends Xn{getDefault(){return s.be.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ns extends Xn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class _h extends Xn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class yh extends Xn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vh extends Xn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class up extends Xn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class xh extends Xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Oa extends Xn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class bh extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class km extends Xn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class zm extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Fm extends Xn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Om extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class hp extends Xn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Nm extends Xn{getDefault(){return s.be.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class dp extends Xn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Mc extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Tc extends Xn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ec extends Xn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class wh extends Xn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Na extends Xn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class fl extends Xn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bo extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Qr extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class pp extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fp extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Sh extends Xn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ua extends Xn{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const d=this.gl;br(d)?d.bindVertexArray(t):(a=d.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ac extends Xn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Cc extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ml extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class wo extends Xn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class mp extends wo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class So extends wo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mo extends wo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Mh="Framebuffer is not complete";class Th{constructor(t,a,d,m,y){this.context=t,this.width=a,this.height=d;const b=t.gl,T=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new mp(t,T),m)this.depthAttachment=y?new Mo(t,T):new So(t,T);else if(y)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(Mh)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class Cn{constructor(t){var a,d;if(this.gl=t,this.clearColor=new Sc(this),this.clearDepth=new Ns(this),this.clearStencil=new _h(this),this.colorMask=new yh(this),this.depthMask=new vh(this),this.stencilMask=new up(this),this.stencilFunc=new xh(this),this.stencilOp=new Oa(this),this.stencilTest=new bh(this),this.depthRange=new km(this),this.depthTest=new zm(this),this.depthFunc=new Fm(this),this.blend=new Om(this),this.blendFunc=new hp(this),this.blendColor=new Nm(this),this.blendEquation=new dp(this),this.cullFace=new Mc(this),this.cullFaceSide=new Tc(this),this.frontFace=new Ec(this),this.program=new wh(this),this.activeTexture=new Na(this),this.viewport=new fl(this),this.bindFramebuffer=new bo(this),this.bindRenderbuffer=new Qr(this),this.bindTexture=new pp(this),this.bindVertexBuffer=new fp(this),this.bindElementBuffer=new Sh(this),this.bindVertexArray=new Ua(this),this.pixelStoreUnpack=new Ac(this),this.pixelStoreUnpackPremultiplyAlpha=new Cc(this),this.pixelStoreUnpackFlipY=new ml(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),br(t)){this.HALF_FLOAT=t.HALF_FLOAT;const m=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=t.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const m=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new lp(this,t,a)}createVertexBuffer(t,a,d){return new gh(this,t,a,d)}createRenderbuffer(t,a,d){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,a,d,m){return new Th(this,t,a,d,m)}clear({color:t,depth:a,stencil:d}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bG(t.blendFunction,Nn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return br(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return br(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ba;function gp(_,t,a,d,m){const y=_.context,b=_.transform,T=y.gl,A=_.useProgram("collisionBox"),D=[];let z=0,U=0;for(let le=0;le<d.length;le++){const pe=d[le],Ae=t.getTile(pe).getBucket(a);if(!Ae)continue;const we=m?Ae.textCollisionBox:Ae.iconCollisionBox,Re=Ae.collisionCircleArray;Re.length>0&&(D.push({circleArray:Re,circleOffset:U,coord:pe}),z+=Re.length/4,U=z),we&&A.draw(y,T.LINES,gn.disabled,an.disabled,_.colorModeForRenderPass(),hn.disabled,hl(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),b.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,_.transform.zoom,null,null,we.collisionVertexBuffer)}if(!m||!D.length)return;const N=_.useProgram("collisionCircle"),H=new s.b_;H.resize(4*z),H._trim();let Y=0;for(const le of D)for(let pe=0;pe<le.circleArray.length/4;pe++){const Ae=4*pe,we=le.circleArray[Ae+0],Re=le.circleArray[Ae+1],Le=le.circleArray[Ae+2],Se=le.circleArray[Ae+3];H.emplace(Y++,we,Re,Le,Se,0),H.emplace(Y++,we,Re,Le,Se,1),H.emplace(Y++,we,Re,Le,Se,2),H.emplace(Y++,we,Re,Le,Se,3)}(!Ba||Ba.length<2*z)&&(Ba=function(le){const pe=2*le,Ae=new s.c0;Ae.resize(pe),Ae._trim();for(let we=0;we<pe;we++){const Re=6*we;Ae.uint16[Re+0]=4*we+0,Ae.uint16[Re+1]=4*we+1,Ae.uint16[Re+2]=4*we+2,Ae.uint16[Re+3]=4*we+2,Ae.uint16[Re+4]=4*we+3,Ae.uint16[Re+5]=4*we+0}return Ae}(z));const oe=y.createIndexBuffer(Ba,!0),ae=y.createVertexBuffer(H,s.b$.members,!0);for(const le of D){const pe=dl(_.transform);N.draw(y,T.TRIANGLES,gn.disabled,an.disabled,_.colorModeForRenderPass(),hn.disabled,pe,_.style.map.terrain&&_.style.map.terrain.getTerrainData(le.coord),null,a.id,ae,oe,s.aL.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,_.transform.zoom,null,null,null)}ae.destroy(),oe.destroy()}const _p=s.af(new Float32Array(16));function gl(_,t,a,d,m,y){const{horizontalAlign:b,verticalAlign:T}=s.aG(_);return new s.P((-(b-.5)*t/m+d[0])*y,(-(T-.5)*a/m+d[1])*y)}function Um(_,t,a,d,m,y){const b=t.tileAnchorPoint.add(new s.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let T=d.mult(y);a||(T=T.rotate(-m));const A=b.add(T);return xn(A.x,A.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const T=wt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(_),A=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return _.add(d.rotate(A))}return _.add(d)}function Bm(_,t,a,d,m,y,b,T,A,D,z,U){const N=_.text.placedSymbolArray,H=_.text.dynamicLayoutVertexArray,Y=_.icon.dynamicLayoutVertexArray,oe={};H.clear();for(let ae=0;ae<N.length;ae++){const le=N.get(ae),pe=le.hidden||!le.crossTileID||_.allowVerticalPlacement&&!le.placedOrientation?null:d[le.crossTileID];if(pe){const Ae=new s.P(le.anchorX,le.anchorY),we={getElevation:U,width:m.width,height:m.height,pitchedLabelPlaneMatrix:y,pitchWithMap:a,transform:m,tileAnchorPoint:Ae,translation:D,unwrappedTileID:z},Re=a?mn(Ae.x,Ae.y,we):wt(Ae.x,Ae.y,we),Le=nn(m.cameraToCenterDistance,Re.signedDistanceFromCamera);let Se=s.ao(_.textSizeData,T,le)*Le/s.aA;a&&(Se*=_.tilePixelRatio/b);const{width:Ne,height:qe,anchor:He,textOffset:je,textBoxScale:Xe}=pe,St=gl(He,Ne,qe,je,Xe,Se),xt=m.getPitchedTextCorrection(Ae.x+D[0],Ae.y+D[1],z),at=Um(Re.point,we,t,St,-m.bearingInRadians,xt),kt=_.allowVerticalPlacement&&le.placedOrientation===s.an.vertical?Math.PI/2:0;for(let _n=0;_n<le.numGlyphs;_n++)s.au(H,at,kt);A&&le.associatedIconIndex>=0&&(oe[le.associatedIconIndex]={shiftedAnchor:at,angle:kt})}else Be(le.numGlyphs,H)}if(A){Y.clear();const ae=_.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const pe=ae.get(le);if(pe.hidden)Be(pe.numGlyphs,Y);else{const Ae=oe[le];if(Ae)for(let we=0;we<pe.numGlyphs;we++)s.au(Y,Ae.shiftedAnchor,Ae.angle);else Be(pe.numGlyphs,Y)}}_.icon.dynamicLayoutVertexBuffer.updateData(Y)}_.text.dynamicLayoutVertexBuffer.updateData(H)}function yp(_,t,a){return a.iconsInText&&t?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function vp(_,t,a,d,m,y,b,T,A,D,z,U,N){const H=_.context,Y=H.gl,oe=_.transform,ae=T==="map",le=A==="map",pe=T!=="viewport"&&a.layout.get("symbol-placement")!=="point",Ae=ae&&!le&&!pe,we=!a.layout.get("symbol-sort-key").isConstant();let Re=!1;const Le=_.getDepthModeForSublayer(0,gn.ReadOnly),Se=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ne=[],qe=oe.getCircleRadiusCorrection();for(const He of d){const je=t.getTile(He),Xe=je.getBucket(a);if(!Xe)continue;const St=m?Xe.text:Xe.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const xt=St.programConfigurations.get(a.id),at=m||Xe.sdfIcons,kt=m?Xe.textSizeData:Xe.iconSizeData,_n=le||oe.pitch!==0,Yn=_.useProgram(yp(at,m,Xe),xt),wi=s.am(kt,oe.zoom),si=_.style.map.terrain&&_.style.map.terrain.getTerrainData(He);let Si,li,ai,ci,nr=[0,0],Gn=null;if(m)li=je.glyphAtlasTexture,ai=Y.LINEAR,Si=je.glyphAtlasTexture.size,Xe.iconsInText&&(nr=je.imageAtlasTexture.size,Gn=je.imageAtlasTexture,ci=_n||_.options.rotating||_.options.zooming||kt.kind==="composite"||kt.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const Ci=a.layout.get("icon-size").constantOr(0)!==1||Xe.iconsNeedLinear;li=je.imageAtlasTexture,ai=at||_.options.rotating||_.options.zooming||Ci||_n?Y.LINEAR:Y.NEAREST,Si=je.imageAtlasTexture.size}const qi=s.aB(je,1,_.transform.zoom),ir=Kt(ae,_.transform,qi),pa=s.L();s.ap(pa,ir);const fa=ni(le,ae,_.transform,qi),ma=s.aC(oe,je,y,b),Cs=oe.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Il=Se&&Xe.hasTextData(),Rl=a.layout.get("icon-text-fit")!=="none"&&Il&&Xe.hasIconData();if(pe){const Ci=_.style.map.terrain?(Tr,Bi)=>_.style.map.terrain.getElevation(He,Tr,Bi):null,pi=a.layout.get("text-rotation-alignment")==="map";Ii(Xe,_,m,ir,pa,le,D,pi,He.toUnwrapped(),oe.width,oe.height,ma,Ci)}const Fo=m&&Se||Rl,kr=pe||Fo?_p:le?ir:_.transform.clipSpaceToPixelsMatrix,us=at&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ga;ga=at?Xe.iconsInText?Lm(kt.kind,wi,Ae,le,pe,Fo,_,kr,fa,ma,Si,nr,qe):xo(kt.kind,wi,Ae,le,pe,Fo,_,kr,fa,ma,m,Si,0,qe):mh(kt.kind,wi,Ae,le,pe,Fo,_,kr,fa,ma,m,Si,qe);const Ha={program:Yn,buffers:St,uniformValues:ga,projectionData:Cs,atlasTexture:li,atlasTextureIcon:Gn,atlasInterpolation:ai,atlasInterpolationIcon:ci,isSDF:at,hasHalo:us};if(we&&Xe.canOverlap){Re=!0;const Ci=St.segments.get();for(const pi of Ci)Ne.push({segments:new s.aL([pi]),sortKey:pi.sortKey,state:Ha,terrainData:si})}else Ne.push({segments:St.segments,sortKey:0,state:Ha,terrainData:si})}Re&&Ne.sort((He,je)=>He.sortKey-je.sortKey);for(const He of Ne){const je=He.state;if(H.activeTexture.set(Y.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,Y.CLAMP_TO_EDGE),je.atlasTextureIcon&&(H.activeTexture.set(Y.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),je.isSDF){const Xe=je.uniformValues;je.hasHalo&&(Xe.u_is_halo=1,Pc(je.buffers,He.segments,a,_,je.program,Le,z,U,Xe,je.projectionData,He.terrainData)),Xe.u_is_halo=0}Pc(je.buffers,He.segments,a,_,je.program,Le,z,U,je.uniformValues,je.projectionData,He.terrainData)}}function Pc(_,t,a,d,m,y,b,T,A,D,z){const U=d.context;m.draw(U,U.gl.TRIANGLES,y,b,T,hn.backCCW,A,z,D,a.id,_.layoutVertexBuffer,_.indexBuffer,t,a.paint,d.transform.zoom,_.programConfigurations.get(a.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Ic(_,t,a,d,m){const y=_.context,b=y.gl,T=an.disabled,A=new Nn([b.ONE,b.ONE],s.be.transparent,[!0,!0,!0,!0]),D=t.getBucket(a);if(!D)return;const z=d.key;let U=a.heatmapFbos.get(z);U||(U=_l(y,t.tileSize,t.tileSize),a.heatmapFbos.set(z,U)),y.bindFramebuffer.set(U.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:s.be.transparent});const N=D.programConfigurations.get(a.id),H=_.useProgram("heatmap",N,!m),Y=_.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),oe=_.style.map.terrain.getTerrainData(d);H.draw(y,b.TRIANGLES,gn.disabled,T,A,hn.disabled,pl(t,_.transform.zoom,a.paint.get("heatmap-intensity"),1),oe,Y,a.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,a.paint,_.transform.zoom,N)}function Rc(_,t,a,d,m){const y=_.context,b=y.gl,T=_.transform;y.setColorMode(_.colorModeForRenderPass());const A=Lc(y,t),D=a.key,z=t.heatmapFbos.get(D);if(!z)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,z.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1),A.bind(b.LINEAR,b.CLAMP_TO_EDGE);const U=T.getProjectionData({overscaledTileID:a,applyTerrainMatrix:m,applyGlobeMatrix:!d});_.useProgram("heatmapTexture").draw(y,b.TRIANGLES,gn.disabled,an.disabled,_.colorModeForRenderPass(),hn.disabled,tp(_,t,0,1),null,U,t.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,t.paint,T.zoom),z.destroy(),t.heatmapFbos.delete(D)}function _l(_,t,a){var d,m;const y=_.gl,b=y.createTexture();y.bindTexture(y.TEXTURE_2D,b),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const T=(d=_.HALF_FLOAT)!==null&&d!==void 0?d:y.UNSIGNED_BYTE,A=(m=_.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,A,t,a,0,y.RGBA,T,null);const D=_.createFramebuffer(t,a,!1,!1);return D.colorAttachment.set(b),D}function Lc(_,t){return t.colorRampTexture||(t.colorRampTexture=new s.T(_,t.colorRamp,_.gl.RGBA)),t.colorRampTexture}function Eh(_,t,a,d,m){if(!a||!d||!d.imageAtlas)return;const y=d.imageAtlas.patternPositions;let b=y[a.to.toString()],T=y[a.from.toString()];if(!b&&T&&(b=T),!T&&b&&(T=b),!b||!T){const A=m.getPaintProperty(t);b=y[A],T=y[A]}b&&T&&_.setConstantPatternPositions(b,T)}function yl(_,t,a,d,m,y,b,T){const A=_.context.gl,D="fill-pattern",z=a.paint.get(D),U=z&&z.constantOr(1),N=a.getCrossfadeParameters();let H,Y,oe,ae,le;const pe=_.transform,Ae=a.paint.get("fill-translate"),we=a.paint.get("fill-translate-anchor");b?(Y=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=A.LINES):(Y=U?"fillPattern":"fill",H=A.TRIANGLES);const Re=z.constantOr(null);for(const Le of d){const Se=t.getTile(Le);if(U&&!Se.patternsLoaded())continue;const Ne=Se.getBucket(a);if(!Ne)continue;const qe=Ne.programConfigurations.get(a.id),He=_.useProgram(Y,qe),je=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le);U&&(_.context.activeTexture.set(A.TEXTURE0),Se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),qe.updatePaintBuffers(N)),Eh(qe,D,Re,Se,a);const Xe=pe.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),St=s.aC(pe,Se,Ae,we);if(b){ae=Ne.indexBuffer2,le=Ne.segments2;const at=[A.drawingBufferWidth,A.drawingBufferHeight];oe=Y==="fillOutlinePattern"&&U?Pm(_,N,Se,at,St):Ts(at,St)}else ae=Ne.indexBuffer,le=Ne.segments,oe=U?xc(_,N,Se,St):{u_fill_translate:St};const xt=_.stencilModeForClipping(Le);He.draw(_.context,H,m,xt,y,hn.backCCW,oe,je,Xe,a.id,Ne.layoutVertexBuffer,ae,le,a.paint,_.transform.zoom,qe)}}function To(_,t,a,d,m,y,b,T){const A=_.context,D=A.gl,z="fill-extrusion-pattern",U=a.paint.get(z),N=U.constantOr(1),H=a.getCrossfadeParameters(),Y=a.paint.get("fill-extrusion-opacity"),oe=U.constantOr(null),ae=_.transform;for(const le of d){const pe=t.getTile(le),Ae=pe.getBucket(a);if(!Ae)continue;const we=_.style.map.terrain&&_.style.map.terrain.getTerrainData(le),Re=Ae.programConfigurations.get(a.id),Le=_.useProgram(N?"fillExtrusionPattern":"fillExtrusion",Re);N&&(_.context.activeTexture.set(D.TEXTURE0),pe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Re.updatePaintBuffers(H));const Se=ae.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Eh(Re,z,oe,pe,a);const Ne=s.aC(ae,pe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qe=a.paint.get("fill-extrusion-vertical-gradient"),He=N?uh(_,qe,Y,Ne,le,H,pe):ul(_,qe,Y,Ne);Le.draw(A,A.gl.TRIANGLES,m,y,b,hn.backCCW,He,we,Se,a.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,a.paint,_.transform.zoom,Re,_.style.map.terrain&&Ae.centroidVertexBuffer)}}function Eo(_,t,a,d,m,y,b,T,A){var D;const z=_.style.projection,U=_.context,N=_.transform,H=U.gl,Y=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],oe=_.useProgram("hillshade",null,!1,Y),ae=!_.options.moving;for(const le of d){const pe=t.getTile(le),Ae=pe.fbo;if(!Ae)continue;const we=z.getMeshFromTileID(U,le.canonical,T,!0,"raster"),Re=(D=_.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(le);U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Ae.colorAttachment.get());const Le=N.getProjectionData({overscaledTileID:le,aligned:ae,applyGlobeMatrix:!A,applyTerrainMatrix:!0});oe.draw(U,H.TRIANGLES,y,m[le.overscaledZ],b,hn.backCCW,vo(_,pe,a),Re,Le,a.id,we.vertexBuffer,we.indexBuffer,we.segments)}}function vl(_,t,a,d,m,y,b,T,A){var D;const z=_.style.projection,U=_.context,N=_.transform,H=U.gl,Y=_.useProgram("colorRelief"),oe=!_.options.moving;let ae=!0;for(const le of d){const pe=t.getTile(le),Ae=pe.dem;if(ae){const qe=H.getParameter(H.MAX_TEXTURE_SIZE),{elevationTexture:He,colorTexture:je}=a.getColorRampTextures(U,qe,Ae.getUnpackVector());U.activeTexture.set(H.TEXTURE1),He.bind(H.NEAREST,H.CLAMP_TO_EDGE),U.activeTexture.set(H.TEXTURE4),je.bind(H.LINEAR,H.CLAMP_TO_EDGE),ae=!1}if(!Ae||!Ae.data)continue;const we=Ae.stride,Re=Ae.getPixels();if(U.activeTexture.set(H.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),pe.demTexture=pe.demTexture||_.getTileTexture(we),pe.demTexture){const qe=pe.demTexture;qe.update(Re,{premultiply:!1}),qe.bind(H.LINEAR,H.CLAMP_TO_EDGE)}else pe.demTexture=new s.T(U,Re,H.RGBA,{premultiply:!1}),pe.demTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Le=z.getMeshFromTileID(U,le.canonical,T,!0,"raster"),Se=(D=_.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(le),Ne=N.getProjectionData({overscaledTileID:le,aligned:oe,applyGlobeMatrix:!A,applyTerrainMatrix:!0});Y.draw(U,H.TRIANGLES,y,m[le.overscaledZ],b,hn.backCCW,Rm(a,pe.dem),Se,Ne,a.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}}const Ah=[new s.P(0,0),new s.P(s.$,0),new s.P(s.$,s.$),new s.P(0,s.$)];function la(_,t,a,d,m,y,b,T,A=!1,D=!1){const z=d[d.length-1].overscaledZ,U=_.context,N=U.gl,H=_.useProgram("raster"),Y=_.transform,oe=_.style.projection,ae=_.colorModeForRenderPass(),le=!_.options.moving;for(const pe of d){const Ae=_.getDepthModeForSublayer(pe.overscaledZ-z,a.paint.get("raster-opacity")===1?gn.ReadWrite:gn.ReadOnly,N.LESS),we=t.getTile(pe);we.registerFadeDuration(a.paint.get("raster-fade-duration"));const Re=t.findLoadedParent(pe,0),Le=t.findLoadedSibling(pe),Se=Vm(we,Re||Le||null,t,a,_.transform,_.style.map.terrain);let Ne,qe;const He=a.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;U.activeTexture.set(N.TEXTURE0),we.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(N.TEXTURE1),Re?(Re.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Ne=Math.pow(2,Re.tileID.overscaledZ-we.tileID.overscaledZ),qe=[we.tileID.canonical.x*Ne%1,we.tileID.canonical.y*Ne%1]):we.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),we.texture.useMipmap&&U.extTextureFilterAnisotropic&&_.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const je=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),Xe=Y.getProjectionData({overscaledTileID:pe,aligned:le,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),St=Fa(qe||[0,0],Ne||1,Se,a,T),xt=oe.getMeshFromTileID(U,pe.canonical,y,b,"raster");H.draw(U,N.TRIANGLES,Ae,m?m[pe.overscaledZ]:an.disabled,ae,A?hn.frontCCW:hn.backCCW,St,je,Xe,a.id,xt.vertexBuffer,xt.indexBuffer,xt.segments)}}function Vm(_,t,a,d,m,y){const b=d.paint.get("raster-fade-duration");if(!y&&b>0){const T=L.now(),A=(T-_.timeAdded)/b,D=t?(T-t.timeAdded)/b:-1,z=a.getSource(),U=xe(m,{tileSize:z.tileSize,roundZoom:z.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(_.tileID.overscaledZ-U),H=N&&_.refreshedUponExpiration?1:s.ag(N?A:1-D,0,1);return _.refreshedUponExpiration&&A>=1&&(_.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const xp=new s.be(1,0,0,1),Dc=new s.be(0,1,0,1),Ch=new s.be(0,0,1,1),bp=new s.be(1,0,1,1),wp=new s.be(0,1,1,1);function xl(_,t,a,d){zc(_,0,t+a/2,_.transform.width,a,d)}function kc(_,t,a,d){zc(_,t-a/2,0,a,_.transform.height,d)}function zc(_,t,a,d,m,y){const b=_.context,T=b.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*_.pixelRatio,a*_.pixelRatio,d*_.pixelRatio,m*_.pixelRatio),b.clear({color:y}),T.disable(T.SCISSOR_TEST)}function Sp(_,t,a){const d=_.context,m=d.gl,y=_.useProgram("debug"),b=gn.disabled,T=an.disabled,A=_.colorModeForRenderPass(),D="$debug",z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(a);d.activeTexture.set(m.TEXTURE0);const U=t.getTileByID(a.key).latestRawTileData,N=Math.floor((U&&U.byteLength||0)/1024),H=t.getTile(a).tileSize,Y=512/Math.min(H,512)*(a.overscaledZ/_.transform.zoom)*.5;let oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(oe+=` => ${a.overscaledZ}`),function(le,pe){le.initDebugOverlayCanvas();const Ae=le.debugOverlayCanvas,we=le.context.gl,Re=le.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ae.width,Ae.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(pe,5,5),Re.strokeText(pe,5,5),le.debugOverlayTexture.update(Ae),le.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(_,`${oe} ${N}kB`);const ae=_.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(d,m.TRIANGLES,b,T,Nn.alphaBlended,hn.disabled,ep(s.be.transparent,Y),null,ae,D,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(d,m.LINE_STRIP,b,T,A,hn.disabled,ep(s.be.red),z,ae,D,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Ti(_,t,a,d){const{isRenderingGlobe:m}=d,y=_.context,b=y.gl,T=_.transform,A=_.colorModeForRenderPass(),D=_.getDepthModeFor3D(),z=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(const U of a){const N=t.getTerrainMesh(U.tileID),H=_.renderToTexture.getTexture(U),Y=t.getTerrainData(U.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,H.texture);const oe=t.getMeshFrameDelta(T.zoom),ae=T.calculateFogMatrix(U.tileID.toUnwrapped()),le=Am(oe,ae,_.style.sky,T.pitch,m),pe=T.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(y,b.TRIANGLES,D,an.disabled,A,hn.backCCW,le,Y,pe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function ca(_,t){if(!t.mesh){const a=new s.aK;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const d=new s.aM;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),t.mesh=new zs(_.createVertexBuffer(a,Fs.members),_.createIndexBuffer(d),s.aL.simpleSegment(0,0,a.length,d.length))}return t.mesh}class es{constructor(t,a){this.context=new Cn(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ui}resize(t,a,d){if(this.width=Math.floor(t*d),this.height=Math.floor(a*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,a=new s.aK;a.emplaceBack(0,0),a.emplaceBack(s.$,0),a.emplaceBack(0,s.$),a.emplaceBack(s.$,s.$),this.tileExtentBuffer=t.createVertexBuffer(a,Fs.members),this.tileExtentSegments=s.aL.simpleSegment(0,0,4,2);const d=new s.aK;d.emplaceBack(0,0),d.emplaceBack(s.$,0),d.emplaceBack(0,s.$),d.emplaceBack(s.$,s.$),this.debugBuffer=t.createVertexBuffer(d,Fs.members),this.debugSegments=s.aL.simpleSegment(0,0,4,5);const m=new s.c5;m.emplaceBack(0,0,0,0),m.emplaceBack(s.$,0,s.$,0),m.emplaceBack(0,s.$,0,s.$),m.emplaceBack(s.$,s.$,s.$,s.$),this.rasterBoundsBuffer=t.createVertexBuffer(m,Tm.members),this.rasterBoundsSegments=s.aL.simpleSegment(0,0,4,2);const y=new s.aK;y.emplaceBack(0,0),y.emplaceBack(s.$,0),y.emplaceBack(0,s.$),y.emplaceBack(s.$,s.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(y,Fs.members),this.rasterBoundsSegmentsPosOnly=s.aL.simpleSegment(0,0,4,5);const b=new s.aK;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Fs.members),this.viewportSegments=s.aL.simpleSegment(0,0,4,2);const T=new s.c6;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(T);const A=new s.aM;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(A);const D=this.context.gl;this.stencilClearMode=new an({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.tileExtentMesh=new zs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=s.L();s.bX(d,0,this.width,this.height,0,0,1),s.N(d,d,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const m={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,gn.disabled,this.stencilClearMode,Nn.disabled,hn.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,d){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const m=this.context;m.setColorMode(Nn.disabled),m.setDepthMode(gn.disabled);const y={};for(const b of a)y[b.key]=this.nextStencilID++;this._renderTileMasks(y,a,d,!0),this._renderTileMasks(y,a,d,!1),this._tileClippingMaskIDs=y}_renderTileMasks(t,a,d,m){const y=this.context,b=y.gl,T=this.style.projection,A=this.transform,D=this.useProgram("clippingMask");for(const z of a){const U=t[z.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),H=T.getMeshFromTileID(this.context,z.canonical,m,!0,"stencil"),Y=A.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!d,applyTerrainMatrix:!0});D.draw(y,b.TRIANGLES,gn.disabled,new an({func:b.ALWAYS,mask:0},U,255,b.KEEP,b.KEEP,b.REPLACE),Nn.disabled,d?hn.disabled:hn.backCCW,null,N,Y,"$clipping",H.vertexBuffer,H.indexBuffer,H.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,d=this.style.projection,m=this.transform,y=this.useProgram("depth"),b=this.getDepthModeFor3D(),T=Ee(m,{tileSize:m.tileSize});for(const A of T){const D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),z=d.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),U=m.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(t,a.TRIANGLES,b,an.disabled,Nn.disabled,hn.backCCW,null,D,U,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new an({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new an({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,d=t.sort((b,T)=>T.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let T=0;T<y;T++)b[T+m]=new an({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,d]}return[{[m]:an.disabled},d]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,d=t.sort((b,T)=>T.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(this.clearStencil(),y>1){const b={},T={};for(let A=0;A<y;A++)b[A+m]=new an({func:a.GREATER,mask:255},y+1+A,255,a.KEEP,a.KEEP,a.REPLACE),T[A+m]=new an({func:a.GREATER,mask:255},1+A,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*y+1,[b,T,d]}return this.nextStencilID=3,[{[m]:new an({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[m]:new an({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Nn([t.CONSTANT_COLOR,t.ONE],new s.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Nn.unblended:Nn.alphaBlended}getDepthModeForSublayer(t,a,d){if(!this.opaquePassEnabledForLayer())return gn.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new gn(d||this.context.gl.LEQUAL,a,[m,m])}getDepthModeFor3D(){return new gn(this.context.gl.LEQUAL,gn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var d,m;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const y=this.style._order,b=this.style.sourceCaches,T={},A={},D={},z={isRenderingToTexture:!1,isRenderingGlobe:((d=t.projection)===null||d===void 0?void 0:d.transitionState)>0};for(const N in b){const H=b[N];H.used&&H.prepare(this.context),T[N]=H.getVisibleCoordinates(!1),A[N]=T[N].slice().reverse(),D[N]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<y.length;N++)if(this.style._layers[y[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of y){const H=this.style._layers[N];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const Y=A[H.source];(H.type==="custom"||Y.length)&&this.renderLayer(this,b[H.source],H,Y,z)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?s.be.black:s.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,H){const Y=N.context,oe=Y.gl,ae=((Le,Se,Ne)=>{const qe=Math.cos(Se.rollInRadians),He=Math.sin(Se.rollInRadians),je=X(Se),Xe=Se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Le.properties.get("sky-color"),u_horizon_color:Le.properties.get("horizon-color"),u_horizon:[(Se.width/2-je*He)*Ne,(Se.height/2+je*qe)*Ne],u_horizon_normal:[-He,qe],u_sky_horizon_blend:Le.properties.get("sky-horizon-blend")*Se.height/2*Ne,u_sky_blend:Xe}})(H,N.style.map.transform,N.pixelRatio),le=new gn(oe.LEQUAL,gn.ReadWrite,[0,1]),pe=an.disabled,Ae=N.colorModeForRenderPass(),we=N.useProgram("sky"),Re=ca(Y,H);we.draw(Y,oe.TRIANGLES,le,pe,Ae,hn.disabled,ae,null,void 0,"sky",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[y[this.currentLayer]],H=b[N.source],Y=T[N.source];this._renderTileClippingMasks(N,Y,!1),this.renderLayer(this,H,N,Y,z)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const N=this.style._layers[y[this.currentLayer]],H=b[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,z))continue;this.opaquePassEnabledForLayer()||U||(U=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Y=(N.type==="symbol"?D:A)[N.source];this._renderTileClippingMasks(N,T[N.source],!!this.renderToTexture),this.renderLayer(this,H,N,Y,z)}if(z.isRenderingGlobe&&function(N,H,Y){const oe=N.context,ae=oe.gl,le=N.useProgram("atmosphere"),pe=new gn(ae.LEQUAL,gn.ReadOnly,[0,1]),Ae=N.transform,we=function(Xe,St){const xt=Xe.properties.get("position"),at=[-xt.x,-xt.y,-xt.z],kt=s.af(new Float64Array(16));return Xe.properties.get("anchor")==="map"&&(s.b5(kt,kt,St.rollInRadians),s.b6(kt,kt,-St.pitchInRadians),s.b5(kt,kt,St.bearingInRadians),s.b6(kt,kt,St.center.lat*Math.PI/180),s.by(kt,kt,-St.center.lng*Math.PI/180)),s.c4(at,at,kt),at}(Y,N.transform),Re=Ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Le=H.properties.get("atmosphere-blend")*Re.projectionTransition;if(Le===0)return;const Se=po(Ae.worldSize,Ae.center.lat),Ne=Ae.inverseProjectionMatrix,qe=new Float64Array(4);qe[3]=1,s.av(qe,qe,Ae.modelViewProjectionMatrix),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1,s.av(qe,qe,Ne),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1;const He=((Xe,St,xt,at,kt)=>({u_sun_pos:Xe,u_atmosphere_blend:St,u_globe_position:xt,u_globe_radius:at,u_inv_proj_matrix:kt}))(we,Le,[qe[0],qe[1],qe[2]],Se,Ne),je=ca(oe,H);le.draw(oe,ae.TRIANGLES,pe,an.disabled,Nn.alphaBlended,hn.disabled,He,null,null,"atmosphere",je.vertexBuffer,je.indexBuffer,je.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=function(H,Y){let oe=null;const ae=Object.values(H._layers).flatMap(we=>we.source&&!we.isHidden(Y)?[H.sourceCaches[we.source]]:[]),le=ae.filter(we=>we.getSource().type==="vector"),pe=ae.filter(we=>we.getSource().type!=="vector"),Ae=we=>{(!oe||oe.getSource().maxzoom<we.getSource().maxzoom)&&(oe=we)};return le.forEach(we=>Ae(we)),oe||pe.forEach(we=>Ae(we)),oe}(this.style,this.transform.zoom);N&&function(H,Y,oe){for(let ae=0;ae<oe.length;ae++)Sp(H,Y,oe[ae])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const H=N.transform.padding;xl(N,N.transform.height-(H.top||0),3,xp),xl(N,H.bottom||0,3,Dc),kc(N,H.left||0,3,Ch),kc(N,N.transform.width-(H.right||0),3,bp);const Y=N.transform.centerPoint;(function(oe,ae,le,pe){zc(oe,ae-1,le-10,2,20,pe),zc(oe,ae-10,le-1,20,2,pe)})(N,Y.x,N.transform.height-Y.y,wp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=t?!s.c7(a,d):!s.c8(a,d)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(s.c9(a,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,b){const T=y.context,A=T.gl,D=y.transform,z=Nn.unblended,U=new gn(A.LEQUAL,gn.ReadWrite,[0,1]),N=b.sourceCache.getRenderableTiles(),H=y.useProgram("terrainDepth");T.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),T.clear({color:s.be.transparent,depth:1});for(const Y of N){const oe=b.getTerrainMesh(Y.tileID),ae=b.getTerrainData(Y.tileID),le=D.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),pe={u_ele_delta:b.getMeshFrameDelta(D.zoom)};H.draw(T,A.TRIANGLES,U,an.disabled,z,hn.backCCW,pe,ae,le,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,b){const T=y.context,A=T.gl,D=y.transform,z=Nn.unblended,U=new gn(A.LEQUAL,gn.ReadWrite,[0,1]),N=b.getCoordsTexture(),H=b.sourceCache.getRenderableTiles(),Y=y.useProgram("terrainCoords");T.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),T.clear({color:s.be.transparent,depth:1}),b.coordsIndex=[];for(const oe of H){const ae=b.getTerrainMesh(oe.tileID),le=b.getTerrainData(oe.tileID);T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,N.texture);const pe={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(D.zoom)},Ae=D.getProjectionData({overscaledTileID:oe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(T,A.TRIANGLES,U,an.disabled,z,hn.backCCW,pe,le,Ae,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),b.coordsIndex.push(oe.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(t,a,d,m,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(m||[]).length)&&(this.id=d.id,s.ca(d)?function(b,T,A,D,z,U){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:N}=U,H=an.disabled,Y=b.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(oe,ae,le,pe,Ae,we,Re,Le,Se){const Ne=ae.transform,qe=ae.style.map.terrain,He=Ae==="map",je=we==="map";for(const Xe of oe){const St=pe.getTile(Xe),xt=St.getBucket(le);if(!xt||!xt.text||!xt.text.segments.get().length)continue;const at=s.am(xt.textSizeData,Ne.zoom),kt=s.aB(St,1,ae.transform.zoom),_n=Kt(He,ae.transform,kt),Yn=le.layout.get("icon-text-fit")!=="none"&&xt.hasIconData();if(at){const wi=Math.pow(2,Ne.zoom-St.tileID.overscaledZ),si=qe?(Si,li)=>qe.getElevation(Xe,Si,li):null;Bm(xt,He,je,Se,Ne,_n,wi,at,Yn,s.aC(Ne,St,Re,Le),Xe.toUnwrapped(),si)}}}(D,b,A,T,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),z),A.paint.get("icon-opacity").constantOr(1)!==0&&vp(b,T,A,D,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),H,Y,N),A.paint.get("text-opacity").constantOr(1)!==0&&vp(b,T,A,D,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),H,Y,N),T.map.showCollisionBoxes&&(gp(b,T,A,D,!0),gp(b,T,A,D,!1))}(t,a,d,m,this.style.placement.variableOffsets,y):s.cb(d)?function(b,T,A,D,z){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:U}=z,N=A.paint.get("circle-opacity"),H=A.paint.get("circle-stroke-width"),Y=A.paint.get("circle-stroke-opacity"),oe=!A.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(H.constantOr(1)===0||Y.constantOr(1)===0))return;const ae=b.context,le=ae.gl,pe=b.transform,Ae=b.getDepthModeForSublayer(0,gn.ReadOnly),we=an.disabled,Re=b.colorModeForRenderPass(),Le=[],Se=pe.getCircleRadiusCorrection();for(let Ne=0;Ne<D.length;Ne++){const qe=D[Ne],He=T.getTile(qe),je=He.getBucket(A);if(!je)continue;const Xe=A.paint.get("circle-translate"),St=A.paint.get("circle-translate-anchor"),xt=s.aC(pe,He,Xe,St),at=je.programConfigurations.get(A.id),kt=b.useProgram("circle",at),_n=je.layoutVertexBuffer,Yn=je.indexBuffer,wi=b.style.map.terrain&&b.style.map.terrain.getTerrainData(qe),si={programConfiguration:at,program:kt,layoutVertexBuffer:_n,indexBuffer:Yn,uniformValues:hh(b,He,A,xt,Se),terrainData:wi,projectionData:pe.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(oe){const Si=je.segments.get();for(const li of Si)Le.push({segments:new s.aL([li]),sortKey:li.sortKey,state:si})}else Le.push({segments:je.segments,sortKey:0,state:si})}oe&&Le.sort((Ne,qe)=>Ne.sortKey-qe.sortKey);for(const Ne of Le){const{programConfiguration:qe,program:He,layoutVertexBuffer:je,indexBuffer:Xe,uniformValues:St,terrainData:xt,projectionData:at}=Ne.state;He.draw(ae,le.TRIANGLES,Ae,we,Re,hn.backCCW,St,xt,at,A.id,je,Xe,Ne.segments,A.paint,b.transform.zoom,qe)}}(t,a,d,m,y):s.cc(d)?function(b,T,A,D,z){if(A.paint.get("heatmap-opacity")===0)return;const U=b.context,{isRenderingToTexture:N,isRenderingGlobe:H}=z;if(b.style.map.terrain){for(const Y of D){const oe=T.getTile(Y);T.hasRenderableParent(Y)||(b.renderPass==="offscreen"?Ic(b,oe,A,Y,H):b.renderPass==="translucent"&&Rc(b,A,Y,N,H))}U.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(Y,oe,ae,le){const pe=Y.context,Ae=pe.gl,we=Y.transform,Re=an.disabled,Le=new Nn([Ae.ONE,Ae.ONE],s.be.transparent,[!0,!0,!0,!0]);(function(Se,Ne,qe){const He=Se.gl;Se.activeTexture.set(He.TEXTURE1),Se.viewport.set([0,0,Ne.width/4,Ne.height/4]);let je=qe.heatmapFbos.get(s.c1);je?(He.bindTexture(He.TEXTURE_2D,je.colorAttachment.get()),Se.bindFramebuffer.set(je.framebuffer)):(je=_l(Se,Ne.width/4,Ne.height/4),qe.heatmapFbos.set(s.c1,je))})(pe,Y,ae),pe.clear({color:s.be.transparent});for(let Se=0;Se<le.length;Se++){const Ne=le[Se];if(oe.hasRenderableParent(Ne))continue;const qe=oe.getTile(Ne),He=qe.getBucket(ae);if(!He)continue;const je=He.programConfigurations.get(ae.id),Xe=Y.useProgram("heatmap",je),St=we.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),xt=we.getCircleRadiusCorrection();Xe.draw(pe,Ae.TRIANGLES,gn.disabled,Re,Le,hn.backCCW,pl(qe,we.zoom,ae.paint.get("heatmap-intensity"),xt),null,St,ae.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,ae.paint,we.zoom,je)}pe.viewport.set([0,0,Y.width,Y.height])}(b,T,A,D):b.renderPass==="translucent"&&function(Y,oe){const ae=Y.context,le=ae.gl;ae.setColorMode(Y.colorModeForRenderPass());const pe=oe.heatmapFbos.get(s.c1);pe&&(ae.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_2D,pe.colorAttachment.get()),ae.activeTexture.set(le.TEXTURE1),Lc(ae,oe).bind(le.LINEAR,le.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(ae,le.TRIANGLES,gn.disabled,an.disabled,Y.colorModeForRenderPass(),hn.disabled,tp(Y,oe,0,1),null,null,oe.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,oe.paint,Y.transform.zoom))}(b,A)}(t,a,d,m,y):s.cd(d)?function(b,T,A,D,z){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:U}=z,N=A.paint.get("line-opacity"),H=A.paint.get("line-width");if(N.constantOr(1)===0||H.constantOr(1)===0)return;const Y=b.getDepthModeForSublayer(0,gn.ReadOnly),oe=b.colorModeForRenderPass(),ae=A.paint.get("line-dasharray"),le=A.paint.get("line-pattern"),pe=le.constantOr(1),Ae=A.paint.get("line-gradient"),we=A.getCrossfadeParameters(),Re=pe?"linePattern":ae?"lineSDF":Ae?"lineGradient":"line",Le=b.context,Se=Le.gl,Ne=b.transform;let qe=!0;for(const He of D){const je=T.getTile(He);if(pe&&!je.patternsLoaded())continue;const Xe=je.getBucket(A);if(!Xe)continue;const St=Xe.programConfigurations.get(A.id),xt=b.context.program.get(),at=b.useProgram(Re,St),kt=qe||at.program!==xt,_n=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Yn=le.constantOr(null);if(Yn&&je.imageAtlas){const ai=je.imageAtlas,ci=ai.patternPositions[Yn.to.toString()],nr=ai.patternPositions[Yn.from.toString()];ci&&nr&&St.setConstantPatternPositions(ci,nr)}const wi=Ne.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),si=Ne.getPixelScale(),Si=pe?ip(b,je,A,si,we):ae?rp(b,je,A,si,ae,we):Ae?dh(b,je,A,si,Xe.lineClipsArray.length):bc(b,je,A,si);if(pe)Le.activeTexture.set(Se.TEXTURE0),je.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),St.updatePaintBuffers(we);else if(ae&&(kt||b.lineAtlas.dirty))Le.activeTexture.set(Se.TEXTURE0),b.lineAtlas.bind(Le);else if(Ae){const ai=Xe.gradients[A.id];let ci=ai.texture;if(A.gradientVersion!==ai.version){let nr=256;if(A.stepInterpolant){const Gn=T.getSource().maxzoom,qi=He.canonical.z===Gn?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;nr=s.ag(s.c2(Xe.maxLineLength/s.$*1024*qi),256,Le.maxTextureSize)}ai.gradient=s.c3({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:nr,image:ai.gradient||void 0,clips:Xe.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new s.T(Le,ai.gradient,Se.RGBA),ai.version=A.gradientVersion,ci=ai.texture}Le.activeTexture.set(Se.TEXTURE0),ci.bind(A.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}const li=b.stencilModeForClipping(He);at.draw(Le,Se.TRIANGLES,Y,li,oe,hn.disabled,Si,_n,wi,A.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,A.paint,b.transform.zoom,St,Xe.layoutVertexBuffer2),qe=!1}}(t,a,d,m,y):s.ce(d)?function(b,T,A,D,z){const U=A.paint.get("fill-color"),N=A.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:H}=z,Y=b.colorModeForRenderPass(),oe=A.paint.get("fill-pattern"),ae=b.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&U.constantOr(s.be.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===ae){const le=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?gn.ReadWrite:gn.ReadOnly);yl(b,T,A,D,le,Y,!1,H)}if(b.renderPass==="translucent"&&A.paint.get("fill-antialias")){const le=b.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,gn.ReadOnly);yl(b,T,A,D,le,Y,!0,H)}}(t,a,d,m,y):s.cf(d)?function(b,T,A,D,z){const U=A.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:N}=z;if(b.renderPass==="translucent"){const H=new gn(b.context.gl.LEQUAL,gn.ReadWrite,b.depthRangeFor3D);if(U!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))To(b,T,A,D,H,an.disabled,Nn.disabled,N),To(b,T,A,D,H,b.stencilModeFor3D(),b.colorModeForRenderPass(),N);else{const Y=b.colorModeForRenderPass();To(b,T,A,D,H,an.disabled,Y,N)}}}(t,a,d,m,y):s.cg(d)?function(b,T,A,D,z){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:U}=z,N=b.context,H=b.style.projection.useSubdivision,Y=b.getDepthModeForSublayer(0,gn.ReadOnly),oe=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(ae,le,pe,Ae,we,Re,Le){const Se=ae.context,Ne=Se.gl;for(const qe of pe){const He=le.getTile(qe),je=He.dem;if(!je||!je.data||!He.needsHillshadePrepare)continue;const Xe=je.dim,St=je.stride,xt=je.getPixels();if(Se.activeTexture.set(Ne.TEXTURE1),Se.pixelStoreUnpackPremultiplyAlpha.set(!1),He.demTexture=He.demTexture||ae.getTileTexture(St),He.demTexture){const kt=He.demTexture;kt.update(xt,{premultiply:!1}),kt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE)}else He.demTexture=new s.T(Se,xt,Ne.RGBA,{premultiply:!1}),He.demTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);Se.activeTexture.set(Ne.TEXTURE0);let at=He.fbo;if(!at){const kt=new s.T(Se,{width:Xe,height:Xe,data:null},Ne.RGBA);kt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),at=He.fbo=Se.createFramebuffer(Xe,Xe,!0,!1),at.colorAttachment.set(kt.texture)}Se.bindFramebuffer.set(at.framebuffer),Se.viewport.set([0,0,Xe,Xe]),ae.useProgram("hillshadePrepare").draw(Se,Ne.TRIANGLES,we,Re,Le,hn.disabled,Im(He.tileID,je),null,null,Ae.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),He.needsHillshadePrepare=!1}})(b,T,D,A,Y,an.disabled,oe),N.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(H){const[ae,le,pe]=b.stencilConfigForOverlapTwoPass(D);Eo(b,T,A,pe,ae,Y,oe,!1,U),Eo(b,T,A,pe,le,Y,oe,!0,U)}else{const[ae,le]=b.getStencilConfigForOverlapAndUpdateStencilID(D);Eo(b,T,A,le,ae,Y,oe,!1,U)}}(t,a,d,m,y):s.ch(d)?function(b,T,A,D,z){if(b.renderPass!=="translucent"||!D.length)return;const{isRenderingToTexture:U}=z,N=b.style.projection.useSubdivision,H=b.getDepthModeForSublayer(0,gn.ReadOnly),Y=b.colorModeForRenderPass();if(N){const[oe,ae,le]=b.stencilConfigForOverlapTwoPass(D);vl(b,T,A,le,oe,H,Y,!1,U),vl(b,T,A,le,ae,H,Y,!0,U)}else{const[oe,ae]=b.getStencilConfigForOverlapAndUpdateStencilID(D);vl(b,T,A,ae,oe,H,Y,!1,U)}}(t,a,d,m,y):s.ci(d)?function(b,T,A,D,z){if(b.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!D.length)return;const{isRenderingToTexture:U}=z,N=T.getSource(),H=b.style.projection.useSubdivision;if(N instanceof Tn)la(b,T,A,D,null,!1,!1,N.tileCoords,N.flippedWindingOrder,U);else if(H){const[Y,oe,ae]=b.stencilConfigForOverlapTwoPass(D);la(b,T,A,ae,Y,!1,!0,Ah,!1,U),la(b,T,A,ae,oe,!0,!0,Ah,!1,U)}else{const[Y,oe]=b.getStencilConfigForOverlapAndUpdateStencilID(D);la(b,T,A,oe,Y,!1,!0,Ah,!1,U)}}(t,a,d,m,y):s.cj(d)?function(b,T,A,D,z){const U=A.paint.get("background-color"),N=A.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:H}=z,Y=b.context,oe=Y.gl,ae=b.style.projection,le=b.transform,pe=le.tileSize,Ae=A.paint.get("background-pattern");if(b.isPatternMissing(Ae))return;const we=!Ae&&U.a===1&&N===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==we)return;const Re=an.disabled,Le=b.getDepthModeForSublayer(0,we==="opaque"?gn.ReadWrite:gn.ReadOnly),Se=b.colorModeForRenderPass(),Ne=b.useProgram(Ae?"backgroundPattern":"background"),qe=D||Ee(le,{tileSize:pe,terrain:b.style.map.terrain});Ae&&(Y.activeTexture.set(oe.TEXTURE0),b.imageManager.bind(b.context));const He=A.getCrossfadeParameters();for(const je of qe){const Xe=le.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),St=Ae?Dm(N,b,Ae,{tileID:je,tileSize:pe},He):wc(N,U),xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(je),at=ae.getMeshFromTileID(Y,je.canonical,!1,!0,"raster");Ne.draw(Y,oe.TRIANGLES,Le,Re,Se,hn.backCCW,St,xt,Xe,A.id,at.vertexBuffer,at.indexBuffer,at.segments)}}(t,0,d,m,y):s.ck(d)&&function(b,T,A,D){const{isRenderingGlobe:z}=D,U=b.context,N=A.implementation,H=b.style.projection,Y=b.transform,oe=Y.getProjectionDataForCustomLayer(z),ae={farZ:Y.farZ,nearZ:Y.nearZ,fov:Y.fov*Math.PI/180,modelViewProjectionMatrix:Y.modelViewProjectionMatrix,projectionMatrix:Y.projectionMatrix,shaderData:{variantName:H.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${H.shaderPreludeCode.vertexSource}`,define:H.shaderDefine},defaultProjectionData:oe},le=N.renderingMode?N.renderingMode:"2d";if(b.renderPass==="offscreen"){const pe=N.prerender;pe&&(b.setCustomLayerDefaults(),U.setColorMode(b.colorModeForRenderPass()),pe.call(N,U.gl,ae),U.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),U.setColorMode(b.colorModeForRenderPass()),U.setStencilMode(an.disabled);const pe=le==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,gn.ReadOnly);U.setDepthMode(pe),N.render(U.gl,ae),U.setDirty(),b.setBaseState(),U.bindFramebuffer.set(null)}}(t,0,d,y))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!a||!d}useProgram(t,a,d=!1,m=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,b=this.style.projection,T=d?ji.projectionMercator:b.shaderPreludeCode,A=d?Da:b.shaderDefine,D=t+(a?a.cacheKey:"")+`/${d?ih:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[D]||(this.cache[D]=new yc(this.context,ji[t],a,op[t],this._showOverdrawInspector,y,T,A,m)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function Fc(_,t){let a,d=!1,m=null,y=null;const b=()=>{m=null,d&&(_.apply(y,a),m=setTimeout(b,t),d=!1)};return(...T)=>(d=!0,y=this,a=T,m||b(),m)}class bl{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const d=a.join("/");let m=d;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${d}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let b=window.location.href.replace(/(#.+)?$/,y);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=Fc(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),b=Math.round(a.lng*y)/y,T=Math.round(a.lat*y)/y,A=this._map.getBearing(),D=this._map.getPitch();let z="";if(z+=t?`/${b}/${T}/${d}`:`${d}/${T}/${b}`,(A||D)&&(z+="/"+Math.round(10*A)/10),D&&(z+=`/${Math.round(D)}`),this._hashName){const U=this._hashName;let N=!1;const H=window.location.hash.slice(1).split("&").map(Y=>{const oe=Y.split("=")[0];return oe===U?(N=!0,`${oe}=${z}`):Y}).filter(Y=>Y);return N||H.push(`${U}=${z}`),`#${H.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new s.S(+t[2],+t[1])}catch{return!1}const a=+t[0],d=+(t[3]||0),m=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&d>=-180&&d<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const Ao={linearity:.3,easing:s.cl(0,0,.3,1)},Co=s.e({deceleration:2500,maxSpeed:1400},Ao),Ph=s.e({deceleration:20,maxSpeed:1400},Ao),wl=s.e({deceleration:1e3,maxSpeed:360},Ao),Ih=s.e({deceleration:1e3,maxSpeed:90},Ao),Mp=s.e({deceleration:1e3,maxSpeed:360},Ao);class Tp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=L.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,a.roll+=y.rollDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const y=Io(a.pan.mag(),d,s.e({},Co,t||{})),b=a.pan.mult(y.amount/a.pan.mag()),T=this._map.cameraHelper.handlePanInertia(b,this._map.transform);m.center=T.easingCenter,m.offset=T.easingOffset,Po(m,y)}if(a.zoom){const y=Io(a.zoom,d,Ph);m.zoom=this._map.transform.zoom+y.amount,Po(m,y)}if(a.bearing){const y=Io(a.bearing,d,wl);m.bearing=this._map.transform.bearing+s.ag(y.amount,-179,179),Po(m,y)}if(a.pitch){const y=Io(a.pitch,d,Ih);m.pitch=this._map.transform.pitch+y.amount,Po(m,y)}if(a.roll){const y=Io(a.roll,d,Mp);m.roll=this._map.transform.roll+s.ag(y.amount,-179,179),Po(m,y)}if(m.zoom||m.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.e(m,{noMoveStart:!0})}}function Po(_,t){(!_.duration||_.duration<t.duration)&&(_.duration=t.duration,_.easing=t.easing)}function Io(_,t,a){const{maxSpeed:d,linearity:m,deceleration:y}=a,b=s.ag(_*m/(t/1e3),-d,d),T=Math.abs(b)/(y*m);return{easing:a.easing,duration:1e3*T,amount:b*(T/2)}}class Dr extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,m={}){d=d instanceof MouseEvent?d:new MouseEvent(t,d);const y=R.mousePos(a.getCanvas(),d),b=a.unproject(y);super(t,s.e({point:y,lngLat:b,originalEvent:d},m)),this._defaultPrevented=!1,this.target=a}}class ls extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const m=t==="touchend"?d.changedTouches:d.touches,y=R.touchPos(a.getCanvasContainer(),m),b=y.map(A=>a.unproject(A)),T=y.reduce((A,D,z,U)=>A.add(D.div(U.length)),new s.P(0,0));super(t,{points:y,point:T,lngLats:b,lngLat:a.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class Rh extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class Ep{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Rh(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Dr(t.type,this._map,t))}mouseup(t){this._map.fire(new Dr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Dr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Dr(t.type,this._map,t))}mouseover(t){this._map.fire(new Dr(t.type,this._map,t))}mouseout(t){this._map.fire(new Dr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ls(t.type,this._map,t))}touchmove(t){this._map.fire(new ls(t.type,this._map,t))}touchend(t){this._map.fire(new ls(t.type,this._map,t))}touchcancel(t){this._map.fire(new ls(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ap{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Dr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Dr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ro{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(s.P.convert(t),this._map.terrain)}}class Lh{constructor(t,a){this._map=t,this._tr=new Ro(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(R.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(m.x,d.x),b=Math.max(m.x,d.x),T=Math.min(m.y,d.y),A=Math.max(m.y,d.y);R.setTransform(this._box,`translate(${y}px,${T}px)`),this._box.style.width=b-y+"px",this._box.style.height=A-T+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const d=this._startPos,m=a;if(this.reset(),R.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new s.l(t,{originalEvent:a}))}}function Oc(_,t){if(_.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${t.length}`);const a={};for(let d=0;d<_.length;d++)a[_[d].identifier]=t[d];return a}class Cp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const y=new s.P(0,0);for(const b of m)y._add(b);return y.div(m.length)}(a),this.touches=Oc(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const m=Oc(d,a);for(const y in this.touches){const b=m[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Nc{constructor(t){this.singleTap=new Cp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const m=this.singleTap.touchend(t,a,d);if(m){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Uc{constructor(t){this._tr=new Ro(t),this._zoomIn=new Nc({numTouches:1,numTaps:2}),this._zoomOut=new Nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const m=this._zoomIn.touchend(t,a,d),y=this._zoomOut.touchend(t,a,d),b=this._tr;return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lo{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const m=Array.isArray(a)?a[0]:a;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&R.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ts=0,cs=2,Pp={[ts]:1,[cs]:2};class Sr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=R.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,d){const m=Pp[d];return a.buttons===void 0||(a.buttons&m)!==m}(t,this._eventButton)}isValidEndEvent(t){return R.mouseButton(t)===this._eventButton}}class Do{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Gm{constructor(t=new Sr({checkCorrectEvent:()=>!0}),a=new Do){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,d){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?d(t):void 0}startMove(t){this._executeRelevantHandler(t,a=>this.mouseMoveStateManager.startMove(a),a=>this.oneFingerTouchMoveStateManager.startMove(a))}endMove(t){this._executeRelevantHandler(t,a=>this.mouseMoveStateManager.endMove(a),a=>this.oneFingerTouchMoveStateManager.endMove(a))}isValidStartEvent(t){return this._executeRelevantHandler(t,a=>this.mouseMoveStateManager.isValidStartEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a))}isValidMoveEvent(t){return this._executeRelevantHandler(t,a=>this.mouseMoveStateManager.isValidMoveEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a))}isValidEndEvent(t){return this._executeRelevantHandler(t,a=>this.mouseMoveStateManager.isValidEndEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a))}}const Bc=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=t=>{t.preventDefault()}};class Hm{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active){if(!this._shouldBePrevented(d.length))return t.preventDefault(),this._calculateTransform(t,a,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const m=Oc(d,a),y=new s.P(0,0),b=new s.P(0,0);let T=0;for(const D in m){const z=m[D],U=this._touches[D];U&&(y._add(z),b._add(z.sub(U)),T++,m[D]=z)}if(this._touches=m,this._shouldBePrevented(T)||!b.mag())return;const A=b.div(T);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){if(!this._firstTwoTouches)return;t.preventDefault();const[m,y]=this._firstTwoTouches,b=Sl(d,a,m),T=Sl(d,a,y);if(!b||!T)return;const A=this._aroundCenter?null:b.add(T).div(2);return this._move([b,T],A,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,b=Sl(d,a,m),T=Sl(d,a,y);b&&T||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sl(_,t,a){for(let d=0;d<_.length;d++)if(_[d].identifier===a)return t[d]}function ko(_,t){return Math.log(_/t)/Math.LN2}class Es extends Dh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ko(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ko(this._distance,d),pinchAround:a}}}function Pt(_,t){return 180*_.angleWith(t)/Math.PI}class kh extends Dh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,d){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pt(this._vector,m),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Pt(t,this._startVector);return Math.abs(d)<a}}function Ml(_){return Math.abs(_.y)>Math.abs(_.x)}class zh extends Dh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,d){super.touchstart(t,a,d),this._currentTouchCount=d.length}_start(t){this._lastPoints=t,Ml(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,d.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=a.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const b=t.y>0==a.y>0;return Ml(t)&&Ml(a)&&b}}const Tl={panStep:100,bearingStep:15,pitchStep:10};class zo{constructor(t){this._tr=new Ro(t);const a=Tl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,m=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:T=>{const A=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Fh,zoom:a?Math.round(A.zoom)+a*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+d*this._bearingStep,pitch:A.pitch+m*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fh(_){return _*(2-_)}const Pn=4.000244140625,Oh=1/450;class Ip{constructor(t,a){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=t,this._tr=new Ro(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Oh}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=L.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Pn==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=R.mousePos(this._map.getCanvas(),t),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(s.S.convert(d.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const T=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Pn?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&A!==0&&(A=1/A);const D=typeof this._targetZoom!="number"?t.scale:s.ae(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),s.aj(D*A)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,d=this._startZoom,m=this._easing;let y,b=!1;if(this._type==="wheel"&&d&&m){const T=L.now()-this._lastWheelEventTime,A=Math.min((T+5)/200,1),D=m(A);y=s.C.number(d,a,D),A<1?this._frameId||(this._frameId=!0):b=!0}else y=a,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!b,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=s.cn;if(this._prevEase){const d=this._prevEase,m=(L.now()-d.start)/d.duration,y=d.easing(m+.01)-d.easing(m),b=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-b*b);a=s.cl(b,T,.25,1)}return this._prevEase={start:L.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vc{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jm{constructor(t){this._tr=new Ro(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $m{constructor(){this._tap=new Nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,d){if(!this._swipePoint)if(this._tapTime){const m=a[0],y=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(m)<30;y&&b?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(t,a,d)}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=a[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(t,a,d);m&&(this._tapTime=t.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nh{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gc{constructor(t,a,d,m){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=d,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Uh{constructor(t,a,d,m){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Rp{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=a,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=d,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const El=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class Wm extends s.l{}function Bh(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class ua{constructor(t,a){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=m.type==="renderFrame"?void 0:m,T={needsRenderFrame:!1},A={},D={};for(const{handlerName:N,handler:H,allowed:Y}of this._handlers){if(!H.isEnabled())continue;let oe;if(this._blockedByActive(D,Y,N))H.reset();else if(H[y||m.type]){if(s.co(m,y||m.type)){const ae=R.mousePos(this._map.getCanvas(),m);oe=H[y||m.type](m,ae)}else if(s.cp(m,y||m.type)){const ae=this._getMapTouches(m.touches),le=R.touchPos(this._map.getCanvas(),ae);oe=H[y||m.type](m,le,ae)}else s.cq(y||m.type)||(oe=H[y||m.type](m));this.mergeHandlerResult(T,A,oe,N,b),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()}(oe||H.isActive())&&(D[N]=H)}const z={};for(const N in this._previousActiveHandlers)D[N]||(z[N]=b);this._previousActiveHandlers=D,(Object.keys(z).length||Bh(T))&&(this._changes.push([T,A,z]),this._triggerRenderFrame()),(Object.keys(D).length||Bh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=T;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,b]of this._listeners)R.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,a,d]of this._listeners)R.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Ep(a,t));const m=a.boxZoom=new Lh(a,t);this._add("boxZoom",m),t.interactive&&t.boxZoom&&m.enable();const y=a.cooperativeGestures=new Rp(a,t.cooperativeGestures);this._add("cooperativeGestures",y),t.cooperativeGestures&&y.enable();const b=new Uc(a),T=new jm(a);a.doubleClickZoom=new Vc(T,b),this._add("tapZoom",b),this._add("clickZoom",T),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const A=new $m;this._add("tapDragZoom",A);const D=a.touchPitch=new zh(a);this._add("touchPitch",D),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const z=()=>a.project(a.getCenter()),U=function({enable:we,clickTolerance:Re,aroundCenter:Le=!0,minPixelCenterThreshold:Se=100,rotateDegreesPerPixelMoved:Ne=.8},qe){const He=new Sr({checkCorrectEvent:je=>R.mouseButton(je)===0&&je.ctrlKey||R.mouseButton(je)===2&&!je.ctrlKey});return new Lo({clickTolerance:Re,move:(je,Xe)=>{const St=qe();if(Le&&Math.abs(St.y-je.y)>Se)return{bearingDelta:s.cm(new s.P(je.x,Xe.y),Xe,St)};let xt=(Xe.x-je.x)*Ne;return Le&&Xe.y<St.y&&(xt=-xt),{bearingDelta:xt}},moveStateManager:He,enable:we,assignEvents:Bc})}(t,z),N=function({enable:we,clickTolerance:Re,pitchDegreesPerPixelMoved:Le=-.5}){const Se=new Sr({checkCorrectEvent:Ne=>R.mouseButton(Ne)===0&&Ne.ctrlKey||R.mouseButton(Ne)===2});return new Lo({clickTolerance:Re,move:(Ne,qe)=>({pitchDelta:(qe.y-Ne.y)*Le}),moveStateManager:Se,enable:we,assignEvents:Bc})}(t),H=function({enable:we,clickTolerance:Re,rollDegreesPerPixelMoved:Le=.3},Se){const Ne=new Sr({checkCorrectEvent:qe=>R.mouseButton(qe)===2&&qe.ctrlKey});return new Lo({clickTolerance:Re,move:(qe,He)=>{const je=Se();let Xe=(He.x-qe.x)*Le;return He.y<je.y&&(Xe=-Xe),{rollDelta:Xe}},moveStateManager:Ne,enable:we,assignEvents:Bc})}(t,z);a.dragRotate=new Gc(t,U,N,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",H,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const Y=function({enable:we,clickTolerance:Re}){const Le=new Sr({checkCorrectEvent:Se=>R.mouseButton(Se)===0&&!Se.ctrlKey});return new Lo({clickTolerance:Re,move:(Se,Ne)=>({around:Ne,panDelta:Ne.sub(Se)}),activateOnStart:!0,moveStateManager:Le,enable:we,assignEvents:Bc})}(t),oe=new Hm(t,a);a.dragPan=new Nh(d,Y,oe),this._add("mousePan",Y),this._add("touchPan",oe,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const ae=new kh,le=new Es;a.touchZoomRotate=new Uh(d,le,ae,A),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const pe=a.scrollZoom=new Ip(a,()=>this._triggerRenderFrame());this._add("scrollZoom",pe,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Ae=a.keyboard=new zo(a);this._add("keyboard",Ae),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Ap(a))}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!El(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,d){for(const m in t)if(m!==d&&(!a||a.indexOf(m)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}mergeHandlerResult(t,a,d,m,y){if(!d)return;s.e(t,d);const b={handlerName:m,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(a.zoom=b),d.panDelta!==void 0&&(a.drag=b),d.rollDelta!==void 0&&(a.roll=b),d.pitchDelta!==void 0&&(a.pitch=b),d.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const t={},a={},d={};for(const[m,y,b]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(t.rollDelta=(t.rollDelta||0)+m.rollDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),s.e(a,y),s.e(d,b);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const m=this._map,y=m._getTransformForUpdate(),b=m.terrain;if(!(Bh(t)||b&&this._terrainMovement))return this._fireEvents(a,d,!0);m._stop(!0);let{panDelta:T,zoomDelta:A,bearingDelta:D,pitchDelta:z,rollDelta:U,around:N,pinchAround:H}=t;H!==void 0&&(N=H),N=N||m.transform.centerPoint,b&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const Y={panDelta:T,zoomDelta:A,rollDelta:U,pitchDelta:z,bearingDelta:D,around:N};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const oe=N.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(T?N.sub(T):N);b?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,y),this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(T))):this._map.cameraHelper.handleMapControlsPan(Y,y,oe):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Y,y,oe))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,y),this._map.cameraHelper.handleMapControlsPan(Y,y,oe)),m._applyUpdatedTransform(y),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const m=El(this._eventsInProgress),y=El(t),b={};for(const U in t){const{originalEvent:N}=t[U];this._eventsInProgress[U]||(b[`${U}start`]=N),this._eventsInProgress[U]=t[U]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const U in b)this._fireEvent(U,b[U]);y&&this._fireEvent("move",y.originalEvent);for(const U in t){const{originalEvent:N}=t[U];this._fireEvent(U,N)}const T={};let A;for(const U in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[U];this._handlersById[N].isActive()||(delete this._eventsInProgress[U],A=a[N]||H,T[`${U}end`]=A)}for(const U in T)this._fireEvent(U,T[U]);const D=El(this._eventsInProgress),z=(m||y)&&!D;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(d&&z){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!U||!U.essential&&L.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:A})),N(this._map.getBearing())&&this._map.resetNorth()):(N(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new s.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Wm("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class yi extends s.E{constructor(t,a,d){super(),this._renderFrameCallback=()=>{const m=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=d.bearingSnap,this.cameraHelper=a,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new s.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,d){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},a),d)}panTo(t,a,d){return this.easeTo(s.e({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(s.e({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new s.l("movestart",a)).fire(new s.l("move",a)).fire(new s.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(s.e({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,s.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=pn.convert(t).adjustAntiMeridian();const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,a)}_cameraForBoxAndBearing(t,a,d,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=s.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const D=m.padding;m.padding={top:D,bottom:D,right:D,left:D}}const b=s.e(y,m.padding);m.padding=b;const T=this.transform,A=new pn(t,a);return this.cameraHelper.cameraForBoxAndBearing(m,b,A,d,T)}fitBounds(t,a,d){return this._fitInternal(this.cameraForBounds(t,a),a,d)}fitScreenCoordinates(t,a,d,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(t)),this.transform.screenPointToLocation(s.P.convert(a)),d,m),m,y)}_fitInternal(t,a,d){return t?(delete(a=s.e(t,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(t,a){this.stop();const d=this._getTransformForUpdate();let m=!1,y=!1,b=!1;const T=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,t);const A=d.zoom!==T;return"elevation"in t&&d.elevation!==+t.elevation&&d.setElevation(+t.elevation),"bearing"in t&&d.bearing!==+t.bearing&&(m=!0,d.setBearing(+t.bearing)),"pitch"in t&&d.pitch!==+t.pitch&&(y=!0,d.setPitch(+t.pitch)),"roll"in t&&d.roll!==+t.roll&&(b=!0,d.setRoll(+t.roll)),t.padding==null||d.isPaddingEqual(t.padding)||d.setPadding(t.padding),this._applyUpdatedTransform(d),this.fire(new s.l("movestart",a)).fire(new s.l("move",a)),A&&this.fire(new s.l("zoomstart",a)).fire(new s.l("zoom",a)).fire(new s.l("zoomend",a)),m&&this.fire(new s.l("rotatestart",a)).fire(new s.l("rotate",a)).fire(new s.l("rotateend",a)),y&&this.fire(new s.l("pitchstart",a)).fire(new s.l("pitch",a)).fire(new s.l("pitchend",a)),b&&this.fire(new s.l("rollstart",a)).fire(new s.l("roll",a)).fire(new s.l("rollend",a)),this.fire(new s.l("moveend",a))}calculateCameraOptionsFromTo(t,a,d,m=0){const y=s.a0.fromLngLat(t,a),b=s.a0.fromLngLat(d,m),T=b.x-y.x,A=b.y-y.y,D=b.z-y.z,z=Math.hypot(T,A,D);if(z===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(T,A),N=s.aj(this.transform.cameraToCenterDistance/z/this.transform.tileSize),H=180*Math.atan2(T,-A)/Math.PI;let Y=180*Math.acos(U/z)/Math.PI;return Y=D<0?90-Y:90+Y,{center:b.toLngLat(),elevation:m,zoom:N,pitch:Y,bearing:H}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,d,m,y){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,a,d,m);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:d,pitch:m,roll:y}}easeTo(t,a){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.cn},t)).animate===!1||!t.essential&&L.prefersReducedMotion)&&(t.duration=0);const d=this._getTransformForUpdate(),m=this.getBearing(),y=d.pitch,b=d.roll,T="bearing"in t?this._normalizeBearing(t.bearing,m):m,A="pitch"in t?+t.pitch:y,D="roll"in t?this._normalizeBearing(t.roll,b):b,z="padding"in t?t.padding:d.padding,U=s.P.convert(t.offset);let N,H;t.around&&(N=s.S.convert(t.around),H=d.locationToScreenPoint(N));const Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},oe=this.cameraHelper.handleEaseTo(d,{bearing:T,pitch:A,roll:D,padding:z,around:N,aroundPoint:H,offsetAsPoint:U,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||m!==T,this._pitching=this._pitching||A!==y,this._rolling=this._rolling||D!==b,this._padding=!d.isPaddingEqual(z),this._zooming=this._zooming||oe.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Y),this.terrain&&this._prepareElevation(oe.elevationCenter),this._ease(ae=>{oe.easeFunc(ae),this.terrain&&!t.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},ae=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,ae)},t),this}_prepareEase(t,a,d={}){this._moving=!0,a||d.moving||this.fire(new s.l("movestart",t)),this._zooming&&!d.zooming&&this.fire(new s.l("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new s.l("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new s.l("pitchstart",t)),this._rolling&&!d.rolling&&this.fire(new s.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(d-(a-(d*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(s.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),d=t.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(d<m){const y=this.calculateCameraOptionsFromTo(a,m,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&a.push(m=>this.transformCameraUpdate(m)),!a.length)return;const d=t.clone();for(const m of a){const y=d.clone(),{center:b,zoom:T,roll:A,pitch:D,bearing:z,elevation:U}=m(y);b&&y.setCenter(b),U!==void 0&&y.setElevation(U),T!==void 0&&y.setZoom(T),A!==void 0&&y.setRoll(A),D!==void 0&&y.setPitch(D),z!==void 0&&y.setBearing(z),d.apply(y)}this.transform.apply(d)}_fireMoveEvents(t){this.fire(new s.l("move",t)),this._zooming&&this.fire(new s.l("zoom",t)),this._rotating&&this.fire(new s.l("rotate",t)),this._pitching&&this.fire(new s.l("pitch",t)),this._rolling&&this.fire(new s.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const d=this._zooming,m=this._rotating,y=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new s.l("zoomend",t)),m&&this.fire(new s.l("rotateend",t)),y&&this.fire(new s.l("pitchend",t)),b&&this.fire(new s.l("rollend",t)),this.fire(new s.l("moveend",t))}flyTo(t,a){if(!t.essential&&L.prefersReducedMotion){const Xe=s.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Xe,a)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cn},t);const d=this._getTransformForUpdate(),m=d.bearing,y=d.pitch,b=d.roll,T=d.padding,A="bearing"in t?this._normalizeBearing(t.bearing,m):m,D="pitch"in t?+t.pitch:y,z="roll"in t?this._normalizeBearing(t.roll,b):b,U="padding"in t?t.padding:d.padding,N=s.P.convert(t.offset);let H=d.centerPoint.add(N);const Y=d.screenPointToLocation(H),oe=this.cameraHelper.handleFlyTo(d,{bearing:A,pitch:D,roll:z,padding:U,locationAtOffset:Y,offsetAsPoint:N,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ae=t.curve;const le=Math.max(d.width,d.height),pe=le/oe.scaleOfZoom,Ae=oe.pixelPathLength;typeof oe.scaleOfMinZoom=="number"&&(ae=Math.sqrt(le/oe.scaleOfMinZoom/Ae*2));const we=ae*ae;function Re(Xe){const St=(pe*pe-le*le+(Xe?-1:1)*we*we*Ae*Ae)/(2*(Xe?pe:le)*we*Ae);return Math.log(Math.sqrt(St*St+1)-St)}function Le(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Se(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const Ne=Re(!1);let qe=function(Xe){return Se(Ne)/Se(Ne+ae*Xe)},He=function(Xe){return le*((Se(Ne)*(Le(St=Ne+ae*Xe)/Se(St))-Le(Ne))/we)/Ae;var St},je=(Re(!0)-Ne)/ae;if(Math.abs(Ae)<2e-6||!isFinite(je)){if(Math.abs(le-pe)<1e-6)return this.easeTo(t,a);const Xe=pe<le?-1:1;je=Math.abs(Math.log(pe/le))/ae,He=()=>0,qe=St=>Math.exp(Xe*ae*St)}return t.duration="duration"in t?+t.duration:1e3*je/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=m!==A,this._pitching=D!==y,this._rolling=z!==b,this._padding=!d.isPaddingEqual(U),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(oe.targetCenter),this._ease(Xe=>{const St=Xe*je,xt=1/qe(St),at=He(St);this._rotating&&d.setBearing(s.C.number(m,A,Xe)),this._pitching&&d.setPitch(s.C.number(y,D,Xe)),this._rolling&&d.setRoll(s.C.number(b,z,Xe)),this._padding&&(d.interpolatePadding(T,U,Xe),H=d.centerPoint.add(N)),oe.easeFunc(Xe,xt,at,H),this.terrain&&!t.freezeElevation&&this._updateElevation(Xe),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,a)}return t||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=L.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=s.aN(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.S.convert(t),this.transform.tileZoom):null}}const Al={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Hc{constructor(t=Al){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const d=this._map._getUIString(`AttributionControl.${a}`);t.title=d,t.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style.sourceCaches;for(const m in a){const y=a[m];if(y.used||y.usedForTerrain){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(m)>=0)return!1;return!0});const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=R.sanitize(d),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vh{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const a=R.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Lp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Dp=s.aI([{name:"a_pos3d",type:"Int16",components:3}]);class qm extends s.E{constructor(t){super(),this._lastTilesetChange=L.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const d={};for(const m of Ee(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),s.bX(m.terrainRttPosMatrix32f,0,s.$,s.$,0,0,1),this._tiles[m.key]=new At(m,this.tileSize),this._lastTilesetChange=L.now());for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(t){for(const a in this._tiles){const d=this._tiles[a];(!t||d.tileID.equals(t)||d.tileID.isChildOf(t)||t.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID,y=t.clone(),b=s.b9();if(m.canonical.equals(t.canonical))s.bX(b,0,s.$,s.$,0,0,1);else if(m.canonical.isChildOf(t.canonical)){const T=m.canonical.z-t.canonical.z,A=m.canonical.x-(m.canonical.x>>T<<T),D=m.canonical.y-(m.canonical.y>>T<<T),z=s.$>>T;s.bX(b,0,z,z,0,0,1),s.M(b,b,[-A*z,-D*z,0])}else{if(!t.canonical.isChildOf(m.canonical))continue;{const T=t.canonical.z-m.canonical.z,A=t.canonical.x-(t.canonical.x>>T<<T),D=t.canonical.y-(t.canonical.y>>T<<T),z=s.$>>T;s.bX(b,0,s.$,s.$,0,0,1),s.M(b,b,[A*z,D*z,0]),s.N(b,b,[1/2**T,1/2**T,0])}}y.terrainRttPosMatrix32f=new Float32Array(b),a[d]=y}return a}_getTerrainCoordsForTileRanges(t,a){const d={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID;if(!this._isWithinTileRanges(y,a))continue;const b=t.clone(),T=s.b9();if(y.canonical.z===t.canonical.z){const A=t.canonical.x-y.canonical.x,D=t.canonical.y-y.canonical.y;s.bX(T,0,s.$,s.$,0,0,1),s.M(T,T,[A*s.$,D*s.$,0])}else if(y.canonical.z>t.canonical.z){const A=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>A<<A),z=y.canonical.y-(y.canonical.y>>A<<A),U=t.canonical.x-(y.canonical.x>>A),N=t.canonical.y-(y.canonical.y>>A),H=s.$>>A;s.bX(T,0,H,H,0,0,1),s.M(T,T,[-D*H+U*s.$,-z*H+N*s.$,0])}else{const A=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>A<<A),z=t.canonical.y-(t.canonical.y>>A<<A),U=(t.canonical.x>>A)-y.canonical.x,N=(t.canonical.y>>A)-y.canonical.y,H=s.$<<A;s.bX(T,0,H,H,0,0,1),s.M(T,T,[D*s.$+U*H,z*s.$+N*H,0])}b.terrainRttPosMatrix32f=new Float32Array(T),d[m]=b}return d}getSourceTile(t,a){const d=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!y||!y.dem)&&a)for(;m>=d.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(t.scaledTo(m--).key);return y}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class As{constructor(t,a,d){this._meshCache={},this.painter=t,this.sourceCache=new qm(a),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,d,m=s.$){var y;if(!(a>=0&&a<m&&d>=0&&d<m))return 0;const b=this.getTerrainData(t),T=(y=b.tile)===null||y===void 0?void 0:y.dem;if(!T)return 0;const A=s.cr([],[a/m*s.$,d/m*s.$],b.u_terrain_matrix),D=[A[0]*T.dim,A[1]*T.dim],z=Math.floor(D[0]),U=Math.floor(D[1]),N=D[0]-z,H=D[1]-U;return T.get(z,U)*(1-N)*(1-H)+T.get(z+1,U)*N*(1-H)+T.get(z,U+1)*(1-N)*H+T.get(z+1,U+1)*N*H}getElevationForLngLatZoom(t,a){if(!s.cs(a,t.wrap()))return 0;const{tileID:d,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(d,m%s.$,y%s.$,s.$)}getElevation(t,a,d,m=s.$){return this.getDEMElevation(t,a,d,m)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.painter.context,y=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(m,new s.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.af([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const m=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new s.T(m,a.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),a.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const d=a&&a+a.tileID.key+t.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?y=t.canonical.z-m:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>y<<y),T=t.canonical.y-(t.canonical.y>>y<<y),A=s.ct(new Float64Array(16),[1/(s.$<<y),1/(s.$<<y),0]);s.M(A,A,[b*s.$,T*s.$,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,d=a.width/devicePixelRatio,m=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(a.context,{width:d,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(a.context,{width:d,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,b=0;y<this._coordsTextureSize;y++)for(let T=0;T<this._coordsTextureSize;T++,b+=4)a[b+0]=255&T,a[b+1]=255&y,a[b+2]=T>>8<<4|y>>8,a[b+3]=0;const d=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),m=new s.T(t,d,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),d=this.painter.context,m=d.gl,y=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,T-b-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),d.bindFramebuffer.set(null);const A=a[0]+(a[2]>>4<<8),D=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],U=z&&this.sourceCache.getTileByID(z);if(!U)return null;const N=this._coordsTextureSize,H=(1<<U.tileID.canonical.z)*N;return new s.a0((U.tileID.canonical.x*N+A)/H+U.tileID.wrap,(U.tileID.canonical.y*N+D)/H,this.getElevation(U.tileID,A,D,N))}depthAtPoint(t){const a=new Uint8Array(4),d=this.painter.context,m=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),d.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const d=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,m=d&&t.canonical.y===0,y=d&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${m?"n":""}_${y?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const T=this.painter.context,A=new s.cu,D=new s.aM,z=this.meshSize,U=s.$/z,N=z*z;for(let Se=0;Se<=z;Se++)for(let Ne=0;Ne<=z;Ne++)A.emplaceBack(Ne*U,Se*U,0);for(let Se=0;Se<N;Se+=z+1)for(let Ne=0;Ne<z;Ne++)D.emplaceBack(Ne+Se,z+Ne+Se+1,z+Ne+Se+2),D.emplaceBack(Ne+Se,z+Ne+Se+2,Ne+Se+1);const H=A.length,Y=H+(z+1),oe=(z+1)*z,ae=m?s.bg:0,le=m?0:1,pe=y?s.bh:s.$,Ae=y?0:1;for(let Se=0;Se<=z;Se++)A.emplaceBack(Se*U,ae,le);for(let Se=0;Se<=z;Se++)A.emplaceBack(Se*U,pe,Ae);for(let Se=0;Se<z;Se++)D.emplaceBack(oe+Se,Y+Se,Y+Se+1),D.emplaceBack(oe+Se,Y+Se+1,oe+Se+1),D.emplaceBack(0+Se,H+Se+1,H+Se),D.emplaceBack(0+Se,0+Se+1,H+Se+1);const we=A.length,Re=we+2*(z+1);for(const Se of[0,1])for(let Ne=0;Ne<=z;Ne++)for(const qe of[0,1])A.emplaceBack(Se*s.$,Ne*U,qe);for(let Se=0;Se<2*z;Se+=2)D.emplaceBack(we+Se,we+Se+1,we+Se+3),D.emplaceBack(we+Se,we+Se+3,we+Se+2),D.emplaceBack(Re+Se,Re+Se+3,Re+Se+1),D.emplaceBack(Re+Se,Re+Se+2,Re+Se+3);const Le=new zs(T.createVertexBuffer(A,Dp.members),T.createIndexBuffer(D),s.aL.simpleSegment(0,0,A.length,D.length));return this._meshCache[b]=Le,Le}getMeshFrameDelta(t){return 2*Math.PI*s.bt/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,d={minElevation:null,maxElevation:null};return a&&a.dem&&(d.minElevation=a.dem.min*this.exaggeration,d.maxElevation=a.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(t,a){const d=s.a0.fromLngLat(t.wrap()),m=(1<<a)*s.$,y=d.x*m,b=d.y*m,T=Math.floor(y/s.$),A=Math.floor(b/s.$);return{tileID:new s.Z(a,0,a,T,A),mercatorX:y,mercatorY:b}}}class jc{constructor(t,a,d){this._context=t,this._size=a,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(d.texture),{id:t,fbo:a,texture:d,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ft={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class rn{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new jc(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(d=>!t._layers[d].isHidden(a)),this._coordsAscending={};for(const d in t.sourceCaches){this._coordsAscending[d]={};const m=t.sourceCaches[d].getVisibleCoordinates(),y=t.sourceCaches[d].getSource(),b=y instanceof Tn?y.terrainTileRanges:null;for(const T of m){const A=this.terrain.sourceCache.getTerrainCoords(T,b);for(const D in A)this._coordsAscending[d][D]||(this._coordsAscending[d][D]=[]),this._coordsAscending[d][D].push(A[D])}}this._coordsAscendingStr={};for(const d of t._order){const m=t._layers[d],y=m.source;if(Ft[m.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const b in this._coordsAscending[y])this._coordsAscendingStr[y][b]=this._coordsAscending[y][b].map(T=>T.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsAscendingStr){const y=this._coordsAscendingStr[m][d.tileID.key];y&&y!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),m=t.type,y=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ft[m]&&(this._prevType&&Ft[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(Ft[this._prevType]||Ft[m]&&b){this._prevType=m;const T=this._stacks.length-1,A=this._stacks[T]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(Ti(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[T]){const U=this.pool.getObjectForId(D.rtt[T].id);if(U.stamp===D.rtt[T].stamp){this.pool.useObject(U);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[T]={id:z.id,stamp:z.stamp},y.context.bindFramebuffer.set(z.fbo.framebuffer),y.context.clear({color:s.be.transparent,stencil:0}),y.currentStencilSource=void 0;for(let U=0;U<A.length;U++){const N=y.style._layers[A[U]],H=N.source?this._coordsAscending[N.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),y._renderTileClippingMasks(N,H,!0),y.renderLayer(y,y.style.sourceCaches[N.source],N,H,d),N.source&&(D.rttCoords[N.source]=this._coordsAscendingStr[N.source][D.tileID.key])}}return Ti(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),Ft[m]}return!1}}const $c={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=S,Cl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Al,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Mr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class kp{constructor(t,a,d=!1){this.mousedown=y=>{this.startMove(y,R.mousePos(this.element,y)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,R.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHanlder.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const m=new Gm;this._rotatePitchHanlder=new Lo({clickTolerance:3,move:(y,b)=>{const T=a.getBoundingClientRect(),A=new s.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:s.cm(new s.P(y.x,b.y),b,A),pitchDelta:d?-.5*(b.y-y.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=t,R.addEventListener(a,"mousedown",this.mousedown),R.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHanlder.dragStart(t,a),R.disableDrag()}move(t,a){const d=this.map,{bearingDelta:m,pitchDelta:y}=this._rotatePitchHanlder.dragMove(t,a)||{};m&&d.setBearing(d.getBearing()+m),y&&d.setPitch(d.getPitch()+y)}off(){const t=this.element;R.removeEventListener(t,"mousedown",this.mousedown),R.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let tr;function zp(_,t,a,d=!1){if(d||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const m=new s.S(_.lng,_.lat);if(_=new s.S(_.lng,_.lat),t){const y=new s.S(_.lng-360,_.lat),b=new s.S(_.lng+360,_.lat),T=a.locationToScreenPoint(_).distSqr(t);a.locationToScreenPoint(y).distSqr(t)<T?_=y:a.locationToScreenPoint(b).distSqr(t)<T&&(_=b)}for(;Math.abs(_.lng-a.center.lng)>180;){const y=a.locationToScreenPoint(_);if(y.x>=0&&y.y>=0&&y.x<=a.width&&y.y<=a.height)break;_.lng>a.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(_))?_:m}const Va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bi(_,t,a){const d=_.classList;for(const m in Va)d.remove(`maplibregl-${a}-anchor-${m}`);d.add(`maplibregl-${a}-anchor-${t}`)}class Ei extends s.E{constructor(t){if(super(),this._onKeyPress=a=>{const d=a.code,m=a.charCode||a.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=a=>{const d=a.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=zp(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Va[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${m}`),L.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div");const a=R.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${d}px`),a.setAttributeNS(null,"width",`${m}px`),a.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const b=R.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const T=R.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of A){const pe=R.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",le.rx),pe.setAttributeNS(null,"ry",le.ry),T.appendChild(pe)}const D=R.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const z=R.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(z);const U=R.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const N=R.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(N);const H=R.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const Y=R.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=R.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const ae=R.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),Y.appendChild(oe),Y.appendChild(ae),b.appendChild(T),b.appendChild(D),b.appendChild(U),b.appendChild(H),b.appendChild(Y),a.appendChild(b),a.setAttributeNS(null,"height",d*this._scale+"px"),a.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(a),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),bi(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,d;const m=(a=this._map)===null||a===void 0?void 0:a.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!m||y){const H=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==H&&(this._element.style.opacity=H))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,T=b.terrain.depthAtPoint(this._pos),A=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,A)-T<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/b.transform.pixelsPerMeter,z=Math.sin(b.getPitch()*Math.PI/180)*D,U=b.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),N=b.transform.lngLatToCameraDepth(this._lngLat,A+z)-U>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Fp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ha=0,da=!1;const Hh={maxWidth:100,unit:"metric"};function Wc(_,t,a){const d=a&&a.maxWidth||100,m=_._container.clientHeight/2,y=_._container.clientWidth/2,b=_.unproject([y-d/2,m]),T=_.unproject([y+d/2,m]),A=Math.round(_.project(T).x-_.project(b).x),D=Math.min(d,A,_._container.clientWidth),z=b.distanceTo(T);if(a&&a.unit==="imperial"){const U=3.2808*z;U>5280?Ga(t,D,U/5280,_._getUIString("ScaleControl.Miles")):Ga(t,D,U,_._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ga(t,D,z/1852,_._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Ga(t,D,z/1e3,_._getUIString("ScaleControl.Kilometers")):Ga(t,D,z,_._getUIString("ScaleControl.Meters"))}function Ga(_,t,a,d){const m=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/b;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(T),b*T}(a);_.style.width=t*(m/a)+"px",_.innerHTML=`${m}&nbsp;${d}`}const Pl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},jh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qc(_){if(_){if(typeof _=="number"){const t=Math.round(Math.abs(_)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,_),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-_),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(_,0),right:new s.P(-_,0)}}if(_ instanceof s.P||Array.isArray(_)){const t=s.P.convert(_);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(_.center||[0,0]),top:s.P.convert(_.top||[0,0]),"top-left":s.P.convert(_["top-left"]||[0,0]),"top-right":s.P.convert(_["top-right"]||[0,0]),bottom:s.P.convert(_.bottom||[0,0]),"bottom-left":s.P.convert(_["bottom-left"]||[0,0]),"bottom-right":s.P.convert(_["bottom-right"]||[0,0]),left:s.P.convert(_.left||[0,0]),right:s.P.convert(_.right||[0,0])}}return qc(new s.P(0,0))}const $h=S;p.AJAXError=s.cy,p.Event=s.l,p.Evented=s.E,p.LngLat=s.S,p.MercatorCoordinate=s.a0,p.Point=s.P,p.addProtocol=s.cz,p.config=s.a,p.removeProtocol=s.cA,p.AttributionControl=Hc,p.BoxZoomHandler=Lh,p.CanvasSource=ve,p.CooperativeGesturesHandler=Rp,p.DoubleClickZoomHandler=Vc,p.DragPanHandler=Nh,p.DragRotateHandler=Gc,p.EdgeInsets=Kr,p.FullscreenControl=class extends s.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a==null?void 0:a.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},p.GeoJSONSource=Zt,p.GeolocateControl=class extends s.E{constructor(_){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new s.S(t.coords.longitude,t.coords.latitude),d=t.coords.accuracy,m=this._map.getBearing(),y=s.e({bearing:m},this.options.fitBoundsOptions),b=pn.fromLngLat(a,d);this._map.fitBounds(b,y,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new s.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&da)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ei({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ei({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},Fp,_)}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(t=!1){if(tr!==void 0&&!t)return tr;if(window.navigator.permissions===void 0)return tr=!!window.navigator.geolocation,tr;try{tr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{tr=!!window.navigator.geolocation}return tr})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ha=0,da=!1}_isOutOfMapMaxBounds(_){const t=this._map.getMaxBounds(),a=_.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),t=_.getSouthEast(),a=_.getNorthEast(),d=t.distanceTo(a),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ha--,da=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ha++,ha>1?(_={maximumAge:6e5,timeout:0},da=!0):(_=this.options.positionOptions,da=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},p.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const t=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=R.create("button","maplibregl-ctrl-globe",this._container),R.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},p.Hash=bl,p.ImageSource=Tn,p.KeyboardHandler=zo,p.LngLatBounds=pn,p.LogoControl=Vh,p.Map=class extends yi{constructor(_){var t,a;s.cv.mark(s.cw.create);const d=Object.assign(Object.assign(Object.assign({},Cl),_),{canvasContextAttributes:Object.assign(Object.assign({},Cl.canvasContextAttributes),_.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new zi,y=new gc;if(d.minZoom!==void 0&&m.setMinZoom(d.minZoom),d.maxZoom!==void 0&&m.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&m.setMinPitch(d.minPitch),d.maxPitch!==void 0&&m.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&m.setRenderWorldCopies(d.renderWorldCopies),super(m,y,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Lp,this._controls=[],this._mapId=s.a6(),this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$c),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Q.addThrottleControl(()=>this.isMoving()),this._requestManager=new de(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const A=Fc(D=>{this._trackResize&&!this._removed&&(this.resize(D),this.redraw())},50);this._resizeObserver=new ResizeObserver(D=>{T?A(D):T=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ua(this,d),this._hash=d.hash&&new bl(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.e({},d.fitBoundsOptions,{duration:0}))));const b=typeof d.style=="string"||((a=(t=d.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Hc(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Vh,d.logoPosition),this.on("style.load",()=>{if(b||this._resizeTransform(),this.transform.unmodified){const T=s.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}}),this.on("data",T=>{this._update(T.dataType==="style"),this.fire(new s.l(`${T.dataType}data`,T))}),this.on("dataloading",T=>{this.fire(new s.l(`${T.dataType}dataloading`,T))}),this.on("dataabort",T=>{this.fire(new s.l("sourcedataabort",T))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,t){return this.style.setGlobalStateProperty(_,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,t){if(t===void 0&&(t=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(_);return t>-1&&this._controls.splice(t,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,t,a,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,t,a,d)}resize(_,t=!0){const[a,d]=this._containerDimensions(),m=this._getClampedPixelRatio(a,d);if(this._resizeCanvas(a,d,m),this.painter.resize(a,d,m),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const T=this._getClampedPixelRatio(a,d);this._resizeCanvas(a,d,T),this.painter.resize(a,d,T)}this._resizeTransform(t);const y=!this._moving;return y&&(this.stop(),this.fire(new s.l("movestart",_)).fire(new s.l("move",_))),this.fire(new s.l("resize",_)),y&&this.fire(new s.l("moveend",_)),this}_resizeTransform(_=!0){var t;const[a,d]=this._containerDimensions();this.transform.resize(a,d,_),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,d,_)}_getClampedPixelRatio(_,t){const{0:a,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),y=_*m,b=t*m;return Math.min(y>a?a/y:1,b>d?d/b:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(pn.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(s.S.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(s.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,t,a){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layers:t,listener:a,delegates:{mousemove:y=>{const b=t.filter(A=>this.getLayer(A)),T=b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[];T.length?d||(d=!0,a.call(this,new Dr(_,this,y.originalEvent,{features:T}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const T=t.filter(A=>this.getLayer(A));(T.length!==0?this.queryRenderedFeatures(b.point,{layers:T}):[]).length?d=!0:d&&(d=!1,a.call(this,new Dr(_,this,b.originalEvent)))},mouseout:b=>{d&&(d=!1,a.call(this,new Dr(_,this,b.originalEvent)))}}}}{const d=m=>{const y=t.filter(T=>this.getLayer(T)),b=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length&&(m.features=b,a.call(this,m),delete m.features)};return{layers:t,listener:a,delegates:{[_]:d}}}}_saveDelegatedListener(_,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(t)}_removeDelegatedListener(_,t,a){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const d=this._delegatedListeners[_];for(let m=0;m<d.length;m++){const y=d[m];if(y.listener===a&&y.layers.length===t.length&&y.layers.every(b=>t.includes(b))){for(const b in y.delegates)this.off(b,y.delegates[b]);return void d.splice(m,1)}}}on(_,t,a){if(a===void 0)return super.on(_,t);const d=typeof t=="string"?[t]:t,m=this._createDelegatedListener(_,d,a);this._saveDelegatedListener(_,m);for(const y in m.delegates)this.on(y,m.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,d,a)}}}once(_,t,a){if(a===void 0)return super.once(_,t);const d=typeof t=="string"?[t]:t,m=this._createDelegatedListener(_,d,a);for(const y in m.delegates){const b=m.delegates[y];m.delegates[y]=(...T)=>{this._removeDelegatedListener(_,d,a),b(...T)}}this._saveDelegatedListener(_,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(_,t,a){return a===void 0?super.off(_,t):(this._removeDelegatedListener(_,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(_,t){if(!this.style)return[];let a;const d=_ instanceof s.P||Array.isArray(_),m=d?_:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(d?{}:_)||{},m instanceof s.P||typeof m[0]=="number")a=[s.P.convert(m)];else{const y=s.P.convert(m[0]),b=s.P.convert(m[1]);a=[y,new s.P(b.x,y.y),b,new s.P(y.x,b.y),y]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(_,t){return this.style.querySourceFeatures(_,t)}setStyle(_,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(_,t))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const t=this._locale[_];if(t==null)throw new Error(`Missing UI string '${_}'`);return t}_updateStyle(_,t){var a,d;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,t));const m=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new ch(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,t,m):this.style.loadJSON(_,t,m),this):((d=(a=this.style)===null||a===void 0?void 0:a.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ch(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,t){if(typeof _=="string"){const a=this._requestManager.transformRequest(_,"Style");s.j(a,new AbortController).then(d=>{this._updateDiff(d.data,t)}).catch(d=>{d&&this.fire(new s.k(d))})}else typeof _=="object"&&this._updateDiff(_,t)}_updateDiff(_,t){try{this.style.setState(_,t)&&this._update(!0)}catch(a){s.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(_,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(_,t){return this._lazyInitEmptyStyle(),this.style.addSource(_,t),this._update(!0)}isSourceLoaded(_){const t=this.style&&this.style.sourceCaches[_];if(t!==void 0)return t.loaded();this.fire(new s.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const t=this.style.sourceCaches[_.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const d=this.style._layers[a];d.type==="hillshade"&&d.source===_.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),d.type==="color-relief"&&d.source===_.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new As(this.painter,t,_),this.painter.renderToTexture=new rn(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var d;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((d=a.source)===null||d===void 0?void 0:d.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:_})),this}getTerrain(){var _,t;return(t=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const t in _){const a=_[t]._tiles;for(const d in a){const m=a[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,t,a){if(a){const d=this.getSource(a);if(!d)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);d.calculateTileZoom=ne(Math.max(1,_),Math.max(1,t))}else for(const d in this.style.sourceCaches)this.style.sourceCaches[d].getSource().calculateTileZoom=ne(Math.max(1,_),Math.max(1,t));return this._update(!0),this}refreshTiles(_,t){const a=this.style.sourceCaches[_];if(!a)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map(d=>new s.a3(d.z,d.x,d.y)))}addImage(_,t,a={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:y,stretchY:b,content:T,textFitWidth:A,textFitHeight:D}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:U,data:N}=t,H=t;return this.style.addImage(_,{data:new s.R({width:z,height:U},new Uint8Array(N)),pixelRatio:d,stretchX:y,stretchY:b,content:T,textFitWidth:A,textFitHeight:D,sdf:m,version:0,userImage:H}),H.onAdd&&H.onAdd(this,_),this}}{const{width:z,height:U,data:N}=L.getImageData(t);this.style.addImage(_,{data:new s.R({width:z,height:U},N),pixelRatio:d,stretchX:y,stretchY:b,content:T,textFitWidth:A,textFitHeight:D,sdf:m,version:0})}}updateImage(_,t){const a=this.style.getImage(_);if(!a)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||s.b(t)?L.getImageData(t):t,{width:m,height:y,data:b}=d;if(m===void 0||y===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==a.data.width||y!==a.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(t instanceof HTMLImageElement||s.b(t));return a.data.replace(b,T),this.style.updateImage(_,a),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return Q.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,t){return this._lazyInitEmptyStyle(),this.style.addLayer(_,t),this._update(!0)}moveLayer(_,t){return this.style.moveLayer(_,t),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,t,a){return this.style.setLayerZoomRange(_,t,a),this._update(!0)}setFilter(_,t,a={}){return this.style.setFilter(_,t,a),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,t,a,d={}){return this.style.setPaintProperty(_,t,a,d),this._update(!0)}getPaintProperty(_,t){return this.style.getPaintProperty(_,t)}setLayoutProperty(_,t,a,d={}){return this.style.setLayoutProperty(_,t,a,d),this._update(!0)}getLayoutProperty(_,t){return this.style.getLayoutProperty(_,t)}setGlyphs(_,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,t,a,d=>{d||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,t,a=>{a||this._update(!0)}),this}setLight(_,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,t){return this.style.setFeatureState(_,t),this._update()}removeFeatureState(_,t){return this.style.removeFeatureState(_,t),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,t=0;return this._container&&(_=this._container.clientWidth||400,t=this._container.clientHeight||300),[_,t]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const t=this._canvasContainer=R.create("div","maplibregl-canvas-container",_);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),d=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],d);const m=this._controlContainer=R.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=R.create("div",`maplibregl-ctrl-${b} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,t,a){this._canvas.width=Math.floor(a*_),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{t={requestedAttributes:_},d&&(t.statusMessage=d.statusMessage,t.type=d.type)},{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!a){const d="Failed to initialize WebGL";throw t?(t.message=d,new Error(JSON.stringify(t))):new Error(d)}this.painter=new es(a,this.transform),B.testSupport(a)}migrateProjection(_,t){super.migrateProjection(_,t),this.painter.transform=_,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var t,a,d,m,y;const b=this._idleTriggered?this._fadeDuration:0,T=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,N=L.now();this.style.zoomHistory.update(U,N);const H=new s.F(U,{now:N,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Y=H.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(A=!0,this._crossFadingFactor=Y),this.style.update(H)}const D=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==T;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||D)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,D),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cv.mark(s.cw.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,s.cv.mark(s.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Q.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cv.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frame(this._frameRequest,_=>{s.cv.frame(_),this._frameRequest=null;try{this._render(_)}catch(t){if(!s.cx(t)&&!function(a){return a.message===Mh}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},p.MapMouseEvent=Dr,p.MapTouchEvent=ls,p.MapWheelEvent=Rh,p.Marker=Ei,p.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),d=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const d=this._map._getUIString(`NavigationControl.${a}`);t.title=d,t.setAttribute("aria-label",d)},this.options=s.e({},Mr,_),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,t){const a=R.create("button",_,this._container);return a.type="button",a.addEventListener("click",t),a}},p.Popup=class extends s.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=zp(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const m=qc(this.options.offset);if(!d){const b=this._container.offsetWidth,T=this._container.offsetHeight;let A;A=a.y+m.bottom.y<T?["top"]:a.y>this._map.transform.height-T?["bottom"]:[],a.x<b/2?A.push("left"):a.x>this._map.transform.width-b/2&&A.push("right"),d=A.length===0?"bottom":A.join("-")}let y=a.add(m[d]);this.options.subpixelPositioning||(y=y.round()),R.setTransform(this._container,`${Va[d]} translate(${y.x}px,${y.y}px)`),bi(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Pl),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=s.S.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const t=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=_;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(jh);_&&_.focus()}},p.RasterDEMTileSource=cn,p.RasterTileSource=bn,p.ScaleControl=class{constructor(_){this._onMove=()=>{Wc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Wc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Hh),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},p.ScrollZoomHandler=Ip,p.Style=ch,p.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},p.TwoFingersTouchPitchHandler=zh,p.TwoFingersTouchRotateHandler=kh,p.TwoFingersTouchZoomHandler=Es,p.TwoFingersTouchZoomRotateHandler=Uh,p.VectorTileSource=gi,p.VideoSource=Yt,p.addSourceType=(_,t)=>s._(void 0,void 0,void 0,function*(){if(Ze(_))throw new Error(`A source type called "${_}" already exists.`);((a,d)=>{te[a]=d})(_,t)}),p.clearPrewarmedResources=function(){const _=Rn;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Ut),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},p.createTileMesh=ah,p.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},p.getRTLTextPluginStatus=function(){return Vt().getRTLTextPluginStatus()},p.getVersion=function(){return $h},p.getWorkerCount=function(){return Wt.workerCount},p.getWorkerUrl=function(){return s.a.WORKER_URL},p.importScriptInWorkers=function(_){return Rt().broadcast("IS",_)},p.prewarm=function(){Tt().acquire(Ut)},p.setMaxParallelImageRequests=function(_){s.a.MAX_PARALLEL_IMAGE_REQUESTS=_},p.setRTLTextPlugin=function(_,t){return Vt().setRTLTextPlugin(_,t)},p.setWorkerCount=function(_){Wt.workerCount=_},p.setWorkerUrl=function(_){s.a.WORKER_URL=_}});var f=n;return f})}(zf)),zf.exports}var bT=xT();const Qt=E1(bT);function wT(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ST{constructor(){this._apiKey="",this._fetch=wT(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const Cu=new ST,MT={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},TT={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},jd={...MT,...TT};function ET(c,e=jd){return c in e?c[c]:null}function R_(c,e=jd){for(const n of Object.values(e))if(n.code===c)return n;return null}function L_(c,e=jd){for(const n of Object.values(e))if(n.flag===c)return n;return null}function AT(c){return c!==null&&typeof c=="object"&&"code"in c&&"flag"in c&&"name"in c&&"latin"in c&&"isMode"in c&&"geocoding"in c&&(typeof c.code=="string"||c.code===null)&&typeof c.flag=="string"&&typeof c.name=="string"&&typeof c.latin=="boolean"&&typeof c.isMode=="boolean"&&typeof c.geocoding=="boolean"}function mx(c,e=jd){return AT(c)?L_(c.flag,e):typeof c!="string"?null:ET(c,e)||R_(c,e)||L_(c,e)||null}async function CT(c,e={}){if(Cu.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(c).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Cu.fetch(c,e)}const C1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(C1);class PT extends Error{constructor(e,n=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${n}`),this.res=e}}const gx={403:"Key is missing, invalid or restricted"};async function IT(c={}){const e=new URL("geolocation/ip.json",C1.maptilerApiURL);e.searchParams.set("key",c.apiKey??Cu.apiKey);const n=e.toString(),r=await CT(n);if(!r.ok)throw new PT(r,r.status in gx?gx[r.status]:"");return await r.json()}const _x={info:IT};function P1(c){const e=/^maptiler:\/\/(.*)/;let n;const r=c.trim();let u;return r.startsWith("http://")||r.startsWith("https://")?u=r:(n=e.exec(r))!==null?u=`https://api.maptiler.com/maps/${n[1]}/style.json`:u=`https://api.maptiler.com/maps/${r}/style.json`,u}class I1{constructor(e,n,r,u,f,p,s=!1){this.name=e,this.variantType=n,this.id=r,this.referenceStyle=u,this.description=f,this.imageURL=p,this.deprecated=s}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){const n=this.referenceStyle.getVariant(e);return this.warnIfDeprecated(n),n}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this).map(e=>(this.warnIfDeprecated(e),e))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return P1(this.getId())}warnIfDeprecated(e=this){if(!e.deprecated)return e;const n=e.getFullName();return console.warn(`Style "${n}" is deprecated and will be removed in a future version.`),e}}class R1{constructor(e,n){this.name=e,this.id=n,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const Td=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function RT(c){return new Proxy(c,{get(e,n,r){return e.hasVariant(n)?e.getVariant(n):n.toString().toUpperCase()===n?c.getDefaultVariant():Reflect.get(e,n,r)}})}function LT(){const c={};for(let e=0;e<Td.length;e+=1){const n=Td[e],r=RT(new R1(n.name,n.referenceStyleID));for(let u=0;u<n.variants.length;u+=1){const f=n.variants[u],p=new I1(f.name,f.variantType,f.id,r,f.description,f.imageURL,f.deprecated);r.addVariant(p)}c[n.referenceStyleID]=r}return c}const Pu=LT();var tf={exports:{}},yx;function DT(){if(yx)return tf.exports;yx=1;var c=typeof Reflect=="object"?Reflect:null,e=c&&typeof c.apply=="function"?c.apply:function(de,fe,ye){return Function.prototype.apply.call(de,fe,ye)},n;c&&typeof c.ownKeys=="function"?n=c.ownKeys:Object.getOwnPropertySymbols?n=function(de){return Object.getOwnPropertyNames(de).concat(Object.getOwnPropertySymbols(de))}:n=function(de){return Object.getOwnPropertyNames(de)};function r(Q){console&&console.warn&&console.warn(Q)}var u=Number.isNaN||function(de){return de!==de};function f(){f.init.call(this)}tf.exports=f,tf.exports.once=O,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var p=10;function s(Q){if(typeof Q!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Q)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(Q){if(typeof Q!="number"||Q<0||u(Q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Q+".");p=Q}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(de){if(typeof de!="number"||de<0||u(de))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+de+".");return this._maxListeners=de,this};function S(Q){return Q._maxListeners===void 0?f.defaultMaxListeners:Q._maxListeners}f.prototype.getMaxListeners=function(){return S(this)},f.prototype.emit=function(de){for(var fe=[],ye=1;ye<arguments.length;ye++)fe.push(arguments[ye]);var ke=de==="error",ce=this._events;if(ce!==void 0)ke=ke&&ce.error===void 0;else if(!ke)return!1;if(ke){var ie;if(fe.length>0&&(ie=fe[0]),ie instanceof Error)throw ie;var Oe=new Error("Unhandled error."+(ie?" ("+ie.message+")":""));throw Oe.context=ie,Oe}var nt=ce[de];if(nt===void 0)return!1;if(typeof nt=="function")e(nt,this,fe);else for(var Je=nt.length,ut=B(nt,Je),ye=0;ye<Je;++ye)e(ut[ye],this,fe);return!0};function M(Q,de,fe,ye){var ke,ce,ie;if(s(fe),ce=Q._events,ce===void 0?(ce=Q._events=Object.create(null),Q._eventsCount=0):(ce.newListener!==void 0&&(Q.emit("newListener",de,fe.listener?fe.listener:fe),ce=Q._events),ie=ce[de]),ie===void 0)ie=ce[de]=fe,++Q._eventsCount;else if(typeof ie=="function"?ie=ce[de]=ye?[fe,ie]:[ie,fe]:ye?ie.unshift(fe):ie.push(fe),ke=S(Q),ke>0&&ie.length>ke&&!ie.warned){ie.warned=!0;var Oe=new Error("Possible EventEmitter memory leak detected. "+ie.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");Oe.name="MaxListenersExceededWarning",Oe.emitter=Q,Oe.type=de,Oe.count=ie.length,r(Oe)}return Q}f.prototype.addListener=function(de,fe){return M(this,de,fe,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(de,fe){return M(this,de,fe,!0)};function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(Q,de,fe){var ye={fired:!1,wrapFn:void 0,target:Q,type:de,listener:fe},ke=C.bind(ye);return ke.listener=fe,ye.wrapFn=ke,ke}f.prototype.once=function(de,fe){return s(fe),this.on(de,I(this,de,fe)),this},f.prototype.prependOnceListener=function(de,fe){return s(fe),this.prependListener(de,I(this,de,fe)),this},f.prototype.removeListener=function(de,fe){var ye,ke,ce,ie,Oe;if(s(fe),ke=this._events,ke===void 0)return this;if(ye=ke[de],ye===void 0)return this;if(ye===fe||ye.listener===fe)--this._eventsCount===0?this._events=Object.create(null):(delete ke[de],ke.removeListener&&this.emit("removeListener",de,ye.listener||fe));else if(typeof ye!="function"){for(ce=-1,ie=ye.length-1;ie>=0;ie--)if(ye[ie]===fe||ye[ie].listener===fe){Oe=ye[ie].listener,ce=ie;break}if(ce<0)return this;ce===0?ye.shift():Z(ye,ce),ye.length===1&&(ke[de]=ye[0]),ke.removeListener!==void 0&&this.emit("removeListener",de,Oe||fe)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(de){var fe,ye,ke;if(ye=this._events,ye===void 0)return this;if(ye.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ye[de]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ye[de]),this;if(arguments.length===0){var ce=Object.keys(ye),ie;for(ke=0;ke<ce.length;++ke)ie=ce[ke],ie!=="removeListener"&&this.removeAllListeners(ie);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(fe=ye[de],typeof fe=="function")this.removeListener(de,fe);else if(fe!==void 0)for(ke=fe.length-1;ke>=0;ke--)this.removeListener(de,fe[ke]);return this};function L(Q,de,fe){var ye=Q._events;if(ye===void 0)return[];var ke=ye[de];return ke===void 0?[]:typeof ke=="function"?fe?[ke.listener||ke]:[ke]:fe?V(ke):B(ke,ke.length)}f.prototype.listeners=function(de){return L(this,de,!0)},f.prototype.rawListeners=function(de){return L(this,de,!1)},f.listenerCount=function(Q,de){return typeof Q.listenerCount=="function"?Q.listenerCount(de):R.call(Q,de)},f.prototype.listenerCount=R;function R(Q){var de=this._events;if(de!==void 0){var fe=de[Q];if(typeof fe=="function")return 1;if(fe!==void 0)return fe.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function B(Q,de){for(var fe=new Array(de),ye=0;ye<de;++ye)fe[ye]=Q[ye];return fe}function Z(Q,de){for(;de+1<Q.length;de++)Q[de]=Q[de+1];Q.pop()}function V(Q){for(var de=new Array(Q.length),fe=0;fe<de.length;++fe)de[fe]=Q[fe].listener||Q[fe];return de}function O(Q,de){return new Promise(function(fe,ye){function ke(ie){Q.removeListener(de,ce),ye(ie)}function ce(){typeof Q.removeListener=="function"&&Q.removeListener("error",ke),fe([].slice.call(arguments))}me(Q,de,ce,{once:!0}),de!=="error"&&ge(Q,ke,{once:!0})})}function ge(Q,de,fe){typeof Q.on=="function"&&me(Q,"error",de,fe)}function me(Q,de,fe,ye){if(typeof Q.on=="function")ye.once?Q.once(de,fe):Q.on(de,fe);else if(typeof Q.addEventListener=="function")Q.addEventListener(de,function ke(ce){ye.once&&Q.removeEventListener(de,ke),fe(ce)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Q)}return tf.exports}var kT=DT();const zT=E1(kT),Ar=[];for(let c=0;c<256;++c)Ar.push((c+256).toString(16).slice(1));function FT(c,e=0){return(Ar[c[e+0]]+Ar[c[e+1]]+Ar[c[e+2]]+Ar[c[e+3]]+"-"+Ar[c[e+4]]+Ar[c[e+5]]+"-"+Ar[c[e+6]]+Ar[c[e+7]]+"-"+Ar[c[e+8]]+Ar[c[e+9]]+"-"+Ar[c[e+10]]+Ar[c[e+11]]+Ar[c[e+12]]+Ar[c[e+13]]+Ar[c[e+14]]+Ar[c[e+15]]).toLowerCase()}let Ng;const OT=new Uint8Array(16);function NT(){if(!Ng){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ng=crypto.getRandomValues.bind(crypto)}return Ng(OT)}const UT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vx={randomUUID:UT};function BT(c,e,n){var u;if(vx.randomUUID&&!c)return vx.randomUUID();c=c||{};const r=c.random??((u=c.rng)==null?void 0:u.call(c))??NT();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,FT(r)}const L1="3.7.7",VT=L1,Xu=typeof Buffer=="function",xx=typeof TextDecoder=="function"?new TextDecoder:void 0,bx=typeof TextEncoder=="function"?new TextEncoder:void 0,GT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",wd=Array.prototype.slice.call(GT),nf=(c=>{let e={};return c.forEach((n,r)=>e[n]=r),e})(wd),HT=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Cr=String.fromCharCode.bind(String),wx=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):c=>new Uint8Array(Array.prototype.slice.call(c,0)),D1=c=>c.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),k1=c=>c.replace(/[^A-Za-z0-9\+\/]/g,""),z1=c=>{let e,n,r,u,f="";const p=c.length%3;for(let s=0;s<c.length;){if((n=c.charCodeAt(s++))>255||(r=c.charCodeAt(s++))>255||(u=c.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|u,f+=wd[e>>18&63]+wd[e>>12&63]+wd[e>>6&63]+wd[e&63]}return p?f.slice(0,p-3)+"===".substring(p):f},Fy=typeof btoa=="function"?c=>btoa(c):Xu?c=>Buffer.from(c,"binary").toString("base64"):z1,D_=Xu?c=>Buffer.from(c).toString("base64"):c=>{let n=[];for(let r=0,u=c.length;r<u;r+=4096)n.push(Cr.apply(null,c.subarray(r,r+4096)));return Fy(n.join(""))},Ff=(c,e=!1)=>e?D1(D_(c)):D_(c),jT=c=>{if(c.length<2){var e=c.charCodeAt(0);return e<128?c:e<2048?Cr(192|e>>>6)+Cr(128|e&63):Cr(224|e>>>12&15)+Cr(128|e>>>6&63)+Cr(128|e&63)}else{var e=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return Cr(240|e>>>18&7)+Cr(128|e>>>12&63)+Cr(128|e>>>6&63)+Cr(128|e&63)}},$T=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,F1=c=>c.replace($T,jT),Sx=Xu?c=>Buffer.from(c,"utf8").toString("base64"):bx?c=>D_(bx.encode(c)):c=>Fy(F1(c)),Iu=(c,e=!1)=>e?D1(Sx(c)):Sx(c),Mx=c=>Iu(c,!0),WT=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,qT=c=>{switch(c.length){case 4:var e=(7&c.charCodeAt(0))<<18|(63&c.charCodeAt(1))<<12|(63&c.charCodeAt(2))<<6|63&c.charCodeAt(3),n=e-65536;return Cr((n>>>10)+55296)+Cr((n&1023)+56320);case 3:return Cr((15&c.charCodeAt(0))<<12|(63&c.charCodeAt(1))<<6|63&c.charCodeAt(2));default:return Cr((31&c.charCodeAt(0))<<6|63&c.charCodeAt(1))}},O1=c=>c.replace(WT,qT),N1=c=>{if(c=c.replace(/\s+/g,""),!HT.test(c))throw new TypeError("malformed base64.");c+="==".slice(2-(c.length&3));let e,n="",r,u;for(let f=0;f<c.length;)e=nf[c.charAt(f++)]<<18|nf[c.charAt(f++)]<<12|(r=nf[c.charAt(f++)])<<6|(u=nf[c.charAt(f++)]),n+=r===64?Cr(e>>16&255):u===64?Cr(e>>16&255,e>>8&255):Cr(e>>16&255,e>>8&255,e&255);return n},Oy=typeof atob=="function"?c=>atob(k1(c)):Xu?c=>Buffer.from(c,"base64").toString("binary"):N1,U1=Xu?c=>wx(Buffer.from(c,"base64")):c=>wx(Oy(c).split("").map(e=>e.charCodeAt(0))),B1=c=>U1(V1(c)),ZT=Xu?c=>Buffer.from(c,"base64").toString("utf8"):xx?c=>xx.decode(U1(c)):c=>O1(Oy(c)),V1=c=>k1(c.replace(/[-_]/g,e=>e=="-"?"+":"/")),k_=c=>ZT(V1(c)),XT=c=>{if(typeof c!="string")return!1;const e=c.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},G1=c=>({value:c,enumerable:!1,writable:!0,configurable:!0}),H1=function(){const c=(e,n)=>Object.defineProperty(String.prototype,e,G1(n));c("fromBase64",function(){return k_(this)}),c("toBase64",function(e){return Iu(this,e)}),c("toBase64URI",function(){return Iu(this,!0)}),c("toBase64URL",function(){return Iu(this,!0)}),c("toUint8Array",function(){return B1(this)})},j1=function(){const c=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,G1(n));c("toBase64",function(e){return Ff(this,e)}),c("toBase64URI",function(){return Ff(this,!0)}),c("toBase64URL",function(){return Ff(this,!0)})},YT=()=>{H1(),j1()},KT={version:L1,VERSION:VT,atob:Oy,atobPolyfill:N1,btoa:Fy,btoaPolyfill:z1,fromBase64:k_,toBase64:Iu,encode:Iu,encodeURI:Mx,encodeURL:Mx,utob:F1,btou:O1,decode:k_,isValid:XT,fromUint8Array:Ff,toUint8Array:B1,extendString:H1,extendUint8Array:j1,extendBuiltins:YT};var JT=Object.defineProperty,$1=c=>{throw TypeError(c)},QT=(c,e,n)=>e in c?JT(c,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[e]=n,Mn=(c,e,n)=>QT(c,typeof e!="symbol"?e+"":e,n),Ny=(c,e,n)=>e.has(c)||$1("Cannot "+n),Kn=(c,e,n)=>(Ny(c,e,"read from private field"),n?n.call(c):e.get(c)),Gl=(c,e,n)=>e.has(c)?$1("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,n),wu=(c,e,n,r)=>(Ny(c,e,"write to private field"),e.set(c,n),n),_s=(c,e,n)=>(Ny(c,e,"access private method"),n);const Jn={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...jd};function Tx(){if(typeof navigator>"u"){const c=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return R_(c)||Jn.ENGLISH}return Array.from(new Set(navigator.languages.map(c=>c.split("-")[0]))).map(c=>R_(c)).filter(c=>c)[0]??Jn.LOCAL}const $r={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Jn.STYLE,secondaryLanguage:Jn.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze($r);const Uy=BT();class e2 extends zT{constructor(){super(...arguments),Mn(this,"primaryLanguage",$r.primaryLanguage),Mn(this,"secondaryLanguage"),Mn(this,"session",!0),Mn(this,"caching",!0),Mn(this,"telemetry",!0),Mn(this,"_unit","metric"),Mn(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,Cu.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){Cu.fetch=e}get fetch(){return Cu.fetch}}const lr=new e2,z_="localcache_source",F_="localcache",t2="maptiler_sdk",n2=1e3,i2=100,O_=typeof caches<"u",{addProtocol:Ex}=Qt;function r2(c,e){if(O_&&lr.caching&&lr.session&&c.host===$r.maptilerApiHost){if(e==="Source"&&c.href.includes("tiles.json"))return c.href.replace("https://",`${z_}://`);if(e==="Tile"||e==="Glyphs")return c.href.replace("https://",`${F_}://`)}return c.href}let Ug;async function W1(){return Ug||(Ug=await caches.open(t2)),Ug}let Ax=0;async function s2(){const c=await W1(),e=await c.keys(),n=e.slice(0,Math.max(e.length-n2,0));for(const r of n)c.delete(r)}function a2(){Ex(z_,async(c,e)=>{if(!c.url)throw new Error("");c.url=c.url.replace(`${z_}://`,"https://");const n=c;n.signal=e.signal;const r=await fetch(c.url,n),u=await r.json();return u.tiles&&u.tiles.length>0&&(u.tiles[0]+=`&last-modified=${r.headers.get("Last-Modified")}`),{data:u,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}}),Ex(F_,async(c,e)=>{if(!c.url)throw new Error("");c.url=c.url.replace(`${F_}://`,"https://");const n=new URL(c.url),r=new URL(n);r.searchParams.delete("mtsid"),r.searchParams.delete("key");const u=r.toString(),f=new URL(n);f.searchParams.delete("last-modified");const p=f.toString(),s=async L=>({data:await L.arrayBuffer(),cacheControl:L.headers.get("Cache-Control"),expires:L.headers.get("Expires")}),S=await W1(),M=await S.match(u);if(M)return s(M);const C=c;C.signal=e.signal;const I=await fetch(p,C);return I.status>=200&&I.status<300&&(S.put(u,I.clone()).catch(()=>{}),++Ax>i2&&(s2(),Ax=0)),s(I)})}function o2(){if(typeof window>"u")return;const c=Qt.getRTLTextPluginStatus();if(c==="unavailable"||c==="requested")try{Qt.setRTLTextPlugin($r.rtlPluginURL,!0)}catch{}}function l2(c,e){for(const n of c)typeof e[n]=="function"&&(e[n]=e[n].bind(e))}function Cx(c,e){let n=null;try{n=new URL(c)}catch{return{url:c}}return n.host===$r.maptilerApiHost&&(n.searchParams.has("key")||n.searchParams.append("key",lr.apiKey),lr.session&&n.searchParams.append("mtsid",Uy)),{url:r2(n,e)}}function Px(c){return(e,n)=>{if(c!=null){const r=c(e,n),u=Cx((r==null?void 0:r.url)??"",n);return{...r,...u}}return Cx(e,n)}}function c2(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function u2(c){const e=c2();if(!e)return;let n=null;if(typeof c=="string"?n=document.getElementById(c):c instanceof HTMLElement&&(n=c),!n)throw new Error("The Map container must be provided.");const r=document.createElement("div");throw r.innerHTML=e,r.classList.add("webgl-warning-div"),n.appendChild(r),new Error(e)}function Ix(c,e){return!(!Array.isArray(c)||c.length!==2||c[0]!=="get"||typeof c[1]!="string"||e&&!c[1].startsWith("name:")||!e&&c[1]!=="name")}function h2(c,e,n){const r=structuredClone(c),u=f=>{if(typeof f!="string")for(let p=0;p<f.length;p+=1)Ix(f[p],n)?f[p]=structuredClone(e):u(f[p])};return Ix(r,n)?e:(u(r),r)}function d2(c,e){const n=e?/\{name:\S+\}/:/\{name\}/;return{contains:n.test(c),exactMatch:new RegExp(`^${n.source}$`).test(c)}}function p2(c,e,n){const r=n?/\{name:\S+\}/:/\{name\}/,u=c.split(r);return["concat",...u.flatMap((f,p)=>p===u.length-1?[f]:[f,e])]}function f2(c){var e;const n=/\{name(?::(?<language>\S+))?\}/g,r=[];for(;;){const u=n.exec(c);if(!u)break;const f=((e=u.groups)==null?void 0:e.language)??null;r.push(f)}return r}function m2(c){return!Array.isArray(c)||c.length!==2||c[0]!=="get"||typeof c[1]!="string"?null:c[1].trim()==="name"?{isLanguage:!0,localization:null}:c[1].trim().startsWith("name:")?{isLanguage:!0,localization:c[1].trim().split(":").pop()}:null}function g2(c){const e=[],n=structuredClone(c),r=u=>{if(typeof u!="string")for(let f=0;f<u.length;f+=1){const p=m2(u[f]);p?e.push(p.localization):r(u[f])}};return r([n]),e}function _2(c,e){const n=[];for(const f of c){if(f.type!=="symbol")continue;const p=f,{id:s,layout:S}=p;if(!S||!("text-field"in S))continue;const M=e.getLayoutProperty(s,"text-field");if(M)if(typeof M=="string"){const C=f2(M);n.push(C)}else{const C=g2(M);n.push(C)}}const r=n.flat(),u={unlocalized:0,localized:{}};for(const f of r)f===null?u.unlocalized+=1:(f in u.localized||(u.localized[f]=0),u.localized[f]+=1);return u}(class extends Qt.Marker{addTo(c){return super.addTo(c)}});class Gk extends Qt.Popup{addTo(e){return super.addTo(e)}}class Hk extends Qt.Style{constructor(e,n={}){super(e,n)}}class jk extends Qt.CanvasSource{onAdd(e){super.onAdd(e)}}class $k extends Qt.GeoJSONSource{onAdd(e){super.onAdd(e)}}class Wk extends Qt.ImageSource{onAdd(e){super.onAdd(e)}}class qk extends Qt.RasterTileSource{onAdd(e){super.onAdd(e)}}class Zk extends Qt.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class Xk extends Qt.VectorTileSource{onAdd(e){super.onAdd(e)}}class Yk extends Qt.VideoSource{onAdd(e){super.onAdd(e)}}class y2 extends Qt.NavigationControl{onAdd(e){return super.onAdd(e)}}class v2 extends Qt.GeolocateControl{onAdd(e){return super.onAdd(e)}}class Kk extends Qt.AttributionControl{onAdd(e){return super.onAdd(e)}}class x2 extends Qt.LogoControl{onAdd(e){return super.onAdd(e)}}class b2 extends Qt.ScaleControl{onAdd(e){return super.onAdd(e)}}class w2 extends Qt.FullscreenControl{onAdd(e){return super.onAdd(e)}}class Jk extends Qt.TerrainControl{onAdd(e){return super.onAdd(e)}}class Qk extends Qt.BoxZoomHandler{constructor(e,n){super(e,n)}}class ez extends Qt.ScrollZoomHandler{constructor(e,n){super(e,n)}}class tz extends Qt.CooperativeGesturesHandler{constructor(e,n){super(e,n)}}class nz extends Qt.KeyboardHandler{constructor(e){super(e)}}class iz extends Qt.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class rz extends Qt.MapWheelEvent{constructor(e,n,r){super(e,n,r)}}class sz extends Qt.MapTouchEvent{constructor(e,n,r){super(e,n,r)}}class az extends Qt.MapMouseEvent{constructor(e,n,r,u={}){super(e,n,r,u)}}class Rx extends x2{constructor(e={}){super(e),Mn(this,"logoURL",""),Mn(this,"linkURL",""),this.logoURL=e.logoURL??$r.maptilerLogoURL,this.linkURL=e.linkURL??$r.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage=`url(${this.logoURL})`,n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener",n.href=this.linkURL,n.setAttribute("aria-label","MapTiler logo"),n.setAttribute("rel","noopener"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var S2=8,M2={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},T2={"*":{type:"source"}},E2=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],A2={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},C2={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},P2={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},I2={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},R2={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},L2={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},D2={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},k2=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],z2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},F2={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},O2={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},N2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},U2={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},B2={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},V2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},G2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},H2={type:"array",value:"*"},j2={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},$2={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},W2={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},q2={type:"array",value:"*",minimum:1},Z2={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},X2={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Y2={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},K2={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},J2=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],Q2={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},eE={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},tE={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},nE={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},iE={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},rE={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},sE={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},aE={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},oE={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},lE={"*":{type:"string"}},cE={$version:S2,$root:M2,sources:T2,source:E2,source_vector:A2,source_raster:C2,source_raster_dem:P2,source_geojson:I2,source_video:R2,source_image:L2,layer:D2,layout:k2,layout_background:z2,layout_fill:F2,layout_circle:O2,layout_heatmap:N2,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:U2,layout_symbol:B2,layout_raster:V2,layout_hillshade:G2,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:H2,filter_operator:j2,geometry_type:$2,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:W2,expression:q2,light:Z2,sky:X2,terrain:Y2,projection:K2,paint:J2,paint_fill:Q2,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:eE,paint_circle:tE,paint_heatmap:nE,paint_symbol:iE,paint_raster:rE,paint_hillshade:sE,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:aE,transition:oE,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:lE};class Mt{constructor(e,n,r,u){this.message=(e?`${e}: `:"")+r,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function qf(c,...e){for(const n of e)for(const r in n)c[r]=n[r];return c}let ba=class extends Error{constructor(e,n){super(n),this.message=n,this.key=e}};class By{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,u]of n)this.bindings[r]=u}concat(e){return new By(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const om={kind:"null"},Et={kind:"number"},Bn={kind:"string"},In={kind:"boolean"},Sa={kind:"color"},lm={kind:"projectionDefinition"},ac={kind:"object"},Sn={kind:"value"},uE={kind:"error"},cm={kind:"collator"},um={kind:"formatted"},hm={kind:"padding"},Ld={kind:"colorArray"},dm={kind:"numberArray"},$d={kind:"resolvedImage"},pm={kind:"variableAnchorOffsetCollection"};function vs(c,e){return{kind:"array",itemType:c,N:e}}function Pi(c){if(c.kind==="array"){const e=Pi(c.itemType);return typeof c.N=="number"?`array<${e}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${e}>`}else return c.kind}const hE=[om,Et,Bn,In,Sa,lm,um,ac,vs(Sn),hm,dm,Ld,$d,pm];function Dd(c,e){if(e.kind==="error")return null;if(c.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Dd(c.itemType,e.itemType))&&(typeof c.N!="number"||c.N===e.N))return null}else{if(c.kind===e.kind)return null;if(c.kind==="value"){for(const n of hE)if(!Dd(n,e))return null}}return`Expected ${Pi(c)} but found ${Pi(e)} instead.`}function Vy(c,e){return e.some(n=>n.kind===c.kind)}function oc(c,e){return e.some(n=>n==="null"?c===null:n==="array"?Array.isArray(c):n==="object"?c&&!Array.isArray(c)&&typeof c=="object":n===typeof c)}function Go(c,e){return c.kind==="array"&&e.kind==="array"?c.itemType.kind===e.itemType.kind&&typeof c.N=="number":c.kind===e.kind}const q1=.96422,Z1=1,X1=.82521,Y1=4/29,Ru=6/29,K1=3*Ru*Ru,dE=Ru*Ru*Ru,pE=Math.PI/180,fE=180/Math.PI;function J1(c){return c=c%360,c<0&&(c+=360),c}function Q1([c,e,n,r]){c=Bg(c),e=Bg(e),n=Bg(n);let u,f;const p=Vg((.2225045*c+.7168786*e+.0606169*n)/Z1);c===e&&e===n?u=f=p:(u=Vg((.4360747*c+.3850649*e+.1430804*n)/q1),f=Vg((.0139322*c+.0971045*e+.7141733*n)/X1));const s=116*p-16;return[s<0?0:s,500*(u-p),200*(p-f),r]}function Bg(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Vg(c){return c>dE?Math.pow(c,1/3):c/K1+Y1}function ew([c,e,n,r]){let u=(c+16)/116,f=isNaN(e)?u:u+e/500,p=isNaN(n)?u:u-n/200;return u=Z1*Hg(u),f=q1*Hg(f),p=X1*Hg(p),[Gg(3.1338561*f-1.6168667*u-.4906146*p),Gg(-.9787684*f+1.9161415*u+.033454*p),Gg(.0719453*f-.2289914*u+1.4052427*p),r]}function Gg(c){return c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055,c<0?0:c>1?1:c}function Hg(c){return c>Ru?c*c*c:K1*(c-Y1)}function mE(c){const[e,n,r,u]=Q1(c),f=Math.sqrt(n*n+r*r);return[Math.round(f*1e4)?J1(Math.atan2(r,n)*fE):NaN,f,e,u]}function gE([c,e,n,r]){return c=isNaN(c)?0:c*pE,ew([n,Math.cos(c)*e,Math.sin(c)*e,r])}function _E([c,e,n,r]){c=J1(c),e/=100,n/=100;function u(f){const p=(f+c/30)%12,s=e*Math.min(n,1-n);return n-s*Math.max(-1,Math.min(p-3,9-p,1))}return[u(0),u(8),u(4),r]}const yE=Object.hasOwn||function(c,e){return Object.prototype.hasOwnProperty.call(c,e)};function Ed(c,e){return yE(c,e)?c[e]:void 0}function vE(c){if(c=c.toLowerCase().trim(),c==="transparent")return[0,0,0,0];const e=Ed(xE,c);if(e){const[u,f,p]=e;return[u/255,f/255,p/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const u=c.length<6?1:2;let f=1;return[rf(c.slice(f,f+=u)),rf(c.slice(f,f+=u)),rf(c.slice(f,f+=u)),rf(c.slice(f,f+u)||"ff")]}if(c.startsWith("rgb")){const u=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,f=c.match(u);if(f){const[p,s,S,M,C,I,L,R,B,Z,V,O]=f,ge=[M||" ",L||" ",Z].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const me=[S,I,B].join(""),Q=me==="%%%"?100:me===""?255:0;if(Q){const de=[Su(+s/Q,0,1),Su(+C/Q,0,1),Su(+R/Q,0,1),V?Lx(+V,O):1];if(Dx(de))return de}}return}}const n=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=c.match(n);if(r){const[u,f,p,s,S,M,C,I,L]=r,R=[p||" ",S||" ",C].join("");if(R==="  "||R==="  /"||R===",,"||R===",,,"){const B=[+f,Su(+s,0,100),Su(+M,0,100),I?Lx(+I,L):1];if(Dx(B))return _E(B)}}}function rf(c){return parseInt(c.padEnd(2,c),16)/255}function Lx(c,e){return Su(e?c/100:c,0,1)}function Su(c,e,n){return Math.min(Math.max(e,c),n)}function Dx(c){return!c.some(Number.isNaN)}const xE={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function lc(c,e,n){return c+n*(e-c)}function kd(c,e,n){return c.map((r,u)=>lc(r,e[u],n))}class ui{constructor(e,n,r,u=1,f=!0){this.r=e,this.g=n,this.b=r,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,n,r,u]))}static parse(e){if(e instanceof ui)return e;if(typeof e!="string")return;const n=vE(e);if(n)return new ui(...n,!1)}get rgb(){const{r:e,g:n,b:r,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,n/f,r/f,u])}get hcl(){return this.overwriteGetter("hcl",mE(this.rgb))}get lab(){return this.overwriteGetter("lab",Q1(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,r,u]=this.rgb;return`rgba(${[e,n,r].map(f=>Math.round(f*255)).join(",")},${u})`}static interpolate(e,n,r,u="rgb"){switch(u){case"rgb":{const[f,p,s,S]=kd(e.rgb,n.rgb,r);return new ui(f,p,s,S,!1)}case"hcl":{const[f,p,s,S]=e.hcl,[M,C,I,L]=n.hcl;let R,B;if(!isNaN(f)&&!isNaN(M)){let me=M-f;M>f&&me>180?me-=360:M<f&&f-M>180&&(me+=360),R=f+r*me}else isNaN(f)?isNaN(M)?R=NaN:(R=M,(s===1||s===0)&&(B=C)):(R=f,(I===1||I===0)&&(B=p));const[Z,V,O,ge]=gE([R,B??lc(p,C,r),lc(s,I,r),lc(S,L,r)]);return new ui(Z,V,O,ge,!1)}case"lab":{const[f,p,s,S]=ew(kd(e.lab,n.lab,r));return new ui(f,p,s,S,!1)}}}}ui.black=new ui(0,0,0,1);ui.white=new ui(1,1,1,1);ui.transparent=new ui(0,0,0,0);ui.red=new ui(1,0,0,1);class Gy{constructor(e,n,r){e?this.sensitivity=n?"variant":"case":this.sensitivity=n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const bE=["bottom","center","top"];class N_{constructor(e,n,r,u,f,p){this.text=e,this.image=n,this.scale=r,this.fontStack=u,this.textColor=f,this.verticalAlign=p}}let Wd=class Of{constructor(e){this.sections=e}static fromString(e){return new Of([new N_(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Of?e:Of.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}};class Js{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Js)return e;if(typeof e=="number")return new Js([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Js(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){return new Js(kd(e.values,n.values,r))}}class Qs{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qs)return e;if(typeof e=="number")return new Qs([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new Qs(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){return new Qs(kd(e.values,n.values,r))}}class xs{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof xs)return e;if(typeof e=="string"){const r=ui.parse(e);return r?new xs([r]):void 0}if(!Array.isArray(e))return;const n=[];for(const r of e){if(typeof r!="string")return;const u=ui.parse(r);if(!u)return;n.push(u)}return new xs(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r,u="rgb"){const f=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)f.push(ui.interpolate(e.values[p],n.values[p],r,u));return new xs(f)}}class Li extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const wE=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ma{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ma)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let n=0;n<e.length;n+=2){const r=e[n],u=e[n+1];if(typeof r!="string"||!wE.has(r)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Ma(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){const u=e.values,f=n.values;if(u.length!==f.length)throw new Li(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const p=[];for(let s=0;s<u.length;s+=2){if(u[s]!==f[s])throw new Li(`Cannot interpolate values containing mismatched anchors. from[${s}]: ${u[s]}, to[${s}]: ${f[s]}`);p.push(u[s]);const[S,M]=u[s+1],[C,I]=f[s+1];p.push([lc(S,C,r),lc(M,I,r)])}return new Ma(p)}}class nl{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new nl({name:e,available:!1}):null}}class Zs{constructor(e,n,r){this.from=e,this.to=n,this.transition=r}static interpolate(e,n,r){return new Zs(e,n,r)}static parse(e){if(e instanceof Zs)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new Zs(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new Zs(e.from,e.to,e.transition);if(typeof e=="string")return new Zs(e,e,1)}}function tw(c,e,n,r){return typeof c=="number"&&c>=0&&c<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[c,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[c,e,n,r]:[c,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zd(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Zs||c instanceof ui||c instanceof Gy||c instanceof Wd||c instanceof Js||c instanceof Qs||c instanceof xs||c instanceof Ma||c instanceof nl)return!0;if(Array.isArray(c)){for(const e of c)if(!zd(e))return!1;return!0}else if(typeof c=="object"){for(const e in c)if(!zd(c[e]))return!1;return!0}else return!1}function er(c){if(c===null)return om;if(typeof c=="string")return Bn;if(typeof c=="boolean")return In;if(typeof c=="number")return Et;if(c instanceof ui)return Sa;if(c instanceof Zs)return lm;if(c instanceof Gy)return cm;if(c instanceof Wd)return um;if(c instanceof Js)return hm;if(c instanceof Qs)return dm;if(c instanceof xs)return Ld;if(c instanceof Ma)return pm;if(c instanceof nl)return $d;if(Array.isArray(c)){const e=c.length;let n;for(const r of c){const u=er(r);if(!n)n=u;else{if(n===u)continue;n=Sn;break}}return vs(n||Sn,e)}else return ac}function Ad(c){const e=typeof c;return c===null?"":e==="string"||e==="number"||e==="boolean"?String(c):c instanceof ui||c instanceof Zs||c instanceof Wd||c instanceof Js||c instanceof Qs||c instanceof xs||c instanceof Ma||c instanceof nl?c.toString():JSON.stringify(c)}class Fu{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zd(e[1]))return n.error("invalid value");const r=e[1];let u=er(r);const f=n.expectedType;return u.kind==="array"&&u.N===0&&f&&f.kind==="array"&&(typeof f.N!="number"||f.N===0)&&(u=f),new Fu(u,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const sf={string:Bn,number:Et,boolean:In,object:ac};class Xs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=1,u;const f=e[0];if(f==="array"){let s;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in sf)||M==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);s=sf[M],r++}else s=Sn;let S;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],r++}u=vs(s,S)}else{if(!sf[f])throw new Error(`Types doesn't contain name = ${f}`);u=sf[f]}const p=[];for(;r<e.length;r++){const s=n.parse(e[r],r,Sn);if(!s)return null;p.push(s)}return new Xs(u,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(Dd(this.type,er(r))){if(n===this.args.length-1)throw new Li(`Expected value to be of type ${Pi(this.type)}, but found ${Pi(er(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const kx={"to-boolean":In,"to-color":Sa,"to-number":Et,"to-string":Bn};let Eu=class nw{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0];if(!kx[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return n.error("Expected one argument.");const u=kx[r],f=[];for(let p=1;p<e.length;p++){const s=n.parse(e[p],p,Sn);if(!s)return null;f.push(s)}return new nw(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,r;for(const u of this.args){if(n=u.evaluate(e),r=null,n instanceof ui)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(n.length<3||n.length>4?r=`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:r=tw(n[0],n[1],n[2],n[3]),!r))return new ui(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Li(r||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const r of this.args){n=r.evaluate(e);const u=Js.parse(n);if(u)return u}throw new Li(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const r of this.args){n=r.evaluate(e);const u=Qs.parse(n);if(u)return u}throw new Li(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const r of this.args){n=r.evaluate(e);const u=xs.parse(n);if(u)return u}throw new Li(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const r of this.args){n=r.evaluate(e);const u=Ma.parse(n);if(u)return u}throw new Li(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const r of this.args){if(n=r.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Li(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Wd.fromString(Ad(this.args[0].evaluate(e)));case"resolvedImage":return nl.fromString(Ad(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ad(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}};const SE=["Unknown","Point","LineString","Polygon"];class iw{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?SE[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=ui.parse(e),this._parseColorCache.set(e,n)),n}}let rw=class sw{constructor(e,n,r=[],u,f=new By,p=[]){this.registry=e,this.path=r,this.key=r.map(s=>`[${s}]`).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._isConstant=n}parse(e,n,r,u,f={}){return n?this.concat(n,r,u)._parse(e,f):this._parse(e,f)}_parse(e,n){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(u,f,p){return p==="assert"?new Xs(f,[u]):p==="coerce"?new Eu(f,[u]):u}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let p=f.parse(e,this);if(!p)return null;if(this.expectedType){const s=this.expectedType,S=p.type;if((s.kind==="string"||s.kind==="number"||s.kind==="boolean"||s.kind==="object"||s.kind==="array")&&S.kind==="value")p=r(p,s,n.typeAnnotation||"assert");else if(s.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(s.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(s.kind)&&["value","number","array"].includes(S.kind)||s.kind==="colorArray"&&["value","string","array"].includes(S.kind)||s.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))p=r(p,s,n.typeAnnotation||"coerce");else if(this.checkSubtype(s,S))return null}if(!(p instanceof Fu)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const s=new iw;try{p=new Fu(p.type,p.evaluate(s))}catch(S){return this.error(S.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const u=typeof e=="number"?this.path.concat(e):this.path,f=r?this.scope.concat(r):this.scope;return new sw(this.registry,this._isConstant,u,n||null,f,this.errors)}error(e,...n){const r=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new ba(r,e))}checkSubtype(e,n){const r=Dd(e,n);return r&&this.error(r),r}},aw=class ow{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const s=n.parse(e[f+1],f+1);if(!s)return null;r.push([p,s])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return u?new ow(r,u):null}outputDefined(){return this.result.outputDefined()}},lw=class cw{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new cw(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}};class Hy{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Et),u=n.parse(e[2],2,vs(n.expectedType||Sn));if(!r||!u)return null;const f=u.type;return new Hy(f.itemType,r,u)}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new Li(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new Li(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new Li(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class jy{constructor(e,n){this.type=In,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Sn);return!r||!u?null:Vy(r.type,[In,Bn,Et,om,Sn])?new jy(r,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(r.type)} instead`)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!oc(n,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(er(n))} instead.`);if(!oc(r,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${Pi(er(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Zf{constructor(e,n,r){this.type=Et,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Sn);if(!r||!u)return null;if(!Vy(r.type,[In,Bn,Et,om,Sn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(r.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Et);return f?new Zf(r,u,f):null}else return new Zf(r,u)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!oc(n,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(er(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),oc(r,["string"])){const f=r.indexOf(n,u);return f===-1?-1:[...r.slice(0,f)].length}else{if(oc(r,["array"]))return r.indexOf(n,u);throw new Li(`Expected second argument to be of type array or string, but found ${Pi(er(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class $y{constructor(e,n,r,u,f,p){this.inputType=e,this.type=n,this.input=r,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return n.error("Expected an even number of arguments.");let r,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const f={},p=[];for(let M=2;M<e.length-1;M+=2){let C=e[M];const I=e[M+1];Array.isArray(C)||(C=[C]);const L=n.concat(M);if(C.length===0)return L.error("Expected at least one branch label.");for(const B of C){if(typeof B!="number"&&typeof B!="string")return L.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return L.error("Numeric branch labels must be integer values.");if(!r)r=er(B);else if(L.checkSubtype(r,er(B)))return null;if(typeof f[String(B)]<"u")return L.error("Branch labels must be unique.");f[String(B)]=p.length}const R=n.parse(I,M,u);if(!R)return null;u=u||R.type,p.push(R)}const s=n.parse(e[1],1,Sn);if(!s)return null;const S=n.parse(e[e.length-1],e.length-1,u);return!S||s.type.kind!=="value"&&n.concat(1).checkSubtype(r,s.type)?null:new $y(r,u,s,f,p,S)}evaluate(e){const n=this.input.evaluate(e);return(er(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Wy{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const s=n.parse(e[p],p,In);if(!s)return null;const S=n.parse(e[p+1],p+1,r);if(!S)return null;u.push([s,S]),r=r||S.type}const f=n.parse(e[e.length-1],e.length-1,r);if(!f)return null;if(!r)throw new Error("Can't infer output type");return new Wy(r,u,f)}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Xf{constructor(e,n,r,u){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Et);if(!r||!u)return null;if(!Vy(r.type,[vs(Sn),Bn,Sn]))return n.error(`Expected first argument to be of type array or string, but found ${Pi(r.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Et);return f?new Xf(r.type,r,u,f):null}else return new Xf(r.type,r,u)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),oc(n,["string"]))return[...n].slice(r,u).join("");if(oc(n,["array"]))return n.slice(r,u);throw new Li(`Expected first argument to be of type array or string, but found ${Pi(er(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function uw(c,e){const n=c.length-1;let r=0,u=n,f=0,p,s;for(;r<=u;)if(f=Math.floor((r+u)/2),p=c[f],s=c[f+1],p<=e){if(f===n||e<s)return f;r=f+1}else if(p>e)u=f-1;else throw new Li("Input is not a number.");return 0}let hw=class dw{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of r)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,Et);if(!r)return null;const u=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let p=1;p<e.length;p+=2){const s=p===1?-1/0:e[p],S=e[p+1],M=p,C=p+1;if(typeof s!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const I=n.parse(S,C,f);if(!I)return null;f=f||I.type,u.push([s,I])}return new dw(f,r,u)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return r[0].evaluate(e);const f=n.length;if(u>=n[f-1])return r[f-1].evaluate(e);const p=uw(n,u);return r[p].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}};function ME(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var jg,zx;function TE(){if(zx)return jg;zx=1,jg=c;function c(e,n,r,u){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=u}return c.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,u=0;u<8;u++){var f=this.sampleCurveX(r)-e;if(Math.abs(f)<n)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r=r-f/p}var s=0,S=1;for(r=e,u=0;u<20&&(f=this.sampleCurveX(r),!(Math.abs(f-e)<n));u++)e>f?s=r:S=r,r=(S-s)*.5+s;return r},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},jg}var EE=TE(),AE=ME(EE);class Ta{constructor(e,n,r,u,f){this.type=e,this.operator=n,this.interpolation=r,this.input=u,this.labels=[],this.outputs=[];for(const[p,s]of f)this.labels.push(p),this.outputs.push(s)}static interpolationFactor(e,n,r,u){let f=0;if(e.name==="exponential")f=$g(n,e.base,r,u);else if(e.name==="linear")f=$g(n,1,r,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new AE(p[0],p[1],p[2],p[3]).solve($g(n,1,r,u))}return f}static parse(e,n){let[r,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else if(u[0]==="cubic-bezier"){const M=u.slice(1);if(M.length!==4||M.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}else return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Et),!f)return null;const s=[];let S=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&n.expectedType!=Ld?S=Sa:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let M=0;M<p.length;M+=2){const C=p[M],I=p[M+1],L=M+3,R=M+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(s.length&&s[s.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const B=n.parse(I,R,S);if(!B)return null;S=S||B.type,s.push([C,B])}return!Go(S,Et)&&!Go(S,lm)&&!Go(S,Sa)&&!Go(S,hm)&&!Go(S,dm)&&!Go(S,Ld)&&!Go(S,pm)&&!Go(S,vs(Et))?n.error(`Type ${Pi(S)} is not interpolatable.`):new Ta(S,r,u,f,s)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return r[0].evaluate(e);const f=n.length;if(u>=n[f-1])return r[f-1].evaluate(e);const p=uw(n,u),s=n[p],S=n[p+1],M=Ta.interpolationFactor(this.interpolation,u,s,S),C=r[p].evaluate(e),I=r[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return lc(C,I,M);case"color":return ui.interpolate(C,I,M);case"padding":return Js.interpolate(C,I,M);case"colorArray":return xs.interpolate(C,I,M);case"numberArray":return Qs.interpolate(C,I,M);case"variableAnchorOffsetCollection":return Ma.interpolate(C,I,M);case"array":return kd(C,I,M);case"projectionDefinition":return Zs.interpolate(C,I,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return ui.interpolate(C,I,M,"hcl");case"colorArray":return xs.interpolate(C,I,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ui.interpolate(C,I,M,"lab");case"colorArray":return xs.interpolate(C,I,M,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function $g(c,e,n,r){const u=r-n,f=c-n;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class Fd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=null;const u=n.expectedType;u&&u.kind!=="value"&&(r=u);const f=[];for(const p of e.slice(1)){const s=n.parse(p,1+f.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,f.push(s)}if(!r)throw new Error("No output type");return u&&f.some(p=>Dd(u,p.type))?new Fd(Sn,f):new Fd(r,f)}evaluate(e){let n=null,r=0,u;for(const f of this.args)if(r++,n=f.evaluate(e),n&&n instanceof nl&&!n.available&&(u||(u=n.name),n=null,r===this.args.length&&(n=u)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Fx(c,e){return c==="=="||c==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function CE(c,e,n){return e===n}function PE(c,e,n){return e!==n}function IE(c,e,n){return e<n}function RE(c,e,n){return e>n}function LE(c,e,n){return e<=n}function DE(c,e,n){return e>=n}function pw(c,e,n,r){return r.compare(e,n)===0}function kE(c,e,n,r){return!pw(c,e,n,r)}function zE(c,e,n,r){return r.compare(e,n)<0}function FE(c,e,n,r){return r.compare(e,n)>0}function OE(c,e,n,r){return r.compare(e,n)<=0}function NE(c,e,n,r){return r.compare(e,n)>=0}function Yu(c,e,n){const r=c!=="=="&&c!=="!=";return class fw{constructor(f,p,s){this.type=In,this.lhs=f,this.rhs=p,this.collator=s,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const s=f[0];let S=p.parse(f[1],1,Sn);if(!S)return null;if(!Fx(s,S.type))return p.concat(1).error(`"${s}" comparisons are not supported for type '${Pi(S.type)}'.`);let M=p.parse(f[2],2,Sn);if(!M)return null;if(!Fx(s,M.type))return p.concat(2).error(`"${s}" comparisons are not supported for type '${Pi(M.type)}'.`);if(S.type.kind!==M.type.kind&&S.type.kind!=="value"&&M.type.kind!=="value")return p.error(`Cannot compare types '${Pi(S.type)}' and '${Pi(M.type)}'.`);r&&(S.type.kind==="value"&&M.type.kind!=="value"?S=new Xs(M.type,[S]):S.type.kind!=="value"&&M.type.kind==="value"&&(M=new Xs(S.type,[M])));let C=null;if(f.length===4){if(S.type.kind!=="string"&&M.type.kind!=="string"&&S.type.kind!=="value"&&M.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(C=p.parse(f[3],3,cm),!C)return null}return new fw(S,M,C)}evaluate(f){const p=this.lhs.evaluate(f),s=this.rhs.evaluate(f);if(r&&this.hasUntypedArgument){const S=er(p),M=er(s);if(S.kind!==M.kind||!(S.kind==="string"||S.kind==="number"))throw new Li(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${S.kind}, ${M.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const S=er(p),M=er(s);if(S.kind!=="string"||M.kind!=="string")return e(f,p,s)}return this.collator?n(f,p,s,this.collator.evaluate(f)):e(f,p,s)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const UE=Yu("==",CE,pw),BE=Yu("!=",PE,kE),VE=Yu("<",IE,zE),GE=Yu(">",RE,FE),HE=Yu("<=",LE,OE),jE=Yu(">=",DE,NE);let mw=class gw{constructor(e,n,r){this.type=cm,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const u=n.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,In);if(!u)return null;const f=n.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,In);if(!f)return null;let p=null;return r.locale&&(p=n.parse(r.locale,1,Bn),!p)?null:new gw(u,f,p)}evaluate(e){return new Gy(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}};class qy{constructor(e,n,r,u,f){this.type=Bn,this.number=e,this.locale=n,this.currency=r,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const r=n.parse(e[1],1,Et);if(!r)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,Bn),!f))return null;let p=null;if(u.currency&&(p=n.parse(u.currency,1,Bn),!p))return null;let s=null;if(u["min-fraction-digits"]&&(s=n.parse(u["min-fraction-digits"],1,Et),!s))return null;let S=null;return u["max-fraction-digits"]&&(S=n.parse(u["max-fraction-digits"],1,Et),!S)?null:new qy(r,f,p,s,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Zy{constructor(e){this.type=um,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const s=e[p];if(f&&typeof s=="object"&&!Array.isArray(s)){f=!1;let S=null;if(s["font-scale"]&&(S=n.parse(s["font-scale"],1,Et),!S))return null;let M=null;if(s["text-font"]&&(M=n.parse(s["text-font"],1,vs(Bn)),!M))return null;let C=null;if(s["text-color"]&&(C=n.parse(s["text-color"],1,Sa),!C))return null;let I=null;if(s["vertical-align"]){if(typeof s["vertical-align"]=="string"&&!bE.includes(s["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${s["vertical-align"]}' instead.`);if(I=n.parse(s["vertical-align"],1,Bn),!I)return null}const L=u[u.length-1];L.scale=S,L.font=M,L.textColor=C,L.verticalAlign=I}else{const S=n.parse(e[p],1,Sn);if(!S)return null;const M=S.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Zy(u)}evaluate(e){const n=r=>{const u=r.content.evaluate(e);return er(u)===$d?new N_("",u,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new N_(Ad(u),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)};return new Wd(this.sections.map(n))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Xy{constructor(e){this.type=$d,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const r=n.parse(e[1],1,Bn);return r?new Xy(r):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),r=nl.fromString(n);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(n)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class Yy{constructor(e){this.type=Et,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Pi(r.type)} instead.`):new Yy(r):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Li(`Expected value to be of type string or array, but found ${Pi(er(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ea=8192;function $E(c,e){const n=WE(c[0]),r=ZE(c[1]),u=Math.pow(2,e.z);return[Math.round(n*u*Ea),Math.round(r*u*Ea)]}function Ky(c,e){const n=Math.pow(2,e.z),r=(c[0]/Ea+e.x)/n,u=(c[1]/Ea+e.y)/n;return[qE(r),XE(u)]}function WE(c){return(180+c)/360}function qE(c){return c*360-180}function ZE(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function XE(c){return 360/Math.PI*Math.atan(Math.exp((180-c*360)*Math.PI/180))-90}function qd(c,e){c[0]=Math.min(c[0],e[0]),c[1]=Math.min(c[1],e[1]),c[2]=Math.max(c[2],e[0]),c[3]=Math.max(c[3],e[1])}function Od(c,e){return!(c[0]<=e[0]||c[2]>=e[2]||c[1]<=e[1]||c[3]>=e[3])}function YE(c,e,n){return e[1]>c[1]!=n[1]>c[1]&&c[0]<(n[0]-e[0])*(c[1]-e[1])/(n[1]-e[1])+e[0]}function KE(c,e,n){const r=c[0]-e[0],u=c[1]-e[1],f=c[0]-n[0],p=c[1]-n[1];return r*p-f*u===0&&r*f<=0&&u*p<=0}function fm(c,e,n,r){const u=[e[0]-c[0],e[1]-c[1]],f=[r[0]-n[0],r[1]-n[1]];return tA(f,u)===0?!1:!!(Ox(c,e,n,r)&&Ox(n,r,c,e))}function JE(c,e,n){for(const r of n)for(let u=0;u<r.length-1;++u)if(fm(c,e,r[u],r[u+1]))return!0;return!1}function Ku(c,e,n=!1){let r=!1;for(const u of e)for(let f=0;f<u.length-1;f++){if(KE(c,u[f],u[f+1]))return n;YE(c,u[f],u[f+1])&&(r=!r)}return r}function QE(c,e){for(const n of e)if(Ku(c,n))return!0;return!1}function _w(c,e){for(const n of c)if(!Ku(n,e))return!1;for(let n=0;n<c.length-1;++n)if(JE(c[n],c[n+1],e))return!1;return!0}function eA(c,e){for(const n of e)if(_w(c,n))return!0;return!1}function tA(c,e){return c[0]*e[1]-c[1]*e[0]}function Ox(c,e,n,r){const u=c[0]-n[0],f=c[1]-n[1],p=e[0]-n[0],s=e[1]-n[1],S=r[0]-n[0],M=r[1]-n[1],C=u*M-S*f,I=p*M-S*s;return C>0&&I<0||C<0&&I>0}function Jy(c,e,n){const r=[];for(let u=0;u<c.length;u++){const f=[];for(let p=0;p<c[u].length;p++){const s=$E(c[u][p],n);qd(e,s),f.push(s)}r.push(f)}return r}function yw(c,e,n){const r=[];for(let u=0;u<c.length;u++){const f=Jy(c[u],e,n);r.push(f)}return r}function vw(c,e,n,r){if(c[0]<n[0]||c[0]>n[2]){const u=r*.5;let f=c[0]-n[0]>u?-r:n[0]-c[0]>u?r:0;f===0&&(f=c[0]-n[2]>u?-r:n[2]-c[0]>u?r:0),c[0]+=f}qd(e,c)}function nA(c){c[0]=c[1]=1/0,c[2]=c[3]=-1/0}function Nx(c,e,n,r){const u=Math.pow(2,r.z)*Ea,f=[r.x*Ea,r.y*Ea],p=[];for(const s of c)for(const S of s){const M=[S.x+f[0],S.y+f[1]];vw(M,e,n,u),p.push(M)}return p}function Ux(c,e,n,r){const u=Math.pow(2,r.z)*Ea,f=[r.x*Ea,r.y*Ea],p=[];for(const s of c){const S=[];for(const M of s){const C=[M.x+f[0],M.y+f[1]];qd(e,C),S.push(C)}p.push(S)}if(e[2]-e[0]<=u/2){nA(e);for(const s of p)for(const S of s)vw(S,e,n,u)}return p}function iA(c,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],u=c.canonicalID();if(e.type==="Polygon"){const f=Jy(e.coordinates,r,u),p=Nx(c.geometry(),n,r,u);if(!Od(n,r))return!1;for(const s of p)if(!Ku(s,f))return!1}if(e.type==="MultiPolygon"){const f=yw(e.coordinates,r,u),p=Nx(c.geometry(),n,r,u);if(!Od(n,r))return!1;for(const s of p)if(!QE(s,f))return!1}return!0}function rA(c,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],u=c.canonicalID();if(e.type==="Polygon"){const f=Jy(e.coordinates,r,u),p=Ux(c.geometry(),n,r,u);if(!Od(n,r))return!1;for(const s of p)if(!_w(s,f))return!1}if(e.type==="MultiPolygon"){const f=yw(e.coordinates,r,u),p=Ux(c.geometry(),n,r,u);if(!Od(n,r))return!1;for(const s of p)if(!eA(s,f))return!1}return!0}class cc{constructor(e,n){this.type=In,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zd(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const u=[];for(const f of r.features){const{type:p,coordinates:s}=f.geometry;p==="Polygon"&&u.push(s),p==="MultiPolygon"&&u.push(...s)}if(u.length){const f={type:"MultiPolygon",coordinates:u};return new cc(r,f)}}else if(r.type==="Feature"){const u=r.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new cc(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new cc(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return iA(e,this.geometries);if(e.geometryType()==="LineString")return rA(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class xw{constructor(e=[],n=(r,u)=>r<u?-1:r>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,u=n[e];for(;e>0;){const f=e-1>>1,p=n[f];if(r(u,p)>=0)break;n[e]=p,e=f}n[e]=u}_down(e){const{data:n,compare:r}=this,u=this.length>>1,f=n[e];for(;e<u;){let p=(e<<1)+1;const s=p+1;if(s<this.length&&r(n[s],n[p])<0&&(p=s),r(n[p],f)>=0)break;n[e]=n[p],e=p}n[e]=f}}function sA(c,e){if(c.length<=1)return[c];const n=[];let r,u;for(const f of c){const p=aA(f);p!==0&&(f.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(r&&n.push(r),r=[f]):r.push(f))}return r&&n.push(r),n}function aA(c){let e=0;for(let n=0,r=c.length,u=r-1,f,p;n<r;u=n++)f=c[n],p=c[u],e+=(p.x-f.x)*(f.y+p.y);return e}const oA=6378.137,Bx=1/298.257223563,Vx=Bx*(2-Bx),Gx=Math.PI/180;class Qy{constructor(e){const n=Gx*oA*1e3,r=Math.cos(e*Gx),u=1/(1-Vx*(1-r*r)),f=Math.sqrt(u);this.kx=n*f*r,this.ky=n*f*u*(1-Vx)}distance(e,n){const r=this.wrap(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(r*r+u*u)}pointOnLine(e,n){let r=1/0,u,f,p,s;for(let S=0;S<e.length-1;S++){let M=e[S][0],C=e[S][1],I=this.wrap(e[S+1][0]-M)*this.kx,L=(e[S+1][1]-C)*this.ky,R=0;(I!==0||L!==0)&&(R=(this.wrap(n[0]-M)*this.kx*I+(n[1]-C)*this.ky*L)/(I*I+L*L),R>1?(M=e[S+1][0],C=e[S+1][1]):R>0&&(M+=I/this.kx*R,C+=L/this.ky*R)),I=this.wrap(n[0]-M)*this.kx,L=(n[1]-C)*this.ky;const B=I*I+L*L;B<r&&(r=B,u=M,f=C,p=S,s=R)}return{point:[u,f],index:p,t:Math.max(0,Math.min(1,s))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const U_=100,B_=50;function bw(c,e){return e[0]-c[0]}function Yf(c){return c[1]-c[0]+1}function so(c,e){return c[1]>=c[0]&&c[1]<e}function V_(c,e){if(c[0]>c[1])return[null,null];const n=Yf(c);if(e){if(n===2)return[c,null];const u=Math.floor(n/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}if(n===1)return[c,null];const r=Math.floor(n/2)-1;return[[c[0],c[0]+r],[c[0]+r+1,c[1]]]}function G_(c,e){if(!so(e,c.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)qd(n,c[r]);return n}function H_(c){const e=[1/0,1/0,-1/0,-1/0];for(const n of c)for(const r of n)qd(e,r);return e}function Hx(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function ev(c,e,n){if(!Hx(c)||!Hx(e))return NaN;let r=0,u=0;return c[2]<e[0]&&(r=e[0]-c[2]),c[0]>e[2]&&(r=c[0]-e[2]),c[1]>e[3]&&(u=c[1]-e[3]),c[3]<e[1]&&(u=e[1]-c[3]),n.distance([0,0],[r,u])}function ic(c,e,n){const r=n.pointOnLine(e,c);return n.distance(c,r.point)}function tv(c,e,n,r,u){const f=Math.min(ic(c,[n,r],u),ic(e,[n,r],u)),p=Math.min(ic(n,[c,e],u),ic(r,[c,e],u));return Math.min(f,p)}function lA(c,e,n,r,u){if(!(so(e,c.length)&&so(r,n.length)))return 1/0;let f=1/0;for(let p=e[0];p<e[1];++p){const s=c[p],S=c[p+1];for(let M=r[0];M<r[1];++M){const C=n[M],I=n[M+1];if(fm(s,S,C,I))return 0;f=Math.min(f,tv(s,S,C,I,u))}}return f}function cA(c,e,n,r,u){if(!(so(e,c.length)&&so(r,n.length)))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let s=r[0];s<=r[1];++s)if(f=Math.min(f,u.distance(c[p],n[s])),f===0)return f;return f}function uA(c,e,n){if(Ku(c,e,!0))return 0;let r=1/0;for(const u of e){const f=u[0],p=u[u.length-1];if(f!==p&&(r=Math.min(r,ic(c,[p,f],n)),r===0))return r;const s=n.pointOnLine(u,c);if(r=Math.min(r,n.distance(c,s.point)),r===0)return r}return r}function hA(c,e,n,r){if(!so(e,c.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Ku(c[f],n,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const p=c[f],s=c[f+1];for(const S of n)for(let M=0,C=S.length,I=C-1;M<C;I=M++){const L=S[I],R=S[M];if(fm(p,s,L,R))return 0;u=Math.min(u,tv(p,s,L,R,r))}}return u}function jx(c,e){for(const n of c)for(const r of n)if(Ku(r,e,!0))return!0;return!1}function dA(c,e,n,r=1/0){const u=H_(c),f=H_(e);if(r!==1/0&&ev(u,f,n)>=r)return r;if(Od(u,f)){if(jx(c,e))return 0}else if(jx(e,c))return 0;let p=1/0;for(const s of c)for(let S=0,M=s.length,C=M-1;S<M;C=S++){const I=s[C],L=s[S];for(const R of e)for(let B=0,Z=R.length,V=Z-1;B<Z;V=B++){const O=R[V],ge=R[B];if(fm(I,L,O,ge))return 0;p=Math.min(p,tv(I,L,O,ge,n))}}return p}function $x(c,e,n,r,u,f){if(!f)return;const p=ev(G_(r,f),u,n);p<e&&c.push([p,f,[0,0]])}function af(c,e,n,r,u,f,p){if(!f||!p)return;const s=ev(G_(r,f),G_(u,p),n);s<e&&c.push([s,f,p])}function Kf(c,e,n,r,u=1/0){let f=Math.min(r.distance(c[0],n[0][0]),u);if(f===0)return f;const p=new xw([[0,[0,c.length-1],[0,0]]],bw),s=H_(n);for(;p.length>0;){const S=p.pop();if(S[0]>=f)continue;const M=S[1],C=e?B_:U_;if(Yf(M)<=C){if(!so(M,c.length))return NaN;if(e){const I=hA(c,M,n,r);if(isNaN(I)||I===0)return I;f=Math.min(f,I)}else for(let I=M[0];I<=M[1];++I){const L=uA(c[I],n,r);if(f=Math.min(f,L),f===0)return 0}}else{const I=V_(M,e);$x(p,f,r,c,s,I[0]),$x(p,f,r,c,s,I[1])}}return f}function Jf(c,e,n,r,u,f=1/0){let p=Math.min(f,u.distance(c[0],n[0]));if(p===0)return p;const s=new xw([[0,[0,c.length-1],[0,n.length-1]]],bw);for(;s.length>0;){const S=s.pop();if(S[0]>=p)continue;const M=S[1],C=S[2],I=e?B_:U_,L=r?B_:U_;if(Yf(M)<=I&&Yf(C)<=L){if(!so(M,c.length)&&so(C,n.length))return NaN;let R;if(e&&r)R=lA(c,M,n,C,u),p=Math.min(p,R);else if(e&&!r){const B=c.slice(M[0],M[1]+1);for(let Z=C[0];Z<=C[1];++Z)if(R=ic(n[Z],B,u),p=Math.min(p,R),p===0)return p}else if(!e&&r){const B=n.slice(C[0],C[1]+1);for(let Z=M[0];Z<=M[1];++Z)if(R=ic(c[Z],B,u),p=Math.min(p,R),p===0)return p}else R=cA(c,M,n,C,u),p=Math.min(p,R)}else{const R=V_(M,e),B=V_(C,r);af(s,p,u,c,n,R[0],B[0]),af(s,p,u,c,n,R[0],B[1]),af(s,p,u,c,n,R[1],B[0]),af(s,p,u,c,n,R[1],B[1])}}return p}function pA(c,e){const n=c.geometry(),r=n.flat().map(p=>Ky([p.x,p.y],c.canonical));if(n.length===0)return NaN;const u=new Qy(r[0][1]);let f=1/0;for(const p of e){switch(p.type){case"Point":f=Math.min(f,Jf(r,!1,[p.coordinates],!1,u,f));break;case"LineString":f=Math.min(f,Jf(r,!1,p.coordinates,!0,u,f));break;case"Polygon":f=Math.min(f,Kf(r,!1,p.coordinates,u,f));break}if(f===0)return f}return f}function fA(c,e){const n=c.geometry(),r=n.flat().map(p=>Ky([p.x,p.y],c.canonical));if(n.length===0)return NaN;const u=new Qy(r[0][1]);let f=1/0;for(const p of e){switch(p.type){case"Point":f=Math.min(f,Jf(r,!0,[p.coordinates],!1,u,f));break;case"LineString":f=Math.min(f,Jf(r,!0,p.coordinates,!0,u,f));break;case"Polygon":f=Math.min(f,Kf(r,!0,p.coordinates,u,f));break}if(f===0)return f}return f}function mA(c,e){const n=c.geometry();if(n.length===0||n[0].length===0)return NaN;const r=sA(n).map(p=>p.map(s=>s.map(S=>Ky([S.x,S.y],c.canonical)))),u=new Qy(r[0][0][0][1]);let f=1/0;for(const p of e)for(const s of r){switch(p.type){case"Point":f=Math.min(f,Kf([p.coordinates],!1,s,u,f));break;case"LineString":f=Math.min(f,Kf(p.coordinates,!0,s,u,f));break;case"Polygon":f=Math.min(f,dA(s,p.coordinates,u,f));break}if(f===0)return f}return f}function Wg(c){return c.type==="MultiPolygon"?c.coordinates.map(e=>({type:"Polygon",coordinates:e})):c.type==="MultiLineString"?c.coordinates.map(e=>({type:"LineString",coordinates:e})):c.type==="MultiPoint"?c.coordinates.map(e=>({type:"Point",coordinates:e})):[c]}class uc{constructor(e,n){this.type=Et,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zd(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new uc(r,r.features.map(u=>Wg(u.geometry)).flat());if(r.type==="Feature")return new uc(r,Wg(r.geometry));if("type"in r&&"coordinates"in r)return new uc(r,Wg(r))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return pA(e,this.geometries);if(e.geometryType()==="LineString")return fA(e,this.geometries);if(e.geometryType()==="Polygon")return mA(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Zd{constructor(e){this.type=Sn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=e[1];return r==null?n.error("Global state property must be defined."):typeof r!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Zd(r)}evaluate(e){var n;const r=(n=e.globals)===null||n===void 0?void 0:n.globalState;return!r||Object.keys(r).length===0?null:Ed(r,this.key)}eachChild(){}outputDefined(){return!1}}const nv={"==":UE,"!=":BE,">":GE,"<":VE,">=":jE,"<=":HE,array:Xs,at:Hy,boolean:Xs,case:Wy,coalesce:Fd,collator:mw,format:Zy,image:Xy,in:jy,"index-of":Zf,interpolate:Ta,"interpolate-hcl":Ta,"interpolate-lab":Ta,length:Yy,let:aw,literal:Fu,match:$y,number:Xs,"number-format":qy,object:Xs,slice:Xf,step:hw,string:Xs,"to-boolean":Eu,"to-color":Eu,"to-number":Eu,"to-string":Eu,var:lw,within:cc,distance:uc,"global-state":Zd};class ea{constructor(e,n,r,u){this.name=e,this.type=n,this._evaluate=r,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const r=e[0],u=ea.definitions[r];if(!u)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,s=p.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let S=null;for(const[M,C]of s){S=new rw(n.registry,Qf,n.path,null,n.scope);const I=[];let L=!1;for(let R=1;R<e.length;R++){const B=e[R],Z=Array.isArray(M)?M[R-1]:M.type,V=S.parse(B,1+I.length,Z);if(!V){L=!0;break}I.push(V)}if(!L){if(Array.isArray(M)&&M.length!==I.length){S.error(`Expected ${M.length} arguments, but found ${I.length} instead.`);continue}for(let R=0;R<I.length;R++){const B=Array.isArray(M)?M[R]:M.type,Z=I[R];S.concat(R+1).checkSubtype(B,Z.type)}if(S.errors.length===0)return new ea(r,f,C,I)}}if(s.length===1)n.errors.push(...S.errors);else{const M=(s.length?s:p).map(([I])=>_A(I)).join(" | "),C=[];for(let I=1;I<e.length;I++){const L=n.parse(e[I],1+C.length);if(!L)return null;C.push(Pi(L.type))}n.error(`Expected arguments of type ${M}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){ea.definitions=n;for(const r in n)e[r]=ea}}function Wx(c,[e,n,r,u]){e=e.evaluate(c),n=n.evaluate(c),r=r.evaluate(c);const f=u?u.evaluate(c):1,p=tw(e,n,r,f);if(p)throw new Li(p);return new ui(e/255,n/255,r/255,f,!1)}function qx(c,e){return c in e}function qg(c,e){const n=e[c];return typeof n>"u"?null:n}function gA(c,e,n,r){for(;n<=r;){const u=n+r>>1;if(e[u]===c)return!0;e[u]>c?r=u-1:n=u+1}return!1}function Hl(c){return{type:c}}ea.register(nv,{error:[uE,[Bn],(c,[e])=>{throw new Li(e.evaluate(c))}],typeof:[Bn,[Sn],(c,[e])=>Pi(er(e.evaluate(c)))],"to-rgba":[vs(Et,4),[Sa],(c,[e])=>{const[n,r,u,f]=e.evaluate(c).rgb;return[n*255,r*255,u*255,f]}],rgb:[Sa,[Et,Et,Et],Wx],rgba:[Sa,[Et,Et,Et,Et],Wx],has:{type:In,overloads:[[[Bn],(c,[e])=>qx(e.evaluate(c),c.properties())],[[Bn,ac],(c,[e,n])=>qx(e.evaluate(c),n.evaluate(c))]]},get:{type:Sn,overloads:[[[Bn],(c,[e])=>qg(e.evaluate(c),c.properties())],[[Bn,ac],(c,[e,n])=>qg(e.evaluate(c),n.evaluate(c))]]},"feature-state":[Sn,[Bn],(c,[e])=>qg(e.evaluate(c),c.featureState||{})],properties:[ac,[],c=>c.properties()],"geometry-type":[Bn,[],c=>c.geometryType()],id:[Sn,[],c=>c.id()],zoom:[Et,[],c=>c.globals.zoom],"heatmap-density":[Et,[],c=>c.globals.heatmapDensity||0],elevation:[Et,[],c=>c.globals.elevation||0],"line-progress":[Et,[],c=>c.globals.lineProgress||0],accumulated:[Sn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Et,Hl(Et),(c,e)=>{let n=0;for(const r of e)n+=r.evaluate(c);return n}],"*":[Et,Hl(Et),(c,e)=>{let n=1;for(const r of e)n*=r.evaluate(c);return n}],"-":{type:Et,overloads:[[[Et,Et],(c,[e,n])=>e.evaluate(c)-n.evaluate(c)],[[Et],(c,[e])=>-e.evaluate(c)]]},"/":[Et,[Et,Et],(c,[e,n])=>e.evaluate(c)/n.evaluate(c)],"%":[Et,[Et,Et],(c,[e,n])=>e.evaluate(c)%n.evaluate(c)],ln2:[Et,[],()=>Math.LN2],pi:[Et,[],()=>Math.PI],e:[Et,[],()=>Math.E],"^":[Et,[Et,Et],(c,[e,n])=>Math.pow(e.evaluate(c),n.evaluate(c))],sqrt:[Et,[Et],(c,[e])=>Math.sqrt(e.evaluate(c))],log10:[Et,[Et],(c,[e])=>Math.log(e.evaluate(c))/Math.LN10],ln:[Et,[Et],(c,[e])=>Math.log(e.evaluate(c))],log2:[Et,[Et],(c,[e])=>Math.log(e.evaluate(c))/Math.LN2],sin:[Et,[Et],(c,[e])=>Math.sin(e.evaluate(c))],cos:[Et,[Et],(c,[e])=>Math.cos(e.evaluate(c))],tan:[Et,[Et],(c,[e])=>Math.tan(e.evaluate(c))],asin:[Et,[Et],(c,[e])=>Math.asin(e.evaluate(c))],acos:[Et,[Et],(c,[e])=>Math.acos(e.evaluate(c))],atan:[Et,[Et],(c,[e])=>Math.atan(e.evaluate(c))],min:[Et,Hl(Et),(c,e)=>Math.min(...e.map(n=>n.evaluate(c)))],max:[Et,Hl(Et),(c,e)=>Math.max(...e.map(n=>n.evaluate(c)))],abs:[Et,[Et],(c,[e])=>Math.abs(e.evaluate(c))],round:[Et,[Et],(c,[e])=>{const n=e.evaluate(c);return n<0?-Math.round(-n):Math.round(n)}],floor:[Et,[Et],(c,[e])=>Math.floor(e.evaluate(c))],ceil:[Et,[Et],(c,[e])=>Math.ceil(e.evaluate(c))],"filter-==":[In,[Bn,Sn],(c,[e,n])=>c.properties()[e.value]===n.value],"filter-id-==":[In,[Sn],(c,[e])=>c.id()===e.value],"filter-type-==":[In,[Bn],(c,[e])=>c.geometryType()===e.value],"filter-<":[In,[Bn,Sn],(c,[e,n])=>{const r=c.properties()[e.value],u=n.value;return typeof r==typeof u&&r<u}],"filter-id-<":[In,[Sn],(c,[e])=>{const n=c.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[In,[Bn,Sn],(c,[e,n])=>{const r=c.properties()[e.value],u=n.value;return typeof r==typeof u&&r>u}],"filter-id->":[In,[Sn],(c,[e])=>{const n=c.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[In,[Bn,Sn],(c,[e,n])=>{const r=c.properties()[e.value],u=n.value;return typeof r==typeof u&&r<=u}],"filter-id-<=":[In,[Sn],(c,[e])=>{const n=c.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[In,[Bn,Sn],(c,[e,n])=>{const r=c.properties()[e.value],u=n.value;return typeof r==typeof u&&r>=u}],"filter-id->=":[In,[Sn],(c,[e])=>{const n=c.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[In,[Sn],(c,[e])=>e.value in c.properties()],"filter-has-id":[In,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[In,[vs(Bn)],(c,[e])=>e.value.indexOf(c.geometryType())>=0],"filter-id-in":[In,[vs(Sn)],(c,[e])=>e.value.indexOf(c.id())>=0],"filter-in-small":[In,[Bn,vs(Sn)],(c,[e,n])=>n.value.indexOf(c.properties()[e.value])>=0],"filter-in-large":[In,[Bn,vs(Sn)],(c,[e,n])=>gA(c.properties()[e.value],n.value,0,n.value.length-1)],all:{type:In,overloads:[[[In,In],(c,[e,n])=>e.evaluate(c)&&n.evaluate(c)],[Hl(In),(c,e)=>{for(const n of e)if(!n.evaluate(c))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(c,[e,n])=>e.evaluate(c)||n.evaluate(c)],[Hl(In),(c,e)=>{for(const n of e)if(n.evaluate(c))return!0;return!1}]]},"!":[In,[In],(c,[e])=>!e.evaluate(c)],"is-supported-script":[In,[Bn],(c,[e])=>{const n=c.globals&&c.globals.isSupportedScript;return n?n(e.evaluate(c)):!0}],upcase:[Bn,[Bn],(c,[e])=>e.evaluate(c).toUpperCase()],downcase:[Bn,[Bn],(c,[e])=>e.evaluate(c).toLowerCase()],concat:[Bn,Hl(Sn),(c,e)=>e.map(n=>Ad(n.evaluate(c))).join("")],"resolved-locale":[Bn,[cm],(c,[e])=>e.evaluate(c).resolvedLocale()]});function _A(c){return Array.isArray(c)?`(${c.map(Pi).join(", ")})`:`(${Pi(c.type)}...)`}function Qf(c){if(c instanceof lw)return Qf(c.boundExpression);if(c instanceof ea&&c.name==="error"||c instanceof mw||c instanceof cc||c instanceof uc||c instanceof Zd)return!1;const e=c instanceof Eu||c instanceof Xs;let n=!0;return c.eachChild(r=>{e?n=n&&Qf(r):n=n&&r instanceof Fu}),n?mm(c)&&gm(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function mm(c){if(c instanceof ea&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof cc||c instanceof uc)return!1;let e=!0;return c.eachChild(n=>{e&&!mm(n)&&(e=!1)}),e}function Nd(c){if(c instanceof ea&&c.name==="feature-state")return!1;let e=!0;return c.eachChild(n=>{e&&!Nd(n)&&(e=!1)}),e}function gm(c,e){if(c instanceof ea&&e.indexOf(c.name)>=0)return!1;let n=!0;return c.eachChild(r=>{n&&!gm(r,e)&&(n=!1)}),n}function j_(c){return{result:"success",value:c}}function Mu(c){return{result:"error",value:c}}function em(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function ww(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Sw(c){return!!c.expression&&c.expression.interpolated}function jn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function iv(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&er(c)===ac}class yA{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new iw,this._defaultValue=n?bA(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,r,u,f,p){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,u,f,p){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null;try{const s=this.expression.evaluate(this._evaluator);if(s==null||typeof s=="number"&&s!==s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new Li(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(s)} instead.`);return s}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0,typeof console<"u"&&console.warn(s.message)),this._defaultValue}}}function Mw(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in nv}function Tw(c,e){const n=new rw(nv,Qf,[],e?xA(e):void 0),r=n.parse(c,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?j_(new yA(r,e)):Mu(n.errors)}class Zx{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Nd(n.expression),this.globalStateRefs=rv(n.expression)}evaluateWithoutErrorHandling(e,n,r,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,u,f,p)}evaluate(e,n,r,u,f,p){return this._styleExpression.evaluate(e,n,r,u,f,p)}}class Xx{constructor(e,n,r,u){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Nd(n.expression),this.globalStateRefs=rv(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,r,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,u,f,p)}evaluate(e,n,r,u,f,p){return this._styleExpression.evaluate(e,n,r,u,f,p)}interpolationFactor(e,n,r){return this.interpolationType?Ta.interpolationFactor(this.interpolationType,e,n,r):0}}function vA(c,e){const n=Tw(c,e);if(n.result==="error")return n;const r=n.value.expression,u=mm(r);if(!u&&!em(e))return Mu([new ba("","data expressions not supported")]);const f=gm(r,["zoom"]);if(!f&&!ww(e))return Mu([new ba("","zoom expressions not supported")]);const p=Nf(r);if(!p&&!f)return Mu([new ba("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(p instanceof ba)return Mu([p]);if(p instanceof Ta&&!Sw(e))return Mu([new ba("",'"interpolate" expressions cannot be used with this property')]);if(!p)return j_(u?new Zx("constant",n.value):new Zx("source",n.value));const s=p instanceof Ta?p.interpolation:void 0;return j_(u?new Xx("camera",n.value,p.labels,s):new Xx("composite",n.value,p.labels,s))}function Nf(c){let e=null;if(c instanceof aw)e=Nf(c.result);else if(c instanceof Fd){for(const n of c.args)if(e=Nf(n),e)break}else(c instanceof hw||c instanceof Ta)&&c.input instanceof ea&&c.input.name==="zoom"&&(e=c);return e instanceof ba||c.eachChild(n=>{const r=Nf(n);r instanceof ba?e=r:!e&&r?e=new ba("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new ba("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function rv(c,e=new Set){return c instanceof Zd&&e.add(c.key),c.eachChild(n=>{rv(n,e)}),e}function xA(c){const e={color:Sa,string:Bn,number:Et,enum:Bn,boolean:In,formatted:um,padding:hm,numberArray:dm,colorArray:Ld,projectionDefinition:lm,resolvedImage:$d,variableAnchorOffsetCollection:pm};return c.type==="array"?vs(e[c.value]||Sn,c.length):e[c.type]}function bA(c){if(c.type==="color"&&iv(c.default))return new ui(0,0,0,0);switch(c.type){case"color":return ui.parse(c.default)||null;case"padding":return Js.parse(c.default)||null;case"numberArray":return Qs.parse(c.default)||null;case"colorArray":return xs.parse(c.default)||null;case"variableAnchorOffsetCollection":return Ma.parse(c.default)||null;case"projectionDefinition":return Zs.parse(c.default)||null;default:return c.default===void 0?null:c.default}}function Ew(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const e of c.slice(1))if(!Ew(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Aw(c){const e=c.key,n=c.value;return n?[new Mt(e,n,"constants have been deprecated as of v8")]:[]}function Ni(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function hc(c){if(Array.isArray(c))return c.map(hc);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const e={};for(const n in c)e[n]=hc(c[n]);return e}return Ni(c)}function Ds(c){const e=c.key,n=c.value,r=c.valueSpec||{},u=c.objectElementValidators||{},f=c.style,p=c.styleSpec,s=c.validateSpec;let S=[];const M=jn(n);if(M!=="object")return[new Mt(e,n,`object expected, ${M} found`)];for(const C in n){const I=C.split(".")[0],L=Ed(r,I)||r["*"];let R;if(Ed(u,I))R=u[I];else if(Ed(r,I))R=s;else if(u["*"])R=u["*"];else if(r["*"])R=s;else{S.push(new Mt(e,n[C],`unknown property "${C}"`));continue}S=S.concat(R({key:(e&&`${e}.`)+C,value:n[C],valueSpec:L,style:f,styleSpec:p,object:n,objectKey:C,validateSpec:s},n))}for(const C in r)u[C]||r[C].required&&r[C].default===void 0&&n[C]===void 0&&S.push(new Mt(e,n,`missing required property "${C}"`));return S}function sv(c){const e=c.value,n=c.valueSpec,r=c.validateSpec,u=c.style,f=c.styleSpec,p=c.key,s=c.arrayElementValidator||r;if(jn(e)!=="array")return[new Mt(p,e,`array expected, ${jn(e)} found`)];if(n.length&&e.length!==n.length)return[new Mt(p,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Mt(p,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let S={type:n.value,values:n.values};f.$version<7&&(S.function=n.function),jn(n.value)==="object"&&(S=n.value);let M=[];for(let C=0;C<e.length;C++)M=M.concat(s({array:e,arrayIndex:C,value:e[C],valueSpec:S,validateSpec:c.validateSpec,style:u,styleSpec:f,key:`${p}[${C}]`}));return M}function _m(c){const e=c.key,n=c.value,r=c.valueSpec;let u=jn(n);return u==="number"&&n!==n&&(u="NaN"),u!=="number"?[new Mt(e,n,`number expected, ${u} found`)]:"minimum"in r&&n<r.minimum?[new Mt(e,n,`${n} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&n>r.maximum?[new Mt(e,n,`${n} is greater than the maximum value ${r.maximum}`)]:[]}function Cw(c){const e=c.valueSpec,n=Ni(c.value.type);let r,u={},f,p;const s=n!=="categorical"&&c.value.property===void 0,S=!s,M=jn(c.value.stops)==="array"&&jn(c.value.stops[0])==="array"&&jn(c.value.stops[0][0])==="object",C=Ds({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:I,default:B}});return n==="identity"&&s&&C.push(new Mt(c.key,c.value,'missing required property "property"')),n!=="identity"&&!c.value.stops&&C.push(new Mt(c.key,c.value,'missing required property "stops"')),n==="exponential"&&c.valueSpec.expression&&!Sw(c.valueSpec)&&C.push(new Mt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(S&&!em(c.valueSpec)?C.push(new Mt(c.key,c.value,"property functions not supported")):s&&!ww(c.valueSpec)&&C.push(new Mt(c.key,c.value,"zoom functions not supported"))),(n==="categorical"||M)&&c.value.property===void 0&&C.push(new Mt(c.key,c.value,'"property" property is required')),C;function I(Z){if(n==="identity")return[new Mt(Z.key,Z.value,'identity function may not have a "stops" property')];let V=[];const O=Z.value;return V=V.concat(sv({key:Z.key,value:O,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:L})),jn(O)==="array"&&O.length===0&&V.push(new Mt(Z.key,O,"array must have at least one stop")),V}function L(Z){let V=[];const O=Z.value,ge=Z.key;if(jn(O)!=="array")return[new Mt(ge,O,`array expected, ${jn(O)} found`)];if(O.length!==2)return[new Mt(ge,O,`array length 2 expected, length ${O.length} found`)];if(M){if(jn(O[0])!=="object")return[new Mt(ge,O,`object expected, ${jn(O[0])} found`)];if(O[0].zoom===void 0)return[new Mt(ge,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Mt(ge,O,"object stop key must have value")];if(p&&p>Ni(O[0].zoom))return[new Mt(ge,O[0].zoom,"stop zoom values must appear in ascending order")];Ni(O[0].zoom)!==p&&(p=Ni(O[0].zoom),f=void 0,u={}),V=V.concat(Ds({key:`${ge}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:_m,value:R}}))}else V=V.concat(R({key:`${ge}[0]`,value:O[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},O));return Mw(hc(O[1]))?V.concat([new Mt(`${ge}[1]`,O[1],"expressions are not allowed in function stops.")]):V.concat(Z.validateSpec({key:`${ge}[1]`,value:O[1],valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function R(Z,V){const O=jn(Z.value),ge=Ni(Z.value),me=Z.value!==null?Z.value:V;if(!r)r=O;else if(O!==r)return[new Mt(Z.key,me,`${O} stop domain type must match previous stop domain type ${r}`)];if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Mt(Z.key,me,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let Q=`number expected, ${O} found`;return em(e)&&n===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(Z.key,me,Q)]}return n==="categorical"&&O==="number"&&(!isFinite(ge)||Math.floor(ge)!==ge)?[new Mt(Z.key,me,`integer expected, found ${ge}`)]:n!=="categorical"&&O==="number"&&f!==void 0&&ge<f?[new Mt(Z.key,me,"stop domain values must appear in ascending order")]:(f=ge,n==="categorical"&&ge in u?[new Mt(Z.key,me,"stop domain values must be unique")]:(u[ge]=!0,[]))}function B(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}function Ou(c){const e=(c.expressionContext==="property"?vA:Tw)(hc(c.value),c.valueSpec);if(e.result==="error")return e.value.map(r=>new Mt(`${c.key}${r.key}`,c.value,r.message));const n=e.value.expression||e.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!n.outputDefined())return[new Mt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Nd(n))return[new Mt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Nd(n))return[new Mt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!gm(n,["zoom","feature-state"]))return[new Mt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!mm(n))return[new Mt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wA(c){const e=c.value,n=c.key,r=jn(e);return r!=="boolean"?[new Mt(n,e,`boolean expected, ${r} found`)]:[]}function $_(c){const e=c.key,n=c.value,r=jn(n);return r!=="string"?[new Mt(e,n,`color expected, ${r} found`)]:ui.parse(String(n))?[]:[new Mt(e,n,`color expected, "${n}" found`)]}function Ud(c){const e=c.key,n=c.value,r=c.valueSpec,u=[];return Array.isArray(r.values)?r.values.indexOf(Ni(n))===-1&&u.push(new Mt(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(Ni(n))===-1&&u.push(new Mt(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function av(c){return Ew(hc(c.value))?Ou(qf({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Pw(c)}function Pw(c){const e=c.value,n=c.key;if(jn(e)!=="array")return[new Mt(n,e,`array expected, ${jn(e)} found`)];const r=c.styleSpec;let u,f=[];if(e.length<1)return[new Mt(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Ud({key:`${n}[0]`,value:e[0],valueSpec:r.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ni(e[1])==="$type"&&f.push(new Mt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Mt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=jn(e[1]),u!=="string"&&f.push(new Mt(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=jn(e[p]),Ni(e[1])==="$type"?f=f.concat(Ud({key:`${n}[${p}]`,value:e[p],valueSpec:r.geometry_type,style:c.style,styleSpec:c.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Mt(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(Pw({key:`${n}[${p}]`,value:e[p],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":u=jn(e[1]),e.length!==2?f.push(new Mt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Mt(`${n}[1]`,e[1],`string expected, ${u} found`));break}return f}function Iw(c,e){const n=c.key,r=c.validateSpec,u=c.style,f=c.styleSpec,p=c.value,s=c.objectKey,S=f[`${e}_${c.layerType}`];if(!S)return[];const M=s.match(/^(.*)-transition$/);if(e==="paint"&&M&&S[M[1]]&&S[M[1]].transition)return r({key:n,value:p,valueSpec:f.transition,style:u,styleSpec:f});const C=c.valueSpec||S[s];if(!C)return[new Mt(n,p,`unknown property "${s}"`)];let I;if(jn(p)==="string"&&em(C)&&!C.tokens&&(I=/^{([^}]+)}$/.exec(p)))return[new Mt(n,p,`"${s}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const L=[];return c.layerType==="symbol"&&(s==="text-field"&&u&&!u.glyphs&&L.push(new Mt(n,p,'use of "text-field" requires a style "glyphs" property')),s==="text-font"&&iv(hc(p))&&Ni(p.type)==="identity"&&L.push(new Mt(n,p,'"text-font" does not support identity functions'))),L.concat(r({key:c.key,value:p,valueSpec:C,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:s}))}function Rw(c){return Iw(c,"paint")}function Lw(c){return Iw(c,"layout")}function Dw(c){let e=[];const n=c.value,r=c.key,u=c.style,f=c.styleSpec;if(jn(n)!=="object")return[new Mt(r,n,`object expected, ${jn(n)} found`)];!n.type&&!n.ref&&e.push(new Mt(r,n,'either "type" or "ref" is required'));let p=Ni(n.type);const s=Ni(n.ref);if(n.id){const S=Ni(n.id);for(let M=0;M<c.arrayIndex;M++){const C=u.layers[M];Ni(C.id)===S&&e.push(new Mt(r,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){["type","source","source-layer","filter","layout"].forEach(M=>{M in n&&e.push(new Mt(r,n[M],`"${M}" is prohibited for ref layers`))});let S;u.layers.forEach(M=>{Ni(M.id)===s&&(S=M)}),S?S.ref?e.push(new Mt(r,n.ref,"ref cannot reference another ref layer")):p=Ni(S.type):e.push(new Mt(r,n.ref,`ref layer "${s}" not found`))}else if(p!=="background")if(!n.source)e.push(new Mt(r,n,'missing required property "source"'));else{const S=u.sources&&u.sources[n.source],M=S&&Ni(S.type);S?M==="vector"&&p==="raster"?e.push(new Mt(r,n.source,`layer "${n.id}" requires a raster source`)):M!=="raster-dem"&&p==="hillshade"?e.push(new Mt(r,n.source,`layer "${n.id}" requires a raster-dem source`)):M!=="raster-dem"&&p==="color-relief"?e.push(new Mt(r,n.source,`layer "${n.id}" requires a raster-dem source`)):M==="raster"&&p!=="raster"?e.push(new Mt(r,n.source,`layer "${n.id}" requires a vector source`)):M==="vector"&&!n["source-layer"]?e.push(new Mt(r,n,`layer "${n.id}" must specify a "source-layer"`)):M==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new Mt(r,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p==="line"&&n.paint&&n.paint["line-gradient"]&&(M!=="geojson"||!S.lineMetrics)&&e.push(new Mt(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Mt(r,n.source,`source "${n.source}" not found`))}return e=e.concat(Ds({key:r,value:n,valueSpec:f.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*"(){return[]},type(){return c.validateSpec({key:`${r}.type`,value:n.type,valueSpec:f.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:n,objectKey:"type"})},filter:av,layout(S){return Ds({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*"(M){return Lw(qf({layerType:p},M))}}})},paint(S){return Ds({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*"(M){return Rw(qf({layerType:p},M))}}})}}})),e}function dc(c){const e=c.value,n=c.key,r=jn(e);return r!=="string"?[new Mt(n,e,`string expected, ${r} found`)]:[]}function SA(c){var e;const n=(e=c.sourceName)!==null&&e!==void 0?e:"",r=c.value,u=c.styleSpec,f=u.source_raster_dem,p=c.style;let s=[];const S=jn(r);if(r===void 0)return s;if(S!=="object")return s.push(new Mt("source_raster_dem",r,`object expected, ${S} found`)),s;const M=Ni(r.encoding)==="custom",C=["redFactor","greenFactor","blueFactor","baseShift"],I=c.value.encoding?`"${c.value.encoding}"`:"Default";for(const L in r)!M&&C.includes(L)?s.push(new Mt(L,r[L],`In "${n}": "${L}" is only valid when "encoding" is set to "custom". ${I} encoding found`)):f[L]?s=s.concat(c.validateSpec({key:L,value:r[L],valueSpec:f[L],validateSpec:c.validateSpec,style:p,styleSpec:u})):s.push(new Mt(L,r[L],`unknown property "${L}"`));return s}const Yx={promoteId:MA};function kw(c){const e=c.value,n=c.key,r=c.styleSpec,u=c.style,f=c.validateSpec;if(!e.type)return[new Mt(n,e,'"type" is required')];const p=Ni(e.type);let s;switch(p){case"vector":case"raster":return s=Ds({key:n,value:e,valueSpec:r[`source_${p.replace("-","_")}`],style:c.style,styleSpec:r,objectElementValidators:Yx,validateSpec:f}),s;case"raster-dem":return s=SA({sourceName:n,value:e,style:c.style,styleSpec:r,validateSpec:f}),s;case"geojson":if(s=Ds({key:n,value:e,valueSpec:r.source_geojson,style:u,styleSpec:r,validateSpec:f,objectElementValidators:Yx}),e.cluster)for(const S in e.clusterProperties){const[M,C]=e.clusterProperties[S],I=typeof M=="string"?[M,["accumulated"],["get",S]]:M;s.push(...Ou({key:`${n}.${S}.map`,value:C,expressionContext:"cluster-map"})),s.push(...Ou({key:`${n}.${S}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return s;case"video":return Ds({key:n,value:e,valueSpec:r.source_video,style:u,validateSpec:f,styleSpec:r});case"image":return Ds({key:n,value:e,valueSpec:r.source_image,style:u,validateSpec:f,styleSpec:r});case"canvas":return[new Mt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ud({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function MA({key:c,value:e}){if(jn(e)==="string")return dc({key:c,value:e});{const n=[];for(const r in e)n.push(...dc({key:`${c}.${r}`,value:e[r]}));return n}}function zw(c){const e=c.value,n=c.styleSpec,r=n.light,u=c.style;let f=[];const p=jn(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Mt("light",e,`object expected, ${p} found`)]),f;for(const s in e){const S=s.match(/^(.*)-transition$/);S&&r[S[1]]&&r[S[1]].transition?f=f.concat(c.validateSpec({key:s,value:e[s],valueSpec:n.transition,validateSpec:c.validateSpec,style:u,styleSpec:n})):r[s]?f=f.concat(c.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:c.validateSpec,style:u,styleSpec:n})):f=f.concat([new Mt(s,e[s],`unknown property "${s}"`)])}return f}function Fw(c){const e=c.value,n=c.styleSpec,r=n.sky,u=c.style,f=jn(e);if(e===void 0)return[];if(f!=="object")return[new Mt("sky",e,`object expected, ${f} found`)];let p=[];for(const s in e)r[s]?p=p.concat(c.validateSpec({key:s,value:e[s],valueSpec:r[s],style:u,styleSpec:n})):p=p.concat([new Mt(s,e[s],`unknown property "${s}"`)]);return p}function Ow(c){const e=c.value,n=c.styleSpec,r=n.terrain,u=c.style;let f=[];const p=jn(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Mt("terrain",e,`object expected, ${p} found`)]),f;for(const s in e)r[s]?f=f.concat(c.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:c.validateSpec,style:u,styleSpec:n})):f=f.concat([new Mt(s,e[s],`unknown property "${s}"`)]);return f}function TA(c){return dc(c).length===0?[]:Ou(c)}function EA(c){return dc(c).length===0?[]:Ou(c)}function AA(c){const e=c.key,n=c.value;if(jn(n)==="array"){if(n.length<1||n.length>4)return[new Mt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const r={type:"number"};let u=[];for(let f=0;f<n.length;f++)u=u.concat(c.validateSpec({key:`${e}[${f}]`,value:n[f],validateSpec:c.validateSpec,valueSpec:r}));return u}else return _m({key:e,value:n,valueSpec:{}})}function CA(c){const e=c.key,n=c.value;if(jn(n)==="array"){const r={type:"number"};if(n.length<1)return[new Mt(e,n,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<n.length;f++)u=u.concat(c.validateSpec({key:`${e}[${f}]`,value:n[f],validateSpec:c.validateSpec,valueSpec:r}));return u}else return _m({key:e,value:n,valueSpec:{}})}function PA(c){const e=c.key,n=c.value;if(jn(n)==="array"){if(n.length<1)return[new Mt(e,n,"array length at least 1 expected, length 0 found")];let r=[];for(let u=0;u<n.length;u++)r=r.concat($_({key:`${e}[${u}]`,value:n[u]}));return r}else return $_({key:e,value:n})}function IA(c){const e=c.key,n=c.value,r=jn(n),u=c.styleSpec;if(r!=="array"||n.length<1||n.length%2!==0)return[new Mt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let p=0;p<n.length;p+=2)f=f.concat(Ud({key:`${e}[${p}]`,value:n[p],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(sv({key:`${e}[${p+1}]`,value:n[p+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:u}));return f}function Nw(c){let e=[];const n=c.value,r=c.key;if(Array.isArray(n)){const u=[],f=[];for(const p in n){n[p].id&&u.includes(n[p].id)&&e.push(new Mt(r,n,`all the sprites' ids must be unique, but ${n[p].id} is duplicated`)),u.push(n[p].id),n[p].url&&f.includes(n[p].url)&&e.push(new Mt(r,n,`all the sprites' URLs must be unique, but ${n[p].url} is duplicated`)),f.push(n[p].url);const s={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(Ds({key:`${r}[${p}]`,value:n[p],valueSpec:s,validateSpec:c.validateSpec}))}return e}else return dc({key:r,value:n})}function RA(c){const e=c.value,n=c.styleSpec,r=n.projection,u=c.style,f=jn(e);if(e===void 0)return[];if(f!=="object")return[new Mt("projection",e,`object expected, ${f} found`)];let p=[];for(const s in e)r[s]?p=p.concat(c.validateSpec({key:s,value:e[s],valueSpec:r[s],style:u,styleSpec:n})):p=p.concat([new Mt(s,e[s],`unknown property "${s}"`)]);return p}function LA(c){const e=c.key;let n=c.value;n=n instanceof String?n.valueOf():n;const r=jn(n);return r==="array"&&!kA(n)&&!DA(n)?[new Mt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]:["array","string"].includes(r)?[]:[new Mt(e,n,`projection expected, invalid type "${r}" found`)]}function DA(c){return!!["interpolate","step","literal"].includes(c[0])}function kA(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"}function zA(c){return!!c&&c.constructor===Object}function Uw(c){return zA(c.value)?[]:[new Mt(c.key,c.value,`object expected, ${jn(c.value)} found`)]}const Kx={"*"(){return[]},array:sv,boolean:wA,number:_m,color:$_,constants:Aw,enum:Ud,filter:av,function:Cw,layer:Dw,object:Ds,source:kw,light:zw,sky:Fw,terrain:Ow,projection:RA,projectionDefinition:LA,string:dc,formatted:TA,resolvedImage:EA,padding:AA,numberArray:CA,colorArray:PA,variableAnchorOffsetCollection:IA,sprite:Nw,state:Uw};function tm(c){const e=c.value,n=c.valueSpec,r=c.styleSpec;return c.validateSpec=tm,n.expression&&iv(Ni(e))?Cw(c):n.expression&&Mw(hc(e))?Ou(c):n.type&&Kx[n.type]?Kx[n.type](c):Ds(qf({},c,{valueSpec:n.type?r[n.type]:n}))}function Bw(c){const e=c.value,n=c.key,r=dc(c);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new Mt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new Mt(n,e,'"glyphs" url must include a "{range}" token'))),r}function ws(c,e=cE){let n=[];return n=n.concat(tm({key:"",value:c,valueSpec:e.$root,styleSpec:e,style:c,validateSpec:tm,objectElementValidators:{glyphs:Bw,"*"(){return[]}}})),c.constants&&(n=n.concat(Aw({key:"constants",value:c.constants}))),Vw(n)}ws.source=ra(ia(kw));ws.sprite=ra(ia(Nw));ws.glyphs=ra(ia(Bw));ws.light=ra(ia(zw));ws.sky=ra(ia(Fw));ws.terrain=ra(ia(Ow));ws.state=ra(ia(Uw));ws.layer=ra(ia(Dw));ws.filter=ra(ia(av));ws.paintProperty=ra(ia(Rw));ws.layoutProperty=ra(ia(Lw));function ia(c){return function(e){return c({...e,validateSpec:tm})}}function Vw(c){return[].concat(c).sort((e,n)=>e.line-n.line)}function ra(c){return function(...e){return Vw(c.apply(this,e))}}function Jx(c){if(!c)return{style:Pu[Td[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof c=="string"){const e=OA(c);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:Pu[Td[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:c.startsWith("http")?{style:c,requiresUrlMonitoring:!0,isFallback:!1}:c.toLowerCase().includes(".json")?{style:FA(c),requiresUrlMonitoring:!0,isFallback:!1}:{style:P1(c),requiresUrlMonitoring:!0,isFallback:!1}}return c instanceof I1?{style:c.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:c instanceof R1?{style:c.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:ws(c).length===0?{style:c,requiresUrlMonitoring:!1,isFallback:!1}:{style:Pu[Td[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function FA(c){try{return new URL(c).href}catch{}return new URL(c,location.origin).href}function OA(c){try{const e=JSON.parse(c),n=ws(e);return{isValidJSON:!0,isValidStyle:n.length===0,styleObject:n.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function no(c,e,n){const r=window.document.createElement(c);return e!==void 0&&(r.className=e),n&&n.appendChild(r),r}function ov(c){c.parentNode&&c.parentNode.removeChild(c)}class NA{constructor(){Mn(this,"_map"),Mn(this,"_container"),Mn(this,"_terrainButton"),l2(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=no("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=no("button","maplibregl-ctrl-terrain",this._container),no("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ov(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class UA extends y2{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),Mn(this,"_rotateCompassArrow",()=>{const n=this._map.getBearing(),r=this._map.getPitch(),u=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(r*(Math.PI/180))**.5)}) rotateX(${Math.min(70,r)}deg) rotateZ(${-n}deg)`:`rotate(${-n}deg)`;this._compassIcon.style.transform=u}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",n=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}))}_createButton(e,n){const r=super._createButton(e,n);return r.clickFunction=n,r}}const Qx=Qt.Marker,eb=Qt.LngLat,BA=Qt.LngLatBounds;class VA extends v2{constructor(){super(...arguments),Mn(this,"lastUpdatedCenter",new eb(0,0)),Mn(this,"_updateCamera",e=>{var n;const r=new eb(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,f={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},p=this._map.getZoom();p>(((n=this.options.fitBoundsOptions)==null?void 0:n.maxZoom)??30)&&(f.zoom=p),this._map.fitBounds(BA.fromLngLat(r,u),f,{geolocateSource:!0});let s=!1;const S=()=>{s=!0};this._map.once("click",S),this._map.once("dblclick",S),this._map.once("dragstart",S),this._map.once("mousedown",S),this._map.once("touchstart",S),this._map.once("wheel",S),this._map.once("moveend",()=>{this._map.off("click",S),this._map.off("dblclick",S),this._map.off("dragstart",S),this._map.off("mousedown",S),this._map.off("touchstart",S),this._map.off("wheel",S),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}),Mn(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=no("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Qx({element:this._dotElement}),this._circleElement=no("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",n=>{const r=n.originalEvent&&n.originalEvent.type==="resize",u=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!n.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!r&&u>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),Mn(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],n=this._map.project(e),r=this._map.unproject([n.x,n.y]),u=this._map.unproject([n.x+20,n.y]),f=r.distanceTo(u)/20,p=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var ys,va,Kl,Jl,Is,Uf,jr,Gw,Rs,Hw;let Zg=class{constructor(e,n){Gl(this,jr),Gl(this,ys),Mn(this,"map"),Gl(this,va),Gl(this,Kl),Gl(this,Jl),Gl(this,Is,!1),Gl(this,Uf),e.style!==void 0&&wu(this,Is,!0),wu(this,ys,{zoomAdjust:-4,position:"top-right",...n,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(Kn(this,ys).minZoom=e.lockZoom,Kn(this,ys).maxZoom=e.lockZoom)}setStyle(e,n){Kn(this,Is)||this.map.setStyle(e,n),_s(this,jr,Rs).call(this)}addLayer(e,n){return Kn(this,Is)||this.map.addLayer(e,n),_s(this,jr,Rs).call(this),this.map}moveLayer(e,n){return Kn(this,Is)||this.map.moveLayer(e,n),_s(this,jr,Rs).call(this),this.map}removeLayer(e){return Kn(this,Is)||this.map.removeLayer(e),_s(this,jr,Rs).call(this),this}setLayerZoomRange(e,n,r){return Kn(this,Is)||this.map.setLayerZoomRange(e,n,r),_s(this,jr,Rs).call(this),this}setFilter(e,n,r){return Kn(this,Is)||this.map.setFilter(e,n,r),_s(this,jr,Rs).call(this),this}setPaintProperty(e,n,r,u){return Kn(this,Is)||this.map.setPaintProperty(e,n,r,u),_s(this,jr,Rs).call(this),this}setLayoutProperty(e,n,r,u){return Kn(this,Is)||this.map.setLayoutProperty(e,n,r,u),_s(this,jr,Rs).call(this),this}setGlyphs(e,n){return Kn(this,Is)||this.map.setGlyphs(e,n),_s(this,jr,Rs).call(this),this}onAdd(e){wu(this,va,e),wu(this,Kl,no("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[n,r]of Object.entries(Kn(this,ys).containerStyle))Kn(this,Kl).style.setProperty(n,r);return Kn(this,ys).container=Kn(this,Kl),Kn(this,ys).zoom=e.getZoom()+Kn(this,ys).zoomAdjust,this.map=new jw(Kn(this,ys)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{_s(this,jr,Gw).call(this,Kn(this,ys).parentRect),wu(this,Uf,_s(this,jr,Hw).call(this))}),Kn(this,Kl)}onRemove(){var e;(e=Kn(this,Uf))==null||e.call(this),ov(Kn(this,Kl))}};ys=new WeakMap,va=new WeakMap,Kl=new WeakMap,Jl=new WeakMap,Is=new WeakMap,Uf=new WeakMap,jr=new WeakSet,Gw=function(c){c===void 0||c.linePaint===void 0&&c.fillPaint===void 0||(wu(this,Jl,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Kn(this,Jl)}),(c.lineLayout!==void 0||c.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...c.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...c.linePaint}}),c.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...c.fillPaint}}),_s(this,jr,Rs).call(this))},Rs=function(){if(Kn(this,Jl)===void 0)return;const{devicePixelRatio:c}=window,e=Kn(this,va).getCanvas(),n=e.width/c,r=e.height/c,u=Kn(this,va).unproject.bind(Kn(this,va)),f=u([0,0]),p=u([n,0]),s=u([0,r]),S=u([n,r]);Kn(this,Jl).geometry.coordinates=[[s.toArray(),S.toArray(),p.toArray(),f.toArray(),s.toArray()]];const M=this.map.getSource("parentRect");M!==void 0&&M.setData(Kn(this,Jl))},Hw=function(){const{pitchAdjust:c}=Kn(this,ys),e=()=>{f("parent")},n=()=>{f("minimap")},r=()=>{Kn(this,va).on("move",e),this.map.on("move",n)},u=()=>{Kn(this,va).off("move",e),this.map.off("move",n)},f=p=>{u();const s=p==="parent"?Kn(this,va):this.map,S=p==="parent"?this.map:Kn(this,va),M=s.getCenter(),C=s.getZoom()+Kn(this,ys).zoomAdjust*(p==="parent"?1:-1),I=s.getBearing(),L=s.getPitch();S.jumpTo({center:M,zoom:C,bearing:I,pitch:c?L:0}),_s(this,jr,Rs).call(this),r()};return r(),()=>{u()}};class GA{constructor(){Mn(this,"map"),Mn(this,"container"),Mn(this,"projectionButton")}onAdd(e){return this.map=e,this.container=no("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=no("button","maplibregl-ctrl-projection",this.container),no("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){ov(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}const HA="3.3.0",jA={version:HA};class $A{constructor(e,n=2e3){Mn(this,"map"),Mn(this,"registeredModules",new Set),this.map=e,setTimeout(async()=>{if(!lr.telemetry)return;const r=this.preparePayload();try{(await fetch(r,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(u){console.warn("The metrics could not be sent to MapTiler Cloud",u)}},Math.max(1e3,n))}registerModule(e,n){this.registeredModules.add(`${e}:${n}`)}preparePayload(){const e=new URL($r.telemetryURL);return e.searchParams.append("sdk",jA.version),e.searchParams.append("key",lr.apiKey),e.searchParams.append("mtsid",Uy),e.searchParams.append("session",lr.session?"1":"0"),e.searchParams.append("caching",lr.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}const WA={POINT:"POINT",COUNTRY:"COUNTRY"};let jw=class $w extends Qt.Map{constructor(e){u2(e.container),e.apiKey&&(lr.apiKey=e.apiKey);const{style:n,requiresUrlMonitoring:r,isFallback:u}=Jx(e.style);u&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),lr.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const f=location.hash;let p={compact:!1};e.customAttribution?p.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(p={...p,...e.attributionControl});const s={...e,style:n,maplibreLogo:!1,transformRequest:Px(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:p};delete s.style,super(s),Mn(this,"options"),Mn(this,"telemetry"),Mn(this,"isTerrainEnabled",!1),Mn(this,"terrainExaggeration",1),Mn(this,"primaryLanguage"),Mn(this,"terrainGrowing",!1),Mn(this,"terrainFlattening",!1),Mn(this,"minimap"),Mn(this,"forceLanguageUpdate"),Mn(this,"languageAlwaysBeenStyle"),Mn(this,"isReady",!1),Mn(this,"terrainAnimationDuration",1e3),Mn(this,"monitoredStyleUrls"),Mn(this,"styleInProcess",!1),Mn(this,"curentProjection"),Mn(this,"originalLabelStyle",new window.Map),Mn(this,"isStyleLocalized",!1),Mn(this,"languageIsUpdated",!1),this.options=e,this.setStyle(n),r&&this.monitorStyleUrl(n);const S=()=>{let R="The distant style could not be loaded.";this.getStyle()?R+="Leaving the style as is.":(this.setStyle(Pu.STREETS),R+=`Loading default MapTiler Cloud style "${Pu.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(R)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",R=>{if(R.error instanceof Qt.AJAXError){const B=R.error.url,Z=new URL(B);Z.search="";const V=Z.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(V)&&(this.monitoredStyleUrls.delete(V),S());return}if(this.styleInProcess){S();return}}),lr.caching&&!O_&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),lr.caching&&O_&&a2(),typeof e.language>"u")this.primaryLanguage=lr.primaryLanguage;else{const R=mx(e.language,Jn);this.primaryLanguage=R??lr.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Jn.STYLE||this.primaryLanguage===Jn.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Jn.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&f)return;try{if(e.geolocate===WA.COUNTRY){await this.fitToIpBounds();return}}catch(B){console.warn(B.message)}let R;try{await this.centerOnIpPoint(e.zoom),R=this.getCameraHash()}catch(B){console.warn(B.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(B=>{R===this.getCameraHash()&&(this.terrain?this.easeTo({center:[B.coords.longitude,B.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[B.coords.longitude,B.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let R={logo:null};try{const B=Object.keys(this.style.sourceCaches).map(V=>this.getSource(V)).filter(V=>V&&"url"in V&&typeof V.url=="string"&&V.url.includes("tiles.json")),Z=new URL(B[0].url);Z.searchParams.has("key")||Z.searchParams.append("key",lr.apiKey),R=await(await fetch(Z.href)).json()}catch{}if(e.forceNoAttributionControl!==!0)if("logo"in R&&R.logo){const B=R.logo;this.addControl(new Rx({logoURL:B}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new Rx,e.logoPosition);if(e.scaleControl){const B=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,Z=new b2({unit:lr.unit});this.addControl(Z,B),lr.on("unit",V=>{Z.setUnit(V)})}if(e.navigationControl!==!1){const B=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new UA,B)}if(e.geolocateControl!==!1){const B=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new VA({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),B)}if(e.terrainControl){const B=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new NA,B)}if(e.projectionControl){const B=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new GA,B)}if(e.fullscreenControl){const B=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new w2({}),B)}this.isReady=!0,this.fire("ready",{target:this})});let M=!1,C=!1,I;this.once("ready",()=>{M=!0,C&&this.fire("loadWithTerrain",I)}),this.once("style.load",()=>{const{minimap:R}=e;if(typeof R=="object"){const{zoom:B,center:Z,style:V,language:O,apiKey:ge,maptilerLogo:me,canvasContextAttributes:Q,refreshExpiredTiles:de,maxBounds:fe,scrollZoom:ye,minZoom:ke,maxZoom:ce,boxZoom:ie,locale:Oe,fadeDuration:nt,crossSourceCollisions:Je,clickTolerance:ut,bounds:ht,fitBoundsOptions:ot,pixelRatio:ft,validateStyle:tt}=e;this.minimap=new Zg(R,{zoom:B,center:Z,style:V,language:O,apiKey:ge,container:"null",maptilerLogo:me,canvasContextAttributes:Q,refreshExpiredTiles:de,maxBounds:fe,scrollZoom:ye,minZoom:ke,maxZoom:ce,boxZoom:ie,locale:Oe,fadeDuration:nt,crossSourceCollisions:Je,clickTolerance:ut,bounds:ht,fitBoundsOptions:ot,pixelRatio:ft,validateStyle:tt}),this.addControl(this.minimap,R.position??"bottom-left")}else R===!0?(this.minimap=new Zg({},e),this.addControl(this.minimap,"bottom-left")):R!==void 0&&R!==!1&&(this.minimap=new Zg({},e),this.addControl(this.minimap,R))});const L=R=>{R.terrain&&(C=!0,I={type:"loadWithTerrain",target:this,terrain:R.terrain},this.off("terrain",L),M&&this.fire("loadWithTerrain",I))};this.on("terrain",L),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",R=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",R)})}),this.telemetry=new $A(this)}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new $w({...this.options})),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded()){e(this);return}this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady){e(this);return}this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain){e(this);return}this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const n=new URL(e);n.search="",this.monitoredStyleUrls.add(n.href)}setStyle(e,n){var r;this.originalLabelStyle.clear(),(r=this.minimap)==null||r.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const u=Jx(e);if(u.requiresUrlMonitoring&&this.monitorStyleUrl(u.style),u.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}return this.styleInProcess=!0,super.setStyle(u.style,n),this}addLayer(e,n){var r;return(r=this.minimap)==null||r.addLayer(e,n),super.addLayer(e,n)}moveLayer(e,n){var r;return(r=this.minimap)==null||r.moveLayer(e,n),super.moveLayer(e,n)}removeLayer(e){var n;return(n=this.minimap)==null||n.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,n,r){var u;return(u=this.minimap)==null||u.setLayerZoomRange(e,n,r),super.setLayerZoomRange(e,n,r)}setFilter(e,n,r){var u;return(u=this.minimap)==null||u.setFilter(e,n,r),super.setFilter(e,n,r)}setPaintProperty(e,n,r,u){var f;return(f=this.minimap)==null||f.setPaintProperty(e,n,r,u),super.setPaintProperty(e,n,r,u)}setLayoutProperty(e,n,r,u){var f;return(f=this.minimap)==null||f.setLayoutProperty(e,n,r,u),super.setLayoutProperty(e,n,r,u)}setGlyphs(e,n){var r;return(r=this.minimap)==null||r.setGlyphs(e,n),super.setGlyphs(e,n)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?L_(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var n;(n=this.minimap)==null||n.map.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const n=this.getStyleLanguage(),r=mx(e,Jn);if(!r){console.warn(`The language "${r}" is not supported.`);return}if(!(r.flag===Jn.STYLE.flag&&n&&(n.flag===Jn.AUTO.flag||n.flag===Jn.VISITOR.flag))&&(r.flag!==Jn.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===r&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Jn.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=r;let u=r;if(r.flag===Jn.STYLE.flag){if(!n){console.warn("The style has no default languages or has an invalid one.");return}u=n}let f=Jn.LOCAL.flag,p=["get",f];u.flag===Jn.VISITOR.flag?(f=Tx().flag,p=["case",["all",["has",f],["has",Jn.LOCAL.flag]],["case",["==",["get",f],["get",Jn.LOCAL.flag]],["get",Jn.LOCAL.flag],["format",["get",f],{"font-scale":.8},`
`,["get",Jn.LOCAL.flag],{"font-scale":1.1}]],["get",Jn.LOCAL.flag]]):u.flag===Jn.VISITOR_ENGLISH.flag?(f=Jn.ENGLISH.flag,p=["case",["all",["has",f],["has",Jn.LOCAL.flag]],["case",["==",["get",f],["get",Jn.LOCAL.flag]],["get",Jn.LOCAL.flag],["format",["get",f],{"font-scale":.8},`
`,["get",Jn.LOCAL.flag],{"font-scale":1.1}]],["get",Jn.LOCAL.flag]]):u.flag===Jn.AUTO.flag?(f=Tx().flag,p=["coalesce",["get",f],["get",Jn.LOCAL.flag]]):u===Jn.LOCAL?(f=Jn.LOCAL.flag,p=["get",f]):(f=u.flag,p=["coalesce",["get",f],["get",Jn.LOCAL.flag]]);const{layers:s}=this.getStyle(),S=this.originalLabelStyle.size===0;if(S){const M=_2(s,this);this.isStyleLocalized=Object.keys(M.localized).length>0}for(const M of s){if(M.type!=="symbol")continue;const C=M,I=this.getSource(C.source);if(!I||!("url"in I&&typeof I.url=="string")||new URL(I.url).host!==$r.maptilerApiHost)continue;const{id:L,layout:R}=C;if(!R||!("text-field"in R))continue;let B;if(S?(B=this.getLayoutProperty(L,"text-field"),this.originalLabelStyle.set(L,B)):B=this.originalLabelStyle.get(L),typeof B=="string"){const{contains:Z,exactMatch:V}=d2(B,this.isStyleLocalized);if(!Z)continue;if(V)this.setLayoutProperty(L,"text-field",p);else{const O=p2(B,p,this.isStyleLocalized);this.setLayoutProperty(L,"text-field",O)}}else{const Z=h2(B,p,this.isStyleLocalized);this.setLayoutProperty(L,"text-field",Z)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const n=performance.now(),r=this.terrain.exaggeration,u=e-r,f=()=>{if(!this.terrain||this.terrainFlattening)return;const p=(performance.now()-n)/this.terrainAnimationDuration;if(p<.99){const s=1-(1-p)**4,S=r+s*u;this.terrain.exaggeration=S,requestAnimationFrame(f)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(f)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const n=u=>{!this.terrain||u.type!=="data"||u.dataType!=="source"||!("source"in u)||u.sourceId!=="maptiler-terrain"||u.source.type!=="raster-dem"||u.isSourceLoaded&&(this.off("data",n),this.growTerrain(e))},r=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",n),this.addSource($r.terrainSourceId,{type:"raster-dem",url:$r.terrainSourceURL}),this.setTerrain({source:$r.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}this.loaded()||this.isTerrainEnabled?r():this.once("load",()=>{this.getTerrain()&&this.getSource($r.terrainSourceId)||r()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),n=this.terrain.exaggeration,r=()=>{if(!this.terrain||this.terrainGrowing)return;const u=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,u<.99){const f=(1-u)**4,p=n*f;this.terrain.exaggeration=p,requestAnimationFrame(r)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource($r.terrainSourceId)&&this.removeSource($r.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(r)}setTerrainExaggeration(e,n=!0){!n&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await _x.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const n=await _x.info();this.jumpTo({center:[n.longitude??0,n.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),n=this.getCenter();return e[0]=n.lng,e[1]=n.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),KT.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return lr}getMaptilerSessionId(){return Uy}setTransformRequest(e){return super.setTransformRequest(Px(e)),this}isGlobeProjection(){const e=this.getProjection();return e?e.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};function of(c){const e=c.toString(16);return e.length===1?`0${e}`:e}function qA(c){return`#${of(c[0])}${of(c[1])}${of(c[2])}${c.length===4?of(c[3]):""}`}class ln extends Array{constructor(e={}){super(),Mn(this,"min",0),Mn(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new ln({stops:e.map(n=>({value:n[0],color:n[1]}))})}setStops(e,n={clone:!0}){const r=n.clone?this.clone():this;r.length=0;let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(let p=0;p<e.length;p+=1)u=Math.min(u,e[p].value),f=Math.max(f,e[p].value),r.push({value:e[p].value,color:e[p].color.slice()});return r.sort((p,s)=>p.value<s.value?-1:1),this.min=u,this.max=f,r}scale(e,n,r={clone:!0}){const u=r.clone,f=this[0].value,p=this.at(-1).value-f,s=n-e,S=[];for(let M=0;M<this.length;M+=1){const C=(this[M].value-f)/p*s+e;u?S.push({value:C,color:this[M].color.slice()}):this[M].value=C}return u?new ln({stops:S}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new ln({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let n=0;n<this.length;n+=1)e.push({value:this[n].value,color:this[n].color});return e}reverse(e={clone:!0}){const n=e.clone?this.clone():this;for(let r=0;r<~~(n.length/2);r+=1){const u=n[r].color;n[r].color=n.at(-(r+1)).color,n.at(-(r+1)).color=u}return n}getBounds(){return{min:this.min,max:this.max}}getColor(e,n={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let r=0;r<this.length-1;r+=1){if(e>this[r+1].value)continue;const u=this[r].color;if(!n.smooth)return u.slice();const f=this[r].value,p=this[r+1].value,s=this[r+1].color,S=(p-e)/(p-f);return u.map((M,C)=>Math.round(M*S+s[C]*(1-S)))}return[0,0,0]}getColorHex(e,n={smooth:!0,withAlpha:!1}){return qA(this.getColor(e,n))}getColorRelative(e,n={smooth:!0}){const r=this.getBounds();return this.getColor(r.min+e*(r.max-r.min),n)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const n=document.createElement("canvas");n.width=e.horizontal?e.size:1,n.height=e.horizontal?1:e.size;const r=n.getContext("2d");if(!r)throw new Error("Canvs context is missing");const u=r.getImageData(0,0,n.width,n.height),f=u.data,p=e.size,s=this[0].value,S=(this.at(-1).value-s)/p;for(let M=0;M<p;M+=1){const C=this.getColor(s+M*S,{smooth:e.smooth});f[M*4]=C[0],f[M*4+1]=C[1],f[M*4+2]=C[2],f[M*4+3]=C.length>3?C[3]:255}return r.putImageData(u,0,0),n}resample(e,n=15){const r=this.getBounds(),u=this.scale(0,1),f=1/(n-1);let p;if(e==="ease-in-square")p=Array.from({length:n},(s,S)=>{const M=S*f,C=M**2,I=u.getColor(C);return{value:M,color:I}});else if(e==="ease-out-square")p=Array.from({length:n},(s,S)=>{const M=S*f,C=1-(1-M)**2,I=u.getColor(C);return{value:M,color:I}});else if(e==="ease-out-sqrt")p=Array.from({length:n},(s,S)=>{const M=S*f,C=M**.5,I=u.getColor(C);return{value:M,color:I}});else if(e==="ease-in-sqrt")p=Array.from({length:n},(s,S)=>{const M=S*f,C=1-(1-M)**.5,I=u.getColor(C);return{value:M,color:I}});else if(e==="ease-out-exp")p=Array.from({length:n},(s,S)=>{const M=S*f,C=1-2**(-10*M),I=u.getColor(C);return{value:M,color:I}});else if(e==="ease-in-exp")p=Array.from({length:n},(s,S)=>{const M=S*f,C=2**(10*M-10),I=u.getColor(C);return{value:M,color:I}});else throw new Error("Invalid ressampling method.");return new ln({stops:p}).scale(r.min,r.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const n of e)n.color.length===3&&n.color.push(255);return e[0].color[3]=0,new ln({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}new ln({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new ln({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),new ln({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),new ln({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),new ln({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),new ln({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),new ln({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new ln({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),new ln({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),new ln({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),new ln({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),new ln({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),new ln({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),new ln({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),new ln({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),new ln({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),new ln({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),new ln({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),new ln({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),new ln({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),new ln({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),new ln({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),new ln({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),new ln({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),new ln({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),new ln({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),new ln({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),new ln({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),new ln({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),new ln({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),new ln({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),new ln({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),new ln({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),new ln({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),new ln({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),new ln({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),new ln({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),new ln({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),new ln({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),new ln({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),new ln({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),new ln({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]});o2();Qt.Map;Qt.Marker;Qt.Popup;Qt.Style;Qt.CanvasSource;Qt.GeoJSONSource;Qt.ImageSource;Qt.RasterTileSource;Qt.RasterDEMTileSource;Qt.VectorTileSource;Qt.VideoSource;Qt.NavigationControl;Qt.GeolocateControl;Qt.AttributionControl;Qt.LogoControl;Qt.ScaleControl;Qt.FullscreenControl;Qt.TerrainControl;Qt.BoxZoomHandler;Qt.ScrollZoomHandler;Qt.CooperativeGesturesHandler;Qt.KeyboardHandler;Qt.TwoFingersTouchPitchHandler;Qt.MapWheelEvent;Qt.MapTouchEvent;Qt.MapMouseEvent;Qt.config;Qt.getVersion;const{setRTLTextPlugin:cz,getRTLTextPluginStatus:uz,LngLat:dd,LngLatBounds:hz,MercatorCoordinate:dz,Evented:pz,AJAXError:fz,prewarm:mz,clearPrewarmedResources:gz,Hash:_z,Point:yz,EdgeInsets:vz,DragRotateHandler:xz,DragPanHandler:bz,TwoFingersTouchZoomRotateHandler:wz,DoubleClickZoomHandler:Sz,TwoFingersTouchZoomHandler:Mz,TwoFingersTouchRotateHandler:Tz,getWorkerCount:Ez,setWorkerCount:Az,getMaxParallelImageRequests:Cz,setMaxParallelImageRequests:Pz,getWorkerUrl:Iz,setWorkerUrl:Rz,addSourceType:Lz,importScriptInWorkers:Dz,addProtocol:kz,removeProtocol:zz}=Qt;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const lv="172",ZA=0,tb=1,XA=2,Ww=1,YA=2,Ja=3,ao=0,ss=1,wa=2,Qo=0,Lu=1,nb=2,ib=3,rb=4,KA=5,tc=100,JA=101,QA=102,eC=103,tC=104,nC=200,iC=201,rC=202,sC=203,W_=204,q_=205,aC=206,oC=207,lC=208,cC=209,uC=210,hC=211,dC=212,pC=213,fC=214,Z_=0,X_=1,Y_=2,Nu=3,K_=4,J_=5,Q_=6,ey=7,qw=0,mC=1,gC=2,el=0,_C=1,yC=2,vC=3,xC=4,bC=5,wC=6,SC=7,sb="attached",MC="detached",Zw=300,Uu=301,Bu=302,ty=303,ny=304,ym=306,Vu=1e3,Ko=1001,nm=1002,Wr=1003,Xw=1004,Sd=1005,bs=1006,Bf=1007,eo=1008,oo=1009,Yw=1010,Kw=1011,Bd=1012,cv=1013,pc=1014,ta=1015,Xd=1016,uv=1017,hv=1018,Gu=1020,Jw=35902,Qw=1021,eS=1022,ks=1023,tS=1024,nS=1025,Du=1026,Hu=1027,dv=1028,pv=1029,iS=1030,fv=1031,mv=1033,Vf=33776,Gf=33777,Hf=33778,jf=33779,iy=35840,ry=35841,sy=35842,ay=35843,oy=36196,ly=37492,cy=37496,uy=37808,hy=37809,dy=37810,py=37811,fy=37812,my=37813,gy=37814,_y=37815,yy=37816,vy=37817,xy=37818,by=37819,wy=37820,Sy=37821,$f=36492,My=36494,Ty=36495,rS=36283,Ey=36284,Ay=36285,Cy=36286,Vd=2300,Gd=2301,Xg=2302,ab=2400,ob=2401,lb=2402,TC=2500,EC=0,sS=1,Py=2,AC=3200,CC=3201,aS=0,PC=1,Yo="",Pr="srgb",Zr="srgb-linear",im="linear",mi="srgb",ou=7680,cb=519,IC=512,RC=513,LC=514,oS=515,DC=516,kC=517,zC=518,FC=519,Iy=35044,ub="300 es",to=2e3,rm=2001;class Ju{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const u=this._listeners[e];if(u!==void 0){const f=u.indexOf(n);f!==-1&&u.splice(f,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const u=r.slice(0);for(let f=0,p=u.length;f<p;f++)u[f].call(this,e);e.target=null}}}const Fr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let hb=1234567;const Cd=Math.PI/180,ju=180/Math.PI;function na(){const c=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Fr[c&255]+Fr[c>>8&255]+Fr[c>>16&255]+Fr[c>>24&255]+"-"+Fr[e&255]+Fr[e>>8&255]+"-"+Fr[e>>16&15|64]+Fr[e>>24&255]+"-"+Fr[n&63|128]+Fr[n>>8&255]+"-"+Fr[n>>16&255]+Fr[n>>24&255]+Fr[r&255]+Fr[r>>8&255]+Fr[r>>16&255]+Fr[r>>24&255]).toLowerCase()}function $n(c,e,n){return Math.max(e,Math.min(n,c))}function gv(c,e){return(c%e+e)%e}function OC(c,e,n,r,u){return r+(c-e)*(u-r)/(n-e)}function NC(c,e,n){return c!==e?(n-c)/(e-c):0}function Pd(c,e,n){return(1-n)*c+n*e}function UC(c,e,n,r){return Pd(c,e,1-Math.exp(-n*r))}function BC(c,e=1){return e-Math.abs(gv(c,e*2)-e)}function VC(c,e,n){return c<=e?0:c>=n?1:(c=(c-e)/(n-e),c*c*(3-2*c))}function GC(c,e,n){return c<=e?0:c>=n?1:(c=(c-e)/(n-e),c*c*c*(c*(c*6-15)+10))}function HC(c,e){return c+Math.floor(Math.random()*(e-c+1))}function jC(c,e){return c+Math.random()*(e-c)}function $C(c){return c*(.5-Math.random())}function WC(c){c!==void 0&&(hb=c);let e=hb+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function qC(c){return c*Cd}function ZC(c){return c*ju}function XC(c){return(c&c-1)===0&&c!==0}function YC(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function KC(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}function JC(c,e,n,r,u){const f=Math.cos,p=Math.sin,s=f(n/2),S=p(n/2),M=f((e+r)/2),C=p((e+r)/2),I=f((e-r)/2),L=p((e-r)/2),R=f((r-e)/2),B=p((r-e)/2);switch(u){case"XYX":c.set(s*C,S*I,S*L,s*M);break;case"YZY":c.set(S*L,s*C,S*I,s*M);break;case"ZXZ":c.set(S*I,S*L,s*C,s*M);break;case"XZX":c.set(s*C,S*B,S*R,s*M);break;case"YXY":c.set(S*R,s*C,S*B,s*M);break;case"ZYZ":c.set(S*B,S*R,s*C,s*M);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+u)}}function Ys(c,e){switch(e.constructor){case Float32Array:return c;case Uint32Array:return c/4294967295;case Uint16Array:return c/65535;case Uint8Array:return c/255;case Int32Array:return Math.max(c/2147483647,-1);case Int16Array:return Math.max(c/32767,-1);case Int8Array:return Math.max(c/127,-1);default:throw new Error("Invalid component type.")}}function hi(c,e){switch(e.constructor){case Float32Array:return c;case Uint32Array:return Math.round(c*4294967295);case Uint16Array:return Math.round(c*65535);case Uint8Array:return Math.round(c*255);case Int32Array:return Math.round(c*2147483647);case Int16Array:return Math.round(c*32767);case Int8Array:return Math.round(c*127);default:throw new Error("Invalid component type.")}}const lS={DEG2RAD:Cd,RAD2DEG:ju,generateUUID:na,clamp:$n,euclideanModulo:gv,mapLinear:OC,inverseLerp:NC,lerp:Pd,damp:UC,pingpong:BC,smoothstep:VC,smootherstep:GC,randInt:HC,randFloat:jC,randFloatSpread:$C,seededRandom:WC,degToRad:qC,radToDeg:ZC,isPowerOfTwo:XC,ceilPowerOfTwo:YC,floorPowerOfTwo:KC,setQuaternionFromProperEuler:JC,normalize:hi,denormalize:Ys};class ei{constructor(e=0,n=0){ei.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,u=e.elements;return this.x=u[0]*n+u[3]*r+u[6],this.y=u[1]*n+u[4]*r+u[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=$n(this.x,e.x,n.x),this.y=$n(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=$n(this.x,e,n),this.y=$n(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar($n(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos($n(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),u=Math.sin(n),f=this.x-e.x,p=this.y-e.y;return this.x=f*r-p*u+e.x,this.y=f*u+p*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class kn{constructor(e,n,r,u,f,p,s,S,M){kn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,u,f,p,s,S,M)}set(e,n,r,u,f,p,s,S,M){const C=this.elements;return C[0]=e,C[1]=u,C[2]=s,C[3]=n,C[4]=f,C[5]=S,C[6]=r,C[7]=p,C[8]=M,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,u=n.elements,f=this.elements,p=r[0],s=r[3],S=r[6],M=r[1],C=r[4],I=r[7],L=r[2],R=r[5],B=r[8],Z=u[0],V=u[3],O=u[6],ge=u[1],me=u[4],Q=u[7],de=u[2],fe=u[5],ye=u[8];return f[0]=p*Z+s*ge+S*de,f[3]=p*V+s*me+S*fe,f[6]=p*O+s*Q+S*ye,f[1]=M*Z+C*ge+I*de,f[4]=M*V+C*me+I*fe,f[7]=M*O+C*Q+I*ye,f[2]=L*Z+R*ge+B*de,f[5]=L*V+R*me+B*fe,f[8]=L*O+R*Q+B*ye,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],u=e[2],f=e[3],p=e[4],s=e[5],S=e[6],M=e[7],C=e[8];return n*p*C-n*s*M-r*f*C+r*s*S+u*f*M-u*p*S}invert(){const e=this.elements,n=e[0],r=e[1],u=e[2],f=e[3],p=e[4],s=e[5],S=e[6],M=e[7],C=e[8],I=C*p-s*M,L=s*S-C*f,R=M*f-p*S,B=n*I+r*L+u*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0);const Z=1/B;return e[0]=I*Z,e[1]=(u*M-C*r)*Z,e[2]=(s*r-u*p)*Z,e[3]=L*Z,e[4]=(C*n-u*S)*Z,e[5]=(u*f-s*n)*Z,e[6]=R*Z,e[7]=(r*S-M*n)*Z,e[8]=(p*n-r*f)*Z,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,u,f,p,s){const S=Math.cos(f),M=Math.sin(f);return this.set(r*S,r*M,-r*(S*p+M*s)+p+e,-u*M,u*S,-u*(-M*p+S*s)+s+n,0,0,1),this}scale(e,n){return this.premultiply(Yg.makeScale(e,n)),this}rotate(e){return this.premultiply(Yg.makeRotation(-e)),this}translate(e,n){return this.premultiply(Yg.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let u=0;u<9;u++)if(n[u]!==r[u])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Yg=new kn;function cS(c){for(let e=c.length-1;e>=0;--e)if(c[e]>=65535)return!0;return!1}function Hd(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}function QC(){const c=Hd("canvas");return c.style.display="block",c}const db={};function Tu(c){c in db||(db[c]=!0,console.warn(c))}function eP(c,e,n){return new Promise(function(r,u){function f(){switch(c.clientWaitSync(e,c.SYNC_FLUSH_COMMANDS_BIT,0)){case c.WAIT_FAILED:u();break;case c.TIMEOUT_EXPIRED:setTimeout(f,n);break;default:r()}}setTimeout(f,n)})}function tP(c){const e=c.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function nP(c){const e=c.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const pb=new kn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),fb=new kn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function iP(){const c={enabled:!0,workingColorSpace:Zr,spaces:{},convert:function(u,f,p){return this.enabled===!1||f===p||!f||!p||(this.spaces[f].transfer===mi&&(u.r=io(u.r),u.g=io(u.g),u.b=io(u.b)),this.spaces[f].primaries!==this.spaces[p].primaries&&(u.applyMatrix3(this.spaces[f].toXYZ),u.applyMatrix3(this.spaces[p].fromXYZ)),this.spaces[p].transfer===mi&&(u.r=ku(u.r),u.g=ku(u.g),u.b=ku(u.b))),u},fromWorkingColorSpace:function(u,f){return this.convert(u,this.workingColorSpace,f)},toWorkingColorSpace:function(u,f){return this.convert(u,f,this.workingColorSpace)},getPrimaries:function(u){return this.spaces[u].primaries},getTransfer:function(u){return u===Yo?im:this.spaces[u].transfer},getLuminanceCoefficients:function(u,f=this.workingColorSpace){return u.fromArray(this.spaces[f].luminanceCoefficients)},define:function(u){Object.assign(this.spaces,u)},_getMatrix:function(u,f,p){return u.copy(this.spaces[f].toXYZ).multiply(this.spaces[p].fromXYZ)},_getDrawingBufferColorSpace:function(u){return this.spaces[u].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(u=this.workingColorSpace){return this.spaces[u].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return c.define({[Zr]:{primaries:e,whitePoint:r,transfer:im,toXYZ:pb,fromXYZ:fb,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Pr},outputColorSpaceConfig:{drawingBufferColorSpace:Pr}},[Pr]:{primaries:e,whitePoint:r,transfer:mi,toXYZ:pb,fromXYZ:fb,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Pr}}}),c}const Qn=iP();function io(c){return c<.04045?c*.0773993808:Math.pow(c*.9478672986+.0521327014,2.4)}function ku(c){return c<.0031308?c*12.92:1.055*Math.pow(c,.41666)-.055}let lu;class rP{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{lu===void 0&&(lu=Hd("canvas")),lu.width=e.width,lu.height=e.height;const r=lu.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=lu}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=Hd("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const u=r.getImageData(0,0,e.width,e.height),f=u.data;for(let p=0;p<f.length;p++)f[p]=io(f[p]/255)*255;return r.putImageData(u,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(io(n[r]/255)*255):n[r]=io(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let sP=0;class uS{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sP++}),this.uuid=na(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},u=this.data;if(u!==null){let f;if(Array.isArray(u)){f=[];for(let p=0,s=u.length;p<s;p++)u[p].isDataTexture?f.push(Kg(u[p].image)):f.push(Kg(u[p]))}else f=Kg(u);r.url=f}return n||(e.images[this.uuid]=r),r}}function Kg(c){return typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap?rP.getDataURL(c):c.data?{data:Array.from(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let aP=0;class yr extends Ju{constructor(e=yr.DEFAULT_IMAGE,n=yr.DEFAULT_MAPPING,r=Ko,u=Ko,f=bs,p=eo,s=ks,S=oo,M=yr.DEFAULT_ANISOTROPY,C=Yo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:aP++}),this.uuid=na(),this.name="",this.source=new uS(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=u,this.magFilter=f,this.minFilter=p,this.anisotropy=M,this.format=s,this.internalFormat=null,this.type=S,this.offset=new ei(0,0),this.repeat=new ei(1,1),this.center=new ei(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=C,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Zw)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Vu:e.x=e.x-Math.floor(e.x);break;case Ko:e.x=e.x<0?0:1;break;case nm:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Vu:e.y=e.y-Math.floor(e.y);break;case Ko:e.y=e.y<0?0:1;break;case nm:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}yr.DEFAULT_IMAGE=null;yr.DEFAULT_MAPPING=Zw;yr.DEFAULT_ANISOTROPY=1;class oi{constructor(e=0,n=0,r=0,u=1){oi.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=u}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,u){return this.x=e,this.y=n,this.z=r,this.w=u,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,u=this.z,f=this.w,p=e.elements;return this.x=p[0]*n+p[4]*r+p[8]*u+p[12]*f,this.y=p[1]*n+p[5]*r+p[9]*u+p[13]*f,this.z=p[2]*n+p[6]*r+p[10]*u+p[14]*f,this.w=p[3]*n+p[7]*r+p[11]*u+p[15]*f,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,u,f;const S=e.elements,M=S[0],C=S[4],I=S[8],L=S[1],R=S[5],B=S[9],Z=S[2],V=S[6],O=S[10];if(Math.abs(C-L)<.01&&Math.abs(I-Z)<.01&&Math.abs(B-V)<.01){if(Math.abs(C+L)<.1&&Math.abs(I+Z)<.1&&Math.abs(B+V)<.1&&Math.abs(M+R+O-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const me=(M+1)/2,Q=(R+1)/2,de=(O+1)/2,fe=(C+L)/4,ye=(I+Z)/4,ke=(B+V)/4;return me>Q&&me>de?me<.01?(r=0,u=.707106781,f=.707106781):(r=Math.sqrt(me),u=fe/r,f=ye/r):Q>de?Q<.01?(r=.707106781,u=0,f=.707106781):(u=Math.sqrt(Q),r=fe/u,f=ke/u):de<.01?(r=.707106781,u=.707106781,f=0):(f=Math.sqrt(de),r=ye/f,u=ke/f),this.set(r,u,f,n),this}let ge=Math.sqrt((V-B)*(V-B)+(I-Z)*(I-Z)+(L-C)*(L-C));return Math.abs(ge)<.001&&(ge=1),this.x=(V-B)/ge,this.y=(I-Z)/ge,this.z=(L-C)/ge,this.w=Math.acos((M+R+O-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=$n(this.x,e.x,n.x),this.y=$n(this.y,e.y,n.y),this.z=$n(this.z,e.z,n.z),this.w=$n(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=$n(this.x,e,n),this.y=$n(this.y,e,n),this.z=$n(this.z,e,n),this.w=$n(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar($n(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class oP extends Ju{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new oi(0,0,e,n),this.scissorTest=!1,this.viewport=new oi(0,0,e,n);const u={width:e,height:n,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const f=new yr(u,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);f.flipY=!1,f.generateMipmaps=r.generateMipmaps,f.internalFormat=r.internalFormat,this.textures=[];const p=r.count;for(let s=0;s<p;s++)this.textures[s]=f.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let u=0,f=this.textures.length;u<f;u++)this.textures[u].image.width=e,this.textures[u].image.height=n,this.textures[u].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,u=e.textures.length;r<u;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;const n=Object.assign({},e.texture.image);return this.texture.source=new uS(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fc extends oP{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class hS extends yr{constructor(e=null,n=1,r=1,u=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:u},this.magFilter=Wr,this.minFilter=Wr,this.wrapR=Ko,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class lP extends yr{constructor(e=null,n=1,r=1,u=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:u},this.magFilter=Wr,this.minFilter=Wr,this.wrapR=Ko,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lo{constructor(e=0,n=0,r=0,u=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=u}static slerpFlat(e,n,r,u,f,p,s){let S=r[u+0],M=r[u+1],C=r[u+2],I=r[u+3];const L=f[p+0],R=f[p+1],B=f[p+2],Z=f[p+3];if(s===0){e[n+0]=S,e[n+1]=M,e[n+2]=C,e[n+3]=I;return}if(s===1){e[n+0]=L,e[n+1]=R,e[n+2]=B,e[n+3]=Z;return}if(I!==Z||S!==L||M!==R||C!==B){let V=1-s;const O=S*L+M*R+C*B+I*Z,ge=O>=0?1:-1,me=1-O*O;if(me>Number.EPSILON){const de=Math.sqrt(me),fe=Math.atan2(de,O*ge);V=Math.sin(V*fe)/de,s=Math.sin(s*fe)/de}const Q=s*ge;if(S=S*V+L*Q,M=M*V+R*Q,C=C*V+B*Q,I=I*V+Z*Q,V===1-s){const de=1/Math.sqrt(S*S+M*M+C*C+I*I);S*=de,M*=de,C*=de,I*=de}}e[n]=S,e[n+1]=M,e[n+2]=C,e[n+3]=I}static multiplyQuaternionsFlat(e,n,r,u,f,p){const s=r[u],S=r[u+1],M=r[u+2],C=r[u+3],I=f[p],L=f[p+1],R=f[p+2],B=f[p+3];return e[n]=s*B+C*I+S*R-M*L,e[n+1]=S*B+C*L+M*I-s*R,e[n+2]=M*B+C*R+s*L-S*I,e[n+3]=C*B-s*I-S*L-M*R,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,u){return this._x=e,this._y=n,this._z=r,this._w=u,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,u=e._y,f=e._z,p=e._order,s=Math.cos,S=Math.sin,M=s(r/2),C=s(u/2),I=s(f/2),L=S(r/2),R=S(u/2),B=S(f/2);switch(p){case"XYZ":this._x=L*C*I+M*R*B,this._y=M*R*I-L*C*B,this._z=M*C*B+L*R*I,this._w=M*C*I-L*R*B;break;case"YXZ":this._x=L*C*I+M*R*B,this._y=M*R*I-L*C*B,this._z=M*C*B-L*R*I,this._w=M*C*I+L*R*B;break;case"ZXY":this._x=L*C*I-M*R*B,this._y=M*R*I+L*C*B,this._z=M*C*B+L*R*I,this._w=M*C*I-L*R*B;break;case"ZYX":this._x=L*C*I-M*R*B,this._y=M*R*I+L*C*B,this._z=M*C*B-L*R*I,this._w=M*C*I+L*R*B;break;case"YZX":this._x=L*C*I+M*R*B,this._y=M*R*I+L*C*B,this._z=M*C*B-L*R*I,this._w=M*C*I-L*R*B;break;case"XZY":this._x=L*C*I-M*R*B,this._y=M*R*I-L*C*B,this._z=M*C*B+L*R*I,this._w=M*C*I+L*R*B;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+p)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,u=Math.sin(r);return this._x=e.x*u,this._y=e.y*u,this._z=e.z*u,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],u=n[4],f=n[8],p=n[1],s=n[5],S=n[9],M=n[2],C=n[6],I=n[10],L=r+s+I;if(L>0){const R=.5/Math.sqrt(L+1);this._w=.25/R,this._x=(C-S)*R,this._y=(f-M)*R,this._z=(p-u)*R}else if(r>s&&r>I){const R=2*Math.sqrt(1+r-s-I);this._w=(C-S)/R,this._x=.25*R,this._y=(u+p)/R,this._z=(f+M)/R}else if(s>I){const R=2*Math.sqrt(1+s-r-I);this._w=(f-M)/R,this._x=(u+p)/R,this._y=.25*R,this._z=(S+C)/R}else{const R=2*Math.sqrt(1+I-r-s);this._w=(p-u)/R,this._x=(f+M)/R,this._y=(S+C)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs($n(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const u=Math.min(1,n/r);return this.slerp(e,u),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,u=e._y,f=e._z,p=e._w,s=n._x,S=n._y,M=n._z,C=n._w;return this._x=r*C+p*s+u*M-f*S,this._y=u*C+p*S+f*s-r*M,this._z=f*C+p*M+r*S-u*s,this._w=p*C-r*s-u*S-f*M,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,u=this._y,f=this._z,p=this._w;let s=p*e._w+r*e._x+u*e._y+f*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=p,this._x=r,this._y=u,this._z=f,this;const S=1-s*s;if(S<=Number.EPSILON){const R=1-n;return this._w=R*p+n*this._w,this._x=R*r+n*this._x,this._y=R*u+n*this._y,this._z=R*f+n*this._z,this.normalize(),this}const M=Math.sqrt(S),C=Math.atan2(M,s),I=Math.sin((1-n)*C)/M,L=Math.sin(n*C)/M;return this._w=p*I+this._w*L,this._x=r*I+this._x*L,this._y=u*I+this._y*L,this._z=f*I+this._z*L,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),u=Math.sqrt(1-r),f=Math.sqrt(r);return this.set(u*Math.sin(e),u*Math.cos(e),f*Math.sin(n),f*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ge{constructor(e=0,n=0,r=0){Ge.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(mb.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(mb.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,u=this.z,f=e.elements;return this.x=f[0]*n+f[3]*r+f[6]*u,this.y=f[1]*n+f[4]*r+f[7]*u,this.z=f[2]*n+f[5]*r+f[8]*u,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,u=this.z,f=e.elements,p=1/(f[3]*n+f[7]*r+f[11]*u+f[15]);return this.x=(f[0]*n+f[4]*r+f[8]*u+f[12])*p,this.y=(f[1]*n+f[5]*r+f[9]*u+f[13])*p,this.z=(f[2]*n+f[6]*r+f[10]*u+f[14])*p,this}applyQuaternion(e){const n=this.x,r=this.y,u=this.z,f=e.x,p=e.y,s=e.z,S=e.w,M=2*(p*u-s*r),C=2*(s*n-f*u),I=2*(f*r-p*n);return this.x=n+S*M+p*I-s*C,this.y=r+S*C+s*M-f*I,this.z=u+S*I+f*C-p*M,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,u=this.z,f=e.elements;return this.x=f[0]*n+f[4]*r+f[8]*u,this.y=f[1]*n+f[5]*r+f[9]*u,this.z=f[2]*n+f[6]*r+f[10]*u,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=$n(this.x,e.x,n.x),this.y=$n(this.y,e.y,n.y),this.z=$n(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=$n(this.x,e,n),this.y=$n(this.y,e,n),this.z=$n(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar($n(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,u=e.y,f=e.z,p=n.x,s=n.y,S=n.z;return this.x=u*S-f*s,this.y=f*p-r*S,this.z=r*s-u*p,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Jg.copy(this).projectOnVector(e),this.sub(Jg)}reflect(e){return this.sub(Jg.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos($n(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,u=this.z-e.z;return n*n+r*r+u*u}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const u=Math.sin(n)*e;return this.x=u*Math.sin(r),this.y=Math.cos(n)*e,this.z=u*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),u=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=u,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Jg=new Ge,mb=new lo;class co{constructor(e=new Ge(1/0,1/0,1/0),n=new Ge(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint($s.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint($s.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=$s.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const f=r.getAttribute("position");if(n===!0&&f!==void 0&&e.isInstancedMesh!==!0)for(let p=0,s=f.count;p<s;p++)e.isMesh===!0?e.getVertexPosition(p,$s):$s.fromBufferAttribute(f,p),$s.applyMatrix4(e.matrixWorld),this.expandByPoint($s);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),lf.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),lf.copy(r.boundingBox)),lf.applyMatrix4(e.matrixWorld),this.union(lf)}const u=e.children;for(let f=0,p=u.length;f<p;f++)this.expandByObject(u[f],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,$s),$s.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(pd),cf.subVectors(this.max,pd),cu.subVectors(e.a,pd),uu.subVectors(e.b,pd),hu.subVectors(e.c,pd),Ho.subVectors(uu,cu),jo.subVectors(hu,uu),jl.subVectors(cu,hu);let n=[0,-Ho.z,Ho.y,0,-jo.z,jo.y,0,-jl.z,jl.y,Ho.z,0,-Ho.x,jo.z,0,-jo.x,jl.z,0,-jl.x,-Ho.y,Ho.x,0,-jo.y,jo.x,0,-jl.y,jl.x,0];return!Qg(n,cu,uu,hu,cf)||(n=[1,0,0,0,1,0,0,0,1],!Qg(n,cu,uu,hu,cf))?!1:(uf.crossVectors(Ho,jo),n=[uf.x,uf.y,uf.z],Qg(n,cu,uu,hu,cf))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$s).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize($s).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Wa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Wa=[new Ge,new Ge,new Ge,new Ge,new Ge,new Ge,new Ge,new Ge],$s=new Ge,lf=new co,cu=new Ge,uu=new Ge,hu=new Ge,Ho=new Ge,jo=new Ge,jl=new Ge,pd=new Ge,cf=new Ge,uf=new Ge,$l=new Ge;function Qg(c,e,n,r,u){for(let f=0,p=c.length-3;f<=p;f+=3){$l.fromArray(c,f);const s=u.x*Math.abs($l.x)+u.y*Math.abs($l.y)+u.z*Math.abs($l.z),S=e.dot($l),M=n.dot($l),C=r.dot($l);if(Math.max(-Math.max(S,M,C),Math.min(S,M,C))>s)return!1}return!0}const cP=new co,fd=new Ge,e_=new Ge;class Pa{constructor(e=new Ge,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):cP.setFromPoints(e).getCenter(r);let u=0;for(let f=0,p=e.length;f<p;f++)u=Math.max(u,r.distanceToSquared(e[f]));return this.radius=Math.sqrt(u),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;fd.subVectors(e,this.center);const n=fd.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),u=(r-this.radius)*.5;this.center.addScaledVector(fd,u/r),this.radius+=u}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(e_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(fd.copy(e.center).add(e_)),this.expandByPoint(fd.copy(e.center).sub(e_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const qa=new Ge,t_=new Ge,hf=new Ge,$o=new Ge,n_=new Ge,df=new Ge,i_=new Ge;class vm{constructor(e=new Ge,n=new Ge(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qa)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=qa.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(qa.copy(this.origin).addScaledVector(this.direction,n),qa.distanceToSquared(e))}distanceSqToSegment(e,n,r,u){t_.copy(e).add(n).multiplyScalar(.5),hf.copy(n).sub(e).normalize(),$o.copy(this.origin).sub(t_);const f=e.distanceTo(n)*.5,p=-this.direction.dot(hf),s=$o.dot(this.direction),S=-$o.dot(hf),M=$o.lengthSq(),C=Math.abs(1-p*p);let I,L,R,B;if(C>0)if(I=p*S-s,L=p*s-S,B=f*C,I>=0)if(L>=-B)if(L<=B){const Z=1/C;I*=Z,L*=Z,R=I*(I+p*L+2*s)+L*(p*I+L+2*S)+M}else L=f,I=Math.max(0,-(p*L+s)),R=-I*I+L*(L+2*S)+M;else L=-f,I=Math.max(0,-(p*L+s)),R=-I*I+L*(L+2*S)+M;else L<=-B?(I=Math.max(0,-(-p*f+s)),L=I>0?-f:Math.min(Math.max(-f,-S),f),R=-I*I+L*(L+2*S)+M):L<=B?(I=0,L=Math.min(Math.max(-f,-S),f),R=L*(L+2*S)+M):(I=Math.max(0,-(p*f+s)),L=I>0?f:Math.min(Math.max(-f,-S),f),R=-I*I+L*(L+2*S)+M);else L=p>0?-f:f,I=Math.max(0,-(p*L+s)),R=-I*I+L*(L+2*S)+M;return r&&r.copy(this.origin).addScaledVector(this.direction,I),u&&u.copy(t_).addScaledVector(hf,L),R}intersectSphere(e,n){qa.subVectors(e.center,this.origin);const r=qa.dot(this.direction),u=qa.dot(qa)-r*r,f=e.radius*e.radius;if(u>f)return null;const p=Math.sqrt(f-u),s=r-p,S=r+p;return S<0?null:s<0?this.at(S,n):this.at(s,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,u,f,p,s,S;const M=1/this.direction.x,C=1/this.direction.y,I=1/this.direction.z,L=this.origin;return M>=0?(r=(e.min.x-L.x)*M,u=(e.max.x-L.x)*M):(r=(e.max.x-L.x)*M,u=(e.min.x-L.x)*M),C>=0?(f=(e.min.y-L.y)*C,p=(e.max.y-L.y)*C):(f=(e.max.y-L.y)*C,p=(e.min.y-L.y)*C),r>p||f>u||((f>r||isNaN(r))&&(r=f),(p<u||isNaN(u))&&(u=p),I>=0?(s=(e.min.z-L.z)*I,S=(e.max.z-L.z)*I):(s=(e.max.z-L.z)*I,S=(e.min.z-L.z)*I),r>S||s>u)||((s>r||r!==r)&&(r=s),(S<u||u!==u)&&(u=S),u<0)?null:this.at(r>=0?r:u,n)}intersectsBox(e){return this.intersectBox(e,qa)!==null}intersectTriangle(e,n,r,u,f){n_.subVectors(n,e),df.subVectors(r,e),i_.crossVectors(n_,df);let p=this.direction.dot(i_),s;if(p>0){if(u)return null;s=1}else if(p<0)s=-1,p=-p;else return null;$o.subVectors(this.origin,e);const S=s*this.direction.dot(df.crossVectors($o,df));if(S<0)return null;const M=s*this.direction.dot(n_.cross($o));if(M<0||S+M>p)return null;const C=-s*$o.dot(i_);return C<0?null:this.at(C/p,f)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class dn{constructor(e,n,r,u,f,p,s,S,M,C,I,L,R,B,Z,V){dn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,u,f,p,s,S,M,C,I,L,R,B,Z,V)}set(e,n,r,u,f,p,s,S,M,C,I,L,R,B,Z,V){const O=this.elements;return O[0]=e,O[4]=n,O[8]=r,O[12]=u,O[1]=f,O[5]=p,O[9]=s,O[13]=S,O[2]=M,O[6]=C,O[10]=I,O[14]=L,O[3]=R,O[7]=B,O[11]=Z,O[15]=V,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new dn().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,u=1/du.setFromMatrixColumn(e,0).length(),f=1/du.setFromMatrixColumn(e,1).length(),p=1/du.setFromMatrixColumn(e,2).length();return n[0]=r[0]*u,n[1]=r[1]*u,n[2]=r[2]*u,n[3]=0,n[4]=r[4]*f,n[5]=r[5]*f,n[6]=r[6]*f,n[7]=0,n[8]=r[8]*p,n[9]=r[9]*p,n[10]=r[10]*p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,u=e.y,f=e.z,p=Math.cos(r),s=Math.sin(r),S=Math.cos(u),M=Math.sin(u),C=Math.cos(f),I=Math.sin(f);if(e.order==="XYZ"){const L=p*C,R=p*I,B=s*C,Z=s*I;n[0]=S*C,n[4]=-S*I,n[8]=M,n[1]=R+B*M,n[5]=L-Z*M,n[9]=-s*S,n[2]=Z-L*M,n[6]=B+R*M,n[10]=p*S}else if(e.order==="YXZ"){const L=S*C,R=S*I,B=M*C,Z=M*I;n[0]=L+Z*s,n[4]=B*s-R,n[8]=p*M,n[1]=p*I,n[5]=p*C,n[9]=-s,n[2]=R*s-B,n[6]=Z+L*s,n[10]=p*S}else if(e.order==="ZXY"){const L=S*C,R=S*I,B=M*C,Z=M*I;n[0]=L-Z*s,n[4]=-p*I,n[8]=B+R*s,n[1]=R+B*s,n[5]=p*C,n[9]=Z-L*s,n[2]=-p*M,n[6]=s,n[10]=p*S}else if(e.order==="ZYX"){const L=p*C,R=p*I,B=s*C,Z=s*I;n[0]=S*C,n[4]=B*M-R,n[8]=L*M+Z,n[1]=S*I,n[5]=Z*M+L,n[9]=R*M-B,n[2]=-M,n[6]=s*S,n[10]=p*S}else if(e.order==="YZX"){const L=p*S,R=p*M,B=s*S,Z=s*M;n[0]=S*C,n[4]=Z-L*I,n[8]=B*I+R,n[1]=I,n[5]=p*C,n[9]=-s*C,n[2]=-M*C,n[6]=R*I+B,n[10]=L-Z*I}else if(e.order==="XZY"){const L=p*S,R=p*M,B=s*S,Z=s*M;n[0]=S*C,n[4]=-I,n[8]=M*C,n[1]=L*I+Z,n[5]=p*C,n[9]=R*I-B,n[2]=B*I-R,n[6]=s*C,n[10]=Z*I+L}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(uP,e,hP)}lookAt(e,n,r){const u=this.elements;return ms.subVectors(e,n),ms.lengthSq()===0&&(ms.z=1),ms.normalize(),Wo.crossVectors(r,ms),Wo.lengthSq()===0&&(Math.abs(r.z)===1?ms.x+=1e-4:ms.z+=1e-4,ms.normalize(),Wo.crossVectors(r,ms)),Wo.normalize(),pf.crossVectors(ms,Wo),u[0]=Wo.x,u[4]=pf.x,u[8]=ms.x,u[1]=Wo.y,u[5]=pf.y,u[9]=ms.y,u[2]=Wo.z,u[6]=pf.z,u[10]=ms.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,u=n.elements,f=this.elements,p=r[0],s=r[4],S=r[8],M=r[12],C=r[1],I=r[5],L=r[9],R=r[13],B=r[2],Z=r[6],V=r[10],O=r[14],ge=r[3],me=r[7],Q=r[11],de=r[15],fe=u[0],ye=u[4],ke=u[8],ce=u[12],ie=u[1],Oe=u[5],nt=u[9],Je=u[13],ut=u[2],ht=u[6],ot=u[10],ft=u[14],tt=u[3],It=u[7],Ut=u[11],Wt=u[15];return f[0]=p*fe+s*ie+S*ut+M*tt,f[4]=p*ye+s*Oe+S*ht+M*It,f[8]=p*ke+s*nt+S*ot+M*Ut,f[12]=p*ce+s*Je+S*ft+M*Wt,f[1]=C*fe+I*ie+L*ut+R*tt,f[5]=C*ye+I*Oe+L*ht+R*It,f[9]=C*ke+I*nt+L*ot+R*Ut,f[13]=C*ce+I*Je+L*ft+R*Wt,f[2]=B*fe+Z*ie+V*ut+O*tt,f[6]=B*ye+Z*Oe+V*ht+O*It,f[10]=B*ke+Z*nt+V*ot+O*Ut,f[14]=B*ce+Z*Je+V*ft+O*Wt,f[3]=ge*fe+me*ie+Q*ut+de*tt,f[7]=ge*ye+me*Oe+Q*ht+de*It,f[11]=ge*ke+me*nt+Q*ot+de*Ut,f[15]=ge*ce+me*Je+Q*ft+de*Wt,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],u=e[8],f=e[12],p=e[1],s=e[5],S=e[9],M=e[13],C=e[2],I=e[6],L=e[10],R=e[14],B=e[3],Z=e[7],V=e[11],O=e[15];return B*(+f*S*I-u*M*I-f*s*L+r*M*L+u*s*R-r*S*R)+Z*(+n*S*R-n*M*L+f*p*L-u*p*R+u*M*C-f*S*C)+V*(+n*M*I-n*s*R-f*p*I+r*p*R+f*s*C-r*M*C)+O*(-u*s*C-n*S*I+n*s*L+u*p*I-r*p*L+r*S*C)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const u=this.elements;return e.isVector3?(u[12]=e.x,u[13]=e.y,u[14]=e.z):(u[12]=e,u[13]=n,u[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],u=e[2],f=e[3],p=e[4],s=e[5],S=e[6],M=e[7],C=e[8],I=e[9],L=e[10],R=e[11],B=e[12],Z=e[13],V=e[14],O=e[15],ge=I*V*M-Z*L*M+Z*S*R-s*V*R-I*S*O+s*L*O,me=B*L*M-C*V*M-B*S*R+p*V*R+C*S*O-p*L*O,Q=C*Z*M-B*I*M+B*s*R-p*Z*R-C*s*O+p*I*O,de=B*I*S-C*Z*S-B*s*L+p*Z*L+C*s*V-p*I*V,fe=n*ge+r*me+u*Q+f*de;if(fe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ye=1/fe;return e[0]=ge*ye,e[1]=(Z*L*f-I*V*f-Z*u*R+r*V*R+I*u*O-r*L*O)*ye,e[2]=(s*V*f-Z*S*f+Z*u*M-r*V*M-s*u*O+r*S*O)*ye,e[3]=(I*S*f-s*L*f-I*u*M+r*L*M+s*u*R-r*S*R)*ye,e[4]=me*ye,e[5]=(C*V*f-B*L*f+B*u*R-n*V*R-C*u*O+n*L*O)*ye,e[6]=(B*S*f-p*V*f-B*u*M+n*V*M+p*u*O-n*S*O)*ye,e[7]=(p*L*f-C*S*f+C*u*M-n*L*M-p*u*R+n*S*R)*ye,e[8]=Q*ye,e[9]=(B*I*f-C*Z*f-B*r*R+n*Z*R+C*r*O-n*I*O)*ye,e[10]=(p*Z*f-B*s*f+B*r*M-n*Z*M-p*r*O+n*s*O)*ye,e[11]=(C*s*f-p*I*f-C*r*M+n*I*M+p*r*R-n*s*R)*ye,e[12]=de*ye,e[13]=(C*Z*u-B*I*u+B*r*L-n*Z*L-C*r*V+n*I*V)*ye,e[14]=(B*s*u-p*Z*u-B*r*S+n*Z*S+p*r*V-n*s*V)*ye,e[15]=(p*I*u-C*s*u+C*r*S-n*I*S-p*r*L+n*s*L)*ye,this}scale(e){const n=this.elements,r=e.x,u=e.y,f=e.z;return n[0]*=r,n[4]*=u,n[8]*=f,n[1]*=r,n[5]*=u,n[9]*=f,n[2]*=r,n[6]*=u,n[10]*=f,n[3]*=r,n[7]*=u,n[11]*=f,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],u=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,u))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),u=Math.sin(n),f=1-r,p=e.x,s=e.y,S=e.z,M=f*p,C=f*s;return this.set(M*p+r,M*s-u*S,M*S+u*s,0,M*s+u*S,C*s+r,C*S-u*p,0,M*S-u*s,C*S+u*p,f*S*S+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,u,f,p){return this.set(1,r,f,0,e,1,p,0,n,u,1,0,0,0,0,1),this}compose(e,n,r){const u=this.elements,f=n._x,p=n._y,s=n._z,S=n._w,M=f+f,C=p+p,I=s+s,L=f*M,R=f*C,B=f*I,Z=p*C,V=p*I,O=s*I,ge=S*M,me=S*C,Q=S*I,de=r.x,fe=r.y,ye=r.z;return u[0]=(1-(Z+O))*de,u[1]=(R+Q)*de,u[2]=(B-me)*de,u[3]=0,u[4]=(R-Q)*fe,u[5]=(1-(L+O))*fe,u[6]=(V+ge)*fe,u[7]=0,u[8]=(B+me)*ye,u[9]=(V-ge)*ye,u[10]=(1-(L+Z))*ye,u[11]=0,u[12]=e.x,u[13]=e.y,u[14]=e.z,u[15]=1,this}decompose(e,n,r){const u=this.elements;let f=du.set(u[0],u[1],u[2]).length();const p=du.set(u[4],u[5],u[6]).length(),s=du.set(u[8],u[9],u[10]).length();this.determinant()<0&&(f=-f),e.x=u[12],e.y=u[13],e.z=u[14],Ws.copy(this);const M=1/f,C=1/p,I=1/s;return Ws.elements[0]*=M,Ws.elements[1]*=M,Ws.elements[2]*=M,Ws.elements[4]*=C,Ws.elements[5]*=C,Ws.elements[6]*=C,Ws.elements[8]*=I,Ws.elements[9]*=I,Ws.elements[10]*=I,n.setFromRotationMatrix(Ws),r.x=f,r.y=p,r.z=s,this}makePerspective(e,n,r,u,f,p,s=to){const S=this.elements,M=2*f/(n-e),C=2*f/(r-u),I=(n+e)/(n-e),L=(r+u)/(r-u);let R,B;if(s===to)R=-(p+f)/(p-f),B=-2*p*f/(p-f);else if(s===rm)R=-p/(p-f),B=-p*f/(p-f);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return S[0]=M,S[4]=0,S[8]=I,S[12]=0,S[1]=0,S[5]=C,S[9]=L,S[13]=0,S[2]=0,S[6]=0,S[10]=R,S[14]=B,S[3]=0,S[7]=0,S[11]=-1,S[15]=0,this}makeOrthographic(e,n,r,u,f,p,s=to){const S=this.elements,M=1/(n-e),C=1/(r-u),I=1/(p-f),L=(n+e)*M,R=(r+u)*C;let B,Z;if(s===to)B=(p+f)*I,Z=-2*I;else if(s===rm)B=f*I,Z=-1*I;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return S[0]=2*M,S[4]=0,S[8]=0,S[12]=-L,S[1]=0,S[5]=2*C,S[9]=0,S[13]=-R,S[2]=0,S[6]=0,S[10]=Z,S[14]=-B,S[3]=0,S[7]=0,S[11]=0,S[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let u=0;u<16;u++)if(n[u]!==r[u])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const du=new Ge,Ws=new dn,uP=new Ge(0,0,0),hP=new Ge(1,1,1),Wo=new Ge,pf=new Ge,ms=new Ge,gb=new dn,_b=new lo;class Ca{constructor(e=0,n=0,r=0,u=Ca.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=u}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,u=this._order){return this._x=e,this._y=n,this._z=r,this._order=u,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const u=e.elements,f=u[0],p=u[4],s=u[8],S=u[1],M=u[5],C=u[9],I=u[2],L=u[6],R=u[10];switch(n){case"XYZ":this._y=Math.asin($n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-C,R),this._z=Math.atan2(-p,f)):(this._x=Math.atan2(L,M),this._z=0);break;case"YXZ":this._x=Math.asin(-$n(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(s,R),this._z=Math.atan2(S,M)):(this._y=Math.atan2(-I,f),this._z=0);break;case"ZXY":this._x=Math.asin($n(L,-1,1)),Math.abs(L)<.9999999?(this._y=Math.atan2(-I,R),this._z=Math.atan2(-p,M)):(this._y=0,this._z=Math.atan2(S,f));break;case"ZYX":this._y=Math.asin(-$n(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(L,R),this._z=Math.atan2(S,f)):(this._x=0,this._z=Math.atan2(-p,M));break;case"YZX":this._z=Math.asin($n(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(-C,M),this._y=Math.atan2(-I,f)):(this._x=0,this._y=Math.atan2(s,R));break;case"XZY":this._z=Math.asin(-$n(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(L,M),this._y=Math.atan2(s,f)):(this._x=Math.atan2(-C,R),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return gb.makeRotationFromQuaternion(e),this.setFromRotationMatrix(gb,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return _b.setFromEuler(this),this.setFromQuaternion(_b,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ca.DEFAULT_ORDER="XYZ";class dS{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let dP=0;const yb=new Ge,pu=new lo,Za=new dn,ff=new Ge,md=new Ge,pP=new Ge,fP=new lo,vb=new Ge(1,0,0),xb=new Ge(0,1,0),bb=new Ge(0,0,1),wb={type:"added"},mP={type:"removed"},fu={type:"childadded",child:null},r_={type:"childremoved",child:null};class Di extends Ju{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dP++}),this.uuid=na(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Di.DEFAULT_UP.clone();const e=new Ge,n=new Ca,r=new lo,u=new Ge(1,1,1);function f(){r.setFromEuler(n,!1)}function p(){n.setFromQuaternion(r,void 0,!1)}n._onChange(f),r._onChange(p),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:u},modelViewMatrix:{value:new dn},normalMatrix:{value:new kn}}),this.matrix=new dn,this.matrixWorld=new dn,this.matrixAutoUpdate=Di.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Di.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new dS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return pu.setFromAxisAngle(e,n),this.quaternion.multiply(pu),this}rotateOnWorldAxis(e,n){return pu.setFromAxisAngle(e,n),this.quaternion.premultiply(pu),this}rotateX(e){return this.rotateOnAxis(vb,e)}rotateY(e){return this.rotateOnAxis(xb,e)}rotateZ(e){return this.rotateOnAxis(bb,e)}translateOnAxis(e,n){return yb.copy(e).applyQuaternion(this.quaternion),this.position.add(yb.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(vb,e)}translateY(e){return this.translateOnAxis(xb,e)}translateZ(e){return this.translateOnAxis(bb,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Za.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?ff.copy(e):ff.set(e,n,r);const u=this.parent;this.updateWorldMatrix(!0,!1),md.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Za.lookAt(md,ff,this.up):Za.lookAt(ff,md,this.up),this.quaternion.setFromRotationMatrix(Za),u&&(Za.extractRotation(u.matrixWorld),pu.setFromRotationMatrix(Za),this.quaternion.premultiply(pu.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(wb),fu.child=e,this.dispatchEvent(fu),fu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(mP),r_.child=e,this.dispatchEvent(r_),r_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Za.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Za.multiply(e.parent.matrixWorld)),e.applyMatrix4(Za),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(wb),fu.child=e,this.dispatchEvent(fu),fu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,u=this.children.length;r<u;r++){const p=this.children[r].getObjectByProperty(e,n);if(p!==void 0)return p}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const u=this.children;for(let f=0,p=u.length;f<p;f++)u[f].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(md,e,pP),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(md,fP,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,u=n.length;r<u;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,u=n.length;r<u;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,u=n.length;r<u;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const u=this.children;for(let f=0,p=u.length;f<p;f++)u[f].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const u={};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.castShadow===!0&&(u.castShadow=!0),this.receiveShadow===!0&&(u.receiveShadow=!0),this.visible===!1&&(u.visible=!1),this.frustumCulled===!1&&(u.frustumCulled=!1),this.renderOrder!==0&&(u.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(u.userData=this.userData),u.layers=this.layers.mask,u.matrix=this.matrix.toArray(),u.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(u.matrixAutoUpdate=!1),this.isInstancedMesh&&(u.type="InstancedMesh",u.count=this.count,u.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(u.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(u.type="BatchedMesh",u.perObjectFrustumCulled=this.perObjectFrustumCulled,u.sortObjects=this.sortObjects,u.drawRanges=this._drawRanges,u.reservedRanges=this._reservedRanges,u.visibility=this._visibility,u.active=this._active,u.bounds=this._bounds.map(s=>({boxInitialized:s.boxInitialized,boxMin:s.box.min.toArray(),boxMax:s.box.max.toArray(),sphereInitialized:s.sphereInitialized,sphereRadius:s.sphere.radius,sphereCenter:s.sphere.center.toArray()})),u.maxInstanceCount=this._maxInstanceCount,u.maxVertexCount=this._maxVertexCount,u.maxIndexCount=this._maxIndexCount,u.geometryInitialized=this._geometryInitialized,u.geometryCount=this._geometryCount,u.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(u.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(u.boundingSphere={center:u.boundingSphere.center.toArray(),radius:u.boundingSphere.radius}),this.boundingBox!==null&&(u.boundingBox={min:u.boundingBox.min.toArray(),max:u.boundingBox.max.toArray()}));function f(s,S){return s[S.uuid]===void 0&&(s[S.uuid]=S.toJSON(e)),S.uuid}if(this.isScene)this.background&&(this.background.isColor?u.background=this.background.toJSON():this.background.isTexture&&(u.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(u.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){u.geometry=f(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const S=s.shapes;if(Array.isArray(S))for(let M=0,C=S.length;M<C;M++){const I=S[M];f(e.shapes,I)}else f(e.shapes,S)}}if(this.isSkinnedMesh&&(u.bindMode=this.bindMode,u.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(f(e.skeletons,this.skeleton),u.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let S=0,M=this.material.length;S<M;S++)s.push(f(e.materials,this.material[S]));u.material=s}else u.material=f(e.materials,this.material);if(this.children.length>0){u.children=[];for(let s=0;s<this.children.length;s++)u.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){u.animations=[];for(let s=0;s<this.animations.length;s++){const S=this.animations[s];u.animations.push(f(e.animations,S))}}if(n){const s=p(e.geometries),S=p(e.materials),M=p(e.textures),C=p(e.images),I=p(e.shapes),L=p(e.skeletons),R=p(e.animations),B=p(e.nodes);s.length>0&&(r.geometries=s),S.length>0&&(r.materials=S),M.length>0&&(r.textures=M),C.length>0&&(r.images=C),I.length>0&&(r.shapes=I),L.length>0&&(r.skeletons=L),R.length>0&&(r.animations=R),B.length>0&&(r.nodes=B)}return r.object=u,r;function p(s){const S=[];for(const M in s){const C=s[M];delete C.metadata,S.push(C)}return S}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const u=e.children[r];this.add(u.clone())}return this}}Di.DEFAULT_UP=new Ge(0,1,0);Di.DEFAULT_MATRIX_AUTO_UPDATE=!0;Di.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const qs=new Ge,Xa=new Ge,s_=new Ge,Ya=new Ge,mu=new Ge,gu=new Ge,Sb=new Ge,a_=new Ge,o_=new Ge,l_=new Ge,c_=new oi,u_=new oi,h_=new oi;class Ks{constructor(e=new Ge,n=new Ge,r=new Ge){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,u){u.subVectors(r,n),qs.subVectors(e,n),u.cross(qs);const f=u.lengthSq();return f>0?u.multiplyScalar(1/Math.sqrt(f)):u.set(0,0,0)}static getBarycoord(e,n,r,u,f){qs.subVectors(u,n),Xa.subVectors(r,n),s_.subVectors(e,n);const p=qs.dot(qs),s=qs.dot(Xa),S=qs.dot(s_),M=Xa.dot(Xa),C=Xa.dot(s_),I=p*M-s*s;if(I===0)return f.set(0,0,0),null;const L=1/I,R=(M*S-s*C)*L,B=(p*C-s*S)*L;return f.set(1-R-B,B,R)}static containsPoint(e,n,r,u){return this.getBarycoord(e,n,r,u,Ya)===null?!1:Ya.x>=0&&Ya.y>=0&&Ya.x+Ya.y<=1}static getInterpolation(e,n,r,u,f,p,s,S){return this.getBarycoord(e,n,r,u,Ya)===null?(S.x=0,S.y=0,"z"in S&&(S.z=0),"w"in S&&(S.w=0),null):(S.setScalar(0),S.addScaledVector(f,Ya.x),S.addScaledVector(p,Ya.y),S.addScaledVector(s,Ya.z),S)}static getInterpolatedAttribute(e,n,r,u,f,p){return c_.setScalar(0),u_.setScalar(0),h_.setScalar(0),c_.fromBufferAttribute(e,n),u_.fromBufferAttribute(e,r),h_.fromBufferAttribute(e,u),p.setScalar(0),p.addScaledVector(c_,f.x),p.addScaledVector(u_,f.y),p.addScaledVector(h_,f.z),p}static isFrontFacing(e,n,r,u){return qs.subVectors(r,n),Xa.subVectors(e,n),qs.cross(Xa).dot(u)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,u){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[u]),this}setFromAttributeAndIndices(e,n,r,u){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,u),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return qs.subVectors(this.c,this.b),Xa.subVectors(this.a,this.b),qs.cross(Xa).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ks.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Ks.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,u,f){return Ks.getInterpolation(e,this.a,this.b,this.c,n,r,u,f)}containsPoint(e){return Ks.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ks.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,u=this.b,f=this.c;let p,s;mu.subVectors(u,r),gu.subVectors(f,r),a_.subVectors(e,r);const S=mu.dot(a_),M=gu.dot(a_);if(S<=0&&M<=0)return n.copy(r);o_.subVectors(e,u);const C=mu.dot(o_),I=gu.dot(o_);if(C>=0&&I<=C)return n.copy(u);const L=S*I-C*M;if(L<=0&&S>=0&&C<=0)return p=S/(S-C),n.copy(r).addScaledVector(mu,p);l_.subVectors(e,f);const R=mu.dot(l_),B=gu.dot(l_);if(B>=0&&R<=B)return n.copy(f);const Z=R*M-S*B;if(Z<=0&&M>=0&&B<=0)return s=M/(M-B),n.copy(r).addScaledVector(gu,s);const V=C*B-R*I;if(V<=0&&I-C>=0&&R-B>=0)return Sb.subVectors(f,u),s=(I-C)/(I-C+(R-B)),n.copy(u).addScaledVector(Sb,s);const O=1/(V+Z+L);return p=Z*O,s=L*O,n.copy(r).addScaledVector(mu,p).addScaledVector(gu,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const pS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qo={h:0,s:0,l:0},mf={h:0,s:0,l:0};function d_(c,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?c+(e-c)*6*n:n<1/2?e:n<2/3?c+(e-c)*6*(2/3-n):c}class vn{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const u=e;u&&u.isColor?this.copy(u):typeof u=="number"?this.setHex(u):typeof u=="string"&&this.setStyle(u)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Pr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Qn.toWorkingColorSpace(this,n),this}setRGB(e,n,r,u=Qn.workingColorSpace){return this.r=e,this.g=n,this.b=r,Qn.toWorkingColorSpace(this,u),this}setHSL(e,n,r,u=Qn.workingColorSpace){if(e=gv(e,1),n=$n(n,0,1),r=$n(r,0,1),n===0)this.r=this.g=this.b=r;else{const f=r<=.5?r*(1+n):r+n-r*n,p=2*r-f;this.r=d_(p,f,e+1/3),this.g=d_(p,f,e),this.b=d_(p,f,e-1/3)}return Qn.toWorkingColorSpace(this,u),this}setStyle(e,n=Pr){function r(f){f!==void 0&&parseFloat(f)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let u;if(u=/^(\w+)\(([^\)]*)\)/.exec(e)){let f;const p=u[1],s=u[2];switch(p){case"rgb":case"rgba":if(f=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(f[4]),this.setRGB(Math.min(255,parseInt(f[1],10))/255,Math.min(255,parseInt(f[2],10))/255,Math.min(255,parseInt(f[3],10))/255,n);if(f=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(f[4]),this.setRGB(Math.min(100,parseInt(f[1],10))/100,Math.min(100,parseInt(f[2],10))/100,Math.min(100,parseInt(f[3],10))/100,n);break;case"hsl":case"hsla":if(f=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(f[4]),this.setHSL(parseFloat(f[1])/360,parseFloat(f[2])/100,parseFloat(f[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(u=/^\#([A-Fa-f\d]+)$/.exec(e)){const f=u[1],p=f.length;if(p===3)return this.setRGB(parseInt(f.charAt(0),16)/15,parseInt(f.charAt(1),16)/15,parseInt(f.charAt(2),16)/15,n);if(p===6)return this.setHex(parseInt(f,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Pr){const r=pS[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=io(e.r),this.g=io(e.g),this.b=io(e.b),this}copyLinearToSRGB(e){return this.r=ku(e.r),this.g=ku(e.g),this.b=ku(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Pr){return Qn.fromWorkingColorSpace(Or.copy(this),e),Math.round($n(Or.r*255,0,255))*65536+Math.round($n(Or.g*255,0,255))*256+Math.round($n(Or.b*255,0,255))}getHexString(e=Pr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Qn.workingColorSpace){Qn.fromWorkingColorSpace(Or.copy(this),n);const r=Or.r,u=Or.g,f=Or.b,p=Math.max(r,u,f),s=Math.min(r,u,f);let S,M;const C=(s+p)/2;if(s===p)S=0,M=0;else{const I=p-s;switch(M=C<=.5?I/(p+s):I/(2-p-s),p){case r:S=(u-f)/I+(u<f?6:0);break;case u:S=(f-r)/I+2;break;case f:S=(r-u)/I+4;break}S/=6}return e.h=S,e.s=M,e.l=C,e}getRGB(e,n=Qn.workingColorSpace){return Qn.fromWorkingColorSpace(Or.copy(this),n),e.r=Or.r,e.g=Or.g,e.b=Or.b,e}getStyle(e=Pr){Qn.fromWorkingColorSpace(Or.copy(this),e);const n=Or.r,r=Or.g,u=Or.b;return e!==Pr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${u.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(u*255)})`}offsetHSL(e,n,r){return this.getHSL(qo),this.setHSL(qo.h+e,qo.s+n,qo.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(qo),e.getHSL(mf);const r=Pd(qo.h,mf.h,n),u=Pd(qo.s,mf.s,n),f=Pd(qo.l,mf.l,n);return this.setHSL(r,u,f),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,u=this.b,f=e.elements;return this.r=f[0]*n+f[3]*r+f[6]*u,this.g=f[1]*n+f[4]*r+f[7]*u,this.b=f[2]*n+f[5]*r+f[8]*u,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Or=new vn;vn.NAMES=pS;let gP=0;class Aa extends Ju{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gP++}),this.uuid=na(),this.name="",this.type="Material",this.blending=Lu,this.side=ao,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=W_,this.blendDst=q_,this.blendEquation=tc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new vn(0,0,0),this.blendAlpha=0,this.depthFunc=Nu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=cb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ou,this.stencilZFail=ou,this.stencilZPass=ou,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const u=this[n];if(u===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}u&&u.isColor?u.set(r):u&&u.isVector3&&r&&r.isVector3?u.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Lu&&(r.blending=this.blending),this.side!==ao&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==W_&&(r.blendSrc=this.blendSrc),this.blendDst!==q_&&(r.blendDst=this.blendDst),this.blendEquation!==tc&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Nu&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==cb&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ou&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ou&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ou&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function u(f){const p=[];for(const s in f){const S=f[s];delete S.metadata,p.push(S)}return p}if(n){const f=u(e.textures),p=u(e.images);f.length>0&&(r.textures=f),p.length>0&&(r.images=p)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const u=n.length;r=new Array(u);for(let f=0;f!==u;++f)r[f]=n[f].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class rc extends Aa{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new vn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ca,this.combine=qw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Qi=new Ge,gf=new ei;class qr{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=Iy,this.updateRanges=[],this.gpuType=ta,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let u=0,f=this.itemSize;u<f;u++)this.array[e+u]=n.array[r+u];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)gf.fromBufferAttribute(this,n),gf.applyMatrix3(e),this.setXY(n,gf.x,gf.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)Qi.fromBufferAttribute(this,n),Qi.applyMatrix3(e),this.setXYZ(n,Qi.x,Qi.y,Qi.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)Qi.fromBufferAttribute(this,n),Qi.applyMatrix4(e),this.setXYZ(n,Qi.x,Qi.y,Qi.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Qi.fromBufferAttribute(this,n),Qi.applyNormalMatrix(e),this.setXYZ(n,Qi.x,Qi.y,Qi.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Qi.fromBufferAttribute(this,n),Qi.transformDirection(e),this.setXYZ(n,Qi.x,Qi.y,Qi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=Ys(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=hi(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Ys(n,this.array)),n}setX(e,n){return this.normalized&&(n=hi(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Ys(n,this.array)),n}setY(e,n){return this.normalized&&(n=hi(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Ys(n,this.array)),n}setZ(e,n){return this.normalized&&(n=hi(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Ys(n,this.array)),n}setW(e,n){return this.normalized&&(n=hi(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,u){return e*=this.itemSize,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array),u=hi(u,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=u,this}setXYZW(e,n,r,u,f){return e*=this.itemSize,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array),u=hi(u,this.array),f=hi(f,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=u,this.array[e+3]=f,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Iy&&(e.usage=this.usage),e}}class fS extends qr{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class mS extends qr{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class ro extends qr{constructor(e,n,r){super(new Float32Array(e),n,r)}}let _P=0;const Ps=new dn,p_=new Di,_u=new Ge,gs=new co,gd=new co,_r=new Ge;class Ia extends Ju{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_P++}),this.uuid=na(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(cS(e)?mS:fS)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const f=new kn().getNormalMatrix(e);r.applyNormalMatrix(f),r.needsUpdate=!0}const u=this.attributes.tangent;return u!==void 0&&(u.transformDirection(e),u.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ps.makeRotationFromQuaternion(e),this.applyMatrix4(Ps),this}rotateX(e){return Ps.makeRotationX(e),this.applyMatrix4(Ps),this}rotateY(e){return Ps.makeRotationY(e),this.applyMatrix4(Ps),this}rotateZ(e){return Ps.makeRotationZ(e),this.applyMatrix4(Ps),this}translate(e,n,r){return Ps.makeTranslation(e,n,r),this.applyMatrix4(Ps),this}scale(e,n,r){return Ps.makeScale(e,n,r),this.applyMatrix4(Ps),this}lookAt(e){return p_.lookAt(e),p_.updateMatrix(),this.applyMatrix4(p_.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_u).negate(),this.translate(_u.x,_u.y,_u.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let u=0,f=e.length;u<f;u++){const p=e[u];r.push(p.x,p.y,p.z||0)}this.setAttribute("position",new ro(r,3))}else{const r=Math.min(e.length,n.count);for(let u=0;u<r;u++){const f=e[u];n.setXYZ(u,f.x,f.y,f.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new co);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ge(-1/0,-1/0,-1/0),new Ge(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,u=n.length;r<u;r++){const f=n[r];gs.setFromBufferAttribute(f),this.morphTargetsRelative?(_r.addVectors(this.boundingBox.min,gs.min),this.boundingBox.expandByPoint(_r),_r.addVectors(this.boundingBox.max,gs.max),this.boundingBox.expandByPoint(_r)):(this.boundingBox.expandByPoint(gs.min),this.boundingBox.expandByPoint(gs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Pa);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ge,1/0);return}if(e){const r=this.boundingSphere.center;if(gs.setFromBufferAttribute(e),n)for(let f=0,p=n.length;f<p;f++){const s=n[f];gd.setFromBufferAttribute(s),this.morphTargetsRelative?(_r.addVectors(gs.min,gd.min),gs.expandByPoint(_r),_r.addVectors(gs.max,gd.max),gs.expandByPoint(_r)):(gs.expandByPoint(gd.min),gs.expandByPoint(gd.max))}gs.getCenter(r);let u=0;for(let f=0,p=e.count;f<p;f++)_r.fromBufferAttribute(e,f),u=Math.max(u,r.distanceToSquared(_r));if(n)for(let f=0,p=n.length;f<p;f++){const s=n[f],S=this.morphTargetsRelative;for(let M=0,C=s.count;M<C;M++)_r.fromBufferAttribute(s,M),S&&(_u.fromBufferAttribute(e,M),_r.add(_u)),u=Math.max(u,r.distanceToSquared(_r))}this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,u=n.normal,f=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new qr(new Float32Array(4*r.count),4));const p=this.getAttribute("tangent"),s=[],S=[];for(let ke=0;ke<r.count;ke++)s[ke]=new Ge,S[ke]=new Ge;const M=new Ge,C=new Ge,I=new Ge,L=new ei,R=new ei,B=new ei,Z=new Ge,V=new Ge;function O(ke,ce,ie){M.fromBufferAttribute(r,ke),C.fromBufferAttribute(r,ce),I.fromBufferAttribute(r,ie),L.fromBufferAttribute(f,ke),R.fromBufferAttribute(f,ce),B.fromBufferAttribute(f,ie),C.sub(M),I.sub(M),R.sub(L),B.sub(L);const Oe=1/(R.x*B.y-B.x*R.y);isFinite(Oe)&&(Z.copy(C).multiplyScalar(B.y).addScaledVector(I,-R.y).multiplyScalar(Oe),V.copy(I).multiplyScalar(R.x).addScaledVector(C,-B.x).multiplyScalar(Oe),s[ke].add(Z),s[ce].add(Z),s[ie].add(Z),S[ke].add(V),S[ce].add(V),S[ie].add(V))}let ge=this.groups;ge.length===0&&(ge=[{start:0,count:e.count}]);for(let ke=0,ce=ge.length;ke<ce;++ke){const ie=ge[ke],Oe=ie.start,nt=ie.count;for(let Je=Oe,ut=Oe+nt;Je<ut;Je+=3)O(e.getX(Je+0),e.getX(Je+1),e.getX(Je+2))}const me=new Ge,Q=new Ge,de=new Ge,fe=new Ge;function ye(ke){de.fromBufferAttribute(u,ke),fe.copy(de);const ce=s[ke];me.copy(ce),me.sub(de.multiplyScalar(de.dot(ce))).normalize(),Q.crossVectors(fe,ce);const Oe=Q.dot(S[ke])<0?-1:1;p.setXYZW(ke,me.x,me.y,me.z,Oe)}for(let ke=0,ce=ge.length;ke<ce;++ke){const ie=ge[ke],Oe=ie.start,nt=ie.count;for(let Je=Oe,ut=Oe+nt;Je<ut;Je+=3)ye(e.getX(Je+0)),ye(e.getX(Je+1)),ye(e.getX(Je+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new qr(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let L=0,R=r.count;L<R;L++)r.setXYZ(L,0,0,0);const u=new Ge,f=new Ge,p=new Ge,s=new Ge,S=new Ge,M=new Ge,C=new Ge,I=new Ge;if(e)for(let L=0,R=e.count;L<R;L+=3){const B=e.getX(L+0),Z=e.getX(L+1),V=e.getX(L+2);u.fromBufferAttribute(n,B),f.fromBufferAttribute(n,Z),p.fromBufferAttribute(n,V),C.subVectors(p,f),I.subVectors(u,f),C.cross(I),s.fromBufferAttribute(r,B),S.fromBufferAttribute(r,Z),M.fromBufferAttribute(r,V),s.add(C),S.add(C),M.add(C),r.setXYZ(B,s.x,s.y,s.z),r.setXYZ(Z,S.x,S.y,S.z),r.setXYZ(V,M.x,M.y,M.z)}else for(let L=0,R=n.count;L<R;L+=3)u.fromBufferAttribute(n,L+0),f.fromBufferAttribute(n,L+1),p.fromBufferAttribute(n,L+2),C.subVectors(p,f),I.subVectors(u,f),C.cross(I),r.setXYZ(L+0,C.x,C.y,C.z),r.setXYZ(L+1,C.x,C.y,C.z),r.setXYZ(L+2,C.x,C.y,C.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)_r.fromBufferAttribute(e,n),_r.normalize(),e.setXYZ(n,_r.x,_r.y,_r.z)}toNonIndexed(){function e(s,S){const M=s.array,C=s.itemSize,I=s.normalized,L=new M.constructor(S.length*C);let R=0,B=0;for(let Z=0,V=S.length;Z<V;Z++){s.isInterleavedBufferAttribute?R=S[Z]*s.data.stride+s.offset:R=S[Z]*C;for(let O=0;O<C;O++)L[B++]=M[R++]}return new qr(L,C,I)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Ia,r=this.index.array,u=this.attributes;for(const s in u){const S=u[s],M=e(S,r);n.setAttribute(s,M)}const f=this.morphAttributes;for(const s in f){const S=[],M=f[s];for(let C=0,I=M.length;C<I;C++){const L=M[C],R=e(L,r);S.push(R)}n.morphAttributes[s]=S}n.morphTargetsRelative=this.morphTargetsRelative;const p=this.groups;for(let s=0,S=p.length;s<S;s++){const M=p[s];n.addGroup(M.start,M.count,M.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const S=this.parameters;for(const M in S)S[M]!==void 0&&(e[M]=S[M]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const S in r){const M=r[S];e.data.attributes[S]=M.toJSON(e.data)}const u={};let f=!1;for(const S in this.morphAttributes){const M=this.morphAttributes[S],C=[];for(let I=0,L=M.length;I<L;I++){const R=M[I];C.push(R.toJSON(e.data))}C.length>0&&(u[S]=C,f=!0)}f&&(e.data.morphAttributes=u,e.data.morphTargetsRelative=this.morphTargetsRelative);const p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(n));const u=e.attributes;for(const M in u){const C=u[M];this.setAttribute(M,C.clone(n))}const f=e.morphAttributes;for(const M in f){const C=[],I=f[M];for(let L=0,R=I.length;L<R;L++)C.push(I[L].clone(n));this.morphAttributes[M]=C}this.morphTargetsRelative=e.morphTargetsRelative;const p=e.groups;for(let M=0,C=p.length;M<C;M++){const I=p[M];this.addGroup(I.start,I.count,I.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const S=e.boundingSphere;return S!==null&&(this.boundingSphere=S.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Mb=new dn,Wl=new vm,_f=new Pa,Tb=new Ge,yf=new Ge,vf=new Ge,xf=new Ge,f_=new Ge,bf=new Ge,Eb=new Ge,wf=new Ge;class rs extends Di{constructor(e=new Ia,n=new rc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const u=n[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,p=u.length;f<p;f++){const s=u[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=f}}}}getVertexPosition(e,n){const r=this.geometry,u=r.attributes.position,f=r.morphAttributes.position,p=r.morphTargetsRelative;n.fromBufferAttribute(u,e);const s=this.morphTargetInfluences;if(f&&s){bf.set(0,0,0);for(let S=0,M=f.length;S<M;S++){const C=s[S],I=f[S];C!==0&&(f_.fromBufferAttribute(I,e),p?bf.addScaledVector(f_,C):bf.addScaledVector(f_.sub(n),C))}n.add(bf)}return n}raycast(e,n){const r=this.geometry,u=this.material,f=this.matrixWorld;u!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),_f.copy(r.boundingSphere),_f.applyMatrix4(f),Wl.copy(e.ray).recast(e.near),!(_f.containsPoint(Wl.origin)===!1&&(Wl.intersectSphere(_f,Tb)===null||Wl.origin.distanceToSquared(Tb)>(e.far-e.near)**2))&&(Mb.copy(f).invert(),Wl.copy(e.ray).applyMatrix4(Mb),!(r.boundingBox!==null&&Wl.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Wl)))}_computeIntersections(e,n,r){let u;const f=this.geometry,p=this.material,s=f.index,S=f.attributes.position,M=f.attributes.uv,C=f.attributes.uv1,I=f.attributes.normal,L=f.groups,R=f.drawRange;if(s!==null)if(Array.isArray(p))for(let B=0,Z=L.length;B<Z;B++){const V=L[B],O=p[V.materialIndex],ge=Math.max(V.start,R.start),me=Math.min(s.count,Math.min(V.start+V.count,R.start+R.count));for(let Q=ge,de=me;Q<de;Q+=3){const fe=s.getX(Q),ye=s.getX(Q+1),ke=s.getX(Q+2);u=Sf(this,O,e,r,M,C,I,fe,ye,ke),u&&(u.faceIndex=Math.floor(Q/3),u.face.materialIndex=V.materialIndex,n.push(u))}}else{const B=Math.max(0,R.start),Z=Math.min(s.count,R.start+R.count);for(let V=B,O=Z;V<O;V+=3){const ge=s.getX(V),me=s.getX(V+1),Q=s.getX(V+2);u=Sf(this,p,e,r,M,C,I,ge,me,Q),u&&(u.faceIndex=Math.floor(V/3),n.push(u))}}else if(S!==void 0)if(Array.isArray(p))for(let B=0,Z=L.length;B<Z;B++){const V=L[B],O=p[V.materialIndex],ge=Math.max(V.start,R.start),me=Math.min(S.count,Math.min(V.start+V.count,R.start+R.count));for(let Q=ge,de=me;Q<de;Q+=3){const fe=Q,ye=Q+1,ke=Q+2;u=Sf(this,O,e,r,M,C,I,fe,ye,ke),u&&(u.faceIndex=Math.floor(Q/3),u.face.materialIndex=V.materialIndex,n.push(u))}}else{const B=Math.max(0,R.start),Z=Math.min(S.count,R.start+R.count);for(let V=B,O=Z;V<O;V+=3){const ge=V,me=V+1,Q=V+2;u=Sf(this,p,e,r,M,C,I,ge,me,Q),u&&(u.faceIndex=Math.floor(V/3),n.push(u))}}}}function yP(c,e,n,r,u,f,p,s){let S;if(e.side===ss?S=r.intersectTriangle(p,f,u,!0,s):S=r.intersectTriangle(u,f,p,e.side===ao,s),S===null)return null;wf.copy(s),wf.applyMatrix4(c.matrixWorld);const M=n.ray.origin.distanceTo(wf);return M<n.near||M>n.far?null:{distance:M,point:wf.clone(),object:c}}function Sf(c,e,n,r,u,f,p,s,S,M){c.getVertexPosition(s,yf),c.getVertexPosition(S,vf),c.getVertexPosition(M,xf);const C=yP(c,e,n,r,yf,vf,xf,Eb);if(C){const I=new Ge;Ks.getBarycoord(Eb,yf,vf,xf,I),u&&(C.uv=Ks.getInterpolatedAttribute(u,s,S,M,I,new ei)),f&&(C.uv1=Ks.getInterpolatedAttribute(f,s,S,M,I,new ei)),p&&(C.normal=Ks.getInterpolatedAttribute(p,s,S,M,I,new Ge),C.normal.dot(r.direction)>0&&C.normal.multiplyScalar(-1));const L={a:s,b:S,c:M,normal:new Ge,materialIndex:0};Ks.getNormal(yf,vf,xf,L.normal),C.face=L,C.barycoord=I}return C}class Yd extends Ia{constructor(e=1,n=1,r=1,u=1,f=1,p=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:u,heightSegments:f,depthSegments:p};const s=this;u=Math.floor(u),f=Math.floor(f),p=Math.floor(p);const S=[],M=[],C=[],I=[];let L=0,R=0;B("z","y","x",-1,-1,r,n,e,p,f,0),B("z","y","x",1,-1,r,n,-e,p,f,1),B("x","z","y",1,1,e,r,n,u,p,2),B("x","z","y",1,-1,e,r,-n,u,p,3),B("x","y","z",1,-1,e,n,r,u,f,4),B("x","y","z",-1,-1,e,n,-r,u,f,5),this.setIndex(S),this.setAttribute("position",new ro(M,3)),this.setAttribute("normal",new ro(C,3)),this.setAttribute("uv",new ro(I,2));function B(Z,V,O,ge,me,Q,de,fe,ye,ke,ce){const ie=Q/ye,Oe=de/ke,nt=Q/2,Je=de/2,ut=fe/2,ht=ye+1,ot=ke+1;let ft=0,tt=0;const It=new Ge;for(let Ut=0;Ut<ot;Ut++){const Wt=Ut*Oe-Je;for(let $t=0;$t<ht;$t++){const Rn=$t*ie-nt;It[Z]=Rn*ge,It[V]=Wt*me,It[O]=ut,M.push(It.x,It.y,It.z),It[Z]=0,It[V]=0,It[O]=fe>0?1:-1,C.push(It.x,It.y,It.z),I.push($t/ye),I.push(1-Ut/ke),ft+=1}}for(let Ut=0;Ut<ke;Ut++)for(let Wt=0;Wt<ye;Wt++){const $t=L+Wt+ht*Ut,Rn=L+Wt+ht*(Ut+1),it=L+(Wt+1)+ht*(Ut+1),Tt=L+(Wt+1)+ht*Ut;S.push($t,Rn,Tt),S.push(Rn,it,Tt),tt+=6}s.addGroup(R,tt,ce),R+=tt,L+=ft}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function $u(c){const e={};for(const n in c){e[n]={};for(const r in c[n]){const u=c[n][r];u&&(u.isColor||u.isMatrix3||u.isMatrix4||u.isVector2||u.isVector3||u.isVector4||u.isTexture||u.isQuaternion)?u.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=u.clone():Array.isArray(u)?e[n][r]=u.slice():e[n][r]=u}}return e}function Hr(c){const e={};for(let n=0;n<c.length;n++){const r=$u(c[n]);for(const u in r)e[u]=r[u]}return e}function vP(c){const e=[];for(let n=0;n<c.length;n++)e.push(c[n].clone());return e}function gS(c){const e=c.getRenderTarget();return e===null?c.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Qn.workingColorSpace}const xP={clone:$u,merge:Hr};var bP=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wP=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class tl extends Aa{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=bP,this.fragmentShader=wP,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$u(e.uniforms),this.uniformsGroups=vP(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const u in this.uniforms){const p=this.uniforms[u].value;p&&p.isTexture?n.uniforms[u]={type:"t",value:p.toJSON(e).uuid}:p&&p.isColor?n.uniforms[u]={type:"c",value:p.getHex()}:p&&p.isVector2?n.uniforms[u]={type:"v2",value:p.toArray()}:p&&p.isVector3?n.uniforms[u]={type:"v3",value:p.toArray()}:p&&p.isVector4?n.uniforms[u]={type:"v4",value:p.toArray()}:p&&p.isMatrix3?n.uniforms[u]={type:"m3",value:p.toArray()}:p&&p.isMatrix4?n.uniforms[u]={type:"m4",value:p.toArray()}:n.uniforms[u]={value:p}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const u in this.extensions)this.extensions[u]===!0&&(r[u]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class _v extends Di{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new dn,this.projectionMatrix=new dn,this.projectionMatrixInverse=new dn,this.coordinateSystem=to}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Zo=new Ge,Ab=new ei,Cb=new ei;class is extends _v{constructor(e=50,n=1,r=.1,u=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=u,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=ju*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Cd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ju*2*Math.atan(Math.tan(Cd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){Zo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Zo.x,Zo.y).multiplyScalar(-e/Zo.z),Zo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Zo.x,Zo.y).multiplyScalar(-e/Zo.z)}getViewSize(e,n){return this.getViewBounds(e,Ab,Cb),n.subVectors(Cb,Ab)}setViewOffset(e,n,r,u,f,p){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=u,this.view.width=f,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(Cd*.5*this.fov)/this.zoom,r=2*n,u=this.aspect*r,f=-.5*u;const p=this.view;if(this.view!==null&&this.view.enabled){const S=p.fullWidth,M=p.fullHeight;f+=p.offsetX*u/S,n-=p.offsetY*r/M,u*=p.width/S,r*=p.height/M}const s=this.filmOffset;s!==0&&(f+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(f,f+u,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const yu=-90,vu=1;class SP extends Di{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const u=new is(yu,vu,e,n);u.layers=this.layers,this.add(u);const f=new is(yu,vu,e,n);f.layers=this.layers,this.add(f);const p=new is(yu,vu,e,n);p.layers=this.layers,this.add(p);const s=new is(yu,vu,e,n);s.layers=this.layers,this.add(s);const S=new is(yu,vu,e,n);S.layers=this.layers,this.add(S);const M=new is(yu,vu,e,n);M.layers=this.layers,this.add(M)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,u,f,p,s,S]=n;for(const M of n)this.remove(M);if(e===to)r.up.set(0,1,0),r.lookAt(1,0,0),u.up.set(0,1,0),u.lookAt(-1,0,0),f.up.set(0,0,-1),f.lookAt(0,1,0),p.up.set(0,0,1),p.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),S.up.set(0,1,0),S.lookAt(0,0,-1);else if(e===rm)r.up.set(0,-1,0),r.lookAt(-1,0,0),u.up.set(0,-1,0),u.lookAt(1,0,0),f.up.set(0,0,1),f.lookAt(0,1,0),p.up.set(0,0,-1),p.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),S.up.set(0,-1,0),S.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const M of n)this.add(M),M.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:u}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[f,p,s,S,M,C]=this.children,I=e.getRenderTarget(),L=e.getActiveCubeFace(),R=e.getActiveMipmapLevel(),B=e.xr.enabled;e.xr.enabled=!1;const Z=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,u),e.render(n,f),e.setRenderTarget(r,1,u),e.render(n,p),e.setRenderTarget(r,2,u),e.render(n,s),e.setRenderTarget(r,3,u),e.render(n,S),e.setRenderTarget(r,4,u),e.render(n,M),r.texture.generateMipmaps=Z,e.setRenderTarget(r,5,u),e.render(n,C),e.setRenderTarget(I,L,R),e.xr.enabled=B,r.texture.needsPMREMUpdate=!0}}class _S extends yr{constructor(e,n,r,u,f,p,s,S,M,C){e=e!==void 0?e:[],n=n!==void 0?n:Uu,super(e,n,r,u,f,p,s,S,M,C),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class MP extends fc{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},u=[r,r,r,r,r,r];this.texture=new _S(u,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:bs}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},u=new Yd(5,5,5),f=new tl({name:"CubemapFromEquirect",uniforms:$u(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ss,blending:Qo});f.uniforms.tEquirect.value=n;const p=new rs(u,f),s=n.minFilter;return n.minFilter===eo&&(n.minFilter=bs),new SP(1,10,this).update(e,p),n.minFilter=s,p.geometry.dispose(),p.material.dispose(),this}clear(e,n,r,u){const f=e.getRenderTarget();for(let p=0;p<6;p++)e.setRenderTarget(this,p),e.clear(n,r,u);e.setRenderTarget(f)}}class TP extends Di{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ca,this.environmentIntensity=1,this.environmentRotation=new Ca,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class EP{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=Iy,this.updateRanges=[],this.version=0,this.uuid=na()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,r){e*=this.stride,r*=n.stride;for(let u=0,f=this.stride;u<f;u++)this.array[e+u]=n.array[r+u];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=na()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(n,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=na()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Gr=new Ge;class yv{constructor(e,n,r,u=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=u}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,r=this.data.count;n<r;n++)Gr.fromBufferAttribute(this,n),Gr.applyMatrix4(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Gr.fromBufferAttribute(this,n),Gr.applyNormalMatrix(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Gr.fromBufferAttribute(this,n),Gr.transformDirection(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}getComponent(e,n){let r=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(r=Ys(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=hi(r,this.array)),this.data.array[e*this.data.stride+this.offset+n]=r,this}setX(e,n){return this.normalized&&(n=hi(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=hi(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=hi(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=hi(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=Ys(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=Ys(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=Ys(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=Ys(n,this.array)),n}setXY(e,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this}setXYZ(e,n,r,u){return e=e*this.data.stride+this.offset,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array),u=hi(u,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=u,this}setXYZW(e,n,r,u,f){return e=e*this.data.stride+this.offset,this.normalized&&(n=hi(n,this.array),r=hi(r,this.array),u=hi(u,this.array),f=hi(f,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=u,this.data.array[e+3]=f,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const u=r*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)n.push(this.data.array[u+f])}return new qr(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new yv(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const u=r*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)n.push(this.data.array[u+f])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Pb=new Ge,Ib=new oi,Rb=new oi,AP=new Ge,Lb=new dn,Mf=new Ge,m_=new Pa,Db=new dn,g_=new vm;class CP extends rs{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=sb,this.bindMatrix=new dn,this.bindMatrixInverse=new dn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new co),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,Mf),this.boundingBox.expandByPoint(Mf)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Pa),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,Mf),this.boundingSphere.expandByPoint(Mf)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const r=this.material,u=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),m_.copy(this.boundingSphere),m_.applyMatrix4(u),e.ray.intersectsSphere(m_)!==!1&&(Db.copy(u).invert(),g_.copy(e.ray).applyMatrix4(Db),!(this.boundingBox!==null&&g_.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,g_)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new oi,n=this.geometry.attributes.skinWeight;for(let r=0,u=n.count;r<u;r++){e.fromBufferAttribute(n,r);const f=1/e.manhattanLength();f!==1/0?e.multiplyScalar(f):e.set(1,0,0,0),n.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===sb?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===MC?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const r=this.skeleton,u=this.geometry;Ib.fromBufferAttribute(u.attributes.skinIndex,e),Rb.fromBufferAttribute(u.attributes.skinWeight,e),Pb.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let f=0;f<4;f++){const p=Rb.getComponent(f);if(p!==0){const s=Ib.getComponent(f);Lb.multiplyMatrices(r.bones[s].matrixWorld,r.boneInverses[s]),n.addScaledVector(AP.copy(Pb).applyMatrix4(Lb),p)}}return n.applyMatrix4(this.bindMatrixInverse)}}class yS extends Di{constructor(){super(),this.isBone=!0,this.type="Bone"}}class vS extends yr{constructor(e=null,n=1,r=1,u,f,p,s,S,M=Wr,C=Wr,I,L){super(null,p,s,S,M,C,u,f,I,L),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const kb=new dn,PP=new dn;class vv{constructor(e=[],n=[]){this.uuid=na(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,u=this.bones.length;r<u;r++)this.boneInverses.push(new dn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const r=new dn;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,n=this.boneInverses,r=this.boneMatrices,u=this.boneTexture;for(let f=0,p=e.length;f<p;f++){const s=e[f]?e[f].matrixWorld:PP;kb.multiplyMatrices(s,n[f]),kb.toArray(r,f*16)}u!==null&&(u.needsUpdate=!0)}clone(){return new vv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const r=new vS(n,e,e,ks,ta);return r.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=r,this}getBoneByName(e){for(let n=0,r=this.bones.length;n<r;n++){const u=this.bones[n];if(u.name===e)return u}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let r=0,u=e.bones.length;r<u;r++){const f=e.bones[r];let p=n[f];p===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",f),p=new yS),this.bones.push(p),this.boneInverses.push(new dn().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,r=this.boneInverses;for(let u=0,f=n.length;u<f;u++){const p=n[u];e.bones.push(p.uuid);const s=r[u];e.boneInverses.push(s.toArray())}return e}}class Ry extends qr{constructor(e,n,r,u=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=u}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const xu=new dn,zb=new dn,Tf=[],Fb=new co,IP=new dn,_d=new rs,yd=new Pa;class RP extends rs{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new Ry(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let u=0;u<r;u++)this.setMatrixAt(u,IP)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new co),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,xu),Fb.copy(e.boundingBox).applyMatrix4(xu),this.boundingBox.union(Fb)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Pa),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,xu),yd.copy(e.boundingSphere).applyMatrix4(xu),this.boundingSphere.union(yd)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,u=this.morphTexture.source.data.data,f=r.length+1,p=e*f+1;for(let s=0;s<r.length;s++)r[s]=u[p+s]}raycast(e,n){const r=this.matrixWorld,u=this.count;if(_d.geometry=this.geometry,_d.material=this.material,_d.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),yd.copy(this.boundingSphere),yd.applyMatrix4(r),e.ray.intersectsSphere(yd)!==!1))for(let f=0;f<u;f++){this.getMatrixAt(f,xu),zb.multiplyMatrices(r,xu),_d.matrixWorld=zb,_d.raycast(e,Tf);for(let p=0,s=Tf.length;p<s;p++){const S=Tf[p];S.instanceId=f,S.object=this,n.push(S)}Tf.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new Ry(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,u=r.length+1;this.morphTexture===null&&(this.morphTexture=new vS(new Float32Array(u*this.count),u,this.count,dv,ta));const f=this.morphTexture.source.data.data;let p=0;for(let M=0;M<r.length;M++)p+=r[M];const s=this.geometry.morphTargetsRelative?1:1-p,S=u*e;f[S]=s,f.set(r,S+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const __=new Ge,LP=new Ge,DP=new kn;class Ql{constructor(e=new Ge(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,u){return this.normal.set(e,n,r),this.constant=u,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const u=__.subVectors(r,n).cross(LP.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(u,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(__),u=this.normal.dot(r);if(u===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const f=-(e.start.dot(this.normal)+this.constant)/u;return f<0||f>1?null:n.copy(e.start).addScaledVector(r,f)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||DP.getNormalMatrix(e),u=this.coplanarPoint(__).applyMatrix4(e),f=this.normal.applyMatrix3(r).normalize();return this.constant=-u.dot(f),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ql=new Pa,Ef=new Ge;class xv{constructor(e=new Ql,n=new Ql,r=new Ql,u=new Ql,f=new Ql,p=new Ql){this.planes=[e,n,r,u,f,p]}set(e,n,r,u,f,p){const s=this.planes;return s[0].copy(e),s[1].copy(n),s[2].copy(r),s[3].copy(u),s[4].copy(f),s[5].copy(p),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=to){const r=this.planes,u=e.elements,f=u[0],p=u[1],s=u[2],S=u[3],M=u[4],C=u[5],I=u[6],L=u[7],R=u[8],B=u[9],Z=u[10],V=u[11],O=u[12],ge=u[13],me=u[14],Q=u[15];if(r[0].setComponents(S-f,L-M,V-R,Q-O).normalize(),r[1].setComponents(S+f,L+M,V+R,Q+O).normalize(),r[2].setComponents(S+p,L+C,V+B,Q+ge).normalize(),r[3].setComponents(S-p,L-C,V-B,Q-ge).normalize(),r[4].setComponents(S-s,L-I,V-Z,Q-me).normalize(),n===to)r[5].setComponents(S+s,L+I,V+Z,Q+me).normalize();else if(n===rm)r[5].setComponents(s,I,Z,me).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ql.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),ql.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ql)}intersectsSprite(e){return ql.center.set(0,0,0),ql.radius=.7071067811865476,ql.applyMatrix4(e.matrixWorld),this.intersectsSphere(ql)}intersectsSphere(e){const n=this.planes,r=e.center,u=-e.radius;for(let f=0;f<6;f++)if(n[f].distanceToPoint(r)<u)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const u=n[r];if(Ef.x=u.normal.x>0?e.max.x:e.min.x,Ef.y=u.normal.y>0?e.max.y:e.min.y,Ef.z=u.normal.z>0?e.max.z:e.min.z,u.distanceToPoint(Ef)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class xS extends Aa{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new vn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const sm=new Ge,am=new Ge,Ob=new dn,vd=new vm,Af=new Pa,y_=new Ge,Nb=new Ge;class bv extends Di{constructor(e=new Ia,n=new xS){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[0];for(let u=1,f=n.count;u<f;u++)sm.fromBufferAttribute(n,u-1),am.fromBufferAttribute(n,u),r[u]=r[u-1],r[u]+=sm.distanceTo(am);e.setAttribute("lineDistance",new ro(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const r=this.geometry,u=this.matrixWorld,f=e.params.Line.threshold,p=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Af.copy(r.boundingSphere),Af.applyMatrix4(u),Af.radius+=f,e.ray.intersectsSphere(Af)===!1)return;Ob.copy(u).invert(),vd.copy(e.ray).applyMatrix4(Ob);const s=f/((this.scale.x+this.scale.y+this.scale.z)/3),S=s*s,M=this.isLineSegments?2:1,C=r.index,L=r.attributes.position;if(C!==null){const R=Math.max(0,p.start),B=Math.min(C.count,p.start+p.count);for(let Z=R,V=B-1;Z<V;Z+=M){const O=C.getX(Z),ge=C.getX(Z+1),me=Cf(this,e,vd,S,O,ge);me&&n.push(me)}if(this.isLineLoop){const Z=C.getX(B-1),V=C.getX(R),O=Cf(this,e,vd,S,Z,V);O&&n.push(O)}}else{const R=Math.max(0,p.start),B=Math.min(L.count,p.start+p.count);for(let Z=R,V=B-1;Z<V;Z+=M){const O=Cf(this,e,vd,S,Z,Z+1);O&&n.push(O)}if(this.isLineLoop){const Z=Cf(this,e,vd,S,B-1,R);Z&&n.push(Z)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const u=n[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,p=u.length;f<p;f++){const s=u[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=f}}}}}function Cf(c,e,n,r,u,f){const p=c.geometry.attributes.position;if(sm.fromBufferAttribute(p,u),am.fromBufferAttribute(p,f),n.distanceSqToSegment(sm,am,y_,Nb)>r)return;y_.applyMatrix4(c.matrixWorld);const S=e.ray.origin.distanceTo(y_);if(!(S<e.near||S>e.far))return{distance:S,point:Nb.clone().applyMatrix4(c.matrixWorld),index:u,face:null,faceIndex:null,barycoord:null,object:c}}const Ub=new Ge,Bb=new Ge;class kP extends bv{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[];for(let u=0,f=n.count;u<f;u+=2)Ub.fromBufferAttribute(n,u),Bb.fromBufferAttribute(n,u+1),r[u]=u===0?0:r[u-1],r[u+1]=r[u]+Ub.distanceTo(Bb);e.setAttribute("lineDistance",new ro(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class zP extends bv{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class bS extends Aa{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new vn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Vb=new dn,Ly=new vm,Pf=new Pa,If=new Ge;class FP extends Di{constructor(e=new Ia,n=new bS){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,u=this.matrixWorld,f=e.params.Points.threshold,p=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Pf.copy(r.boundingSphere),Pf.applyMatrix4(u),Pf.radius+=f,e.ray.intersectsSphere(Pf)===!1)return;Vb.copy(u).invert(),Ly.copy(e.ray).applyMatrix4(Vb);const s=f/((this.scale.x+this.scale.y+this.scale.z)/3),S=s*s,M=r.index,I=r.attributes.position;if(M!==null){const L=Math.max(0,p.start),R=Math.min(M.count,p.start+p.count);for(let B=L,Z=R;B<Z;B++){const V=M.getX(B);If.fromBufferAttribute(I,V),Gb(If,V,S,u,e,n,this)}}else{const L=Math.max(0,p.start),R=Math.min(I.count,p.start+p.count);for(let B=L,Z=R;B<Z;B++)If.fromBufferAttribute(I,B),Gb(If,B,S,u,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const u=n[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,p=u.length;f<p;f++){const s=u[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=f}}}}}function Gb(c,e,n,r,u,f,p){const s=Ly.distanceSqToPoint(c);if(s<n){const S=new Ge;Ly.closestPointToPoint(c,S),S.applyMatrix4(r);const M=u.ray.origin.distanceTo(S);if(M<u.near||M>u.far)return;f.push({distance:M,distanceToRay:Math.sqrt(s),point:S,index:e,face:null,faceIndex:null,barycoord:null,object:p})}}class sc extends Di{constructor(){super(),this.isGroup=!0,this.type="Group"}}class wS extends yr{constructor(e,n,r,u,f,p,s,S,M,C=Du){if(C!==Du&&C!==Hu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&C===Du&&(r=pc),r===void 0&&C===Hu&&(r=Gu),super(null,u,f,p,s,S,C,r,M),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=s!==void 0?s:Wr,this.minFilter=S!==void 0?S:Wr,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class xm extends Ia{constructor(e=1,n=1,r=1,u=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:u};const f=e/2,p=n/2,s=Math.floor(r),S=Math.floor(u),M=s+1,C=S+1,I=e/s,L=n/S,R=[],B=[],Z=[],V=[];for(let O=0;O<C;O++){const ge=O*L-p;for(let me=0;me<M;me++){const Q=me*I-f;B.push(Q,-ge,0),Z.push(0,0,1),V.push(me/s),V.push(1-O/S)}}for(let O=0;O<S;O++)for(let ge=0;ge<s;ge++){const me=ge+M*O,Q=ge+M*(O+1),de=ge+1+M*(O+1),fe=ge+1+M*O;R.push(me,Q,fe),R.push(Q,de,fe)}this.setIndex(R),this.setAttribute("position",new ro(B,3)),this.setAttribute("normal",new ro(Z,3)),this.setAttribute("uv",new ro(V,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xm(e.width,e.height,e.widthSegments,e.heightSegments)}}class wv extends Aa{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new vn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aS,this.normalScale=new ei(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ca,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ra extends wv{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ei(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return $n(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new vn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new vn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new vn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class OP extends Aa{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=AC,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class NP extends Aa{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Rf(c,e,n){return!c||!n&&c.constructor===e?c:typeof e.BYTES_PER_ELEMENT=="number"?new e(c):Array.prototype.slice.call(c)}function UP(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)}function BP(c){function e(u,f){return c[u]-c[f]}const n=c.length,r=new Array(n);for(let u=0;u!==n;++u)r[u]=u;return r.sort(e),r}function Hb(c,e,n){const r=c.length,u=new c.constructor(r);for(let f=0,p=0;p!==r;++f){const s=n[f]*e;for(let S=0;S!==e;++S)u[p++]=c[s+S]}return u}function SS(c,e,n,r){let u=1,f=c[0];for(;f!==void 0&&f[r]===void 0;)f=c[u++];if(f===void 0)return;let p=f[r];if(p!==void 0)if(Array.isArray(p))do p=f[r],p!==void 0&&(e.push(f.time),n.push.apply(n,p)),f=c[u++];while(f!==void 0);else if(p.toArray!==void 0)do p=f[r],p!==void 0&&(e.push(f.time),p.toArray(n,n.length)),f=c[u++];while(f!==void 0);else do p=f[r],p!==void 0&&(e.push(f.time),n.push(p)),f=c[u++];while(f!==void 0)}class Kd{constructor(e,n,r,u){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=u!==void 0?u:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let r=this._cachedIndex,u=n[r],f=n[r-1];n:{e:{let p;t:{i:if(!(e<u)){for(let s=r+2;;){if(u===void 0){if(e<f)break i;return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===s)break;if(f=u,u=n[++r],e<u)break e}p=n.length;break t}if(!(e>=f)){const s=n[1];e<s&&(r=2,f=s);for(let S=r-2;;){if(f===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===S)break;if(u=f,f=n[--r-1],e>=f)break e}p=r,r=0;break t}break n}for(;r<p;){const s=r+p>>>1;e<n[s]?p=s:r=s+1}if(u=n[r],f=n[r-1],f===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(u===void 0)return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,f,u)}return this.interpolate_(r,f,e,u)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,u=this.valueSize,f=e*u;for(let p=0;p!==u;++p)n[p]=r[f+p];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class VP extends Kd{constructor(e,n,r,u){super(e,n,r,u),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ab,endingEnd:ab}}intervalChanged_(e,n,r){const u=this.parameterPositions;let f=e-2,p=e+1,s=u[f],S=u[p];if(s===void 0)switch(this.getSettings_().endingStart){case ob:f=e,s=2*n-r;break;case lb:f=u.length-2,s=n+u[f]-u[f+1];break;default:f=e,s=r}if(S===void 0)switch(this.getSettings_().endingEnd){case ob:p=e,S=2*r-n;break;case lb:p=1,S=r+u[1]-u[0];break;default:p=e-1,S=n}const M=(r-n)*.5,C=this.valueSize;this._weightPrev=M/(n-s),this._weightNext=M/(S-r),this._offsetPrev=f*C,this._offsetNext=p*C}interpolate_(e,n,r,u){const f=this.resultBuffer,p=this.sampleValues,s=this.valueSize,S=e*s,M=S-s,C=this._offsetPrev,I=this._offsetNext,L=this._weightPrev,R=this._weightNext,B=(r-n)/(u-n),Z=B*B,V=Z*B,O=-L*V+2*L*Z-L*B,ge=(1+L)*V+(-1.5-2*L)*Z+(-.5+L)*B+1,me=(-1-R)*V+(1.5+R)*Z+.5*B,Q=R*V-R*Z;for(let de=0;de!==s;++de)f[de]=O*p[C+de]+ge*p[M+de]+me*p[S+de]+Q*p[I+de];return f}}class GP extends Kd{constructor(e,n,r,u){super(e,n,r,u)}interpolate_(e,n,r,u){const f=this.resultBuffer,p=this.sampleValues,s=this.valueSize,S=e*s,M=S-s,C=(r-n)/(u-n),I=1-C;for(let L=0;L!==s;++L)f[L]=p[M+L]*I+p[S+L]*C;return f}}class HP extends Kd{constructor(e,n,r,u){super(e,n,r,u)}interpolate_(e){return this.copySampleValue_(e-1)}}class La{constructor(e,n,r,u){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Rf(n,this.TimeBufferType),this.values=Rf(r,this.ValueBufferType),this.setInterpolation(u||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let r;if(n.toJSON!==this.toJSON)r=n.toJSON(e);else{r={name:e.name,times:Rf(e.times,Array),values:Rf(e.values,Array)};const u=e.getInterpolation();u!==e.DefaultInterpolation&&(r.interpolation=u)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new HP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new GP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new VP(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case Vd:n=this.InterpolantFactoryMethodDiscrete;break;case Gd:n=this.InterpolantFactoryMethodLinear;break;case Xg:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Vd;case this.InterpolantFactoryMethodLinear:return Gd;case this.InterpolantFactoryMethodSmooth:return Xg}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let r=0,u=n.length;r!==u;++r)n[r]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let r=0,u=n.length;r!==u;++r)n[r]*=e}return this}trim(e,n){const r=this.times,u=r.length;let f=0,p=u-1;for(;f!==u&&r[f]<e;)++f;for(;p!==-1&&r[p]>n;)--p;if(++p,f!==0||p!==u){f>=p&&(p=Math.max(p,1),f=p-1);const s=this.getValueSize();this.times=r.slice(f,p),this.values=this.values.slice(f*s,p*s)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,u=this.values,f=r.length;f===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let p=null;for(let s=0;s!==f;s++){const S=r[s];if(typeof S=="number"&&isNaN(S)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,S),e=!1;break}if(p!==null&&p>S){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,S,p),e=!1;break}p=S}if(u!==void 0&&UP(u))for(let s=0,S=u.length;s!==S;++s){const M=u[s];if(isNaN(M)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,M),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),r=this.getValueSize(),u=this.getInterpolation()===Xg,f=e.length-1;let p=1;for(let s=1;s<f;++s){let S=!1;const M=e[s],C=e[s+1];if(M!==C&&(s!==1||M!==e[0]))if(u)S=!0;else{const I=s*r,L=I-r,R=I+r;for(let B=0;B!==r;++B){const Z=n[I+B];if(Z!==n[L+B]||Z!==n[R+B]){S=!0;break}}}if(S){if(s!==p){e[p]=e[s];const I=s*r,L=p*r;for(let R=0;R!==r;++R)n[L+R]=n[I+R]}++p}}if(f>0){e[p]=e[f];for(let s=f*r,S=p*r,M=0;M!==r;++M)n[S+M]=n[s+M];++p}return p!==e.length?(this.times=e.slice(0,p),this.values=n.slice(0,p*r)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),r=this.constructor,u=new r(this.name,e,n);return u.createInterpolant=this.createInterpolant,u}}La.prototype.TimeBufferType=Float32Array;La.prototype.ValueBufferType=Float32Array;La.prototype.DefaultInterpolation=Gd;class Qu extends La{constructor(e,n,r){super(e,n,r)}}Qu.prototype.ValueTypeName="bool";Qu.prototype.ValueBufferType=Array;Qu.prototype.DefaultInterpolation=Vd;Qu.prototype.InterpolantFactoryMethodLinear=void 0;Qu.prototype.InterpolantFactoryMethodSmooth=void 0;class MS extends La{}MS.prototype.ValueTypeName="color";class Wu extends La{}Wu.prototype.ValueTypeName="number";class jP extends Kd{constructor(e,n,r,u){super(e,n,r,u)}interpolate_(e,n,r,u){const f=this.resultBuffer,p=this.sampleValues,s=this.valueSize,S=(r-n)/(u-n);let M=e*s;for(let C=M+s;M!==C;M+=4)lo.slerpFlat(f,0,p,M-s,p,M,S);return f}}class qu extends La{InterpolantFactoryMethodLinear(e){return new jP(this.times,this.values,this.getValueSize(),e)}}qu.prototype.ValueTypeName="quaternion";qu.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends La{constructor(e,n,r){super(e,n,r)}}eh.prototype.ValueTypeName="string";eh.prototype.ValueBufferType=Array;eh.prototype.DefaultInterpolation=Vd;eh.prototype.InterpolantFactoryMethodLinear=void 0;eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Zu extends La{}Zu.prototype.ValueTypeName="vector";class $P{constructor(e="",n=-1,r=[],u=TC){this.name=e,this.tracks=r,this.duration=n,this.blendMode=u,this.uuid=na(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,u=1/(e.fps||1);for(let p=0,s=r.length;p!==s;++p)n.push(qP(r[p]).scale(u));const f=new this(e.name,e.duration,n,e.blendMode);return f.uuid=e.uuid,f}static toJSON(e){const n=[],r=e.tracks,u={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let f=0,p=r.length;f!==p;++f)n.push(La.toJSON(r[f]));return u}static CreateFromMorphTargetSequence(e,n,r,u){const f=n.length,p=[];for(let s=0;s<f;s++){let S=[],M=[];S.push((s+f-1)%f,s,(s+1)%f),M.push(0,1,0);const C=BP(S);S=Hb(S,1,C),M=Hb(M,1,C),!u&&S[0]===0&&(S.push(f),M.push(M[0])),p.push(new Wu(".morphTargetInfluences["+n[s].name+"]",S,M).scale(1/r))}return new this(e,-1,p)}static findByName(e,n){let r=e;if(!Array.isArray(e)){const u=e;r=u.geometry&&u.geometry.animations||u.animations}for(let u=0;u<r.length;u++)if(r[u].name===n)return r[u];return null}static CreateClipsFromMorphTargetSequences(e,n,r){const u={},f=/^([\w-]*?)([\d]+)$/;for(let s=0,S=e.length;s<S;s++){const M=e[s],C=M.name.match(f);if(C&&C.length>1){const I=C[1];let L=u[I];L||(u[I]=L=[]),L.push(M)}}const p=[];for(const s in u)p.push(this.CreateFromMorphTargetSequence(s,u[s],n,r));return p}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(I,L,R,B,Z){if(R.length!==0){const V=[],O=[];SS(R,V,O,B),V.length!==0&&Z.push(new I(L,V,O))}},u=[],f=e.name||"default",p=e.fps||30,s=e.blendMode;let S=e.length||-1;const M=e.hierarchy||[];for(let I=0;I<M.length;I++){const L=M[I].keys;if(!(!L||L.length===0))if(L[0].morphTargets){const R={};let B;for(B=0;B<L.length;B++)if(L[B].morphTargets)for(let Z=0;Z<L[B].morphTargets.length;Z++)R[L[B].morphTargets[Z]]=-1;for(const Z in R){const V=[],O=[];for(let ge=0;ge!==L[B].morphTargets.length;++ge){const me=L[B];V.push(me.time),O.push(me.morphTarget===Z?1:0)}u.push(new Wu(".morphTargetInfluence["+Z+"]",V,O))}S=R.length*p}else{const R=".bones["+n[I].name+"]";r(Zu,R+".position",L,"pos",u),r(qu,R+".quaternion",L,"rot",u),r(Zu,R+".scale",L,"scl",u)}}return u.length===0?null:new this(f,S,u,s)}resetDuration(){const e=this.tracks;let n=0;for(let r=0,u=e.length;r!==u;++r){const f=this.tracks[r];n=Math.max(n,f.times[f.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function WP(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wu;case"vector":case"vector2":case"vector3":case"vector4":return Zu;case"color":return MS;case"quaternion":return qu;case"bool":case"boolean":return Qu;case"string":return eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}function qP(c){if(c.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=WP(c.type);if(c.times===void 0){const n=[],r=[];SS(c.keys,n,r,"value"),c.times=n,c.values=r}return e.parse!==void 0?e.parse(c):new e(c.name,c.times,c.values,c.interpolation)}const Jo={enabled:!1,files:{},add:function(c,e){this.enabled!==!1&&(this.files[c]=e)},get:function(c){if(this.enabled!==!1)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class ZP{constructor(e,n,r){const u=this;let f=!1,p=0,s=0,S;const M=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(C){s++,f===!1&&u.onStart!==void 0&&u.onStart(C,p,s),f=!0},this.itemEnd=function(C){p++,u.onProgress!==void 0&&u.onProgress(C,p,s),p===s&&(f=!1,u.onLoad!==void 0&&u.onLoad())},this.itemError=function(C){u.onError!==void 0&&u.onError(C)},this.resolveURL=function(C){return S?S(C):C},this.setURLModifier=function(C){return S=C,this},this.addHandler=function(C,I){return M.push(C,I),this},this.removeHandler=function(C){const I=M.indexOf(C);return I!==-1&&M.splice(I,2),this},this.getHandler=function(C){for(let I=0,L=M.length;I<L;I+=2){const R=M[I],B=M[I+1];if(R.global&&(R.lastIndex=0),R.test(C))return B}return null}}}const XP=new ZP;class th{constructor(e){this.manager=e!==void 0?e:XP,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(u,f){r.load(e,u,n,f)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}th.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ka={};class YP extends Error{constructor(e,n){super(e),this.response=n}}class TS extends th{constructor(e){super(e)}load(e,n,r,u){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const f=Jo.get(e);if(f!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(f),this.manager.itemEnd(e)},0),f;if(Ka[e]!==void 0){Ka[e].push({onLoad:n,onProgress:r,onError:u});return}Ka[e]=[],Ka[e].push({onLoad:n,onProgress:r,onError:u});const p=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,S=this.responseType;fetch(p).then(M=>{if(M.status===200||M.status===0){if(M.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||M.body===void 0||M.body.getReader===void 0)return M;const C=Ka[e],I=M.body.getReader(),L=M.headers.get("X-File-Size")||M.headers.get("Content-Length"),R=L?parseInt(L):0,B=R!==0;let Z=0;const V=new ReadableStream({start(O){ge();function ge(){I.read().then(({done:me,value:Q})=>{if(me)O.close();else{Z+=Q.byteLength;const de=new ProgressEvent("progress",{lengthComputable:B,loaded:Z,total:R});for(let fe=0,ye=C.length;fe<ye;fe++){const ke=C[fe];ke.onProgress&&ke.onProgress(de)}O.enqueue(Q),ge()}},me=>{O.error(me)})}}});return new Response(V)}else throw new YP(`fetch for "${M.url}" responded with ${M.status}: ${M.statusText}`,M)}).then(M=>{switch(S){case"arraybuffer":return M.arrayBuffer();case"blob":return M.blob();case"document":return M.text().then(C=>new DOMParser().parseFromString(C,s));case"json":return M.json();default:if(s===void 0)return M.text();{const I=/charset="?([^;"\s]*)"?/i.exec(s),L=I&&I[1]?I[1].toLowerCase():void 0,R=new TextDecoder(L);return M.arrayBuffer().then(B=>R.decode(B))}}}).then(M=>{Jo.add(e,M);const C=Ka[e];delete Ka[e];for(let I=0,L=C.length;I<L;I++){const R=C[I];R.onLoad&&R.onLoad(M)}}).catch(M=>{const C=Ka[e];if(C===void 0)throw this.manager.itemError(e),M;delete Ka[e];for(let I=0,L=C.length;I<L;I++){const R=C[I];R.onError&&R.onError(M)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class KP extends th{constructor(e){super(e)}load(e,n,r,u){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const f=this,p=Jo.get(e);if(p!==void 0)return f.manager.itemStart(e),setTimeout(function(){n&&n(p),f.manager.itemEnd(e)},0),p;const s=Hd("img");function S(){C(),Jo.add(e,this),n&&n(this),f.manager.itemEnd(e)}function M(I){C(),u&&u(I),f.manager.itemError(e),f.manager.itemEnd(e)}function C(){s.removeEventListener("load",S,!1),s.removeEventListener("error",M,!1)}return s.addEventListener("load",S,!1),s.addEventListener("error",M,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),f.manager.itemStart(e),s.src=e,s}}class JP extends th{constructor(e){super(e)}load(e,n,r,u){const f=new yr,p=new KP(this.manager);return p.setCrossOrigin(this.crossOrigin),p.setPath(this.path),p.load(e,function(s){f.image=s,f.needsUpdate=!0,n!==void 0&&n(f)},r,u),f}}class bm extends Di{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new vn(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}const v_=new dn,jb=new Ge,$b=new Ge;class Sv{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ei(512,512),this.map=null,this.mapPass=null,this.matrix=new dn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xv,this._frameExtents=new ei(1,1),this._viewportCount=1,this._viewports=[new oi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,r=this.matrix;jb.setFromMatrixPosition(e.matrixWorld),n.position.copy(jb),$b.setFromMatrixPosition(e.target.matrixWorld),n.lookAt($b),n.updateMatrixWorld(),v_.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(v_),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(v_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class QP extends Sv{constructor(){super(new is(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,r=ju*2*e.angle*this.focus,u=this.mapSize.width/this.mapSize.height,f=e.distance||n.far;(r!==n.fov||u!==n.aspect||f!==n.far)&&(n.fov=r,n.aspect=u,n.far=f,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class eI extends bm{constructor(e,n,r=0,u=Math.PI/3,f=0,p=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Di.DEFAULT_UP),this.updateMatrix(),this.target=new Di,this.distance=r,this.angle=u,this.penumbra=f,this.decay=p,this.map=null,this.shadow=new QP}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Wb=new dn,xd=new Ge,x_=new Ge;class tI extends Sv{constructor(){super(new is(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ei(4,2),this._viewportCount=6,this._viewports=[new oi(2,1,1,1),new oi(0,1,1,1),new oi(3,1,1,1),new oi(1,1,1,1),new oi(3,0,1,1),new oi(1,0,1,1)],this._cubeDirections=[new Ge(1,0,0),new Ge(-1,0,0),new Ge(0,0,1),new Ge(0,0,-1),new Ge(0,1,0),new Ge(0,-1,0)],this._cubeUps=[new Ge(0,1,0),new Ge(0,1,0),new Ge(0,1,0),new Ge(0,1,0),new Ge(0,0,1),new Ge(0,0,-1)]}updateMatrices(e,n=0){const r=this.camera,u=this.matrix,f=e.distance||r.far;f!==r.far&&(r.far=f,r.updateProjectionMatrix()),xd.setFromMatrixPosition(e.matrixWorld),r.position.copy(xd),x_.copy(r.position),x_.add(this._cubeDirections[n]),r.up.copy(this._cubeUps[n]),r.lookAt(x_),r.updateMatrixWorld(),u.makeTranslation(-xd.x,-xd.y,-xd.z),Wb.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wb)}}class ES extends bm{constructor(e,n,r=0,u=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=u,this.shadow=new tI}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Mv extends _v{constructor(e=-1,n=1,r=1,u=-1,f=.1,p=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=u,this.near=f,this.far=p,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,u,f,p){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=u,this.view.width=f,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,u=(this.top+this.bottom)/2;let f=r-e,p=r+e,s=u+n,S=u-n;if(this.view!==null&&this.view.enabled){const M=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f+=M*this.view.offsetX,p=f+M*this.view.width,s-=C*this.view.offsetY,S=s-C*this.view.height}this.projectionMatrix.makeOrthographic(f,p,s,S,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class nI extends Sv{constructor(){super(new Mv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class iI extends bm{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Di.DEFAULT_UP),this.updateMatrix(),this.target=new Di,this.shadow=new nI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class rI extends bm{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class Id{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let r=0,u=e.length;r<u;r++)n+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class sI extends th{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,r,u){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const f=this,p=Jo.get(e);if(p!==void 0){if(f.manager.itemStart(e),p.then){p.then(M=>{n&&n(M),f.manager.itemEnd(e)}).catch(M=>{u&&u(M)});return}return setTimeout(function(){n&&n(p),f.manager.itemEnd(e)},0),p}const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader;const S=fetch(e,s).then(function(M){return M.blob()}).then(function(M){return createImageBitmap(M,Object.assign(f.options,{colorSpaceConversion:"none"}))}).then(function(M){return Jo.add(e,M),n&&n(M),f.manager.itemEnd(e),M}).catch(function(M){u&&u(M),Jo.remove(e),f.manager.itemError(e),f.manager.itemEnd(e)});Jo.add(e,S),f.manager.itemStart(e)}}class aI extends is{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}const Tv="\\[\\]\\.:\\/",oI=new RegExp("["+Tv+"]","g"),Ev="[^"+Tv+"]",lI="[^"+Tv.replace("\\.","")+"]",cI=/((?:WC+[\/:])*)/.source.replace("WC",Ev),uI=/(WCOD+)?/.source.replace("WCOD",lI),hI=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ev),dI=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ev),pI=new RegExp("^"+cI+uI+hI+dI+"$"),fI=["material","materials","bones","map"];class mI{constructor(e,n,r){const u=r||di.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,u)}getValue(e,n){this.bind();const r=this._targetGroup.nCachedObjects_,u=this._bindings[r];u!==void 0&&u.getValue(e,n)}setValue(e,n){const r=this._bindings;for(let u=this._targetGroup.nCachedObjects_,f=r.length;u!==f;++u)r[u].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].unbind()}}class di{constructor(e,n,r){this.path=n,this.parsedPath=r||di.parseTrackName(n),this.node=di.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new di.Composite(e,n,r):new di(e,n,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(oI,"")}static parseTrackName(e){const n=pI.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},u=r.nodeName&&r.nodeName.lastIndexOf(".");if(u!==void 0&&u!==-1){const f=r.nodeName.substring(u+1);fI.indexOf(f)!==-1&&(r.nodeName=r.nodeName.substring(0,u),r.objectName=f)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(n);if(r!==void 0)return r}if(e.children){const r=function(f){for(let p=0;p<f.length;p++){const s=f[p];if(s.name===n||s.uuid===n)return s;const S=r(s.children);if(S)return S}return null},u=r(e.children);if(u)return u}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const r=this.resolvedProperty;for(let u=0,f=r.length;u!==f;++u)e[n++]=r[u]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const r=this.resolvedProperty;for(let u=0,f=r.length;u!==f;++u)r[u]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const r=this.resolvedProperty;for(let u=0,f=r.length;u!==f;++u)r[u]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const r=this.resolvedProperty;for(let u=0,f=r.length;u!==f;++u)r[u]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,r=n.objectName,u=n.propertyName;let f=n.propertyIndex;if(e||(e=di.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let M=n.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let C=0;C<e.length;C++)if(e[C].name===M){M=C;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(M!==void 0){if(e[M]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[M]}}const p=e[u];if(p===void 0){const M=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+M+"."+u+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?s=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let S=this.BindingType.Direct;if(f!==void 0){if(u==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[f]!==void 0&&(f=e.morphTargetDictionary[f])}S=this.BindingType.ArrayElement,this.resolvedProperty=p,this.propertyIndex=f}else p.fromArray!==void 0&&p.toArray!==void 0?(S=this.BindingType.HasFromToArray,this.resolvedProperty=p):Array.isArray(p)?(S=this.BindingType.EntireArray,this.resolvedProperty=p):this.propertyName=u;this.getValue=this.GetterByBindingType[S],this.setValue=this.SetterByBindingTypeAndVersioning[S][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}di.Composite=mI;di.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};di.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};di.prototype.GetterByBindingType=[di.prototype._getValue_direct,di.prototype._getValue_array,di.prototype._getValue_arrayElement,di.prototype._getValue_toArray];di.prototype.SetterByBindingTypeAndVersioning=[[di.prototype._setValue_direct,di.prototype._setValue_direct_setNeedsUpdate,di.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[di.prototype._setValue_array,di.prototype._setValue_array_setNeedsUpdate,di.prototype._setValue_array_setMatrixWorldNeedsUpdate],[di.prototype._setValue_arrayElement,di.prototype._setValue_arrayElement_setNeedsUpdate,di.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[di.prototype._setValue_fromArray,di.prototype._setValue_fromArray_setNeedsUpdate,di.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];function qb(c,e,n,r){const u=gI(r);switch(n){case Qw:return c*e;case tS:return c*e;case nS:return c*e*2;case dv:return c*e/u.components*u.byteLength;case pv:return c*e/u.components*u.byteLength;case iS:return c*e*2/u.components*u.byteLength;case fv:return c*e*2/u.components*u.byteLength;case eS:return c*e*3/u.components*u.byteLength;case ks:return c*e*4/u.components*u.byteLength;case mv:return c*e*4/u.components*u.byteLength;case Vf:case Gf:return Math.floor((c+3)/4)*Math.floor((e+3)/4)*8;case Hf:case jf:return Math.floor((c+3)/4)*Math.floor((e+3)/4)*16;case ry:case ay:return Math.max(c,16)*Math.max(e,8)/4;case iy:case sy:return Math.max(c,8)*Math.max(e,8)/2;case oy:case ly:return Math.floor((c+3)/4)*Math.floor((e+3)/4)*8;case cy:return Math.floor((c+3)/4)*Math.floor((e+3)/4)*16;case uy:return Math.floor((c+3)/4)*Math.floor((e+3)/4)*16;case hy:return Math.floor((c+4)/5)*Math.floor((e+3)/4)*16;case dy:return Math.floor((c+4)/5)*Math.floor((e+4)/5)*16;case py:return Math.floor((c+5)/6)*Math.floor((e+4)/5)*16;case fy:return Math.floor((c+5)/6)*Math.floor((e+5)/6)*16;case my:return Math.floor((c+7)/8)*Math.floor((e+4)/5)*16;case gy:return Math.floor((c+7)/8)*Math.floor((e+5)/6)*16;case _y:return Math.floor((c+7)/8)*Math.floor((e+7)/8)*16;case yy:return Math.floor((c+9)/10)*Math.floor((e+4)/5)*16;case vy:return Math.floor((c+9)/10)*Math.floor((e+5)/6)*16;case xy:return Math.floor((c+9)/10)*Math.floor((e+7)/8)*16;case by:return Math.floor((c+9)/10)*Math.floor((e+9)/10)*16;case wy:return Math.floor((c+11)/12)*Math.floor((e+9)/10)*16;case Sy:return Math.floor((c+11)/12)*Math.floor((e+11)/12)*16;case $f:case My:case Ty:return Math.ceil(c/4)*Math.ceil(e/4)*16;case rS:case Ey:return Math.ceil(c/4)*Math.ceil(e/4)*8;case Ay:case Cy:return Math.ceil(c/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function gI(c){switch(c){case oo:case Yw:return{byteLength:1,components:1};case Bd:case Kw:case Xd:return{byteLength:2,components:1};case uv:case hv:return{byteLength:2,components:4};case pc:case cv:case ta:return{byteLength:4,components:1};case Jw:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${c}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:lv}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=lv);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function AS(){let c=null,e=!1,n=null,r=null;function u(f,p){n(f,p),r=c.requestAnimationFrame(u)}return{start:function(){e!==!0&&n!==null&&(r=c.requestAnimationFrame(u),e=!0)},stop:function(){c.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(f){n=f},setContext:function(f){c=f}}}function _I(c){const e=new WeakMap;function n(s,S){const M=s.array,C=s.usage,I=M.byteLength,L=c.createBuffer();c.bindBuffer(S,L),c.bufferData(S,M,C),s.onUploadCallback();let R;if(M instanceof Float32Array)R=c.FLOAT;else if(M instanceof Uint16Array)s.isFloat16BufferAttribute?R=c.HALF_FLOAT:R=c.UNSIGNED_SHORT;else if(M instanceof Int16Array)R=c.SHORT;else if(M instanceof Uint32Array)R=c.UNSIGNED_INT;else if(M instanceof Int32Array)R=c.INT;else if(M instanceof Int8Array)R=c.BYTE;else if(M instanceof Uint8Array)R=c.UNSIGNED_BYTE;else if(M instanceof Uint8ClampedArray)R=c.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+M);return{buffer:L,type:R,bytesPerElement:M.BYTES_PER_ELEMENT,version:s.version,size:I}}function r(s,S,M){const C=S.array,I=S.updateRanges;if(c.bindBuffer(M,s),I.length===0)c.bufferSubData(M,0,C);else{I.sort((R,B)=>R.start-B.start);let L=0;for(let R=1;R<I.length;R++){const B=I[L],Z=I[R];Z.start<=B.start+B.count+1?B.count=Math.max(B.count,Z.start+Z.count-B.start):(++L,I[L]=Z)}I.length=L+1;for(let R=0,B=I.length;R<B;R++){const Z=I[R];c.bufferSubData(M,Z.start*C.BYTES_PER_ELEMENT,C,Z.start,Z.count)}S.clearUpdateRanges()}S.onUploadCallback()}function u(s){return s.isInterleavedBufferAttribute&&(s=s.data),e.get(s)}function f(s){s.isInterleavedBufferAttribute&&(s=s.data);const S=e.get(s);S&&(c.deleteBuffer(S.buffer),e.delete(s))}function p(s,S){if(s.isInterleavedBufferAttribute&&(s=s.data),s.isGLBufferAttribute){const C=e.get(s);(!C||C.version<s.version)&&e.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version});return}const M=e.get(s);if(M===void 0)e.set(s,n(s,S));else if(M.version<s.version){if(M.size!==s.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(M.buffer,s,S),M.version=s.version}}return{get:u,remove:f,update:p}}var yI=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,vI=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,xI=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,bI=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wI=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,SI=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,MI=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,TI=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,EI=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,AI=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,CI=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,PI=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,II=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,RI=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,LI=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,DI=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,kI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,FI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,OI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,NI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,UI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,BI=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,VI=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,GI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,HI=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,jI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,$I=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,WI=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,qI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ZI="gl_FragColor = linearToOutputTexel( gl_FragColor );",XI=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,YI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,KI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,JI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,QI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,eR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,tR=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,nR=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,iR=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,rR=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,sR=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,aR=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,oR=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lR=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,cR=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,uR=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,hR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,dR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,pR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,fR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,mR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,gR=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_R=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,yR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,xR=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,bR=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wR=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,SR=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,MR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,TR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,ER=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,AR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,CR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,PR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,IR=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,RR=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,LR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,DR=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,kR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,zR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,FR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,OR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,BR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,VR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,GR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,HR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,jR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,$R=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,WR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,qR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ZR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,XR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,YR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,KR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,QR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,eL=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,tL=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,nL=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,iL=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,rL=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,sL=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,aL=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,oL=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,lL=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,cL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,uL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,hL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,dL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,pL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,mL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,gL=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _L=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,yL=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,xL=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,wL=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,SL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ML=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,TL=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,EL=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,AL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,CL=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PL=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,IL=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,RL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,LL=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DL=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kL=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zL=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,FL=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OL=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,NL=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,UL=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BL=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VL=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,GL=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HL=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,jL=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$L=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,WL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,qL=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ZL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,XL=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,YL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Un={alphahash_fragment:yI,alphahash_pars_fragment:vI,alphamap_fragment:xI,alphamap_pars_fragment:bI,alphatest_fragment:wI,alphatest_pars_fragment:SI,aomap_fragment:MI,aomap_pars_fragment:TI,batching_pars_vertex:EI,batching_vertex:AI,begin_vertex:CI,beginnormal_vertex:PI,bsdfs:II,iridescence_fragment:RI,bumpmap_pars_fragment:LI,clipping_planes_fragment:DI,clipping_planes_pars_fragment:kI,clipping_planes_pars_vertex:zI,clipping_planes_vertex:FI,color_fragment:OI,color_pars_fragment:NI,color_pars_vertex:UI,color_vertex:BI,common:VI,cube_uv_reflection_fragment:GI,defaultnormal_vertex:HI,displacementmap_pars_vertex:jI,displacementmap_vertex:$I,emissivemap_fragment:WI,emissivemap_pars_fragment:qI,colorspace_fragment:ZI,colorspace_pars_fragment:XI,envmap_fragment:YI,envmap_common_pars_fragment:KI,envmap_pars_fragment:JI,envmap_pars_vertex:QI,envmap_physical_pars_fragment:uR,envmap_vertex:eR,fog_vertex:tR,fog_pars_vertex:nR,fog_fragment:iR,fog_pars_fragment:rR,gradientmap_pars_fragment:sR,lightmap_pars_fragment:aR,lights_lambert_fragment:oR,lights_lambert_pars_fragment:lR,lights_pars_begin:cR,lights_toon_fragment:hR,lights_toon_pars_fragment:dR,lights_phong_fragment:pR,lights_phong_pars_fragment:fR,lights_physical_fragment:mR,lights_physical_pars_fragment:gR,lights_fragment_begin:_R,lights_fragment_maps:yR,lights_fragment_end:vR,logdepthbuf_fragment:xR,logdepthbuf_pars_fragment:bR,logdepthbuf_pars_vertex:wR,logdepthbuf_vertex:SR,map_fragment:MR,map_pars_fragment:TR,map_particle_fragment:ER,map_particle_pars_fragment:AR,metalnessmap_fragment:CR,metalnessmap_pars_fragment:PR,morphinstance_vertex:IR,morphcolor_vertex:RR,morphnormal_vertex:LR,morphtarget_pars_vertex:DR,morphtarget_vertex:kR,normal_fragment_begin:zR,normal_fragment_maps:FR,normal_pars_fragment:OR,normal_pars_vertex:NR,normal_vertex:UR,normalmap_pars_fragment:BR,clearcoat_normal_fragment_begin:VR,clearcoat_normal_fragment_maps:GR,clearcoat_pars_fragment:HR,iridescence_pars_fragment:jR,opaque_fragment:$R,packing:WR,premultiplied_alpha_fragment:qR,project_vertex:ZR,dithering_fragment:XR,dithering_pars_fragment:YR,roughnessmap_fragment:KR,roughnessmap_pars_fragment:JR,shadowmap_pars_fragment:QR,shadowmap_pars_vertex:eL,shadowmap_vertex:tL,shadowmask_pars_fragment:nL,skinbase_vertex:iL,skinning_pars_vertex:rL,skinning_vertex:sL,skinnormal_vertex:aL,specularmap_fragment:oL,specularmap_pars_fragment:lL,tonemapping_fragment:cL,tonemapping_pars_fragment:uL,transmission_fragment:hL,transmission_pars_fragment:dL,uv_pars_fragment:pL,uv_pars_vertex:fL,uv_vertex:mL,worldpos_vertex:gL,background_vert:_L,background_frag:yL,backgroundCube_vert:vL,backgroundCube_frag:xL,cube_vert:bL,cube_frag:wL,depth_vert:SL,depth_frag:ML,distanceRGBA_vert:TL,distanceRGBA_frag:EL,equirect_vert:AL,equirect_frag:CL,linedashed_vert:PL,linedashed_frag:IL,meshbasic_vert:RL,meshbasic_frag:LL,meshlambert_vert:DL,meshlambert_frag:kL,meshmatcap_vert:zL,meshmatcap_frag:FL,meshnormal_vert:OL,meshnormal_frag:NL,meshphong_vert:UL,meshphong_frag:BL,meshphysical_vert:VL,meshphysical_frag:GL,meshtoon_vert:HL,meshtoon_frag:jL,points_vert:$L,points_frag:WL,shadow_vert:qL,shadow_frag:ZL,sprite_vert:XL,sprite_frag:YL},Ot={common:{diffuse:{value:new vn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new kn},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new kn}},envmap:{envMap:{value:null},envMapRotation:{value:new kn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new kn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new kn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new kn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new kn},normalScale:{value:new ei(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new kn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new kn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new kn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new kn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0},uvTransform:{value:new kn}},sprite:{diffuse:{value:new vn(16777215)},opacity:{value:1},center:{value:new ei(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new kn},alphaMap:{value:null},alphaMapTransform:{value:new kn},alphaTest:{value:0}}},xa={basic:{uniforms:Hr([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:Un.meshbasic_vert,fragmentShader:Un.meshbasic_frag},lambert:{uniforms:Hr([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new vn(0)}}]),vertexShader:Un.meshlambert_vert,fragmentShader:Un.meshlambert_frag},phong:{uniforms:Hr([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new vn(0)},specular:{value:new vn(1118481)},shininess:{value:30}}]),vertexShader:Un.meshphong_vert,fragmentShader:Un.meshphong_frag},standard:{uniforms:Hr([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new vn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag},toon:{uniforms:Hr([Ot.common,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new vn(0)}}]),vertexShader:Un.meshtoon_vert,fragmentShader:Un.meshtoon_frag},matcap:{uniforms:Hr([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:Un.meshmatcap_vert,fragmentShader:Un.meshmatcap_frag},points:{uniforms:Hr([Ot.points,Ot.fog]),vertexShader:Un.points_vert,fragmentShader:Un.points_frag},dashed:{uniforms:Hr([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Un.linedashed_vert,fragmentShader:Un.linedashed_frag},depth:{uniforms:Hr([Ot.common,Ot.displacementmap]),vertexShader:Un.depth_vert,fragmentShader:Un.depth_frag},normal:{uniforms:Hr([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:Un.meshnormal_vert,fragmentShader:Un.meshnormal_frag},sprite:{uniforms:Hr([Ot.sprite,Ot.fog]),vertexShader:Un.sprite_vert,fragmentShader:Un.sprite_frag},background:{uniforms:{uvTransform:{value:new kn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Un.background_vert,fragmentShader:Un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new kn}},vertexShader:Un.backgroundCube_vert,fragmentShader:Un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Un.cube_vert,fragmentShader:Un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Un.equirect_vert,fragmentShader:Un.equirect_frag},distanceRGBA:{uniforms:Hr([Ot.common,Ot.displacementmap,{referencePosition:{value:new Ge},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Un.distanceRGBA_vert,fragmentShader:Un.distanceRGBA_frag},shadow:{uniforms:Hr([Ot.lights,Ot.fog,{color:{value:new vn(0)},opacity:{value:1}}]),vertexShader:Un.shadow_vert,fragmentShader:Un.shadow_frag}};xa.physical={uniforms:Hr([xa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new kn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new kn},clearcoatNormalScale:{value:new ei(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new kn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new kn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new kn},sheen:{value:0},sheenColor:{value:new vn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new kn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new kn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new kn},transmissionSamplerSize:{value:new ei},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new kn},attenuationDistance:{value:0},attenuationColor:{value:new vn(0)},specularColor:{value:new vn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new kn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new kn},anisotropyVector:{value:new ei},anisotropyMap:{value:null},anisotropyMapTransform:{value:new kn}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag};const Lf={r:0,b:0,g:0},Zl=new Ca,KL=new dn;function JL(c,e,n,r,u,f,p){const s=new vn(0);let S=f===!0?0:1,M,C,I=null,L=0,R=null;function B(me){let Q=me.isScene===!0?me.background:null;return Q&&Q.isTexture&&(Q=(me.backgroundBlurriness>0?n:e).get(Q)),Q}function Z(me){let Q=!1;const de=B(me);de===null?O(s,S):de&&de.isColor&&(O(de,1),Q=!0);const fe=c.xr.getEnvironmentBlendMode();fe==="additive"?r.buffers.color.setClear(0,0,0,1,p):fe==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,p),(c.autoClear||Q)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil))}function V(me,Q){const de=B(Q);de&&(de.isCubeTexture||de.mapping===ym)?(C===void 0&&(C=new rs(new Yd(1,1,1),new tl({name:"BackgroundCubeMaterial",uniforms:$u(xa.backgroundCube.uniforms),vertexShader:xa.backgroundCube.vertexShader,fragmentShader:xa.backgroundCube.fragmentShader,side:ss,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),C.geometry.deleteAttribute("uv"),C.onBeforeRender=function(fe,ye,ke){this.matrixWorld.copyPosition(ke.matrixWorld)},Object.defineProperty(C.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(C)),Zl.copy(Q.backgroundRotation),Zl.x*=-1,Zl.y*=-1,Zl.z*=-1,de.isCubeTexture&&de.isRenderTargetTexture===!1&&(Zl.y*=-1,Zl.z*=-1),C.material.uniforms.envMap.value=de,C.material.uniforms.flipEnvMap.value=de.isCubeTexture&&de.isRenderTargetTexture===!1?-1:1,C.material.uniforms.backgroundBlurriness.value=Q.backgroundBlurriness,C.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,C.material.uniforms.backgroundRotation.value.setFromMatrix4(KL.makeRotationFromEuler(Zl)),C.material.toneMapped=Qn.getTransfer(de.colorSpace)!==mi,(I!==de||L!==de.version||R!==c.toneMapping)&&(C.material.needsUpdate=!0,I=de,L=de.version,R=c.toneMapping),C.layers.enableAll(),me.unshift(C,C.geometry,C.material,0,0,null)):de&&de.isTexture&&(M===void 0&&(M=new rs(new xm(2,2),new tl({name:"BackgroundMaterial",uniforms:$u(xa.background.uniforms),vertexShader:xa.background.vertexShader,fragmentShader:xa.background.fragmentShader,side:ao,depthTest:!1,depthWrite:!1,fog:!1})),M.geometry.deleteAttribute("normal"),Object.defineProperty(M.material,"map",{get:function(){return this.uniforms.t2D.value}}),u.update(M)),M.material.uniforms.t2D.value=de,M.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,M.material.toneMapped=Qn.getTransfer(de.colorSpace)!==mi,de.matrixAutoUpdate===!0&&de.updateMatrix(),M.material.uniforms.uvTransform.value.copy(de.matrix),(I!==de||L!==de.version||R!==c.toneMapping)&&(M.material.needsUpdate=!0,I=de,L=de.version,R=c.toneMapping),M.layers.enableAll(),me.unshift(M,M.geometry,M.material,0,0,null))}function O(me,Q){me.getRGB(Lf,gS(c)),r.buffers.color.setClear(Lf.r,Lf.g,Lf.b,Q,p)}function ge(){C!==void 0&&(C.geometry.dispose(),C.material.dispose()),M!==void 0&&(M.geometry.dispose(),M.material.dispose())}return{getClearColor:function(){return s},setClearColor:function(me,Q=1){s.set(me),S=Q,O(s,S)},getClearAlpha:function(){return S},setClearAlpha:function(me){S=me,O(s,S)},render:Z,addToRenderList:V,dispose:ge}}function QL(c,e){const n=c.getParameter(c.MAX_VERTEX_ATTRIBS),r={},u=L(null);let f=u,p=!1;function s(ie,Oe,nt,Je,ut){let ht=!1;const ot=I(Je,nt,Oe);f!==ot&&(f=ot,M(f.object)),ht=R(ie,Je,nt,ut),ht&&B(ie,Je,nt,ut),ut!==null&&e.update(ut,c.ELEMENT_ARRAY_BUFFER),(ht||p)&&(p=!1,Q(ie,Oe,nt,Je),ut!==null&&c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.get(ut).buffer))}function S(){return c.createVertexArray()}function M(ie){return c.bindVertexArray(ie)}function C(ie){return c.deleteVertexArray(ie)}function I(ie,Oe,nt){const Je=nt.wireframe===!0;let ut=r[ie.id];ut===void 0&&(ut={},r[ie.id]=ut);let ht=ut[Oe.id];ht===void 0&&(ht={},ut[Oe.id]=ht);let ot=ht[Je];return ot===void 0&&(ot=L(S()),ht[Je]=ot),ot}function L(ie){const Oe=[],nt=[],Je=[];for(let ut=0;ut<n;ut++)Oe[ut]=0,nt[ut]=0,Je[ut]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Oe,enabledAttributes:nt,attributeDivisors:Je,object:ie,attributes:{},index:null}}function R(ie,Oe,nt,Je){const ut=f.attributes,ht=Oe.attributes;let ot=0;const ft=nt.getAttributes();for(const tt in ft)if(ft[tt].location>=0){const Ut=ut[tt];let Wt=ht[tt];if(Wt===void 0&&(tt==="instanceMatrix"&&ie.instanceMatrix&&(Wt=ie.instanceMatrix),tt==="instanceColor"&&ie.instanceColor&&(Wt=ie.instanceColor)),Ut===void 0||Ut.attribute!==Wt||Wt&&Ut.data!==Wt.data)return!0;ot++}return f.attributesNum!==ot||f.index!==Je}function B(ie,Oe,nt,Je){const ut={},ht=Oe.attributes;let ot=0;const ft=nt.getAttributes();for(const tt in ft)if(ft[tt].location>=0){let Ut=ht[tt];Ut===void 0&&(tt==="instanceMatrix"&&ie.instanceMatrix&&(Ut=ie.instanceMatrix),tt==="instanceColor"&&ie.instanceColor&&(Ut=ie.instanceColor));const Wt={};Wt.attribute=Ut,Ut&&Ut.data&&(Wt.data=Ut.data),ut[tt]=Wt,ot++}f.attributes=ut,f.attributesNum=ot,f.index=Je}function Z(){const ie=f.newAttributes;for(let Oe=0,nt=ie.length;Oe<nt;Oe++)ie[Oe]=0}function V(ie){O(ie,0)}function O(ie,Oe){const nt=f.newAttributes,Je=f.enabledAttributes,ut=f.attributeDivisors;nt[ie]=1,Je[ie]===0&&(c.enableVertexAttribArray(ie),Je[ie]=1),ut[ie]!==Oe&&(c.vertexAttribDivisor(ie,Oe),ut[ie]=Oe)}function ge(){const ie=f.newAttributes,Oe=f.enabledAttributes;for(let nt=0,Je=Oe.length;nt<Je;nt++)Oe[nt]!==ie[nt]&&(c.disableVertexAttribArray(nt),Oe[nt]=0)}function me(ie,Oe,nt,Je,ut,ht,ot){ot===!0?c.vertexAttribIPointer(ie,Oe,nt,ut,ht):c.vertexAttribPointer(ie,Oe,nt,Je,ut,ht)}function Q(ie,Oe,nt,Je){Z();const ut=Je.attributes,ht=nt.getAttributes(),ot=Oe.defaultAttributeValues;for(const ft in ht){const tt=ht[ft];if(tt.location>=0){let It=ut[ft];if(It===void 0&&(ft==="instanceMatrix"&&ie.instanceMatrix&&(It=ie.instanceMatrix),ft==="instanceColor"&&ie.instanceColor&&(It=ie.instanceColor)),It!==void 0){const Ut=It.normalized,Wt=It.itemSize,$t=e.get(It);if($t===void 0)continue;const Rn=$t.buffer,it=$t.type,Tt=$t.bytesPerElement,qt=it===c.INT||it===c.UNSIGNED_INT||It.gpuType===cv;if(It.isInterleavedBufferAttribute){const Rt=It.data,on=Rt.stride,Xt=It.offset;if(Rt.isInstancedInterleavedBuffer){for(let yn=0;yn<tt.locationSize;yn++)O(tt.location+yn,Rt.meshPerAttribute);ie.isInstancedMesh!==!0&&Je._maxInstanceCount===void 0&&(Je._maxInstanceCount=Rt.meshPerAttribute*Rt.count)}else for(let yn=0;yn<tt.locationSize;yn++)V(tt.location+yn);c.bindBuffer(c.ARRAY_BUFFER,Rn);for(let yn=0;yn<tt.locationSize;yn++)me(tt.location+yn,Wt/tt.locationSize,it,Ut,on*Tt,(Xt+Wt/tt.locationSize*yn)*Tt,qt)}else{if(It.isInstancedBufferAttribute){for(let Rt=0;Rt<tt.locationSize;Rt++)O(tt.location+Rt,It.meshPerAttribute);ie.isInstancedMesh!==!0&&Je._maxInstanceCount===void 0&&(Je._maxInstanceCount=It.meshPerAttribute*It.count)}else for(let Rt=0;Rt<tt.locationSize;Rt++)V(tt.location+Rt);c.bindBuffer(c.ARRAY_BUFFER,Rn);for(let Rt=0;Rt<tt.locationSize;Rt++)me(tt.location+Rt,Wt/tt.locationSize,it,Ut,Wt*Tt,Wt/tt.locationSize*Rt*Tt,qt)}}else if(ot!==void 0){const Ut=ot[ft];if(Ut!==void 0)switch(Ut.length){case 2:c.vertexAttrib2fv(tt.location,Ut);break;case 3:c.vertexAttrib3fv(tt.location,Ut);break;case 4:c.vertexAttrib4fv(tt.location,Ut);break;default:c.vertexAttrib1fv(tt.location,Ut)}}}}ge()}function de(){ke();for(const ie in r){const Oe=r[ie];for(const nt in Oe){const Je=Oe[nt];for(const ut in Je)C(Je[ut].object),delete Je[ut];delete Oe[nt]}delete r[ie]}}function fe(ie){if(r[ie.id]===void 0)return;const Oe=r[ie.id];for(const nt in Oe){const Je=Oe[nt];for(const ut in Je)C(Je[ut].object),delete Je[ut];delete Oe[nt]}delete r[ie.id]}function ye(ie){for(const Oe in r){const nt=r[Oe];if(nt[ie.id]===void 0)continue;const Je=nt[ie.id];for(const ut in Je)C(Je[ut].object),delete Je[ut];delete nt[ie.id]}}function ke(){ce(),p=!0,f!==u&&(f=u,M(f.object))}function ce(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:s,reset:ke,resetDefaultState:ce,dispose:de,releaseStatesOfGeometry:fe,releaseStatesOfProgram:ye,initAttributes:Z,enableAttribute:V,disableUnusedAttributes:ge}}function eD(c,e,n){let r;function u(M){r=M}function f(M,C){c.drawArrays(r,M,C),n.update(C,r,1)}function p(M,C,I){I!==0&&(c.drawArraysInstanced(r,M,C,I),n.update(C,r,I))}function s(M,C,I){if(I===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,M,0,C,0,I);let R=0;for(let B=0;B<I;B++)R+=C[B];n.update(R,r,1)}function S(M,C,I,L){if(I===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let B=0;B<M.length;B++)p(M[B],C[B],L[B]);else{R.multiDrawArraysInstancedWEBGL(r,M,0,C,0,L,0,I);let B=0;for(let Z=0;Z<I;Z++)B+=C[Z]*L[Z];n.update(B,r,1)}}this.setMode=u,this.render=f,this.renderInstances=p,this.renderMultiDraw=s,this.renderMultiDrawInstances=S}function tD(c,e,n,r){let u;function f(){if(u!==void 0)return u;if(e.has("EXT_texture_filter_anisotropic")===!0){const ye=e.get("EXT_texture_filter_anisotropic");u=c.getParameter(ye.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else u=0;return u}function p(ye){return!(ye!==ks&&r.convert(ye)!==c.getParameter(c.IMPLEMENTATION_COLOR_READ_FORMAT))}function s(ye){const ke=ye===Xd&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(ye!==oo&&r.convert(ye)!==c.getParameter(c.IMPLEMENTATION_COLOR_READ_TYPE)&&ye!==ta&&!ke)}function S(ye){if(ye==="highp"){if(c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.HIGH_FLOAT).precision>0&&c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision>0)return"highp";ye="mediump"}return ye==="mediump"&&c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.MEDIUM_FLOAT).precision>0&&c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let M=n.precision!==void 0?n.precision:"highp";const C=S(M);C!==M&&(console.warn("THREE.WebGLRenderer:",M,"not supported, using",C,"instead."),M=C);const I=n.logarithmicDepthBuffer===!0,L=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),R=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),B=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Z=c.getParameter(c.MAX_TEXTURE_SIZE),V=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),O=c.getParameter(c.MAX_VERTEX_ATTRIBS),ge=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),me=c.getParameter(c.MAX_VARYING_VECTORS),Q=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),de=B>0,fe=c.getParameter(c.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:f,getMaxPrecision:S,textureFormatReadable:p,textureTypeReadable:s,precision:M,logarithmicDepthBuffer:I,reverseDepthBuffer:L,maxTextures:R,maxVertexTextures:B,maxTextureSize:Z,maxCubemapSize:V,maxAttributes:O,maxVertexUniforms:ge,maxVaryings:me,maxFragmentUniforms:Q,vertexTextures:de,maxSamples:fe}}function nD(c){const e=this;let n=null,r=0,u=!1,f=!1;const p=new Ql,s=new kn,S={value:null,needsUpdate:!1};this.uniform=S,this.numPlanes=0,this.numIntersection=0,this.init=function(I,L){const R=I.length!==0||L||r!==0||u;return u=L,r=I.length,R},this.beginShadows=function(){f=!0,C(null)},this.endShadows=function(){f=!1},this.setGlobalState=function(I,L){n=C(I,L,0)},this.setState=function(I,L,R){const B=I.clippingPlanes,Z=I.clipIntersection,V=I.clipShadows,O=c.get(I);if(!u||B===null||B.length===0||f&&!V)f?C(null):M();else{const ge=f?0:r,me=ge*4;let Q=O.clippingState||null;S.value=Q,Q=C(B,L,me,R);for(let de=0;de!==me;++de)Q[de]=n[de];O.clippingState=Q,this.numIntersection=Z?this.numPlanes:0,this.numPlanes+=ge}};function M(){S.value!==n&&(S.value=n,S.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function C(I,L,R,B){const Z=I!==null?I.length:0;let V=null;if(Z!==0){if(V=S.value,B!==!0||V===null){const O=R+Z*4,ge=L.matrixWorldInverse;s.getNormalMatrix(ge),(V===null||V.length<O)&&(V=new Float32Array(O));for(let me=0,Q=R;me!==Z;++me,Q+=4)p.copy(I[me]).applyMatrix4(ge,s),p.normal.toArray(V,Q),V[Q+3]=p.constant}S.value=V,S.needsUpdate=!0}return e.numPlanes=Z,e.numIntersection=0,V}}function iD(c){let e=new WeakMap;function n(p,s){return s===ty?p.mapping=Uu:s===ny&&(p.mapping=Bu),p}function r(p){if(p&&p.isTexture){const s=p.mapping;if(s===ty||s===ny)if(e.has(p)){const S=e.get(p).texture;return n(S,p.mapping)}else{const S=p.image;if(S&&S.height>0){const M=new MP(S.height);return M.fromEquirectangularTexture(c,p),e.set(p,M),p.addEventListener("dispose",u),n(M.texture,p.mapping)}else return null}}return p}function u(p){const s=p.target;s.removeEventListener("dispose",u);const S=e.get(s);S!==void 0&&(e.delete(s),S.dispose())}function f(){e=new WeakMap}return{get:r,dispose:f}}const Au=4,Zb=[.125,.215,.35,.446,.526,.582],nc=20,b_=new Mv,Xb=new vn;let w_=null,S_=0,M_=0,T_=!1;const ec=(1+Math.sqrt(5))/2,bu=1/ec,Yb=[new Ge(-ec,bu,0),new Ge(ec,bu,0),new Ge(-bu,0,ec),new Ge(bu,0,ec),new Ge(0,ec,-bu),new Ge(0,ec,bu),new Ge(-1,1,-1),new Ge(1,1,-1),new Ge(-1,1,1),new Ge(1,1,1)];class Kb{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,u=100){w_=this._renderer.getRenderTarget(),S_=this._renderer.getActiveCubeFace(),M_=this._renderer.getActiveMipmapLevel(),T_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const f=this._allocateTargets();return f.depthBuffer=!0,this._sceneToCubeUV(e,r,u,f),n>0&&this._blur(f,0,0,n),this._applyPMREM(f),this._cleanup(f),f}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=e1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Qb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(w_,S_,M_),this._renderer.xr.enabled=T_,e.scissorTest=!1,Df(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Uu||e.mapping===Bu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),w_=this._renderer.getRenderTarget(),S_=this._renderer.getActiveCubeFace(),M_=this._renderer.getActiveMipmapLevel(),T_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:bs,minFilter:bs,generateMipmaps:!1,type:Xd,format:ks,colorSpace:Zr,depthBuffer:!1},u=Jb(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Jb(e,n,r);const{_lodMax:f}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=rD(f)),this._blurMaterial=sD(f,e,n)}return u}_compileMaterial(e){const n=new rs(this._lodPlanes[0],e);this._renderer.compile(n,b_)}_sceneToCubeUV(e,n,r,u){const s=new is(90,1,n,r),S=[1,-1,1,1,1,1],M=[1,1,1,-1,-1,-1],C=this._renderer,I=C.autoClear,L=C.toneMapping;C.getClearColor(Xb),C.toneMapping=el,C.autoClear=!1;const R=new rc({name:"PMREM.Background",side:ss,depthWrite:!1,depthTest:!1}),B=new rs(new Yd,R);let Z=!1;const V=e.background;V?V.isColor&&(R.color.copy(V),e.background=null,Z=!0):(R.color.copy(Xb),Z=!0);for(let O=0;O<6;O++){const ge=O%3;ge===0?(s.up.set(0,S[O],0),s.lookAt(M[O],0,0)):ge===1?(s.up.set(0,0,S[O]),s.lookAt(0,M[O],0)):(s.up.set(0,S[O],0),s.lookAt(0,0,M[O]));const me=this._cubeSize;Df(u,ge*me,O>2?me:0,me,me),C.setRenderTarget(u),Z&&C.render(B,s),C.render(e,s)}B.geometry.dispose(),B.material.dispose(),C.toneMapping=L,C.autoClear=I,e.background=V}_textureToCubeUV(e,n){const r=this._renderer,u=e.mapping===Uu||e.mapping===Bu;u?(this._cubemapMaterial===null&&(this._cubemapMaterial=e1()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Qb());const f=u?this._cubemapMaterial:this._equirectMaterial,p=new rs(this._lodPlanes[0],f),s=f.uniforms;s.envMap.value=e;const S=this._cubeSize;Df(n,0,0,3*S,2*S),r.setRenderTarget(n),r.render(p,b_)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const u=this._lodPlanes.length;for(let f=1;f<u;f++){const p=Math.sqrt(this._sigmas[f]*this._sigmas[f]-this._sigmas[f-1]*this._sigmas[f-1]),s=Yb[(u-f-1)%Yb.length];this._blur(e,f-1,f,p,s)}n.autoClear=r}_blur(e,n,r,u,f){const p=this._pingPongRenderTarget;this._halfBlur(e,p,n,r,u,"latitudinal",f),this._halfBlur(p,e,r,r,u,"longitudinal",f)}_halfBlur(e,n,r,u,f,p,s){const S=this._renderer,M=this._blurMaterial;p!=="latitudinal"&&p!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const C=3,I=new rs(this._lodPlanes[u],M),L=M.uniforms,R=this._sizeLods[r]-1,B=isFinite(f)?Math.PI/(2*R):2*Math.PI/(2*nc-1),Z=f/B,V=isFinite(f)?1+Math.floor(C*Z):nc;V>nc&&console.warn(`sigmaRadians, ${f}, is too large and will clip, as it requested ${V} samples when the maximum is set to ${nc}`);const O=[];let ge=0;for(let ye=0;ye<nc;++ye){const ke=ye/Z,ce=Math.exp(-ke*ke/2);O.push(ce),ye===0?ge+=ce:ye<V&&(ge+=2*ce)}for(let ye=0;ye<O.length;ye++)O[ye]=O[ye]/ge;L.envMap.value=e.texture,L.samples.value=V,L.weights.value=O,L.latitudinal.value=p==="latitudinal",s&&(L.poleAxis.value=s);const{_lodMax:me}=this;L.dTheta.value=B,L.mipInt.value=me-r;const Q=this._sizeLods[u],de=3*Q*(u>me-Au?u-me+Au:0),fe=4*(this._cubeSize-Q);Df(n,de,fe,3*Q,2*Q),S.setRenderTarget(n),S.render(I,b_)}}function rD(c){const e=[],n=[],r=[];let u=c;const f=c-Au+1+Zb.length;for(let p=0;p<f;p++){const s=Math.pow(2,u);n.push(s);let S=1/s;p>c-Au?S=Zb[p-c+Au-1]:p===0&&(S=0),r.push(S);const M=1/(s-2),C=-M,I=1+M,L=[C,C,I,C,I,I,C,C,I,I,C,I],R=6,B=6,Z=3,V=2,O=1,ge=new Float32Array(Z*B*R),me=new Float32Array(V*B*R),Q=new Float32Array(O*B*R);for(let fe=0;fe<R;fe++){const ye=fe%3*2/3-1,ke=fe>2?0:-1,ce=[ye,ke,0,ye+2/3,ke,0,ye+2/3,ke+1,0,ye,ke,0,ye+2/3,ke+1,0,ye,ke+1,0];ge.set(ce,Z*B*fe),me.set(L,V*B*fe);const ie=[fe,fe,fe,fe,fe,fe];Q.set(ie,O*B*fe)}const de=new Ia;de.setAttribute("position",new qr(ge,Z)),de.setAttribute("uv",new qr(me,V)),de.setAttribute("faceIndex",new qr(Q,O)),e.push(de),u>Au&&u--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function Jb(c,e,n){const r=new fc(c,e,n);return r.texture.mapping=ym,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Df(c,e,n,r,u){c.viewport.set(e,n,r,u),c.scissor.set(e,n,r,u)}function sD(c,e,n){const r=new Float32Array(nc),u=new Ge(0,1,0);return new tl({name:"SphericalGaussianBlur",defines:{n:nc,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${c}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:u}},vertexShader:Av(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function Qb(){return new tl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Av(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function e1(){return new tl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Av(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function Av(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function aD(c){let e=new WeakMap,n=null;function r(s){if(s&&s.isTexture){const S=s.mapping,M=S===ty||S===ny,C=S===Uu||S===Bu;if(M||C){let I=e.get(s);const L=I!==void 0?I.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==L)return n===null&&(n=new Kb(c)),I=M?n.fromEquirectangular(s,I):n.fromCubemap(s,I),I.texture.pmremVersion=s.pmremVersion,e.set(s,I),I.texture;if(I!==void 0)return I.texture;{const R=s.image;return M&&R&&R.height>0||C&&R&&u(R)?(n===null&&(n=new Kb(c)),I=M?n.fromEquirectangular(s):n.fromCubemap(s),I.texture.pmremVersion=s.pmremVersion,e.set(s,I),s.addEventListener("dispose",f),I.texture):null}}}return s}function u(s){let S=0;const M=6;for(let C=0;C<M;C++)s[C]!==void 0&&S++;return S===M}function f(s){const S=s.target;S.removeEventListener("dispose",f);const M=e.get(S);M!==void 0&&(e.delete(S),M.dispose())}function p(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:p}}function oD(c){const e={};function n(r){if(e[r]!==void 0)return e[r];let u;switch(r){case"WEBGL_depth_texture":u=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":u=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":u=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":u=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:u=c.getExtension(r)}return e[r]=u,u}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const u=n(r);return u===null&&Tu("THREE.WebGLRenderer: "+r+" extension not supported."),u}}}function lD(c,e,n,r){const u={},f=new WeakMap;function p(I){const L=I.target;L.index!==null&&e.remove(L.index);for(const B in L.attributes)e.remove(L.attributes[B]);L.removeEventListener("dispose",p),delete u[L.id];const R=f.get(L);R&&(e.remove(R),f.delete(L)),r.releaseStatesOfGeometry(L),L.isInstancedBufferGeometry===!0&&delete L._maxInstanceCount,n.memory.geometries--}function s(I,L){return u[L.id]===!0||(L.addEventListener("dispose",p),u[L.id]=!0,n.memory.geometries++),L}function S(I){const L=I.attributes;for(const R in L)e.update(L[R],c.ARRAY_BUFFER)}function M(I){const L=[],R=I.index,B=I.attributes.position;let Z=0;if(R!==null){const ge=R.array;Z=R.version;for(let me=0,Q=ge.length;me<Q;me+=3){const de=ge[me+0],fe=ge[me+1],ye=ge[me+2];L.push(de,fe,fe,ye,ye,de)}}else if(B!==void 0){const ge=B.array;Z=B.version;for(let me=0,Q=ge.length/3-1;me<Q;me+=3){const de=me+0,fe=me+1,ye=me+2;L.push(de,fe,fe,ye,ye,de)}}else return;const V=new(cS(L)?mS:fS)(L,1);V.version=Z;const O=f.get(I);O&&e.remove(O),f.set(I,V)}function C(I){const L=f.get(I);if(L){const R=I.index;R!==null&&L.version<R.version&&M(I)}else M(I);return f.get(I)}return{get:s,update:S,getWireframeAttribute:C}}function cD(c,e,n){let r;function u(L){r=L}let f,p;function s(L){f=L.type,p=L.bytesPerElement}function S(L,R){c.drawElements(r,R,f,L*p),n.update(R,r,1)}function M(L,R,B){B!==0&&(c.drawElementsInstanced(r,R,f,L*p,B),n.update(R,r,B))}function C(L,R,B){if(B===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,R,0,f,L,0,B);let V=0;for(let O=0;O<B;O++)V+=R[O];n.update(V,r,1)}function I(L,R,B,Z){if(B===0)return;const V=e.get("WEBGL_multi_draw");if(V===null)for(let O=0;O<L.length;O++)M(L[O]/p,R[O],Z[O]);else{V.multiDrawElementsInstancedWEBGL(r,R,0,f,L,0,Z,0,B);let O=0;for(let ge=0;ge<B;ge++)O+=R[ge]*Z[ge];n.update(O,r,1)}}this.setMode=u,this.setIndex=s,this.render=S,this.renderInstances=M,this.renderMultiDraw=C,this.renderMultiDrawInstances=I}function uD(c){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(f,p,s){switch(n.calls++,p){case c.TRIANGLES:n.triangles+=s*(f/3);break;case c.LINES:n.lines+=s*(f/2);break;case c.LINE_STRIP:n.lines+=s*(f-1);break;case c.LINE_LOOP:n.lines+=s*f;break;case c.POINTS:n.points+=s*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",p);break}}function u(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:u,update:r}}function hD(c,e,n){const r=new WeakMap,u=new oi;function f(p,s,S){const M=p.morphTargetInfluences,C=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,I=C!==void 0?C.length:0;let L=r.get(s);if(L===void 0||L.count!==I){let ie=function(){ke.dispose(),r.delete(s),s.removeEventListener("dispose",ie)};var R=ie;L!==void 0&&L.texture.dispose();const B=s.morphAttributes.position!==void 0,Z=s.morphAttributes.normal!==void 0,V=s.morphAttributes.color!==void 0,O=s.morphAttributes.position||[],ge=s.morphAttributes.normal||[],me=s.morphAttributes.color||[];let Q=0;B===!0&&(Q=1),Z===!0&&(Q=2),V===!0&&(Q=3);let de=s.attributes.position.count*Q,fe=1;de>e.maxTextureSize&&(fe=Math.ceil(de/e.maxTextureSize),de=e.maxTextureSize);const ye=new Float32Array(de*fe*4*I),ke=new hS(ye,de,fe,I);ke.type=ta,ke.needsUpdate=!0;const ce=Q*4;for(let Oe=0;Oe<I;Oe++){const nt=O[Oe],Je=ge[Oe],ut=me[Oe],ht=de*fe*4*Oe;for(let ot=0;ot<nt.count;ot++){const ft=ot*ce;B===!0&&(u.fromBufferAttribute(nt,ot),ye[ht+ft+0]=u.x,ye[ht+ft+1]=u.y,ye[ht+ft+2]=u.z,ye[ht+ft+3]=0),Z===!0&&(u.fromBufferAttribute(Je,ot),ye[ht+ft+4]=u.x,ye[ht+ft+5]=u.y,ye[ht+ft+6]=u.z,ye[ht+ft+7]=0),V===!0&&(u.fromBufferAttribute(ut,ot),ye[ht+ft+8]=u.x,ye[ht+ft+9]=u.y,ye[ht+ft+10]=u.z,ye[ht+ft+11]=ut.itemSize===4?u.w:1)}}L={count:I,texture:ke,size:new ei(de,fe)},r.set(s,L),s.addEventListener("dispose",ie)}if(p.isInstancedMesh===!0&&p.morphTexture!==null)S.getUniforms().setValue(c,"morphTexture",p.morphTexture,n);else{let B=0;for(let V=0;V<M.length;V++)B+=M[V];const Z=s.morphTargetsRelative?1:1-B;S.getUniforms().setValue(c,"morphTargetBaseInfluence",Z),S.getUniforms().setValue(c,"morphTargetInfluences",M)}S.getUniforms().setValue(c,"morphTargetsTexture",L.texture,n),S.getUniforms().setValue(c,"morphTargetsTextureSize",L.size)}return{update:f}}function dD(c,e,n,r){let u=new WeakMap;function f(S){const M=r.render.frame,C=S.geometry,I=e.get(S,C);if(u.get(I)!==M&&(e.update(I),u.set(I,M)),S.isInstancedMesh&&(S.hasEventListener("dispose",s)===!1&&S.addEventListener("dispose",s),u.get(S)!==M&&(n.update(S.instanceMatrix,c.ARRAY_BUFFER),S.instanceColor!==null&&n.update(S.instanceColor,c.ARRAY_BUFFER),u.set(S,M))),S.isSkinnedMesh){const L=S.skeleton;u.get(L)!==M&&(L.update(),u.set(L,M))}return I}function p(){u=new WeakMap}function s(S){const M=S.target;M.removeEventListener("dispose",s),n.remove(M.instanceMatrix),M.instanceColor!==null&&n.remove(M.instanceColor)}return{update:f,dispose:p}}const CS=new yr,t1=new wS(1,1),PS=new hS,IS=new lP,RS=new _S,n1=[],i1=[],r1=new Float32Array(16),s1=new Float32Array(9),a1=new Float32Array(4);function nh(c,e,n){const r=c[0];if(r<=0||r>0)return c;const u=e*n;let f=n1[u];if(f===void 0&&(f=new Float32Array(u),n1[u]=f),e!==0){r.toArray(f,0);for(let p=1,s=0;p!==e;++p)s+=n,c[p].toArray(f,s)}return f}function cr(c,e){if(c.length!==e.length)return!1;for(let n=0,r=c.length;n<r;n++)if(c[n]!==e[n])return!1;return!0}function ur(c,e){for(let n=0,r=e.length;n<r;n++)c[n]=e[n]}function wm(c,e){let n=i1[e];n===void 0&&(n=new Int32Array(e),i1[e]=n);for(let r=0;r!==e;++r)n[r]=c.allocateTextureUnit();return n}function pD(c,e){const n=this.cache;n[0]!==e&&(c.uniform1f(this.addr,e),n[0]=e)}function fD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(c.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(cr(n,e))return;c.uniform2fv(this.addr,e),ur(n,e)}}function mD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(c.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(c.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(cr(n,e))return;c.uniform3fv(this.addr,e),ur(n,e)}}function gD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(c.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(cr(n,e))return;c.uniform4fv(this.addr,e),ur(n,e)}}function _D(c,e){const n=this.cache,r=e.elements;if(r===void 0){if(cr(n,e))return;c.uniformMatrix2fv(this.addr,!1,e),ur(n,e)}else{if(cr(n,r))return;a1.set(r),c.uniformMatrix2fv(this.addr,!1,a1),ur(n,r)}}function yD(c,e){const n=this.cache,r=e.elements;if(r===void 0){if(cr(n,e))return;c.uniformMatrix3fv(this.addr,!1,e),ur(n,e)}else{if(cr(n,r))return;s1.set(r),c.uniformMatrix3fv(this.addr,!1,s1),ur(n,r)}}function vD(c,e){const n=this.cache,r=e.elements;if(r===void 0){if(cr(n,e))return;c.uniformMatrix4fv(this.addr,!1,e),ur(n,e)}else{if(cr(n,r))return;r1.set(r),c.uniformMatrix4fv(this.addr,!1,r1),ur(n,r)}}function xD(c,e){const n=this.cache;n[0]!==e&&(c.uniform1i(this.addr,e),n[0]=e)}function bD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(c.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(cr(n,e))return;c.uniform2iv(this.addr,e),ur(n,e)}}function wD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(c.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(cr(n,e))return;c.uniform3iv(this.addr,e),ur(n,e)}}function SD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(c.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(cr(n,e))return;c.uniform4iv(this.addr,e),ur(n,e)}}function MD(c,e){const n=this.cache;n[0]!==e&&(c.uniform1ui(this.addr,e),n[0]=e)}function TD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(c.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(cr(n,e))return;c.uniform2uiv(this.addr,e),ur(n,e)}}function ED(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(c.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(cr(n,e))return;c.uniform3uiv(this.addr,e),ur(n,e)}}function AD(c,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(c.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(cr(n,e))return;c.uniform4uiv(this.addr,e),ur(n,e)}}function CD(c,e,n){const r=this.cache,u=n.allocateTextureUnit();r[0]!==u&&(c.uniform1i(this.addr,u),r[0]=u);let f;this.type===c.SAMPLER_2D_SHADOW?(t1.compareFunction=oS,f=t1):f=CS,n.setTexture2D(e||f,u)}function PD(c,e,n){const r=this.cache,u=n.allocateTextureUnit();r[0]!==u&&(c.uniform1i(this.addr,u),r[0]=u),n.setTexture3D(e||IS,u)}function ID(c,e,n){const r=this.cache,u=n.allocateTextureUnit();r[0]!==u&&(c.uniform1i(this.addr,u),r[0]=u),n.setTextureCube(e||RS,u)}function RD(c,e,n){const r=this.cache,u=n.allocateTextureUnit();r[0]!==u&&(c.uniform1i(this.addr,u),r[0]=u),n.setTexture2DArray(e||PS,u)}function LD(c){switch(c){case 5126:return pD;case 35664:return fD;case 35665:return mD;case 35666:return gD;case 35674:return _D;case 35675:return yD;case 35676:return vD;case 5124:case 35670:return xD;case 35667:case 35671:return bD;case 35668:case 35672:return wD;case 35669:case 35673:return SD;case 5125:return MD;case 36294:return TD;case 36295:return ED;case 36296:return AD;case 35678:case 36198:case 36298:case 36306:case 35682:return CD;case 35679:case 36299:case 36307:return PD;case 35680:case 36300:case 36308:case 36293:return ID;case 36289:case 36303:case 36311:case 36292:return RD}}function DD(c,e){c.uniform1fv(this.addr,e)}function kD(c,e){const n=nh(e,this.size,2);c.uniform2fv(this.addr,n)}function zD(c,e){const n=nh(e,this.size,3);c.uniform3fv(this.addr,n)}function FD(c,e){const n=nh(e,this.size,4);c.uniform4fv(this.addr,n)}function OD(c,e){const n=nh(e,this.size,4);c.uniformMatrix2fv(this.addr,!1,n)}function ND(c,e){const n=nh(e,this.size,9);c.uniformMatrix3fv(this.addr,!1,n)}function UD(c,e){const n=nh(e,this.size,16);c.uniformMatrix4fv(this.addr,!1,n)}function BD(c,e){c.uniform1iv(this.addr,e)}function VD(c,e){c.uniform2iv(this.addr,e)}function GD(c,e){c.uniform3iv(this.addr,e)}function HD(c,e){c.uniform4iv(this.addr,e)}function jD(c,e){c.uniform1uiv(this.addr,e)}function $D(c,e){c.uniform2uiv(this.addr,e)}function WD(c,e){c.uniform3uiv(this.addr,e)}function qD(c,e){c.uniform4uiv(this.addr,e)}function ZD(c,e,n){const r=this.cache,u=e.length,f=wm(n,u);cr(r,f)||(c.uniform1iv(this.addr,f),ur(r,f));for(let p=0;p!==u;++p)n.setTexture2D(e[p]||CS,f[p])}function XD(c,e,n){const r=this.cache,u=e.length,f=wm(n,u);cr(r,f)||(c.uniform1iv(this.addr,f),ur(r,f));for(let p=0;p!==u;++p)n.setTexture3D(e[p]||IS,f[p])}function YD(c,e,n){const r=this.cache,u=e.length,f=wm(n,u);cr(r,f)||(c.uniform1iv(this.addr,f),ur(r,f));for(let p=0;p!==u;++p)n.setTextureCube(e[p]||RS,f[p])}function KD(c,e,n){const r=this.cache,u=e.length,f=wm(n,u);cr(r,f)||(c.uniform1iv(this.addr,f),ur(r,f));for(let p=0;p!==u;++p)n.setTexture2DArray(e[p]||PS,f[p])}function JD(c){switch(c){case 5126:return DD;case 35664:return kD;case 35665:return zD;case 35666:return FD;case 35674:return OD;case 35675:return ND;case 35676:return UD;case 5124:case 35670:return BD;case 35667:case 35671:return VD;case 35668:case 35672:return GD;case 35669:case 35673:return HD;case 5125:return jD;case 36294:return $D;case 36295:return WD;case 36296:return qD;case 35678:case 36198:case 36298:case 36306:case 35682:return ZD;case 35679:case 36299:case 36307:return XD;case 35680:case 36300:case 36308:case 36293:return YD;case 36289:case 36303:case 36311:case 36292:return KD}}class QD{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=LD(n.type)}}class e3{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=JD(n.type)}}class t3{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const u=this.seq;for(let f=0,p=u.length;f!==p;++f){const s=u[f];s.setValue(e,n[s.id],r)}}}const E_=/(\w+)(\])?(\[|\.)?/g;function o1(c,e){c.seq.push(e),c.map[e.id]=e}function n3(c,e,n){const r=c.name,u=r.length;for(E_.lastIndex=0;;){const f=E_.exec(r),p=E_.lastIndex;let s=f[1];const S=f[2]==="]",M=f[3];if(S&&(s=s|0),M===void 0||M==="["&&p+2===u){o1(n,M===void 0?new QD(s,c,e):new e3(s,c,e));break}else{let I=n.map[s];I===void 0&&(I=new t3(s),o1(n,I)),n=I}}}class Wf{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let u=0;u<r;++u){const f=e.getActiveUniform(n,u),p=e.getUniformLocation(n,f.name);n3(f,p,this)}}setValue(e,n,r,u){const f=this.map[n];f!==void 0&&f.setValue(e,r,u)}setOptional(e,n,r){const u=n[r];u!==void 0&&this.setValue(e,r,u)}static upload(e,n,r,u){for(let f=0,p=n.length;f!==p;++f){const s=n[f],S=r[s.id];S.needsUpdate!==!1&&s.setValue(e,S.value,u)}}static seqWithValue(e,n){const r=[];for(let u=0,f=e.length;u!==f;++u){const p=e[u];p.id in n&&r.push(p)}return r}}function l1(c,e,n){const r=c.createShader(e);return c.shaderSource(r,n),c.compileShader(r),r}const i3=37297;let r3=0;function s3(c,e){const n=c.split(`
`),r=[],u=Math.max(e-6,0),f=Math.min(e+6,n.length);for(let p=u;p<f;p++){const s=p+1;r.push(`${s===e?">":" "} ${s}: ${n[p]}`)}return r.join(`
`)}const c1=new kn;function a3(c){Qn._getMatrix(c1,Qn.workingColorSpace,c);const e=`mat3( ${c1.elements.map(n=>n.toFixed(4))} )`;switch(Qn.getTransfer(c)){case im:return[e,"LinearTransferOETF"];case mi:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",c),[e,"LinearTransferOETF"]}}function u1(c,e,n){const r=c.getShaderParameter(e,c.COMPILE_STATUS),u=c.getShaderInfoLog(e).trim();if(r&&u==="")return"";const f=/ERROR: 0:(\d+)/.exec(u);if(f){const p=parseInt(f[1]);return n.toUpperCase()+`

`+u+`

`+s3(c.getShaderSource(e),p)}else return u}function o3(c,e){const n=a3(e);return[`vec4 ${c}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function l3(c,e){let n;switch(e){case _C:n="Linear";break;case yC:n="Reinhard";break;case vC:n="Cineon";break;case xC:n="ACESFilmic";break;case wC:n="AgX";break;case SC:n="Neutral";break;case bC:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+c+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const kf=new Ge;function c3(){Qn.getLuminanceCoefficients(kf);const c=kf.x.toFixed(4),e=kf.y.toFixed(4),n=kf.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${c}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function u3(c){return[c.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",c.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Md).join(`
`)}function h3(c){const e=[];for(const n in c){const r=c[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function d3(c,e){const n={},r=c.getProgramParameter(e,c.ACTIVE_ATTRIBUTES);for(let u=0;u<r;u++){const f=c.getActiveAttrib(e,u),p=f.name;let s=1;f.type===c.FLOAT_MAT2&&(s=2),f.type===c.FLOAT_MAT3&&(s=3),f.type===c.FLOAT_MAT4&&(s=4),n[p]={type:f.type,location:c.getAttribLocation(e,p),locationSize:s}}return n}function Md(c){return c!==""}function h1(c,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return c.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function d1(c,e){return c.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const p3=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dy(c){return c.replace(p3,m3)}const f3=new Map;function m3(c,e){let n=Un[e];if(n===void 0){const r=f3.get(e);if(r!==void 0)n=Un[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return Dy(n)}const g3=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function p1(c){return c.replace(g3,_3)}function _3(c,e,n,r){let u="";for(let f=parseInt(e);f<parseInt(n);f++)u+=r.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return u}function f1(c){let e=`precision ${c.precision} float;
	precision ${c.precision} int;
	precision ${c.precision} sampler2D;
	precision ${c.precision} samplerCube;
	precision ${c.precision} sampler3D;
	precision ${c.precision} sampler2DArray;
	precision ${c.precision} sampler2DShadow;
	precision ${c.precision} samplerCubeShadow;
	precision ${c.precision} sampler2DArrayShadow;
	precision ${c.precision} isampler2D;
	precision ${c.precision} isampler3D;
	precision ${c.precision} isamplerCube;
	precision ${c.precision} isampler2DArray;
	precision ${c.precision} usampler2D;
	precision ${c.precision} usampler3D;
	precision ${c.precision} usamplerCube;
	precision ${c.precision} usampler2DArray;
	`;return c.precision==="highp"?e+=`
#define HIGH_PRECISION`:c.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:c.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function y3(c){let e="SHADOWMAP_TYPE_BASIC";return c.shadowMapType===Ww?e="SHADOWMAP_TYPE_PCF":c.shadowMapType===YA?e="SHADOWMAP_TYPE_PCF_SOFT":c.shadowMapType===Ja&&(e="SHADOWMAP_TYPE_VSM"),e}function v3(c){let e="ENVMAP_TYPE_CUBE";if(c.envMap)switch(c.envMapMode){case Uu:case Bu:e="ENVMAP_TYPE_CUBE";break;case ym:e="ENVMAP_TYPE_CUBE_UV";break}return e}function x3(c){let e="ENVMAP_MODE_REFLECTION";if(c.envMap)switch(c.envMapMode){case Bu:e="ENVMAP_MODE_REFRACTION";break}return e}function b3(c){let e="ENVMAP_BLENDING_NONE";if(c.envMap)switch(c.combine){case qw:e="ENVMAP_BLENDING_MULTIPLY";break;case mC:e="ENVMAP_BLENDING_MIX";break;case gC:e="ENVMAP_BLENDING_ADD";break}return e}function w3(c){const e=c.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function S3(c,e,n,r){const u=c.getContext(),f=n.defines;let p=n.vertexShader,s=n.fragmentShader;const S=y3(n),M=v3(n),C=x3(n),I=b3(n),L=w3(n),R=u3(n),B=h3(f),Z=u.createProgram();let V,O,ge=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(V=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B].filter(Md).join(`
`),V.length>0&&(V+=`
`),O=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B].filter(Md).join(`
`),O.length>0&&(O+=`
`)):(V=[f1(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+C:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+S:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Md).join(`
`),O=[f1(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+M:"",n.envMap?"#define "+C:"",n.envMap?"#define "+I:"",L?"#define CUBEUV_TEXEL_WIDTH "+L.texelWidth:"",L?"#define CUBEUV_TEXEL_HEIGHT "+L.texelHeight:"",L?"#define CUBEUV_MAX_MIP "+L.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+S:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==el?"#define TONE_MAPPING":"",n.toneMapping!==el?Un.tonemapping_pars_fragment:"",n.toneMapping!==el?l3("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Un.colorspace_pars_fragment,o3("linearToOutputTexel",n.outputColorSpace),c3(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Md).join(`
`)),p=Dy(p),p=h1(p,n),p=d1(p,n),s=Dy(s),s=h1(s,n),s=d1(s,n),p=p1(p),s=p1(s),n.isRawShaderMaterial!==!0&&(ge=`#version 300 es
`,V=[R,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+V,O=["#define varying in",n.glslVersion===ub?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ub?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+O);const me=ge+V+p,Q=ge+O+s,de=l1(u,u.VERTEX_SHADER,me),fe=l1(u,u.FRAGMENT_SHADER,Q);u.attachShader(Z,de),u.attachShader(Z,fe),n.index0AttributeName!==void 0?u.bindAttribLocation(Z,0,n.index0AttributeName):n.morphTargets===!0&&u.bindAttribLocation(Z,0,"position"),u.linkProgram(Z);function ye(Oe){if(c.debug.checkShaderErrors){const nt=u.getProgramInfoLog(Z).trim(),Je=u.getShaderInfoLog(de).trim(),ut=u.getShaderInfoLog(fe).trim();let ht=!0,ot=!0;if(u.getProgramParameter(Z,u.LINK_STATUS)===!1)if(ht=!1,typeof c.debug.onShaderError=="function")c.debug.onShaderError(u,Z,de,fe);else{const ft=u1(u,de,"vertex"),tt=u1(u,fe,"fragment");console.error("THREE.WebGLProgram: Shader Error "+u.getError()+" - VALIDATE_STATUS "+u.getProgramParameter(Z,u.VALIDATE_STATUS)+`

Material Name: `+Oe.name+`
Material Type: `+Oe.type+`

Program Info Log: `+nt+`
`+ft+`
`+tt)}else nt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",nt):(Je===""||ut==="")&&(ot=!1);ot&&(Oe.diagnostics={runnable:ht,programLog:nt,vertexShader:{log:Je,prefix:V},fragmentShader:{log:ut,prefix:O}})}u.deleteShader(de),u.deleteShader(fe),ke=new Wf(u,Z),ce=d3(u,Z)}let ke;this.getUniforms=function(){return ke===void 0&&ye(this),ke};let ce;this.getAttributes=function(){return ce===void 0&&ye(this),ce};let ie=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ie===!1&&(ie=u.getProgramParameter(Z,i3)),ie},this.destroy=function(){r.releaseStatesOfProgram(this),u.deleteProgram(Z),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=r3++,this.cacheKey=e,this.usedTimes=1,this.program=Z,this.vertexShader=de,this.fragmentShader=fe,this}let M3=0;class T3{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,u=this._getShaderStage(n),f=this._getShaderStage(r),p=this._getShaderCacheForMaterial(e);return p.has(u)===!1&&(p.add(u),u.usedTimes++),p.has(f)===!1&&(p.add(f),f.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new E3(e),n.set(e,r)),r}}class E3{constructor(e){this.id=M3++,this.code=e,this.usedTimes=0}}function A3(c,e,n,r,u,f,p){const s=new dS,S=new T3,M=new Set,C=[],I=u.logarithmicDepthBuffer,L=u.vertexTextures;let R=u.precision;const B={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Z(ce){return M.add(ce),ce===0?"uv":`uv${ce}`}function V(ce,ie,Oe,nt,Je){const ut=nt.fog,ht=Je.geometry,ot=ce.isMeshStandardMaterial?nt.environment:null,ft=(ce.isMeshStandardMaterial?n:e).get(ce.envMap||ot),tt=ft&&ft.mapping===ym?ft.image.height:null,It=B[ce.type];ce.precision!==null&&(R=u.getMaxPrecision(ce.precision),R!==ce.precision&&console.warn("THREE.WebGLProgram.getParameters:",ce.precision,"not supported, using",R,"instead."));const Ut=ht.morphAttributes.position||ht.morphAttributes.normal||ht.morphAttributes.color,Wt=Ut!==void 0?Ut.length:0;let $t=0;ht.morphAttributes.position!==void 0&&($t=1),ht.morphAttributes.normal!==void 0&&($t=2),ht.morphAttributes.color!==void 0&&($t=3);let Rn,it,Tt,qt;if(It){const pt=xa[It];Rn=pt.vertexShader,it=pt.fragmentShader}else Rn=ce.vertexShader,it=ce.fragmentShader,S.update(ce),Tt=S.getVertexShaderID(ce),qt=S.getFragmentShaderID(ce);const Rt=c.getRenderTarget(),on=c.state.buffers.depth.getReversed(),Xt=Je.isInstancedMesh===!0,yn=Je.isBatchedMesh===!0,Vn=!!ce.map,Ln=!!ce.matcap,pn=!!ft,Fe=!!ce.aoMap,gi=!!ce.lightMap,bn=!!ce.bumpMap,cn=!!ce.normalMap,Zt=!!ce.displacementMap,Tn=!!ce.emissiveMap,Yt=!!ce.metalnessMap,ve=!!ce.roughnessMap,te=ce.anisotropy>0,Ze=ce.clearcoat>0,ct=ce.dispersion>0,mt=ce.iridescence>0,rt=ce.sheen>0,Vt=ce.transmission>0,At=te&&!!ce.anisotropyMap,Gt=Ze&&!!ce.clearcoatMap,zn=Ze&&!!ce.clearcoatNormalMap,bt=Ze&&!!ce.clearcoatRoughnessMap,Ce=mt&&!!ce.iridescenceMap,W=mt&&!!ce.iridescenceThicknessMap,X=rt&&!!ce.sheenColorMap,J=rt&&!!ce.sheenRoughnessMap,ue=!!ce.specularMap,Te=!!ce.specularColorMap,De=!!ce.specularIntensityMap,ne=Vt&&!!ce.transmissionMap,_e=Vt&&!!ce.thicknessMap,xe=!!ce.gradientMap,Ee=!!ce.alphaMap,Ie=ce.alphaTest>0,Ue=!!ce.alphaHash,be=!!ce.extensions;let dt=el;ce.toneMapped&&(Rt===null||Rt.isXRRenderTarget===!0)&&(dt=c.toneMapping);const Nt={shaderID:It,shaderType:ce.type,shaderName:ce.name,vertexShader:Rn,fragmentShader:it,defines:ce.defines,customVertexShaderID:Tt,customFragmentShaderID:qt,isRawShaderMaterial:ce.isRawShaderMaterial===!0,glslVersion:ce.glslVersion,precision:R,batching:yn,batchingColor:yn&&Je._colorsTexture!==null,instancing:Xt,instancingColor:Xt&&Je.instanceColor!==null,instancingMorph:Xt&&Je.morphTexture!==null,supportsVertexTextures:L,outputColorSpace:Rt===null?c.outputColorSpace:Rt.isXRRenderTarget===!0?Rt.texture.colorSpace:Zr,alphaToCoverage:!!ce.alphaToCoverage,map:Vn,matcap:Ln,envMap:pn,envMapMode:pn&&ft.mapping,envMapCubeUVHeight:tt,aoMap:Fe,lightMap:gi,bumpMap:bn,normalMap:cn,displacementMap:L&&Zt,emissiveMap:Tn,normalMapObjectSpace:cn&&ce.normalMapType===PC,normalMapTangentSpace:cn&&ce.normalMapType===aS,metalnessMap:Yt,roughnessMap:ve,anisotropy:te,anisotropyMap:At,clearcoat:Ze,clearcoatMap:Gt,clearcoatNormalMap:zn,clearcoatRoughnessMap:bt,dispersion:ct,iridescence:mt,iridescenceMap:Ce,iridescenceThicknessMap:W,sheen:rt,sheenColorMap:X,sheenRoughnessMap:J,specularMap:ue,specularColorMap:Te,specularIntensityMap:De,transmission:Vt,transmissionMap:ne,thicknessMap:_e,gradientMap:xe,opaque:ce.transparent===!1&&ce.blending===Lu&&ce.alphaToCoverage===!1,alphaMap:Ee,alphaTest:Ie,alphaHash:Ue,combine:ce.combine,mapUv:Vn&&Z(ce.map.channel),aoMapUv:Fe&&Z(ce.aoMap.channel),lightMapUv:gi&&Z(ce.lightMap.channel),bumpMapUv:bn&&Z(ce.bumpMap.channel),normalMapUv:cn&&Z(ce.normalMap.channel),displacementMapUv:Zt&&Z(ce.displacementMap.channel),emissiveMapUv:Tn&&Z(ce.emissiveMap.channel),metalnessMapUv:Yt&&Z(ce.metalnessMap.channel),roughnessMapUv:ve&&Z(ce.roughnessMap.channel),anisotropyMapUv:At&&Z(ce.anisotropyMap.channel),clearcoatMapUv:Gt&&Z(ce.clearcoatMap.channel),clearcoatNormalMapUv:zn&&Z(ce.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:bt&&Z(ce.clearcoatRoughnessMap.channel),iridescenceMapUv:Ce&&Z(ce.iridescenceMap.channel),iridescenceThicknessMapUv:W&&Z(ce.iridescenceThicknessMap.channel),sheenColorMapUv:X&&Z(ce.sheenColorMap.channel),sheenRoughnessMapUv:J&&Z(ce.sheenRoughnessMap.channel),specularMapUv:ue&&Z(ce.specularMap.channel),specularColorMapUv:Te&&Z(ce.specularColorMap.channel),specularIntensityMapUv:De&&Z(ce.specularIntensityMap.channel),transmissionMapUv:ne&&Z(ce.transmissionMap.channel),thicknessMapUv:_e&&Z(ce.thicknessMap.channel),alphaMapUv:Ee&&Z(ce.alphaMap.channel),vertexTangents:!!ht.attributes.tangent&&(cn||te),vertexColors:ce.vertexColors,vertexAlphas:ce.vertexColors===!0&&!!ht.attributes.color&&ht.attributes.color.itemSize===4,pointsUvs:Je.isPoints===!0&&!!ht.attributes.uv&&(Vn||Ee),fog:!!ut,useFog:ce.fog===!0,fogExp2:!!ut&&ut.isFogExp2,flatShading:ce.flatShading===!0,sizeAttenuation:ce.sizeAttenuation===!0,logarithmicDepthBuffer:I,reverseDepthBuffer:on,skinning:Je.isSkinnedMesh===!0,morphTargets:ht.morphAttributes.position!==void 0,morphNormals:ht.morphAttributes.normal!==void 0,morphColors:ht.morphAttributes.color!==void 0,morphTargetsCount:Wt,morphTextureStride:$t,numDirLights:ie.directional.length,numPointLights:ie.point.length,numSpotLights:ie.spot.length,numSpotLightMaps:ie.spotLightMap.length,numRectAreaLights:ie.rectArea.length,numHemiLights:ie.hemi.length,numDirLightShadows:ie.directionalShadowMap.length,numPointLightShadows:ie.pointShadowMap.length,numSpotLightShadows:ie.spotShadowMap.length,numSpotLightShadowsWithMaps:ie.numSpotLightShadowsWithMaps,numLightProbes:ie.numLightProbes,numClippingPlanes:p.numPlanes,numClipIntersection:p.numIntersection,dithering:ce.dithering,shadowMapEnabled:c.shadowMap.enabled&&Oe.length>0,shadowMapType:c.shadowMap.type,toneMapping:dt,decodeVideoTexture:Vn&&ce.map.isVideoTexture===!0&&Qn.getTransfer(ce.map.colorSpace)===mi,decodeVideoTextureEmissive:Tn&&ce.emissiveMap.isVideoTexture===!0&&Qn.getTransfer(ce.emissiveMap.colorSpace)===mi,premultipliedAlpha:ce.premultipliedAlpha,doubleSided:ce.side===wa,flipSided:ce.side===ss,useDepthPacking:ce.depthPacking>=0,depthPacking:ce.depthPacking||0,index0AttributeName:ce.index0AttributeName,extensionClipCullDistance:be&&ce.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(be&&ce.extensions.multiDraw===!0||yn)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:ce.customProgramCacheKey()};return Nt.vertexUv1s=M.has(1),Nt.vertexUv2s=M.has(2),Nt.vertexUv3s=M.has(3),M.clear(),Nt}function O(ce){const ie=[];if(ce.shaderID?ie.push(ce.shaderID):(ie.push(ce.customVertexShaderID),ie.push(ce.customFragmentShaderID)),ce.defines!==void 0)for(const Oe in ce.defines)ie.push(Oe),ie.push(ce.defines[Oe]);return ce.isRawShaderMaterial===!1&&(ge(ie,ce),me(ie,ce),ie.push(c.outputColorSpace)),ie.push(ce.customProgramCacheKey),ie.join()}function ge(ce,ie){ce.push(ie.precision),ce.push(ie.outputColorSpace),ce.push(ie.envMapMode),ce.push(ie.envMapCubeUVHeight),ce.push(ie.mapUv),ce.push(ie.alphaMapUv),ce.push(ie.lightMapUv),ce.push(ie.aoMapUv),ce.push(ie.bumpMapUv),ce.push(ie.normalMapUv),ce.push(ie.displacementMapUv),ce.push(ie.emissiveMapUv),ce.push(ie.metalnessMapUv),ce.push(ie.roughnessMapUv),ce.push(ie.anisotropyMapUv),ce.push(ie.clearcoatMapUv),ce.push(ie.clearcoatNormalMapUv),ce.push(ie.clearcoatRoughnessMapUv),ce.push(ie.iridescenceMapUv),ce.push(ie.iridescenceThicknessMapUv),ce.push(ie.sheenColorMapUv),ce.push(ie.sheenRoughnessMapUv),ce.push(ie.specularMapUv),ce.push(ie.specularColorMapUv),ce.push(ie.specularIntensityMapUv),ce.push(ie.transmissionMapUv),ce.push(ie.thicknessMapUv),ce.push(ie.combine),ce.push(ie.fogExp2),ce.push(ie.sizeAttenuation),ce.push(ie.morphTargetsCount),ce.push(ie.morphAttributeCount),ce.push(ie.numDirLights),ce.push(ie.numPointLights),ce.push(ie.numSpotLights),ce.push(ie.numSpotLightMaps),ce.push(ie.numHemiLights),ce.push(ie.numRectAreaLights),ce.push(ie.numDirLightShadows),ce.push(ie.numPointLightShadows),ce.push(ie.numSpotLightShadows),ce.push(ie.numSpotLightShadowsWithMaps),ce.push(ie.numLightProbes),ce.push(ie.shadowMapType),ce.push(ie.toneMapping),ce.push(ie.numClippingPlanes),ce.push(ie.numClipIntersection),ce.push(ie.depthPacking)}function me(ce,ie){s.disableAll(),ie.supportsVertexTextures&&s.enable(0),ie.instancing&&s.enable(1),ie.instancingColor&&s.enable(2),ie.instancingMorph&&s.enable(3),ie.matcap&&s.enable(4),ie.envMap&&s.enable(5),ie.normalMapObjectSpace&&s.enable(6),ie.normalMapTangentSpace&&s.enable(7),ie.clearcoat&&s.enable(8),ie.iridescence&&s.enable(9),ie.alphaTest&&s.enable(10),ie.vertexColors&&s.enable(11),ie.vertexAlphas&&s.enable(12),ie.vertexUv1s&&s.enable(13),ie.vertexUv2s&&s.enable(14),ie.vertexUv3s&&s.enable(15),ie.vertexTangents&&s.enable(16),ie.anisotropy&&s.enable(17),ie.alphaHash&&s.enable(18),ie.batching&&s.enable(19),ie.dispersion&&s.enable(20),ie.batchingColor&&s.enable(21),ce.push(s.mask),s.disableAll(),ie.fog&&s.enable(0),ie.useFog&&s.enable(1),ie.flatShading&&s.enable(2),ie.logarithmicDepthBuffer&&s.enable(3),ie.reverseDepthBuffer&&s.enable(4),ie.skinning&&s.enable(5),ie.morphTargets&&s.enable(6),ie.morphNormals&&s.enable(7),ie.morphColors&&s.enable(8),ie.premultipliedAlpha&&s.enable(9),ie.shadowMapEnabled&&s.enable(10),ie.doubleSided&&s.enable(11),ie.flipSided&&s.enable(12),ie.useDepthPacking&&s.enable(13),ie.dithering&&s.enable(14),ie.transmission&&s.enable(15),ie.sheen&&s.enable(16),ie.opaque&&s.enable(17),ie.pointsUvs&&s.enable(18),ie.decodeVideoTexture&&s.enable(19),ie.decodeVideoTextureEmissive&&s.enable(20),ie.alphaToCoverage&&s.enable(21),ce.push(s.mask)}function Q(ce){const ie=B[ce.type];let Oe;if(ie){const nt=xa[ie];Oe=xP.clone(nt.uniforms)}else Oe=ce.uniforms;return Oe}function de(ce,ie){let Oe;for(let nt=0,Je=C.length;nt<Je;nt++){const ut=C[nt];if(ut.cacheKey===ie){Oe=ut,++Oe.usedTimes;break}}return Oe===void 0&&(Oe=new S3(c,ie,ce,f),C.push(Oe)),Oe}function fe(ce){if(--ce.usedTimes===0){const ie=C.indexOf(ce);C[ie]=C[C.length-1],C.pop(),ce.destroy()}}function ye(ce){S.remove(ce)}function ke(){S.dispose()}return{getParameters:V,getProgramCacheKey:O,getUniforms:Q,acquireProgram:de,releaseProgram:fe,releaseShaderCache:ye,programs:C,dispose:ke}}function C3(){let c=new WeakMap;function e(p){return c.has(p)}function n(p){let s=c.get(p);return s===void 0&&(s={},c.set(p,s)),s}function r(p){c.delete(p)}function u(p,s,S){c.get(p)[s]=S}function f(){c=new WeakMap}return{has:e,get:n,remove:r,update:u,dispose:f}}function P3(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.material.id!==e.material.id?c.material.id-e.material.id:c.z!==e.z?c.z-e.z:c.id-e.id}function m1(c,e){return c.groupOrder!==e.groupOrder?c.groupOrder-e.groupOrder:c.renderOrder!==e.renderOrder?c.renderOrder-e.renderOrder:c.z!==e.z?e.z-c.z:c.id-e.id}function g1(){const c=[];let e=0;const n=[],r=[],u=[];function f(){e=0,n.length=0,r.length=0,u.length=0}function p(I,L,R,B,Z,V){let O=c[e];return O===void 0?(O={id:I.id,object:I,geometry:L,material:R,groupOrder:B,renderOrder:I.renderOrder,z:Z,group:V},c[e]=O):(O.id=I.id,O.object=I,O.geometry=L,O.material=R,O.groupOrder=B,O.renderOrder=I.renderOrder,O.z=Z,O.group=V),e++,O}function s(I,L,R,B,Z,V){const O=p(I,L,R,B,Z,V);R.transmission>0?r.push(O):R.transparent===!0?u.push(O):n.push(O)}function S(I,L,R,B,Z,V){const O=p(I,L,R,B,Z,V);R.transmission>0?r.unshift(O):R.transparent===!0?u.unshift(O):n.unshift(O)}function M(I,L){n.length>1&&n.sort(I||P3),r.length>1&&r.sort(L||m1),u.length>1&&u.sort(L||m1)}function C(){for(let I=e,L=c.length;I<L;I++){const R=c[I];if(R.id===null)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}}return{opaque:n,transmissive:r,transparent:u,init:f,push:s,unshift:S,finish:C,sort:M}}function I3(){let c=new WeakMap;function e(r,u){const f=c.get(r);let p;return f===void 0?(p=new g1,c.set(r,[p])):u>=f.length?(p=new g1,f.push(p)):p=f[u],p}function n(){c=new WeakMap}return{get:e,dispose:n}}function R3(){const c={};return{get:function(e){if(c[e.id]!==void 0)return c[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Ge,color:new vn};break;case"SpotLight":n={position:new Ge,direction:new Ge,color:new vn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ge,color:new vn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ge,skyColor:new vn,groundColor:new vn};break;case"RectAreaLight":n={color:new vn,position:new Ge,halfWidth:new Ge,halfHeight:new Ge};break}return c[e.id]=n,n}}}function L3(){const c={};return{get:function(e){if(c[e.id]!==void 0)return c[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ei};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ei};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ei,shadowCameraNear:1,shadowCameraFar:1e3};break}return c[e.id]=n,n}}}let D3=0;function k3(c,e){return(e.castShadow?2:0)-(c.castShadow?2:0)+(e.map?1:0)-(c.map?1:0)}function z3(c){const e=new R3,n=L3(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let M=0;M<9;M++)r.probe.push(new Ge);const u=new Ge,f=new dn,p=new dn;function s(M){let C=0,I=0,L=0;for(let ce=0;ce<9;ce++)r.probe[ce].set(0,0,0);let R=0,B=0,Z=0,V=0,O=0,ge=0,me=0,Q=0,de=0,fe=0,ye=0;M.sort(k3);for(let ce=0,ie=M.length;ce<ie;ce++){const Oe=M[ce],nt=Oe.color,Je=Oe.intensity,ut=Oe.distance,ht=Oe.shadow&&Oe.shadow.map?Oe.shadow.map.texture:null;if(Oe.isAmbientLight)C+=nt.r*Je,I+=nt.g*Je,L+=nt.b*Je;else if(Oe.isLightProbe){for(let ot=0;ot<9;ot++)r.probe[ot].addScaledVector(Oe.sh.coefficients[ot],Je);ye++}else if(Oe.isDirectionalLight){const ot=e.get(Oe);if(ot.color.copy(Oe.color).multiplyScalar(Oe.intensity),Oe.castShadow){const ft=Oe.shadow,tt=n.get(Oe);tt.shadowIntensity=ft.intensity,tt.shadowBias=ft.bias,tt.shadowNormalBias=ft.normalBias,tt.shadowRadius=ft.radius,tt.shadowMapSize=ft.mapSize,r.directionalShadow[R]=tt,r.directionalShadowMap[R]=ht,r.directionalShadowMatrix[R]=Oe.shadow.matrix,ge++}r.directional[R]=ot,R++}else if(Oe.isSpotLight){const ot=e.get(Oe);ot.position.setFromMatrixPosition(Oe.matrixWorld),ot.color.copy(nt).multiplyScalar(Je),ot.distance=ut,ot.coneCos=Math.cos(Oe.angle),ot.penumbraCos=Math.cos(Oe.angle*(1-Oe.penumbra)),ot.decay=Oe.decay,r.spot[Z]=ot;const ft=Oe.shadow;if(Oe.map&&(r.spotLightMap[de]=Oe.map,de++,ft.updateMatrices(Oe),Oe.castShadow&&fe++),r.spotLightMatrix[Z]=ft.matrix,Oe.castShadow){const tt=n.get(Oe);tt.shadowIntensity=ft.intensity,tt.shadowBias=ft.bias,tt.shadowNormalBias=ft.normalBias,tt.shadowRadius=ft.radius,tt.shadowMapSize=ft.mapSize,r.spotShadow[Z]=tt,r.spotShadowMap[Z]=ht,Q++}Z++}else if(Oe.isRectAreaLight){const ot=e.get(Oe);ot.color.copy(nt).multiplyScalar(Je),ot.halfWidth.set(Oe.width*.5,0,0),ot.halfHeight.set(0,Oe.height*.5,0),r.rectArea[V]=ot,V++}else if(Oe.isPointLight){const ot=e.get(Oe);if(ot.color.copy(Oe.color).multiplyScalar(Oe.intensity),ot.distance=Oe.distance,ot.decay=Oe.decay,Oe.castShadow){const ft=Oe.shadow,tt=n.get(Oe);tt.shadowIntensity=ft.intensity,tt.shadowBias=ft.bias,tt.shadowNormalBias=ft.normalBias,tt.shadowRadius=ft.radius,tt.shadowMapSize=ft.mapSize,tt.shadowCameraNear=ft.camera.near,tt.shadowCameraFar=ft.camera.far,r.pointShadow[B]=tt,r.pointShadowMap[B]=ht,r.pointShadowMatrix[B]=Oe.shadow.matrix,me++}r.point[B]=ot,B++}else if(Oe.isHemisphereLight){const ot=e.get(Oe);ot.skyColor.copy(Oe.color).multiplyScalar(Je),ot.groundColor.copy(Oe.groundColor).multiplyScalar(Je),r.hemi[O]=ot,O++}}V>0&&(c.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_FLOAT_1,r.rectAreaLTC2=Ot.LTC_FLOAT_2):(r.rectAreaLTC1=Ot.LTC_HALF_1,r.rectAreaLTC2=Ot.LTC_HALF_2)),r.ambient[0]=C,r.ambient[1]=I,r.ambient[2]=L;const ke=r.hash;(ke.directionalLength!==R||ke.pointLength!==B||ke.spotLength!==Z||ke.rectAreaLength!==V||ke.hemiLength!==O||ke.numDirectionalShadows!==ge||ke.numPointShadows!==me||ke.numSpotShadows!==Q||ke.numSpotMaps!==de||ke.numLightProbes!==ye)&&(r.directional.length=R,r.spot.length=Z,r.rectArea.length=V,r.point.length=B,r.hemi.length=O,r.directionalShadow.length=ge,r.directionalShadowMap.length=ge,r.pointShadow.length=me,r.pointShadowMap.length=me,r.spotShadow.length=Q,r.spotShadowMap.length=Q,r.directionalShadowMatrix.length=ge,r.pointShadowMatrix.length=me,r.spotLightMatrix.length=Q+de-fe,r.spotLightMap.length=de,r.numSpotLightShadowsWithMaps=fe,r.numLightProbes=ye,ke.directionalLength=R,ke.pointLength=B,ke.spotLength=Z,ke.rectAreaLength=V,ke.hemiLength=O,ke.numDirectionalShadows=ge,ke.numPointShadows=me,ke.numSpotShadows=Q,ke.numSpotMaps=de,ke.numLightProbes=ye,r.version=D3++)}function S(M,C){let I=0,L=0,R=0,B=0,Z=0;const V=C.matrixWorldInverse;for(let O=0,ge=M.length;O<ge;O++){const me=M[O];if(me.isDirectionalLight){const Q=r.directional[I];Q.direction.setFromMatrixPosition(me.matrixWorld),u.setFromMatrixPosition(me.target.matrixWorld),Q.direction.sub(u),Q.direction.transformDirection(V),I++}else if(me.isSpotLight){const Q=r.spot[R];Q.position.setFromMatrixPosition(me.matrixWorld),Q.position.applyMatrix4(V),Q.direction.setFromMatrixPosition(me.matrixWorld),u.setFromMatrixPosition(me.target.matrixWorld),Q.direction.sub(u),Q.direction.transformDirection(V),R++}else if(me.isRectAreaLight){const Q=r.rectArea[B];Q.position.setFromMatrixPosition(me.matrixWorld),Q.position.applyMatrix4(V),p.identity(),f.copy(me.matrixWorld),f.premultiply(V),p.extractRotation(f),Q.halfWidth.set(me.width*.5,0,0),Q.halfHeight.set(0,me.height*.5,0),Q.halfWidth.applyMatrix4(p),Q.halfHeight.applyMatrix4(p),B++}else if(me.isPointLight){const Q=r.point[L];Q.position.setFromMatrixPosition(me.matrixWorld),Q.position.applyMatrix4(V),L++}else if(me.isHemisphereLight){const Q=r.hemi[Z];Q.direction.setFromMatrixPosition(me.matrixWorld),Q.direction.transformDirection(V),Z++}}}return{setup:s,setupView:S,state:r}}function _1(c){const e=new z3(c),n=[],r=[];function u(C){M.camera=C,n.length=0,r.length=0}function f(C){n.push(C)}function p(C){r.push(C)}function s(){e.setup(n)}function S(C){e.setupView(n,C)}const M={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:u,state:M,setupLights:s,setupLightsView:S,pushLight:f,pushShadow:p}}function F3(c){let e=new WeakMap;function n(u,f=0){const p=e.get(u);let s;return p===void 0?(s=new _1(c),e.set(u,[s])):f>=p.length?(s=new _1(c),p.push(s)):s=p[f],s}function r(){e=new WeakMap}return{get:n,dispose:r}}const O3=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,N3=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function U3(c,e,n){let r=new xv;const u=new ei,f=new ei,p=new oi,s=new OP({depthPacking:CC}),S=new NP,M={},C=n.maxTextureSize,I={[ao]:ss,[ss]:ao,[wa]:wa},L=new tl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ei},radius:{value:4}},vertexShader:O3,fragmentShader:N3}),R=L.clone();R.defines.HORIZONTAL_PASS=1;const B=new Ia;B.setAttribute("position",new qr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Z=new rs(B,L),V=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ww;let O=this.type;this.render=function(fe,ye,ke){if(V.enabled===!1||V.autoUpdate===!1&&V.needsUpdate===!1||fe.length===0)return;const ce=c.getRenderTarget(),ie=c.getActiveCubeFace(),Oe=c.getActiveMipmapLevel(),nt=c.state;nt.setBlending(Qo),nt.buffers.color.setClear(1,1,1,1),nt.buffers.depth.setTest(!0),nt.setScissorTest(!1);const Je=O!==Ja&&this.type===Ja,ut=O===Ja&&this.type!==Ja;for(let ht=0,ot=fe.length;ht<ot;ht++){const ft=fe[ht],tt=ft.shadow;if(tt===void 0){console.warn("THREE.WebGLShadowMap:",ft,"has no shadow.");continue}if(tt.autoUpdate===!1&&tt.needsUpdate===!1)continue;u.copy(tt.mapSize);const It=tt.getFrameExtents();if(u.multiply(It),f.copy(tt.mapSize),(u.x>C||u.y>C)&&(u.x>C&&(f.x=Math.floor(C/It.x),u.x=f.x*It.x,tt.mapSize.x=f.x),u.y>C&&(f.y=Math.floor(C/It.y),u.y=f.y*It.y,tt.mapSize.y=f.y)),tt.map===null||Je===!0||ut===!0){const Wt=this.type!==Ja?{minFilter:Wr,magFilter:Wr}:{};tt.map!==null&&tt.map.dispose(),tt.map=new fc(u.x,u.y,Wt),tt.map.texture.name=ft.name+".shadowMap",tt.camera.updateProjectionMatrix()}c.setRenderTarget(tt.map),c.clear();const Ut=tt.getViewportCount();for(let Wt=0;Wt<Ut;Wt++){const $t=tt.getViewport(Wt);p.set(f.x*$t.x,f.y*$t.y,f.x*$t.z,f.y*$t.w),nt.viewport(p),tt.updateMatrices(ft,Wt),r=tt.getFrustum(),Q(ye,ke,tt.camera,ft,this.type)}tt.isPointLightShadow!==!0&&this.type===Ja&&ge(tt,ke),tt.needsUpdate=!1}O=this.type,V.needsUpdate=!1,c.setRenderTarget(ce,ie,Oe)};function ge(fe,ye){const ke=e.update(Z);L.defines.VSM_SAMPLES!==fe.blurSamples&&(L.defines.VSM_SAMPLES=fe.blurSamples,R.defines.VSM_SAMPLES=fe.blurSamples,L.needsUpdate=!0,R.needsUpdate=!0),fe.mapPass===null&&(fe.mapPass=new fc(u.x,u.y)),L.uniforms.shadow_pass.value=fe.map.texture,L.uniforms.resolution.value=fe.mapSize,L.uniforms.radius.value=fe.radius,c.setRenderTarget(fe.mapPass),c.clear(),c.renderBufferDirect(ye,null,ke,L,Z,null),R.uniforms.shadow_pass.value=fe.mapPass.texture,R.uniforms.resolution.value=fe.mapSize,R.uniforms.radius.value=fe.radius,c.setRenderTarget(fe.map),c.clear(),c.renderBufferDirect(ye,null,ke,R,Z,null)}function me(fe,ye,ke,ce){let ie=null;const Oe=ke.isPointLight===!0?fe.customDistanceMaterial:fe.customDepthMaterial;if(Oe!==void 0)ie=Oe;else if(ie=ke.isPointLight===!0?S:s,c.localClippingEnabled&&ye.clipShadows===!0&&Array.isArray(ye.clippingPlanes)&&ye.clippingPlanes.length!==0||ye.displacementMap&&ye.displacementScale!==0||ye.alphaMap&&ye.alphaTest>0||ye.map&&ye.alphaTest>0){const nt=ie.uuid,Je=ye.uuid;let ut=M[nt];ut===void 0&&(ut={},M[nt]=ut);let ht=ut[Je];ht===void 0&&(ht=ie.clone(),ut[Je]=ht,ye.addEventListener("dispose",de)),ie=ht}if(ie.visible=ye.visible,ie.wireframe=ye.wireframe,ce===Ja?ie.side=ye.shadowSide!==null?ye.shadowSide:ye.side:ie.side=ye.shadowSide!==null?ye.shadowSide:I[ye.side],ie.alphaMap=ye.alphaMap,ie.alphaTest=ye.alphaTest,ie.map=ye.map,ie.clipShadows=ye.clipShadows,ie.clippingPlanes=ye.clippingPlanes,ie.clipIntersection=ye.clipIntersection,ie.displacementMap=ye.displacementMap,ie.displacementScale=ye.displacementScale,ie.displacementBias=ye.displacementBias,ie.wireframeLinewidth=ye.wireframeLinewidth,ie.linewidth=ye.linewidth,ke.isPointLight===!0&&ie.isMeshDistanceMaterial===!0){const nt=c.properties.get(ie);nt.light=ke}return ie}function Q(fe,ye,ke,ce,ie){if(fe.visible===!1)return;if(fe.layers.test(ye.layers)&&(fe.isMesh||fe.isLine||fe.isPoints)&&(fe.castShadow||fe.receiveShadow&&ie===Ja)&&(!fe.frustumCulled||r.intersectsObject(fe))){fe.modelViewMatrix.multiplyMatrices(ke.matrixWorldInverse,fe.matrixWorld);const Je=e.update(fe),ut=fe.material;if(Array.isArray(ut)){const ht=Je.groups;for(let ot=0,ft=ht.length;ot<ft;ot++){const tt=ht[ot],It=ut[tt.materialIndex];if(It&&It.visible){const Ut=me(fe,It,ce,ie);fe.onBeforeShadow(c,fe,ye,ke,Je,Ut,tt),c.renderBufferDirect(ke,null,Je,Ut,fe,tt),fe.onAfterShadow(c,fe,ye,ke,Je,Ut,tt)}}}else if(ut.visible){const ht=me(fe,ut,ce,ie);fe.onBeforeShadow(c,fe,ye,ke,Je,ht,null),c.renderBufferDirect(ke,null,Je,ht,fe,null),fe.onAfterShadow(c,fe,ye,ke,Je,ht,null)}}const nt=fe.children;for(let Je=0,ut=nt.length;Je<ut;Je++)Q(nt[Je],ye,ke,ce,ie)}function de(fe){fe.target.removeEventListener("dispose",de);for(const ke in M){const ce=M[ke],ie=fe.target.uuid;ie in ce&&(ce[ie].dispose(),delete ce[ie])}}}const B3={[Z_]:X_,[Y_]:Q_,[K_]:ey,[Nu]:J_,[X_]:Z_,[Q_]:Y_,[ey]:K_,[J_]:Nu};function V3(c,e){function n(){let ne=!1;const _e=new oi;let xe=null;const Ee=new oi(0,0,0,0);return{setMask:function(Ie){xe!==Ie&&!ne&&(c.colorMask(Ie,Ie,Ie,Ie),xe=Ie)},setLocked:function(Ie){ne=Ie},setClear:function(Ie,Ue,be,dt,Nt){Nt===!0&&(Ie*=dt,Ue*=dt,be*=dt),_e.set(Ie,Ue,be,dt),Ee.equals(_e)===!1&&(c.clearColor(Ie,Ue,be,dt),Ee.copy(_e))},reset:function(){ne=!1,xe=null,Ee.set(-1,0,0,0)}}}function r(){let ne=!1,_e=!1,xe=null,Ee=null,Ie=null;return{setReversed:function(Ue){if(_e!==Ue){const be=e.get("EXT_clip_control");_e?be.clipControlEXT(be.LOWER_LEFT_EXT,be.ZERO_TO_ONE_EXT):be.clipControlEXT(be.LOWER_LEFT_EXT,be.NEGATIVE_ONE_TO_ONE_EXT);const dt=Ie;Ie=null,this.setClear(dt)}_e=Ue},getReversed:function(){return _e},setTest:function(Ue){Ue?Rt(c.DEPTH_TEST):on(c.DEPTH_TEST)},setMask:function(Ue){xe!==Ue&&!ne&&(c.depthMask(Ue),xe=Ue)},setFunc:function(Ue){if(_e&&(Ue=B3[Ue]),Ee!==Ue){switch(Ue){case Z_:c.depthFunc(c.NEVER);break;case X_:c.depthFunc(c.ALWAYS);break;case Y_:c.depthFunc(c.LESS);break;case Nu:c.depthFunc(c.LEQUAL);break;case K_:c.depthFunc(c.EQUAL);break;case J_:c.depthFunc(c.GEQUAL);break;case Q_:c.depthFunc(c.GREATER);break;case ey:c.depthFunc(c.NOTEQUAL);break;default:c.depthFunc(c.LEQUAL)}Ee=Ue}},setLocked:function(Ue){ne=Ue},setClear:function(Ue){Ie!==Ue&&(_e&&(Ue=1-Ue),c.clearDepth(Ue),Ie=Ue)},reset:function(){ne=!1,xe=null,Ee=null,Ie=null,_e=!1}}}function u(){let ne=!1,_e=null,xe=null,Ee=null,Ie=null,Ue=null,be=null,dt=null,Nt=null;return{setTest:function(pt){ne||(pt?Rt(c.STENCIL_TEST):on(c.STENCIL_TEST))},setMask:function(pt){_e!==pt&&!ne&&(c.stencilMask(pt),_e=pt)},setFunc:function(pt,Dt,Kt){(xe!==pt||Ee!==Dt||Ie!==Kt)&&(c.stencilFunc(pt,Dt,Kt),xe=pt,Ee=Dt,Ie=Kt)},setOp:function(pt,Dt,Kt){(Ue!==pt||be!==Dt||dt!==Kt)&&(c.stencilOp(pt,Dt,Kt),Ue=pt,be=Dt,dt=Kt)},setLocked:function(pt){ne=pt},setClear:function(pt){Nt!==pt&&(c.clearStencil(pt),Nt=pt)},reset:function(){ne=!1,_e=null,xe=null,Ee=null,Ie=null,Ue=null,be=null,dt=null,Nt=null}}}const f=new n,p=new r,s=new u,S=new WeakMap,M=new WeakMap;let C={},I={},L=new WeakMap,R=[],B=null,Z=!1,V=null,O=null,ge=null,me=null,Q=null,de=null,fe=null,ye=new vn(0,0,0),ke=0,ce=!1,ie=null,Oe=null,nt=null,Je=null,ut=null;const ht=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ot=!1,ft=0;const tt=c.getParameter(c.VERSION);tt.indexOf("WebGL")!==-1?(ft=parseFloat(/^WebGL (\d)/.exec(tt)[1]),ot=ft>=1):tt.indexOf("OpenGL ES")!==-1&&(ft=parseFloat(/^OpenGL ES (\d)/.exec(tt)[1]),ot=ft>=2);let It=null,Ut={};const Wt=c.getParameter(c.SCISSOR_BOX),$t=c.getParameter(c.VIEWPORT),Rn=new oi().fromArray(Wt),it=new oi().fromArray($t);function Tt(ne,_e,xe,Ee){const Ie=new Uint8Array(4),Ue=c.createTexture();c.bindTexture(ne,Ue),c.texParameteri(ne,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(ne,c.TEXTURE_MAG_FILTER,c.NEAREST);for(let be=0;be<xe;be++)ne===c.TEXTURE_3D||ne===c.TEXTURE_2D_ARRAY?c.texImage3D(_e,0,c.RGBA,1,1,Ee,0,c.RGBA,c.UNSIGNED_BYTE,Ie):c.texImage2D(_e+be,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,Ie);return Ue}const qt={};qt[c.TEXTURE_2D]=Tt(c.TEXTURE_2D,c.TEXTURE_2D,1),qt[c.TEXTURE_CUBE_MAP]=Tt(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),qt[c.TEXTURE_2D_ARRAY]=Tt(c.TEXTURE_2D_ARRAY,c.TEXTURE_2D_ARRAY,1,1),qt[c.TEXTURE_3D]=Tt(c.TEXTURE_3D,c.TEXTURE_3D,1,1),f.setClear(0,0,0,1),p.setClear(1),s.setClear(0),Rt(c.DEPTH_TEST),p.setFunc(Nu),bn(!1),cn(tb),Rt(c.CULL_FACE),Fe(Qo);function Rt(ne){C[ne]!==!0&&(c.enable(ne),C[ne]=!0)}function on(ne){C[ne]!==!1&&(c.disable(ne),C[ne]=!1)}function Xt(ne,_e){return I[ne]!==_e?(c.bindFramebuffer(ne,_e),I[ne]=_e,ne===c.DRAW_FRAMEBUFFER&&(I[c.FRAMEBUFFER]=_e),ne===c.FRAMEBUFFER&&(I[c.DRAW_FRAMEBUFFER]=_e),!0):!1}function yn(ne,_e){let xe=R,Ee=!1;if(ne){xe=L.get(_e),xe===void 0&&(xe=[],L.set(_e,xe));const Ie=ne.textures;if(xe.length!==Ie.length||xe[0]!==c.COLOR_ATTACHMENT0){for(let Ue=0,be=Ie.length;Ue<be;Ue++)xe[Ue]=c.COLOR_ATTACHMENT0+Ue;xe.length=Ie.length,Ee=!0}}else xe[0]!==c.BACK&&(xe[0]=c.BACK,Ee=!0);Ee&&c.drawBuffers(xe)}function Vn(ne){return B!==ne?(c.useProgram(ne),B=ne,!0):!1}const Ln={[tc]:c.FUNC_ADD,[JA]:c.FUNC_SUBTRACT,[QA]:c.FUNC_REVERSE_SUBTRACT};Ln[eC]=c.MIN,Ln[tC]=c.MAX;const pn={[nC]:c.ZERO,[iC]:c.ONE,[rC]:c.SRC_COLOR,[W_]:c.SRC_ALPHA,[uC]:c.SRC_ALPHA_SATURATE,[lC]:c.DST_COLOR,[aC]:c.DST_ALPHA,[sC]:c.ONE_MINUS_SRC_COLOR,[q_]:c.ONE_MINUS_SRC_ALPHA,[cC]:c.ONE_MINUS_DST_COLOR,[oC]:c.ONE_MINUS_DST_ALPHA,[hC]:c.CONSTANT_COLOR,[dC]:c.ONE_MINUS_CONSTANT_COLOR,[pC]:c.CONSTANT_ALPHA,[fC]:c.ONE_MINUS_CONSTANT_ALPHA};function Fe(ne,_e,xe,Ee,Ie,Ue,be,dt,Nt,pt){if(ne===Qo){Z===!0&&(on(c.BLEND),Z=!1);return}if(Z===!1&&(Rt(c.BLEND),Z=!0),ne!==KA){if(ne!==V||pt!==ce){if((O!==tc||Q!==tc)&&(c.blendEquation(c.FUNC_ADD),O=tc,Q=tc),pt)switch(ne){case Lu:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case nb:c.blendFunc(c.ONE,c.ONE);break;case ib:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case rb:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ne);break}else switch(ne){case Lu:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case nb:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case ib:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case rb:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ne);break}ge=null,me=null,de=null,fe=null,ye.set(0,0,0),ke=0,V=ne,ce=pt}return}Ie=Ie||_e,Ue=Ue||xe,be=be||Ee,(_e!==O||Ie!==Q)&&(c.blendEquationSeparate(Ln[_e],Ln[Ie]),O=_e,Q=Ie),(xe!==ge||Ee!==me||Ue!==de||be!==fe)&&(c.blendFuncSeparate(pn[xe],pn[Ee],pn[Ue],pn[be]),ge=xe,me=Ee,de=Ue,fe=be),(dt.equals(ye)===!1||Nt!==ke)&&(c.blendColor(dt.r,dt.g,dt.b,Nt),ye.copy(dt),ke=Nt),V=ne,ce=!1}function gi(ne,_e){ne.side===wa?on(c.CULL_FACE):Rt(c.CULL_FACE);let xe=ne.side===ss;_e&&(xe=!xe),bn(xe),ne.blending===Lu&&ne.transparent===!1?Fe(Qo):Fe(ne.blending,ne.blendEquation,ne.blendSrc,ne.blendDst,ne.blendEquationAlpha,ne.blendSrcAlpha,ne.blendDstAlpha,ne.blendColor,ne.blendAlpha,ne.premultipliedAlpha),p.setFunc(ne.depthFunc),p.setTest(ne.depthTest),p.setMask(ne.depthWrite),f.setMask(ne.colorWrite);const Ee=ne.stencilWrite;s.setTest(Ee),Ee&&(s.setMask(ne.stencilWriteMask),s.setFunc(ne.stencilFunc,ne.stencilRef,ne.stencilFuncMask),s.setOp(ne.stencilFail,ne.stencilZFail,ne.stencilZPass)),Tn(ne.polygonOffset,ne.polygonOffsetFactor,ne.polygonOffsetUnits),ne.alphaToCoverage===!0?Rt(c.SAMPLE_ALPHA_TO_COVERAGE):on(c.SAMPLE_ALPHA_TO_COVERAGE)}function bn(ne){ie!==ne&&(ne?c.frontFace(c.CW):c.frontFace(c.CCW),ie=ne)}function cn(ne){ne!==ZA?(Rt(c.CULL_FACE),ne!==Oe&&(ne===tb?c.cullFace(c.BACK):ne===XA?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))):on(c.CULL_FACE),Oe=ne}function Zt(ne){ne!==nt&&(ot&&c.lineWidth(ne),nt=ne)}function Tn(ne,_e,xe){ne?(Rt(c.POLYGON_OFFSET_FILL),(Je!==_e||ut!==xe)&&(c.polygonOffset(_e,xe),Je=_e,ut=xe)):on(c.POLYGON_OFFSET_FILL)}function Yt(ne){ne?Rt(c.SCISSOR_TEST):on(c.SCISSOR_TEST)}function ve(ne){ne===void 0&&(ne=c.TEXTURE0+ht-1),It!==ne&&(c.activeTexture(ne),It=ne)}function te(ne,_e,xe){xe===void 0&&(It===null?xe=c.TEXTURE0+ht-1:xe=It);let Ee=Ut[xe];Ee===void 0&&(Ee={type:void 0,texture:void 0},Ut[xe]=Ee),(Ee.type!==ne||Ee.texture!==_e)&&(It!==xe&&(c.activeTexture(xe),It=xe),c.bindTexture(ne,_e||qt[ne]),Ee.type=ne,Ee.texture=_e)}function Ze(){const ne=Ut[It];ne!==void 0&&ne.type!==void 0&&(c.bindTexture(ne.type,null),ne.type=void 0,ne.texture=void 0)}function ct(){try{c.compressedTexImage2D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function mt(){try{c.compressedTexImage3D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function rt(){try{c.texSubImage2D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function Vt(){try{c.texSubImage3D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function At(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function Gt(){try{c.compressedTexSubImage3D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function zn(){try{c.texStorage2D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function bt(){try{c.texStorage3D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function Ce(){try{c.texImage2D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function W(){try{c.texImage3D.apply(c,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function X(ne){Rn.equals(ne)===!1&&(c.scissor(ne.x,ne.y,ne.z,ne.w),Rn.copy(ne))}function J(ne){it.equals(ne)===!1&&(c.viewport(ne.x,ne.y,ne.z,ne.w),it.copy(ne))}function ue(ne,_e){let xe=M.get(_e);xe===void 0&&(xe=new WeakMap,M.set(_e,xe));let Ee=xe.get(ne);Ee===void 0&&(Ee=c.getUniformBlockIndex(_e,ne.name),xe.set(ne,Ee))}function Te(ne,_e){const Ee=M.get(_e).get(ne);S.get(_e)!==Ee&&(c.uniformBlockBinding(_e,Ee,ne.__bindingPointIndex),S.set(_e,Ee))}function De(){c.disable(c.BLEND),c.disable(c.CULL_FACE),c.disable(c.DEPTH_TEST),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SCISSOR_TEST),c.disable(c.STENCIL_TEST),c.disable(c.SAMPLE_ALPHA_TO_COVERAGE),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ZERO),c.blendFuncSeparate(c.ONE,c.ZERO,c.ONE,c.ZERO),c.blendColor(0,0,0,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(c.LESS),p.setReversed(!1),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(c.ALWAYS,0,4294967295),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),c.clearStencil(0),c.cullFace(c.BACK),c.frontFace(c.CCW),c.polygonOffset(0,0),c.activeTexture(c.TEXTURE0),c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),C={},It=null,Ut={},I={},L=new WeakMap,R=[],B=null,Z=!1,V=null,O=null,ge=null,me=null,Q=null,de=null,fe=null,ye=new vn(0,0,0),ke=0,ce=!1,ie=null,Oe=null,nt=null,Je=null,ut=null,Rn.set(0,0,c.canvas.width,c.canvas.height),it.set(0,0,c.canvas.width,c.canvas.height),f.reset(),p.reset(),s.reset()}return{buffers:{color:f,depth:p,stencil:s},enable:Rt,disable:on,bindFramebuffer:Xt,drawBuffers:yn,useProgram:Vn,setBlending:Fe,setMaterial:gi,setFlipSided:bn,setCullFace:cn,setLineWidth:Zt,setPolygonOffset:Tn,setScissorTest:Yt,activeTexture:ve,bindTexture:te,unbindTexture:Ze,compressedTexImage2D:ct,compressedTexImage3D:mt,texImage2D:Ce,texImage3D:W,updateUBOMapping:ue,uniformBlockBinding:Te,texStorage2D:zn,texStorage3D:bt,texSubImage2D:rt,texSubImage3D:Vt,compressedTexSubImage2D:At,compressedTexSubImage3D:Gt,scissor:X,viewport:J,reset:De}}function G3(c,e,n,r,u,f,p){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,S=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),M=new ei,C=new WeakMap;let I;const L=new WeakMap;let R=!1;try{R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function B(ve,te){return R?new OffscreenCanvas(ve,te):Hd("canvas")}function Z(ve,te,Ze){let ct=1;const mt=Yt(ve);if((mt.width>Ze||mt.height>Ze)&&(ct=Ze/Math.max(mt.width,mt.height)),ct<1)if(typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ve instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ve instanceof ImageBitmap||typeof VideoFrame<"u"&&ve instanceof VideoFrame){const rt=Math.floor(ct*mt.width),Vt=Math.floor(ct*mt.height);I===void 0&&(I=B(rt,Vt));const At=te?B(rt,Vt):I;return At.width=rt,At.height=Vt,At.getContext("2d").drawImage(ve,0,0,rt,Vt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+mt.width+"x"+mt.height+") to ("+rt+"x"+Vt+")."),At}else return"data"in ve&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+mt.width+"x"+mt.height+")."),ve;return ve}function V(ve){return ve.generateMipmaps}function O(ve){c.generateMipmap(ve)}function ge(ve){return ve.isWebGLCubeRenderTarget?c.TEXTURE_CUBE_MAP:ve.isWebGL3DRenderTarget?c.TEXTURE_3D:ve.isWebGLArrayRenderTarget||ve.isCompressedArrayTexture?c.TEXTURE_2D_ARRAY:c.TEXTURE_2D}function me(ve,te,Ze,ct,mt=!1){if(ve!==null){if(c[ve]!==void 0)return c[ve];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ve+"'")}let rt=te;if(te===c.RED&&(Ze===c.FLOAT&&(rt=c.R32F),Ze===c.HALF_FLOAT&&(rt=c.R16F),Ze===c.UNSIGNED_BYTE&&(rt=c.R8)),te===c.RED_INTEGER&&(Ze===c.UNSIGNED_BYTE&&(rt=c.R8UI),Ze===c.UNSIGNED_SHORT&&(rt=c.R16UI),Ze===c.UNSIGNED_INT&&(rt=c.R32UI),Ze===c.BYTE&&(rt=c.R8I),Ze===c.SHORT&&(rt=c.R16I),Ze===c.INT&&(rt=c.R32I)),te===c.RG&&(Ze===c.FLOAT&&(rt=c.RG32F),Ze===c.HALF_FLOAT&&(rt=c.RG16F),Ze===c.UNSIGNED_BYTE&&(rt=c.RG8)),te===c.RG_INTEGER&&(Ze===c.UNSIGNED_BYTE&&(rt=c.RG8UI),Ze===c.UNSIGNED_SHORT&&(rt=c.RG16UI),Ze===c.UNSIGNED_INT&&(rt=c.RG32UI),Ze===c.BYTE&&(rt=c.RG8I),Ze===c.SHORT&&(rt=c.RG16I),Ze===c.INT&&(rt=c.RG32I)),te===c.RGB_INTEGER&&(Ze===c.UNSIGNED_BYTE&&(rt=c.RGB8UI),Ze===c.UNSIGNED_SHORT&&(rt=c.RGB16UI),Ze===c.UNSIGNED_INT&&(rt=c.RGB32UI),Ze===c.BYTE&&(rt=c.RGB8I),Ze===c.SHORT&&(rt=c.RGB16I),Ze===c.INT&&(rt=c.RGB32I)),te===c.RGBA_INTEGER&&(Ze===c.UNSIGNED_BYTE&&(rt=c.RGBA8UI),Ze===c.UNSIGNED_SHORT&&(rt=c.RGBA16UI),Ze===c.UNSIGNED_INT&&(rt=c.RGBA32UI),Ze===c.BYTE&&(rt=c.RGBA8I),Ze===c.SHORT&&(rt=c.RGBA16I),Ze===c.INT&&(rt=c.RGBA32I)),te===c.RGB&&Ze===c.UNSIGNED_INT_5_9_9_9_REV&&(rt=c.RGB9_E5),te===c.RGBA){const Vt=mt?im:Qn.getTransfer(ct);Ze===c.FLOAT&&(rt=c.RGBA32F),Ze===c.HALF_FLOAT&&(rt=c.RGBA16F),Ze===c.UNSIGNED_BYTE&&(rt=Vt===mi?c.SRGB8_ALPHA8:c.RGBA8),Ze===c.UNSIGNED_SHORT_4_4_4_4&&(rt=c.RGBA4),Ze===c.UNSIGNED_SHORT_5_5_5_1&&(rt=c.RGB5_A1)}return(rt===c.R16F||rt===c.R32F||rt===c.RG16F||rt===c.RG32F||rt===c.RGBA16F||rt===c.RGBA32F)&&e.get("EXT_color_buffer_float"),rt}function Q(ve,te){let Ze;return ve?te===null||te===pc||te===Gu?Ze=c.DEPTH24_STENCIL8:te===ta?Ze=c.DEPTH32F_STENCIL8:te===Bd&&(Ze=c.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):te===null||te===pc||te===Gu?Ze=c.DEPTH_COMPONENT24:te===ta?Ze=c.DEPTH_COMPONENT32F:te===Bd&&(Ze=c.DEPTH_COMPONENT16),Ze}function de(ve,te){return V(ve)===!0||ve.isFramebufferTexture&&ve.minFilter!==Wr&&ve.minFilter!==bs?Math.log2(Math.max(te.width,te.height))+1:ve.mipmaps!==void 0&&ve.mipmaps.length>0?ve.mipmaps.length:ve.isCompressedTexture&&Array.isArray(ve.image)?te.mipmaps.length:1}function fe(ve){const te=ve.target;te.removeEventListener("dispose",fe),ke(te),te.isVideoTexture&&C.delete(te)}function ye(ve){const te=ve.target;te.removeEventListener("dispose",ye),ie(te)}function ke(ve){const te=r.get(ve);if(te.__webglInit===void 0)return;const Ze=ve.source,ct=L.get(Ze);if(ct){const mt=ct[te.__cacheKey];mt.usedTimes--,mt.usedTimes===0&&ce(ve),Object.keys(ct).length===0&&L.delete(Ze)}r.remove(ve)}function ce(ve){const te=r.get(ve);c.deleteTexture(te.__webglTexture);const Ze=ve.source,ct=L.get(Ze);delete ct[te.__cacheKey],p.memory.textures--}function ie(ve){const te=r.get(ve);if(ve.depthTexture&&(ve.depthTexture.dispose(),r.remove(ve.depthTexture)),ve.isWebGLCubeRenderTarget)for(let ct=0;ct<6;ct++){if(Array.isArray(te.__webglFramebuffer[ct]))for(let mt=0;mt<te.__webglFramebuffer[ct].length;mt++)c.deleteFramebuffer(te.__webglFramebuffer[ct][mt]);else c.deleteFramebuffer(te.__webglFramebuffer[ct]);te.__webglDepthbuffer&&c.deleteRenderbuffer(te.__webglDepthbuffer[ct])}else{if(Array.isArray(te.__webglFramebuffer))for(let ct=0;ct<te.__webglFramebuffer.length;ct++)c.deleteFramebuffer(te.__webglFramebuffer[ct]);else c.deleteFramebuffer(te.__webglFramebuffer);if(te.__webglDepthbuffer&&c.deleteRenderbuffer(te.__webglDepthbuffer),te.__webglMultisampledFramebuffer&&c.deleteFramebuffer(te.__webglMultisampledFramebuffer),te.__webglColorRenderbuffer)for(let ct=0;ct<te.__webglColorRenderbuffer.length;ct++)te.__webglColorRenderbuffer[ct]&&c.deleteRenderbuffer(te.__webglColorRenderbuffer[ct]);te.__webglDepthRenderbuffer&&c.deleteRenderbuffer(te.__webglDepthRenderbuffer)}const Ze=ve.textures;for(let ct=0,mt=Ze.length;ct<mt;ct++){const rt=r.get(Ze[ct]);rt.__webglTexture&&(c.deleteTexture(rt.__webglTexture),p.memory.textures--),r.remove(Ze[ct])}r.remove(ve)}let Oe=0;function nt(){Oe=0}function Je(){const ve=Oe;return ve>=u.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ve+" texture units while this GPU supports only "+u.maxTextures),Oe+=1,ve}function ut(ve){const te=[];return te.push(ve.wrapS),te.push(ve.wrapT),te.push(ve.wrapR||0),te.push(ve.magFilter),te.push(ve.minFilter),te.push(ve.anisotropy),te.push(ve.internalFormat),te.push(ve.format),te.push(ve.type),te.push(ve.generateMipmaps),te.push(ve.premultiplyAlpha),te.push(ve.flipY),te.push(ve.unpackAlignment),te.push(ve.colorSpace),te.join()}function ht(ve,te){const Ze=r.get(ve);if(ve.isVideoTexture&&Zt(ve),ve.isRenderTargetTexture===!1&&ve.version>0&&Ze.__version!==ve.version){const ct=ve.image;if(ct===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ct.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{it(Ze,ve,te);return}}n.bindTexture(c.TEXTURE_2D,Ze.__webglTexture,c.TEXTURE0+te)}function ot(ve,te){const Ze=r.get(ve);if(ve.version>0&&Ze.__version!==ve.version){it(Ze,ve,te);return}n.bindTexture(c.TEXTURE_2D_ARRAY,Ze.__webglTexture,c.TEXTURE0+te)}function ft(ve,te){const Ze=r.get(ve);if(ve.version>0&&Ze.__version!==ve.version){it(Ze,ve,te);return}n.bindTexture(c.TEXTURE_3D,Ze.__webglTexture,c.TEXTURE0+te)}function tt(ve,te){const Ze=r.get(ve);if(ve.version>0&&Ze.__version!==ve.version){Tt(Ze,ve,te);return}n.bindTexture(c.TEXTURE_CUBE_MAP,Ze.__webglTexture,c.TEXTURE0+te)}const It={[Vu]:c.REPEAT,[Ko]:c.CLAMP_TO_EDGE,[nm]:c.MIRRORED_REPEAT},Ut={[Wr]:c.NEAREST,[Xw]:c.NEAREST_MIPMAP_NEAREST,[Sd]:c.NEAREST_MIPMAP_LINEAR,[bs]:c.LINEAR,[Bf]:c.LINEAR_MIPMAP_NEAREST,[eo]:c.LINEAR_MIPMAP_LINEAR},Wt={[IC]:c.NEVER,[FC]:c.ALWAYS,[RC]:c.LESS,[oS]:c.LEQUAL,[LC]:c.EQUAL,[zC]:c.GEQUAL,[DC]:c.GREATER,[kC]:c.NOTEQUAL};function $t(ve,te){if(te.type===ta&&e.has("OES_texture_float_linear")===!1&&(te.magFilter===bs||te.magFilter===Bf||te.magFilter===Sd||te.magFilter===eo||te.minFilter===bs||te.minFilter===Bf||te.minFilter===Sd||te.minFilter===eo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),c.texParameteri(ve,c.TEXTURE_WRAP_S,It[te.wrapS]),c.texParameteri(ve,c.TEXTURE_WRAP_T,It[te.wrapT]),(ve===c.TEXTURE_3D||ve===c.TEXTURE_2D_ARRAY)&&c.texParameteri(ve,c.TEXTURE_WRAP_R,It[te.wrapR]),c.texParameteri(ve,c.TEXTURE_MAG_FILTER,Ut[te.magFilter]),c.texParameteri(ve,c.TEXTURE_MIN_FILTER,Ut[te.minFilter]),te.compareFunction&&(c.texParameteri(ve,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE),c.texParameteri(ve,c.TEXTURE_COMPARE_FUNC,Wt[te.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(te.magFilter===Wr||te.minFilter!==Sd&&te.minFilter!==eo||te.type===ta&&e.has("OES_texture_float_linear")===!1)return;if(te.anisotropy>1||r.get(te).__currentAnisotropy){const Ze=e.get("EXT_texture_filter_anisotropic");c.texParameterf(ve,Ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(te.anisotropy,u.getMaxAnisotropy())),r.get(te).__currentAnisotropy=te.anisotropy}}}function Rn(ve,te){let Ze=!1;ve.__webglInit===void 0&&(ve.__webglInit=!0,te.addEventListener("dispose",fe));const ct=te.source;let mt=L.get(ct);mt===void 0&&(mt={},L.set(ct,mt));const rt=ut(te);if(rt!==ve.__cacheKey){mt[rt]===void 0&&(mt[rt]={texture:c.createTexture(),usedTimes:0},p.memory.textures++,Ze=!0),mt[rt].usedTimes++;const Vt=mt[ve.__cacheKey];Vt!==void 0&&(mt[ve.__cacheKey].usedTimes--,Vt.usedTimes===0&&ce(te)),ve.__cacheKey=rt,ve.__webglTexture=mt[rt].texture}return Ze}function it(ve,te,Ze){let ct=c.TEXTURE_2D;(te.isDataArrayTexture||te.isCompressedArrayTexture)&&(ct=c.TEXTURE_2D_ARRAY),te.isData3DTexture&&(ct=c.TEXTURE_3D);const mt=Rn(ve,te),rt=te.source;n.bindTexture(ct,ve.__webglTexture,c.TEXTURE0+Ze);const Vt=r.get(rt);if(rt.version!==Vt.__version||mt===!0){n.activeTexture(c.TEXTURE0+Ze);const At=Qn.getPrimaries(Qn.workingColorSpace),Gt=te.colorSpace===Yo?null:Qn.getPrimaries(te.colorSpace),zn=te.colorSpace===Yo||At===Gt?c.NONE:c.BROWSER_DEFAULT_WEBGL;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,te.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,te.unpackAlignment),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,zn);let bt=Z(te.image,!1,u.maxTextureSize);bt=Tn(te,bt);const Ce=f.convert(te.format,te.colorSpace),W=f.convert(te.type);let X=me(te.internalFormat,Ce,W,te.colorSpace,te.isVideoTexture);$t(ct,te);let J;const ue=te.mipmaps,Te=te.isVideoTexture!==!0,De=Vt.__version===void 0||mt===!0,ne=rt.dataReady,_e=de(te,bt);if(te.isDepthTexture)X=Q(te.format===Hu,te.type),De&&(Te?n.texStorage2D(c.TEXTURE_2D,1,X,bt.width,bt.height):n.texImage2D(c.TEXTURE_2D,0,X,bt.width,bt.height,0,Ce,W,null));else if(te.isDataTexture)if(ue.length>0){Te&&De&&n.texStorage2D(c.TEXTURE_2D,_e,X,ue[0].width,ue[0].height);for(let xe=0,Ee=ue.length;xe<Ee;xe++)J=ue[xe],Te?ne&&n.texSubImage2D(c.TEXTURE_2D,xe,0,0,J.width,J.height,Ce,W,J.data):n.texImage2D(c.TEXTURE_2D,xe,X,J.width,J.height,0,Ce,W,J.data);te.generateMipmaps=!1}else Te?(De&&n.texStorage2D(c.TEXTURE_2D,_e,X,bt.width,bt.height),ne&&n.texSubImage2D(c.TEXTURE_2D,0,0,0,bt.width,bt.height,Ce,W,bt.data)):n.texImage2D(c.TEXTURE_2D,0,X,bt.width,bt.height,0,Ce,W,bt.data);else if(te.isCompressedTexture)if(te.isCompressedArrayTexture){Te&&De&&n.texStorage3D(c.TEXTURE_2D_ARRAY,_e,X,ue[0].width,ue[0].height,bt.depth);for(let xe=0,Ee=ue.length;xe<Ee;xe++)if(J=ue[xe],te.format!==ks)if(Ce!==null)if(Te){if(ne)if(te.layerUpdates.size>0){const Ie=qb(J.width,J.height,te.format,te.type);for(const Ue of te.layerUpdates){const be=J.data.subarray(Ue*Ie/J.data.BYTES_PER_ELEMENT,(Ue+1)*Ie/J.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(c.TEXTURE_2D_ARRAY,xe,0,0,Ue,J.width,J.height,1,Ce,be)}te.clearLayerUpdates()}else n.compressedTexSubImage3D(c.TEXTURE_2D_ARRAY,xe,0,0,0,J.width,J.height,bt.depth,Ce,J.data)}else n.compressedTexImage3D(c.TEXTURE_2D_ARRAY,xe,X,J.width,J.height,bt.depth,0,J.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Te?ne&&n.texSubImage3D(c.TEXTURE_2D_ARRAY,xe,0,0,0,J.width,J.height,bt.depth,Ce,W,J.data):n.texImage3D(c.TEXTURE_2D_ARRAY,xe,X,J.width,J.height,bt.depth,0,Ce,W,J.data)}else{Te&&De&&n.texStorage2D(c.TEXTURE_2D,_e,X,ue[0].width,ue[0].height);for(let xe=0,Ee=ue.length;xe<Ee;xe++)J=ue[xe],te.format!==ks?Ce!==null?Te?ne&&n.compressedTexSubImage2D(c.TEXTURE_2D,xe,0,0,J.width,J.height,Ce,J.data):n.compressedTexImage2D(c.TEXTURE_2D,xe,X,J.width,J.height,0,J.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Te?ne&&n.texSubImage2D(c.TEXTURE_2D,xe,0,0,J.width,J.height,Ce,W,J.data):n.texImage2D(c.TEXTURE_2D,xe,X,J.width,J.height,0,Ce,W,J.data)}else if(te.isDataArrayTexture)if(Te){if(De&&n.texStorage3D(c.TEXTURE_2D_ARRAY,_e,X,bt.width,bt.height,bt.depth),ne)if(te.layerUpdates.size>0){const xe=qb(bt.width,bt.height,te.format,te.type);for(const Ee of te.layerUpdates){const Ie=bt.data.subarray(Ee*xe/bt.data.BYTES_PER_ELEMENT,(Ee+1)*xe/bt.data.BYTES_PER_ELEMENT);n.texSubImage3D(c.TEXTURE_2D_ARRAY,0,0,0,Ee,bt.width,bt.height,1,Ce,W,Ie)}te.clearLayerUpdates()}else n.texSubImage3D(c.TEXTURE_2D_ARRAY,0,0,0,0,bt.width,bt.height,bt.depth,Ce,W,bt.data)}else n.texImage3D(c.TEXTURE_2D_ARRAY,0,X,bt.width,bt.height,bt.depth,0,Ce,W,bt.data);else if(te.isData3DTexture)Te?(De&&n.texStorage3D(c.TEXTURE_3D,_e,X,bt.width,bt.height,bt.depth),ne&&n.texSubImage3D(c.TEXTURE_3D,0,0,0,0,bt.width,bt.height,bt.depth,Ce,W,bt.data)):n.texImage3D(c.TEXTURE_3D,0,X,bt.width,bt.height,bt.depth,0,Ce,W,bt.data);else if(te.isFramebufferTexture){if(De)if(Te)n.texStorage2D(c.TEXTURE_2D,_e,X,bt.width,bt.height);else{let xe=bt.width,Ee=bt.height;for(let Ie=0;Ie<_e;Ie++)n.texImage2D(c.TEXTURE_2D,Ie,X,xe,Ee,0,Ce,W,null),xe>>=1,Ee>>=1}}else if(ue.length>0){if(Te&&De){const xe=Yt(ue[0]);n.texStorage2D(c.TEXTURE_2D,_e,X,xe.width,xe.height)}for(let xe=0,Ee=ue.length;xe<Ee;xe++)J=ue[xe],Te?ne&&n.texSubImage2D(c.TEXTURE_2D,xe,0,0,Ce,W,J):n.texImage2D(c.TEXTURE_2D,xe,X,Ce,W,J);te.generateMipmaps=!1}else if(Te){if(De){const xe=Yt(bt);n.texStorage2D(c.TEXTURE_2D,_e,X,xe.width,xe.height)}ne&&n.texSubImage2D(c.TEXTURE_2D,0,0,0,Ce,W,bt)}else n.texImage2D(c.TEXTURE_2D,0,X,Ce,W,bt);V(te)&&O(ct),Vt.__version=rt.version,te.onUpdate&&te.onUpdate(te)}ve.__version=te.version}function Tt(ve,te,Ze){if(te.image.length!==6)return;const ct=Rn(ve,te),mt=te.source;n.bindTexture(c.TEXTURE_CUBE_MAP,ve.__webglTexture,c.TEXTURE0+Ze);const rt=r.get(mt);if(mt.version!==rt.__version||ct===!0){n.activeTexture(c.TEXTURE0+Ze);const Vt=Qn.getPrimaries(Qn.workingColorSpace),At=te.colorSpace===Yo?null:Qn.getPrimaries(te.colorSpace),Gt=te.colorSpace===Yo||Vt===At?c.NONE:c.BROWSER_DEFAULT_WEBGL;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,te.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,te.unpackAlignment),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,Gt);const zn=te.isCompressedTexture||te.image[0].isCompressedTexture,bt=te.image[0]&&te.image[0].isDataTexture,Ce=[];for(let Ee=0;Ee<6;Ee++)!zn&&!bt?Ce[Ee]=Z(te.image[Ee],!0,u.maxCubemapSize):Ce[Ee]=bt?te.image[Ee].image:te.image[Ee],Ce[Ee]=Tn(te,Ce[Ee]);const W=Ce[0],X=f.convert(te.format,te.colorSpace),J=f.convert(te.type),ue=me(te.internalFormat,X,J,te.colorSpace),Te=te.isVideoTexture!==!0,De=rt.__version===void 0||ct===!0,ne=mt.dataReady;let _e=de(te,W);$t(c.TEXTURE_CUBE_MAP,te);let xe;if(zn){Te&&De&&n.texStorage2D(c.TEXTURE_CUBE_MAP,_e,ue,W.width,W.height);for(let Ee=0;Ee<6;Ee++){xe=Ce[Ee].mipmaps;for(let Ie=0;Ie<xe.length;Ie++){const Ue=xe[Ie];te.format!==ks?X!==null?Te?ne&&n.compressedTexSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie,0,0,Ue.width,Ue.height,X,Ue.data):n.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie,ue,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Te?ne&&n.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie,0,0,Ue.width,Ue.height,X,J,Ue.data):n.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie,ue,Ue.width,Ue.height,0,X,J,Ue.data)}}}else{if(xe=te.mipmaps,Te&&De){xe.length>0&&_e++;const Ee=Yt(Ce[0]);n.texStorage2D(c.TEXTURE_CUBE_MAP,_e,ue,Ee.width,Ee.height)}for(let Ee=0;Ee<6;Ee++)if(bt){Te?ne&&n.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,Ce[Ee].width,Ce[Ee].height,X,J,Ce[Ee].data):n.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,ue,Ce[Ee].width,Ce[Ee].height,0,X,J,Ce[Ee].data);for(let Ie=0;Ie<xe.length;Ie++){const be=xe[Ie].image[Ee].image;Te?ne&&n.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie+1,0,0,be.width,be.height,X,J,be.data):n.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie+1,ue,be.width,be.height,0,X,J,be.data)}}else{Te?ne&&n.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,X,J,Ce[Ee]):n.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,ue,X,J,Ce[Ee]);for(let Ie=0;Ie<xe.length;Ie++){const Ue=xe[Ie];Te?ne&&n.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie+1,0,0,X,J,Ue.image[Ee]):n.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ie+1,ue,X,J,Ue.image[Ee])}}}V(te)&&O(c.TEXTURE_CUBE_MAP),rt.__version=mt.version,te.onUpdate&&te.onUpdate(te)}ve.__version=te.version}function qt(ve,te,Ze,ct,mt,rt){const Vt=f.convert(Ze.format,Ze.colorSpace),At=f.convert(Ze.type),Gt=me(Ze.internalFormat,Vt,At,Ze.colorSpace),zn=r.get(te),bt=r.get(Ze);if(bt.__renderTarget=te,!zn.__hasExternalTextures){const Ce=Math.max(1,te.width>>rt),W=Math.max(1,te.height>>rt);mt===c.TEXTURE_3D||mt===c.TEXTURE_2D_ARRAY?n.texImage3D(mt,rt,Gt,Ce,W,te.depth,0,Vt,At,null):n.texImage2D(mt,rt,Gt,Ce,W,0,Vt,At,null)}n.bindFramebuffer(c.FRAMEBUFFER,ve),cn(te)?s.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,ct,mt,bt.__webglTexture,0,bn(te)):(mt===c.TEXTURE_2D||mt>=c.TEXTURE_CUBE_MAP_POSITIVE_X&&mt<=c.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&c.framebufferTexture2D(c.FRAMEBUFFER,ct,mt,bt.__webglTexture,rt),n.bindFramebuffer(c.FRAMEBUFFER,null)}function Rt(ve,te,Ze){if(c.bindRenderbuffer(c.RENDERBUFFER,ve),te.depthBuffer){const ct=te.depthTexture,mt=ct&&ct.isDepthTexture?ct.type:null,rt=Q(te.stencilBuffer,mt),Vt=te.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,At=bn(te);cn(te)?s.renderbufferStorageMultisampleEXT(c.RENDERBUFFER,At,rt,te.width,te.height):Ze?c.renderbufferStorageMultisample(c.RENDERBUFFER,At,rt,te.width,te.height):c.renderbufferStorage(c.RENDERBUFFER,rt,te.width,te.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,Vt,c.RENDERBUFFER,ve)}else{const ct=te.textures;for(let mt=0;mt<ct.length;mt++){const rt=ct[mt],Vt=f.convert(rt.format,rt.colorSpace),At=f.convert(rt.type),Gt=me(rt.internalFormat,Vt,At,rt.colorSpace),zn=bn(te);Ze&&cn(te)===!1?c.renderbufferStorageMultisample(c.RENDERBUFFER,zn,Gt,te.width,te.height):cn(te)?s.renderbufferStorageMultisampleEXT(c.RENDERBUFFER,zn,Gt,te.width,te.height):c.renderbufferStorage(c.RENDERBUFFER,Gt,te.width,te.height)}}c.bindRenderbuffer(c.RENDERBUFFER,null)}function on(ve,te){if(te&&te.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(c.FRAMEBUFFER,ve),!(te.depthTexture&&te.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ct=r.get(te.depthTexture);ct.__renderTarget=te,(!ct.__webglTexture||te.depthTexture.image.width!==te.width||te.depthTexture.image.height!==te.height)&&(te.depthTexture.image.width=te.width,te.depthTexture.image.height=te.height,te.depthTexture.needsUpdate=!0),ht(te.depthTexture,0);const mt=ct.__webglTexture,rt=bn(te);if(te.depthTexture.format===Du)cn(te)?s.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,mt,0,rt):c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,mt,0);else if(te.depthTexture.format===Hu)cn(te)?s.framebufferTexture2DMultisampleEXT(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,mt,0,rt):c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,mt,0);else throw new Error("Unknown depthTexture format")}function Xt(ve){const te=r.get(ve),Ze=ve.isWebGLCubeRenderTarget===!0;if(te.__boundDepthTexture!==ve.depthTexture){const ct=ve.depthTexture;if(te.__depthDisposeCallback&&te.__depthDisposeCallback(),ct){const mt=()=>{delete te.__boundDepthTexture,delete te.__depthDisposeCallback,ct.removeEventListener("dispose",mt)};ct.addEventListener("dispose",mt),te.__depthDisposeCallback=mt}te.__boundDepthTexture=ct}if(ve.depthTexture&&!te.__autoAllocateDepthBuffer){if(Ze)throw new Error("target.depthTexture not supported in Cube render targets");on(te.__webglFramebuffer,ve)}else if(Ze){te.__webglDepthbuffer=[];for(let ct=0;ct<6;ct++)if(n.bindFramebuffer(c.FRAMEBUFFER,te.__webglFramebuffer[ct]),te.__webglDepthbuffer[ct]===void 0)te.__webglDepthbuffer[ct]=c.createRenderbuffer(),Rt(te.__webglDepthbuffer[ct],ve,!1);else{const mt=ve.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,rt=te.__webglDepthbuffer[ct];c.bindRenderbuffer(c.RENDERBUFFER,rt),c.framebufferRenderbuffer(c.FRAMEBUFFER,mt,c.RENDERBUFFER,rt)}}else if(n.bindFramebuffer(c.FRAMEBUFFER,te.__webglFramebuffer),te.__webglDepthbuffer===void 0)te.__webglDepthbuffer=c.createRenderbuffer(),Rt(te.__webglDepthbuffer,ve,!1);else{const ct=ve.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,mt=te.__webglDepthbuffer;c.bindRenderbuffer(c.RENDERBUFFER,mt),c.framebufferRenderbuffer(c.FRAMEBUFFER,ct,c.RENDERBUFFER,mt)}n.bindFramebuffer(c.FRAMEBUFFER,null)}function yn(ve,te,Ze){const ct=r.get(ve);te!==void 0&&qt(ct.__webglFramebuffer,ve,ve.texture,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,0),Ze!==void 0&&Xt(ve)}function Vn(ve){const te=ve.texture,Ze=r.get(ve),ct=r.get(te);ve.addEventListener("dispose",ye);const mt=ve.textures,rt=ve.isWebGLCubeRenderTarget===!0,Vt=mt.length>1;if(Vt||(ct.__webglTexture===void 0&&(ct.__webglTexture=c.createTexture()),ct.__version=te.version,p.memory.textures++),rt){Ze.__webglFramebuffer=[];for(let At=0;At<6;At++)if(te.mipmaps&&te.mipmaps.length>0){Ze.__webglFramebuffer[At]=[];for(let Gt=0;Gt<te.mipmaps.length;Gt++)Ze.__webglFramebuffer[At][Gt]=c.createFramebuffer()}else Ze.__webglFramebuffer[At]=c.createFramebuffer()}else{if(te.mipmaps&&te.mipmaps.length>0){Ze.__webglFramebuffer=[];for(let At=0;At<te.mipmaps.length;At++)Ze.__webglFramebuffer[At]=c.createFramebuffer()}else Ze.__webglFramebuffer=c.createFramebuffer();if(Vt)for(let At=0,Gt=mt.length;At<Gt;At++){const zn=r.get(mt[At]);zn.__webglTexture===void 0&&(zn.__webglTexture=c.createTexture(),p.memory.textures++)}if(ve.samples>0&&cn(ve)===!1){Ze.__webglMultisampledFramebuffer=c.createFramebuffer(),Ze.__webglColorRenderbuffer=[],n.bindFramebuffer(c.FRAMEBUFFER,Ze.__webglMultisampledFramebuffer);for(let At=0;At<mt.length;At++){const Gt=mt[At];Ze.__webglColorRenderbuffer[At]=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,Ze.__webglColorRenderbuffer[At]);const zn=f.convert(Gt.format,Gt.colorSpace),bt=f.convert(Gt.type),Ce=me(Gt.internalFormat,zn,bt,Gt.colorSpace,ve.isXRRenderTarget===!0),W=bn(ve);c.renderbufferStorageMultisample(c.RENDERBUFFER,W,Ce,ve.width,ve.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+At,c.RENDERBUFFER,Ze.__webglColorRenderbuffer[At])}c.bindRenderbuffer(c.RENDERBUFFER,null),ve.depthBuffer&&(Ze.__webglDepthRenderbuffer=c.createRenderbuffer(),Rt(Ze.__webglDepthRenderbuffer,ve,!0)),n.bindFramebuffer(c.FRAMEBUFFER,null)}}if(rt){n.bindTexture(c.TEXTURE_CUBE_MAP,ct.__webglTexture),$t(c.TEXTURE_CUBE_MAP,te);for(let At=0;At<6;At++)if(te.mipmaps&&te.mipmaps.length>0)for(let Gt=0;Gt<te.mipmaps.length;Gt++)qt(Ze.__webglFramebuffer[At][Gt],ve,te,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+At,Gt);else qt(Ze.__webglFramebuffer[At],ve,te,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+At,0);V(te)&&O(c.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Vt){for(let At=0,Gt=mt.length;At<Gt;At++){const zn=mt[At],bt=r.get(zn);n.bindTexture(c.TEXTURE_2D,bt.__webglTexture),$t(c.TEXTURE_2D,zn),qt(Ze.__webglFramebuffer,ve,zn,c.COLOR_ATTACHMENT0+At,c.TEXTURE_2D,0),V(zn)&&O(c.TEXTURE_2D)}n.unbindTexture()}else{let At=c.TEXTURE_2D;if((ve.isWebGL3DRenderTarget||ve.isWebGLArrayRenderTarget)&&(At=ve.isWebGL3DRenderTarget?c.TEXTURE_3D:c.TEXTURE_2D_ARRAY),n.bindTexture(At,ct.__webglTexture),$t(At,te),te.mipmaps&&te.mipmaps.length>0)for(let Gt=0;Gt<te.mipmaps.length;Gt++)qt(Ze.__webglFramebuffer[Gt],ve,te,c.COLOR_ATTACHMENT0,At,Gt);else qt(Ze.__webglFramebuffer,ve,te,c.COLOR_ATTACHMENT0,At,0);V(te)&&O(At),n.unbindTexture()}ve.depthBuffer&&Xt(ve)}function Ln(ve){const te=ve.textures;for(let Ze=0,ct=te.length;Ze<ct;Ze++){const mt=te[Ze];if(V(mt)){const rt=ge(ve),Vt=r.get(mt).__webglTexture;n.bindTexture(rt,Vt),O(rt),n.unbindTexture()}}}const pn=[],Fe=[];function gi(ve){if(ve.samples>0){if(cn(ve)===!1){const te=ve.textures,Ze=ve.width,ct=ve.height;let mt=c.COLOR_BUFFER_BIT;const rt=ve.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,Vt=r.get(ve),At=te.length>1;if(At)for(let Gt=0;Gt<te.length;Gt++)n.bindFramebuffer(c.FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+Gt,c.RENDERBUFFER,null),n.bindFramebuffer(c.FRAMEBUFFER,Vt.__webglFramebuffer),c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0+Gt,c.TEXTURE_2D,null,0);n.bindFramebuffer(c.READ_FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),n.bindFramebuffer(c.DRAW_FRAMEBUFFER,Vt.__webglFramebuffer);for(let Gt=0;Gt<te.length;Gt++){if(ve.resolveDepthBuffer&&(ve.depthBuffer&&(mt|=c.DEPTH_BUFFER_BIT),ve.stencilBuffer&&ve.resolveStencilBuffer&&(mt|=c.STENCIL_BUFFER_BIT)),At){c.framebufferRenderbuffer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.RENDERBUFFER,Vt.__webglColorRenderbuffer[Gt]);const zn=r.get(te[Gt]).__webglTexture;c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,zn,0)}c.blitFramebuffer(0,0,Ze,ct,0,0,Ze,ct,mt,c.NEAREST),S===!0&&(pn.length=0,Fe.length=0,pn.push(c.COLOR_ATTACHMENT0+Gt),ve.depthBuffer&&ve.resolveDepthBuffer===!1&&(pn.push(rt),Fe.push(rt),c.invalidateFramebuffer(c.DRAW_FRAMEBUFFER,Fe)),c.invalidateFramebuffer(c.READ_FRAMEBUFFER,pn))}if(n.bindFramebuffer(c.READ_FRAMEBUFFER,null),n.bindFramebuffer(c.DRAW_FRAMEBUFFER,null),At)for(let Gt=0;Gt<te.length;Gt++){n.bindFramebuffer(c.FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0+Gt,c.RENDERBUFFER,Vt.__webglColorRenderbuffer[Gt]);const zn=r.get(te[Gt]).__webglTexture;n.bindFramebuffer(c.FRAMEBUFFER,Vt.__webglFramebuffer),c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0+Gt,c.TEXTURE_2D,zn,0)}n.bindFramebuffer(c.DRAW_FRAMEBUFFER,Vt.__webglMultisampledFramebuffer)}else if(ve.depthBuffer&&ve.resolveDepthBuffer===!1&&S){const te=ve.stencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT;c.invalidateFramebuffer(c.DRAW_FRAMEBUFFER,[te])}}}function bn(ve){return Math.min(u.maxSamples,ve.samples)}function cn(ve){const te=r.get(ve);return ve.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&te.__useRenderToTexture!==!1}function Zt(ve){const te=p.render.frame;C.get(ve)!==te&&(C.set(ve,te),ve.update())}function Tn(ve,te){const Ze=ve.colorSpace,ct=ve.format,mt=ve.type;return ve.isCompressedTexture===!0||ve.isVideoTexture===!0||Ze!==Zr&&Ze!==Yo&&(Qn.getTransfer(Ze)===mi?(ct!==ks||mt!==oo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ze)),te}function Yt(ve){return typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement?(M.width=ve.naturalWidth||ve.width,M.height=ve.naturalHeight||ve.height):typeof VideoFrame<"u"&&ve instanceof VideoFrame?(M.width=ve.displayWidth,M.height=ve.displayHeight):(M.width=ve.width,M.height=ve.height),M}this.allocateTextureUnit=Je,this.resetTextureUnits=nt,this.setTexture2D=ht,this.setTexture2DArray=ot,this.setTexture3D=ft,this.setTextureCube=tt,this.rebindTextures=yn,this.setupRenderTarget=Vn,this.updateRenderTargetMipmap=Ln,this.updateMultisampleRenderTarget=gi,this.setupDepthRenderbuffer=Xt,this.setupFrameBufferTexture=qt,this.useMultisampledRTT=cn}function H3(c,e){function n(r,u=Yo){let f;const p=Qn.getTransfer(u);if(r===oo)return c.UNSIGNED_BYTE;if(r===uv)return c.UNSIGNED_SHORT_4_4_4_4;if(r===hv)return c.UNSIGNED_SHORT_5_5_5_1;if(r===Jw)return c.UNSIGNED_INT_5_9_9_9_REV;if(r===Yw)return c.BYTE;if(r===Kw)return c.SHORT;if(r===Bd)return c.UNSIGNED_SHORT;if(r===cv)return c.INT;if(r===pc)return c.UNSIGNED_INT;if(r===ta)return c.FLOAT;if(r===Xd)return c.HALF_FLOAT;if(r===Qw)return c.ALPHA;if(r===eS)return c.RGB;if(r===ks)return c.RGBA;if(r===tS)return c.LUMINANCE;if(r===nS)return c.LUMINANCE_ALPHA;if(r===Du)return c.DEPTH_COMPONENT;if(r===Hu)return c.DEPTH_STENCIL;if(r===dv)return c.RED;if(r===pv)return c.RED_INTEGER;if(r===iS)return c.RG;if(r===fv)return c.RG_INTEGER;if(r===mv)return c.RGBA_INTEGER;if(r===Vf||r===Gf||r===Hf||r===jf)if(p===mi)if(f=e.get("WEBGL_compressed_texture_s3tc_srgb"),f!==null){if(r===Vf)return f.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Gf)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Hf)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===jf)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(f=e.get("WEBGL_compressed_texture_s3tc"),f!==null){if(r===Vf)return f.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Gf)return f.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Hf)return f.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===jf)return f.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===iy||r===ry||r===sy||r===ay)if(f=e.get("WEBGL_compressed_texture_pvrtc"),f!==null){if(r===iy)return f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===ry)return f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===sy)return f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===ay)return f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===oy||r===ly||r===cy)if(f=e.get("WEBGL_compressed_texture_etc"),f!==null){if(r===oy||r===ly)return p===mi?f.COMPRESSED_SRGB8_ETC2:f.COMPRESSED_RGB8_ETC2;if(r===cy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:f.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===uy||r===hy||r===dy||r===py||r===fy||r===my||r===gy||r===_y||r===yy||r===vy||r===xy||r===by||r===wy||r===Sy)if(f=e.get("WEBGL_compressed_texture_astc"),f!==null){if(r===uy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:f.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===hy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:f.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===dy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:f.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===py)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:f.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===fy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:f.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===my)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:f.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===gy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:f.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===_y)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:f.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===yy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:f.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===vy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:f.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===xy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:f.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===by)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:f.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===wy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:f.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Sy)return p===mi?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:f.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===$f||r===My||r===Ty)if(f=e.get("EXT_texture_compression_bptc"),f!==null){if(r===$f)return p===mi?f.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:f.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===My)return f.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===Ty)return f.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===rS||r===Ey||r===Ay||r===Cy)if(f=e.get("EXT_texture_compression_rgtc"),f!==null){if(r===$f)return f.COMPRESSED_RED_RGTC1_EXT;if(r===Ey)return f.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Ay)return f.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===Cy)return f.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Gu?c.UNSIGNED_INT_24_8:c[r]!==void 0?c[r]:null}return{convert:n}}const j3={type:"move"};class A_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new sc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new sc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ge,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ge),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new sc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ge,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ge),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let u=null,f=null,p=null;const s=this._targetRay,S=this._grip,M=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(M&&e.hand){p=!0;for(const Z of e.hand.values()){const V=n.getJointPose(Z,r),O=this._getHandJoint(M,Z);V!==null&&(O.matrix.fromArray(V.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.matrixWorldNeedsUpdate=!0,O.jointRadius=V.radius),O.visible=V!==null}const C=M.joints["index-finger-tip"],I=M.joints["thumb-tip"],L=C.position.distanceTo(I.position),R=.02,B=.005;M.inputState.pinching&&L>R+B?(M.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!M.inputState.pinching&&L<=R-B&&(M.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else S!==null&&e.gripSpace&&(f=n.getPose(e.gripSpace,r),f!==null&&(S.matrix.fromArray(f.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,f.linearVelocity?(S.hasLinearVelocity=!0,S.linearVelocity.copy(f.linearVelocity)):S.hasLinearVelocity=!1,f.angularVelocity?(S.hasAngularVelocity=!0,S.angularVelocity.copy(f.angularVelocity)):S.hasAngularVelocity=!1));s!==null&&(u=n.getPose(e.targetRaySpace,r),u===null&&f!==null&&(u=f),u!==null&&(s.matrix.fromArray(u.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,u.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(u.linearVelocity)):s.hasLinearVelocity=!1,u.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(u.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(j3)))}return s!==null&&(s.visible=u!==null),S!==null&&(S.visible=f!==null),M!==null&&(M.visible=p!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new sc;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}const $3=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,W3=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class q3{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const u=new yr,f=e.properties.get(u);f.__webglTexture=n.texture,(n.depthNear!==r.depthNear||n.depthFar!==r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=u}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new tl({vertexShader:$3,fragmentShader:W3,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new rs(new xm(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Z3 extends Ju{constructor(e,n){super();const r=this;let u=null,f=1,p=null,s="local-floor",S=1,M=null,C=null,I=null,L=null,R=null,B=null;const Z=new q3,V=n.getContextAttributes();let O=null,ge=null;const me=[],Q=[],de=new ei;let fe=null;const ye=new is;ye.viewport=new oi;const ke=new is;ke.viewport=new oi;const ce=[ye,ke],ie=new aI;let Oe=null,nt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(it){let Tt=me[it];return Tt===void 0&&(Tt=new A_,me[it]=Tt),Tt.getTargetRaySpace()},this.getControllerGrip=function(it){let Tt=me[it];return Tt===void 0&&(Tt=new A_,me[it]=Tt),Tt.getGripSpace()},this.getHand=function(it){let Tt=me[it];return Tt===void 0&&(Tt=new A_,me[it]=Tt),Tt.getHandSpace()};function Je(it){const Tt=Q.indexOf(it.inputSource);if(Tt===-1)return;const qt=me[Tt];qt!==void 0&&(qt.update(it.inputSource,it.frame,M||p),qt.dispatchEvent({type:it.type,data:it.inputSource}))}function ut(){u.removeEventListener("select",Je),u.removeEventListener("selectstart",Je),u.removeEventListener("selectend",Je),u.removeEventListener("squeeze",Je),u.removeEventListener("squeezestart",Je),u.removeEventListener("squeezeend",Je),u.removeEventListener("end",ut),u.removeEventListener("inputsourceschange",ht);for(let it=0;it<me.length;it++){const Tt=Q[it];Tt!==null&&(Q[it]=null,me[it].disconnect(Tt))}Oe=null,nt=null,Z.reset(),e.setRenderTarget(O),R=null,L=null,I=null,u=null,ge=null,Rn.stop(),r.isPresenting=!1,e.setPixelRatio(fe),e.setSize(de.width,de.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(it){f=it,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(it){s=it,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return M||p},this.setReferenceSpace=function(it){M=it},this.getBaseLayer=function(){return L!==null?L:R},this.getBinding=function(){return I},this.getFrame=function(){return B},this.getSession=function(){return u},this.setSession=async function(it){if(u=it,u!==null){if(O=e.getRenderTarget(),u.addEventListener("select",Je),u.addEventListener("selectstart",Je),u.addEventListener("selectend",Je),u.addEventListener("squeeze",Je),u.addEventListener("squeezestart",Je),u.addEventListener("squeezeend",Je),u.addEventListener("end",ut),u.addEventListener("inputsourceschange",ht),V.xrCompatible!==!0&&await n.makeXRCompatible(),fe=e.getPixelRatio(),e.getSize(de),u.enabledFeatures!==void 0&&u.enabledFeatures.includes("layers")){let qt=null,Rt=null,on=null;V.depth&&(on=V.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,qt=V.stencil?Hu:Du,Rt=V.stencil?Gu:pc);const Xt={colorFormat:n.RGBA8,depthFormat:on,scaleFactor:f};I=new XRWebGLBinding(u,n),L=I.createProjectionLayer(Xt),u.updateRenderState({layers:[L]}),e.setPixelRatio(1),e.setSize(L.textureWidth,L.textureHeight,!1),ge=new fc(L.textureWidth,L.textureHeight,{format:ks,type:oo,depthTexture:new wS(L.textureWidth,L.textureHeight,Rt,void 0,void 0,void 0,void 0,void 0,void 0,qt),stencilBuffer:V.stencil,colorSpace:e.outputColorSpace,samples:V.antialias?4:0,resolveDepthBuffer:L.ignoreDepthValues===!1})}else{const qt={antialias:V.antialias,alpha:!0,depth:V.depth,stencil:V.stencil,framebufferScaleFactor:f};R=new XRWebGLLayer(u,n,qt),u.updateRenderState({baseLayer:R}),e.setPixelRatio(1),e.setSize(R.framebufferWidth,R.framebufferHeight,!1),ge=new fc(R.framebufferWidth,R.framebufferHeight,{format:ks,type:oo,colorSpace:e.outputColorSpace,stencilBuffer:V.stencil})}ge.isXRRenderTarget=!0,this.setFoveation(S),M=null,p=await u.requestReferenceSpace(s),Rn.setContext(u),Rn.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(u!==null)return u.environmentBlendMode},this.getDepthTexture=function(){return Z.getDepthTexture()};function ht(it){for(let Tt=0;Tt<it.removed.length;Tt++){const qt=it.removed[Tt],Rt=Q.indexOf(qt);Rt>=0&&(Q[Rt]=null,me[Rt].disconnect(qt))}for(let Tt=0;Tt<it.added.length;Tt++){const qt=it.added[Tt];let Rt=Q.indexOf(qt);if(Rt===-1){for(let Xt=0;Xt<me.length;Xt++)if(Xt>=Q.length){Q.push(qt),Rt=Xt;break}else if(Q[Xt]===null){Q[Xt]=qt,Rt=Xt;break}if(Rt===-1)break}const on=me[Rt];on&&on.connect(qt)}}const ot=new Ge,ft=new Ge;function tt(it,Tt,qt){ot.setFromMatrixPosition(Tt.matrixWorld),ft.setFromMatrixPosition(qt.matrixWorld);const Rt=ot.distanceTo(ft),on=Tt.projectionMatrix.elements,Xt=qt.projectionMatrix.elements,yn=on[14]/(on[10]-1),Vn=on[14]/(on[10]+1),Ln=(on[9]+1)/on[5],pn=(on[9]-1)/on[5],Fe=(on[8]-1)/on[0],gi=(Xt[8]+1)/Xt[0],bn=yn*Fe,cn=yn*gi,Zt=Rt/(-Fe+gi),Tn=Zt*-Fe;if(Tt.matrixWorld.decompose(it.position,it.quaternion,it.scale),it.translateX(Tn),it.translateZ(Zt),it.matrixWorld.compose(it.position,it.quaternion,it.scale),it.matrixWorldInverse.copy(it.matrixWorld).invert(),on[10]===-1)it.projectionMatrix.copy(Tt.projectionMatrix),it.projectionMatrixInverse.copy(Tt.projectionMatrixInverse);else{const Yt=yn+Zt,ve=Vn+Zt,te=bn-Tn,Ze=cn+(Rt-Tn),ct=Ln*Vn/ve*Yt,mt=pn*Vn/ve*Yt;it.projectionMatrix.makePerspective(te,Ze,ct,mt,Yt,ve),it.projectionMatrixInverse.copy(it.projectionMatrix).invert()}}function It(it,Tt){Tt===null?it.matrixWorld.copy(it.matrix):it.matrixWorld.multiplyMatrices(Tt.matrixWorld,it.matrix),it.matrixWorldInverse.copy(it.matrixWorld).invert()}this.updateCamera=function(it){if(u===null)return;let Tt=it.near,qt=it.far;Z.texture!==null&&(Z.depthNear>0&&(Tt=Z.depthNear),Z.depthFar>0&&(qt=Z.depthFar)),ie.near=ke.near=ye.near=Tt,ie.far=ke.far=ye.far=qt,(Oe!==ie.near||nt!==ie.far)&&(u.updateRenderState({depthNear:ie.near,depthFar:ie.far}),Oe=ie.near,nt=ie.far),ye.layers.mask=it.layers.mask|2,ke.layers.mask=it.layers.mask|4,ie.layers.mask=ye.layers.mask|ke.layers.mask;const Rt=it.parent,on=ie.cameras;It(ie,Rt);for(let Xt=0;Xt<on.length;Xt++)It(on[Xt],Rt);on.length===2?tt(ie,ye,ke):ie.projectionMatrix.copy(ye.projectionMatrix),Ut(it,ie,Rt)};function Ut(it,Tt,qt){qt===null?it.matrix.copy(Tt.matrixWorld):(it.matrix.copy(qt.matrixWorld),it.matrix.invert(),it.matrix.multiply(Tt.matrixWorld)),it.matrix.decompose(it.position,it.quaternion,it.scale),it.updateMatrixWorld(!0),it.projectionMatrix.copy(Tt.projectionMatrix),it.projectionMatrixInverse.copy(Tt.projectionMatrixInverse),it.isPerspectiveCamera&&(it.fov=ju*2*Math.atan(1/it.projectionMatrix.elements[5]),it.zoom=1)}this.getCamera=function(){return ie},this.getFoveation=function(){if(!(L===null&&R===null))return S},this.setFoveation=function(it){S=it,L!==null&&(L.fixedFoveation=it),R!==null&&R.fixedFoveation!==void 0&&(R.fixedFoveation=it)},this.hasDepthSensing=function(){return Z.texture!==null},this.getDepthSensingMesh=function(){return Z.getMesh(ie)};let Wt=null;function $t(it,Tt){if(C=Tt.getViewerPose(M||p),B=Tt,C!==null){const qt=C.views;R!==null&&(e.setRenderTargetFramebuffer(ge,R.framebuffer),e.setRenderTarget(ge));let Rt=!1;qt.length!==ie.cameras.length&&(ie.cameras.length=0,Rt=!0);for(let Xt=0;Xt<qt.length;Xt++){const yn=qt[Xt];let Vn=null;if(R!==null)Vn=R.getViewport(yn);else{const pn=I.getViewSubImage(L,yn);Vn=pn.viewport,Xt===0&&(e.setRenderTargetTextures(ge,pn.colorTexture,L.ignoreDepthValues?void 0:pn.depthStencilTexture),e.setRenderTarget(ge))}let Ln=ce[Xt];Ln===void 0&&(Ln=new is,Ln.layers.enable(Xt),Ln.viewport=new oi,ce[Xt]=Ln),Ln.matrix.fromArray(yn.transform.matrix),Ln.matrix.decompose(Ln.position,Ln.quaternion,Ln.scale),Ln.projectionMatrix.fromArray(yn.projectionMatrix),Ln.projectionMatrixInverse.copy(Ln.projectionMatrix).invert(),Ln.viewport.set(Vn.x,Vn.y,Vn.width,Vn.height),Xt===0&&(ie.matrix.copy(Ln.matrix),ie.matrix.decompose(ie.position,ie.quaternion,ie.scale)),Rt===!0&&ie.cameras.push(Ln)}const on=u.enabledFeatures;if(on&&on.includes("depth-sensing")){const Xt=I.getDepthInformation(qt[0]);Xt&&Xt.isValid&&Xt.texture&&Z.init(e,Xt,u.renderState)}}for(let qt=0;qt<me.length;qt++){const Rt=Q[qt],on=me[qt];Rt!==null&&on!==void 0&&on.update(Rt,Tt,M||p)}Wt&&Wt(it,Tt),Tt.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Tt}),B=null}const Rn=new AS;Rn.setAnimationLoop($t),this.setAnimationLoop=function(it){Wt=it},this.dispose=function(){}}}const Xl=new Ca,X3=new dn;function Y3(c,e){function n(V,O){V.matrixAutoUpdate===!0&&V.updateMatrix(),O.value.copy(V.matrix)}function r(V,O){O.color.getRGB(V.fogColor.value,gS(c)),O.isFog?(V.fogNear.value=O.near,V.fogFar.value=O.far):O.isFogExp2&&(V.fogDensity.value=O.density)}function u(V,O,ge,me,Q){O.isMeshBasicMaterial||O.isMeshLambertMaterial?f(V,O):O.isMeshToonMaterial?(f(V,O),I(V,O)):O.isMeshPhongMaterial?(f(V,O),C(V,O)):O.isMeshStandardMaterial?(f(V,O),L(V,O),O.isMeshPhysicalMaterial&&R(V,O,Q)):O.isMeshMatcapMaterial?(f(V,O),B(V,O)):O.isMeshDepthMaterial?f(V,O):O.isMeshDistanceMaterial?(f(V,O),Z(V,O)):O.isMeshNormalMaterial?f(V,O):O.isLineBasicMaterial?(p(V,O),O.isLineDashedMaterial&&s(V,O)):O.isPointsMaterial?S(V,O,ge,me):O.isSpriteMaterial?M(V,O):O.isShadowMaterial?(V.color.value.copy(O.color),V.opacity.value=O.opacity):O.isShaderMaterial&&(O.uniformsNeedUpdate=!1)}function f(V,O){V.opacity.value=O.opacity,O.color&&V.diffuse.value.copy(O.color),O.emissive&&V.emissive.value.copy(O.emissive).multiplyScalar(O.emissiveIntensity),O.map&&(V.map.value=O.map,n(O.map,V.mapTransform)),O.alphaMap&&(V.alphaMap.value=O.alphaMap,n(O.alphaMap,V.alphaMapTransform)),O.bumpMap&&(V.bumpMap.value=O.bumpMap,n(O.bumpMap,V.bumpMapTransform),V.bumpScale.value=O.bumpScale,O.side===ss&&(V.bumpScale.value*=-1)),O.normalMap&&(V.normalMap.value=O.normalMap,n(O.normalMap,V.normalMapTransform),V.normalScale.value.copy(O.normalScale),O.side===ss&&V.normalScale.value.negate()),O.displacementMap&&(V.displacementMap.value=O.displacementMap,n(O.displacementMap,V.displacementMapTransform),V.displacementScale.value=O.displacementScale,V.displacementBias.value=O.displacementBias),O.emissiveMap&&(V.emissiveMap.value=O.emissiveMap,n(O.emissiveMap,V.emissiveMapTransform)),O.specularMap&&(V.specularMap.value=O.specularMap,n(O.specularMap,V.specularMapTransform)),O.alphaTest>0&&(V.alphaTest.value=O.alphaTest);const ge=e.get(O),me=ge.envMap,Q=ge.envMapRotation;me&&(V.envMap.value=me,Xl.copy(Q),Xl.x*=-1,Xl.y*=-1,Xl.z*=-1,me.isCubeTexture&&me.isRenderTargetTexture===!1&&(Xl.y*=-1,Xl.z*=-1),V.envMapRotation.value.setFromMatrix4(X3.makeRotationFromEuler(Xl)),V.flipEnvMap.value=me.isCubeTexture&&me.isRenderTargetTexture===!1?-1:1,V.reflectivity.value=O.reflectivity,V.ior.value=O.ior,V.refractionRatio.value=O.refractionRatio),O.lightMap&&(V.lightMap.value=O.lightMap,V.lightMapIntensity.value=O.lightMapIntensity,n(O.lightMap,V.lightMapTransform)),O.aoMap&&(V.aoMap.value=O.aoMap,V.aoMapIntensity.value=O.aoMapIntensity,n(O.aoMap,V.aoMapTransform))}function p(V,O){V.diffuse.value.copy(O.color),V.opacity.value=O.opacity,O.map&&(V.map.value=O.map,n(O.map,V.mapTransform))}function s(V,O){V.dashSize.value=O.dashSize,V.totalSize.value=O.dashSize+O.gapSize,V.scale.value=O.scale}function S(V,O,ge,me){V.diffuse.value.copy(O.color),V.opacity.value=O.opacity,V.size.value=O.size*ge,V.scale.value=me*.5,O.map&&(V.map.value=O.map,n(O.map,V.uvTransform)),O.alphaMap&&(V.alphaMap.value=O.alphaMap,n(O.alphaMap,V.alphaMapTransform)),O.alphaTest>0&&(V.alphaTest.value=O.alphaTest)}function M(V,O){V.diffuse.value.copy(O.color),V.opacity.value=O.opacity,V.rotation.value=O.rotation,O.map&&(V.map.value=O.map,n(O.map,V.mapTransform)),O.alphaMap&&(V.alphaMap.value=O.alphaMap,n(O.alphaMap,V.alphaMapTransform)),O.alphaTest>0&&(V.alphaTest.value=O.alphaTest)}function C(V,O){V.specular.value.copy(O.specular),V.shininess.value=Math.max(O.shininess,1e-4)}function I(V,O){O.gradientMap&&(V.gradientMap.value=O.gradientMap)}function L(V,O){V.metalness.value=O.metalness,O.metalnessMap&&(V.metalnessMap.value=O.metalnessMap,n(O.metalnessMap,V.metalnessMapTransform)),V.roughness.value=O.roughness,O.roughnessMap&&(V.roughnessMap.value=O.roughnessMap,n(O.roughnessMap,V.roughnessMapTransform)),O.envMap&&(V.envMapIntensity.value=O.envMapIntensity)}function R(V,O,ge){V.ior.value=O.ior,O.sheen>0&&(V.sheenColor.value.copy(O.sheenColor).multiplyScalar(O.sheen),V.sheenRoughness.value=O.sheenRoughness,O.sheenColorMap&&(V.sheenColorMap.value=O.sheenColorMap,n(O.sheenColorMap,V.sheenColorMapTransform)),O.sheenRoughnessMap&&(V.sheenRoughnessMap.value=O.sheenRoughnessMap,n(O.sheenRoughnessMap,V.sheenRoughnessMapTransform))),O.clearcoat>0&&(V.clearcoat.value=O.clearcoat,V.clearcoatRoughness.value=O.clearcoatRoughness,O.clearcoatMap&&(V.clearcoatMap.value=O.clearcoatMap,n(O.clearcoatMap,V.clearcoatMapTransform)),O.clearcoatRoughnessMap&&(V.clearcoatRoughnessMap.value=O.clearcoatRoughnessMap,n(O.clearcoatRoughnessMap,V.clearcoatRoughnessMapTransform)),O.clearcoatNormalMap&&(V.clearcoatNormalMap.value=O.clearcoatNormalMap,n(O.clearcoatNormalMap,V.clearcoatNormalMapTransform),V.clearcoatNormalScale.value.copy(O.clearcoatNormalScale),O.side===ss&&V.clearcoatNormalScale.value.negate())),O.dispersion>0&&(V.dispersion.value=O.dispersion),O.iridescence>0&&(V.iridescence.value=O.iridescence,V.iridescenceIOR.value=O.iridescenceIOR,V.iridescenceThicknessMinimum.value=O.iridescenceThicknessRange[0],V.iridescenceThicknessMaximum.value=O.iridescenceThicknessRange[1],O.iridescenceMap&&(V.iridescenceMap.value=O.iridescenceMap,n(O.iridescenceMap,V.iridescenceMapTransform)),O.iridescenceThicknessMap&&(V.iridescenceThicknessMap.value=O.iridescenceThicknessMap,n(O.iridescenceThicknessMap,V.iridescenceThicknessMapTransform))),O.transmission>0&&(V.transmission.value=O.transmission,V.transmissionSamplerMap.value=ge.texture,V.transmissionSamplerSize.value.set(ge.width,ge.height),O.transmissionMap&&(V.transmissionMap.value=O.transmissionMap,n(O.transmissionMap,V.transmissionMapTransform)),V.thickness.value=O.thickness,O.thicknessMap&&(V.thicknessMap.value=O.thicknessMap,n(O.thicknessMap,V.thicknessMapTransform)),V.attenuationDistance.value=O.attenuationDistance,V.attenuationColor.value.copy(O.attenuationColor)),O.anisotropy>0&&(V.anisotropyVector.value.set(O.anisotropy*Math.cos(O.anisotropyRotation),O.anisotropy*Math.sin(O.anisotropyRotation)),O.anisotropyMap&&(V.anisotropyMap.value=O.anisotropyMap,n(O.anisotropyMap,V.anisotropyMapTransform))),V.specularIntensity.value=O.specularIntensity,V.specularColor.value.copy(O.specularColor),O.specularColorMap&&(V.specularColorMap.value=O.specularColorMap,n(O.specularColorMap,V.specularColorMapTransform)),O.specularIntensityMap&&(V.specularIntensityMap.value=O.specularIntensityMap,n(O.specularIntensityMap,V.specularIntensityMapTransform))}function B(V,O){O.matcap&&(V.matcap.value=O.matcap)}function Z(V,O){const ge=e.get(O).light;V.referencePosition.value.setFromMatrixPosition(ge.matrixWorld),V.nearDistance.value=ge.shadow.camera.near,V.farDistance.value=ge.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:u}}function K3(c,e,n,r){let u={},f={},p=[];const s=c.getParameter(c.MAX_UNIFORM_BUFFER_BINDINGS);function S(ge,me){const Q=me.program;r.uniformBlockBinding(ge,Q)}function M(ge,me){let Q=u[ge.id];Q===void 0&&(B(ge),Q=C(ge),u[ge.id]=Q,ge.addEventListener("dispose",V));const de=me.program;r.updateUBOMapping(ge,de);const fe=e.render.frame;f[ge.id]!==fe&&(L(ge),f[ge.id]=fe)}function C(ge){const me=I();ge.__bindingPointIndex=me;const Q=c.createBuffer(),de=ge.__size,fe=ge.usage;return c.bindBuffer(c.UNIFORM_BUFFER,Q),c.bufferData(c.UNIFORM_BUFFER,de,fe),c.bindBuffer(c.UNIFORM_BUFFER,null),c.bindBufferBase(c.UNIFORM_BUFFER,me,Q),Q}function I(){for(let ge=0;ge<s;ge++)if(p.indexOf(ge)===-1)return p.push(ge),ge;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function L(ge){const me=u[ge.id],Q=ge.uniforms,de=ge.__cache;c.bindBuffer(c.UNIFORM_BUFFER,me);for(let fe=0,ye=Q.length;fe<ye;fe++){const ke=Array.isArray(Q[fe])?Q[fe]:[Q[fe]];for(let ce=0,ie=ke.length;ce<ie;ce++){const Oe=ke[ce];if(R(Oe,fe,ce,de)===!0){const nt=Oe.__offset,Je=Array.isArray(Oe.value)?Oe.value:[Oe.value];let ut=0;for(let ht=0;ht<Je.length;ht++){const ot=Je[ht],ft=Z(ot);typeof ot=="number"||typeof ot=="boolean"?(Oe.__data[0]=ot,c.bufferSubData(c.UNIFORM_BUFFER,nt+ut,Oe.__data)):ot.isMatrix3?(Oe.__data[0]=ot.elements[0],Oe.__data[1]=ot.elements[1],Oe.__data[2]=ot.elements[2],Oe.__data[3]=0,Oe.__data[4]=ot.elements[3],Oe.__data[5]=ot.elements[4],Oe.__data[6]=ot.elements[5],Oe.__data[7]=0,Oe.__data[8]=ot.elements[6],Oe.__data[9]=ot.elements[7],Oe.__data[10]=ot.elements[8],Oe.__data[11]=0):(ot.toArray(Oe.__data,ut),ut+=ft.storage/Float32Array.BYTES_PER_ELEMENT)}c.bufferSubData(c.UNIFORM_BUFFER,nt,Oe.__data)}}}c.bindBuffer(c.UNIFORM_BUFFER,null)}function R(ge,me,Q,de){const fe=ge.value,ye=me+"_"+Q;if(de[ye]===void 0)return typeof fe=="number"||typeof fe=="boolean"?de[ye]=fe:de[ye]=fe.clone(),!0;{const ke=de[ye];if(typeof fe=="number"||typeof fe=="boolean"){if(ke!==fe)return de[ye]=fe,!0}else if(ke.equals(fe)===!1)return ke.copy(fe),!0}return!1}function B(ge){const me=ge.uniforms;let Q=0;const de=16;for(let ye=0,ke=me.length;ye<ke;ye++){const ce=Array.isArray(me[ye])?me[ye]:[me[ye]];for(let ie=0,Oe=ce.length;ie<Oe;ie++){const nt=ce[ie],Je=Array.isArray(nt.value)?nt.value:[nt.value];for(let ut=0,ht=Je.length;ut<ht;ut++){const ot=Je[ut],ft=Z(ot),tt=Q%de,It=tt%ft.boundary,Ut=tt+It;Q+=It,Ut!==0&&de-Ut<ft.storage&&(Q+=de-Ut),nt.__data=new Float32Array(ft.storage/Float32Array.BYTES_PER_ELEMENT),nt.__offset=Q,Q+=ft.storage}}}const fe=Q%de;return fe>0&&(Q+=de-fe),ge.__size=Q,ge.__cache={},this}function Z(ge){const me={boundary:0,storage:0};return typeof ge=="number"||typeof ge=="boolean"?(me.boundary=4,me.storage=4):ge.isVector2?(me.boundary=8,me.storage=8):ge.isVector3||ge.isColor?(me.boundary=16,me.storage=12):ge.isVector4?(me.boundary=16,me.storage=16):ge.isMatrix3?(me.boundary=48,me.storage=48):ge.isMatrix4?(me.boundary=64,me.storage=64):ge.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ge),me}function V(ge){const me=ge.target;me.removeEventListener("dispose",V);const Q=p.indexOf(me.__bindingPointIndex);p.splice(Q,1),c.deleteBuffer(u[me.id]),delete u[me.id],delete f[me.id]}function O(){for(const ge in u)c.deleteBuffer(u[ge]);p=[],u={},f={}}return{bind:S,update:M,dispose:O}}class J3{constructor(e={}){const{canvas:n=QC(),context:r=null,depth:u=!0,stencil:f=!1,alpha:p=!1,antialias:s=!1,premultipliedAlpha:S=!0,preserveDrawingBuffer:M=!1,powerPreference:C="default",failIfMajorPerformanceCaveat:I=!1,reverseDepthBuffer:L=!1}=e;this.isWebGLRenderer=!0;let R;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");R=r.getContextAttributes().alpha}else R=p;const B=new Uint32Array(4),Z=new Int32Array(4);let V=null,O=null;const ge=[],me=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Pr,this.toneMapping=el,this.toneMappingExposure=1;const Q=this;let de=!1,fe=0,ye=0,ke=null,ce=-1,ie=null;const Oe=new oi,nt=new oi;let Je=null;const ut=new vn(0);let ht=0,ot=n.width,ft=n.height,tt=1,It=null,Ut=null;const Wt=new oi(0,0,ot,ft),$t=new oi(0,0,ot,ft);let Rn=!1;const it=new xv;let Tt=!1,qt=!1;this.transmissionResolutionScale=1;const Rt=new dn,on=new dn,Xt=new Ge,yn=new oi,Vn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ln=!1;function pn(){return ke===null?tt:1}let Fe=r;function gi(ee,Be){return n.getContext(ee,Be)}try{const ee={alpha:!0,depth:u,stencil:f,antialias:s,premultipliedAlpha:S,preserveDrawingBuffer:M,powerPreference:C,failIfMajorPerformanceCaveat:I};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${lv}`),n.addEventListener("webglcontextlost",Ee,!1),n.addEventListener("webglcontextrestored",Ie,!1),n.addEventListener("webglcontextcreationerror",Ue,!1),Fe===null){const Be="webgl2";if(Fe=gi(Be,ee),Fe===null)throw gi(Be)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}let bn,cn,Zt,Tn,Yt,ve,te,Ze,ct,mt,rt,Vt,At,Gt,zn,bt,Ce,W,X,J,ue,Te,De,ne;function _e(){bn=new oD(Fe),bn.init(),Te=new H3(Fe,bn),cn=new tD(Fe,bn,e,Te),Zt=new V3(Fe,bn),cn.reverseDepthBuffer&&L&&Zt.buffers.depth.setReversed(!0),Tn=new uD(Fe),Yt=new C3,ve=new G3(Fe,bn,Zt,Yt,cn,Te,Tn),te=new iD(Q),Ze=new aD(Q),ct=new _I(Fe),De=new QL(Fe,ct),mt=new lD(Fe,ct,Tn,De),rt=new dD(Fe,mt,ct,Tn),X=new hD(Fe,cn,ve),bt=new nD(Yt),Vt=new A3(Q,te,Ze,bn,cn,De,bt),At=new Y3(Q,Yt),Gt=new I3,zn=new F3(bn),W=new JL(Q,te,Ze,Zt,rt,R,S),Ce=new U3(Q,rt,cn),ne=new K3(Fe,Tn,cn,Zt),J=new eD(Fe,bn,Tn),ue=new cD(Fe,bn,Tn),Tn.programs=Vt.programs,Q.capabilities=cn,Q.extensions=bn,Q.properties=Yt,Q.renderLists=Gt,Q.shadowMap=Ce,Q.state=Zt,Q.info=Tn}_e();const xe=new Z3(Q,Fe);this.xr=xe,this.getContext=function(){return Fe},this.getContextAttributes=function(){return Fe.getContextAttributes()},this.forceContextLoss=function(){const ee=bn.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){const ee=bn.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return tt},this.setPixelRatio=function(ee){ee!==void 0&&(tt=ee,this.setSize(ot,ft,!1))},this.getSize=function(ee){return ee.set(ot,ft)},this.setSize=function(ee,Be,Ke=!0){if(xe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ot=ee,ft=Be,n.width=Math.floor(ee*tt),n.height=Math.floor(Be*tt),Ke===!0&&(n.style.width=ee+"px",n.style.height=Be+"px"),this.setViewport(0,0,ee,Be)},this.getDrawingBufferSize=function(ee){return ee.set(ot*tt,ft*tt).floor()},this.setDrawingBufferSize=function(ee,Be,Ke){ot=ee,ft=Be,tt=Ke,n.width=Math.floor(ee*Ke),n.height=Math.floor(Be*Ke),this.setViewport(0,0,ee,Be)},this.getCurrentViewport=function(ee){return ee.copy(Oe)},this.getViewport=function(ee){return ee.copy(Wt)},this.setViewport=function(ee,Be,Ke,We){ee.isVector4?Wt.set(ee.x,ee.y,ee.z,ee.w):Wt.set(ee,Be,Ke,We),Zt.viewport(Oe.copy(Wt).multiplyScalar(tt).round())},this.getScissor=function(ee){return ee.copy($t)},this.setScissor=function(ee,Be,Ke,We){ee.isVector4?$t.set(ee.x,ee.y,ee.z,ee.w):$t.set(ee,Be,Ke,We),Zt.scissor(nt.copy($t).multiplyScalar(tt).round())},this.getScissorTest=function(){return Rn},this.setScissorTest=function(ee){Zt.setScissorTest(Rn=ee)},this.setOpaqueSort=function(ee){It=ee},this.setTransparentSort=function(ee){Ut=ee},this.getClearColor=function(ee){return ee.copy(W.getClearColor())},this.setClearColor=function(){W.setClearColor.apply(W,arguments)},this.getClearAlpha=function(){return W.getClearAlpha()},this.setClearAlpha=function(){W.setClearAlpha.apply(W,arguments)},this.clear=function(ee=!0,Be=!0,Ke=!0){let We=0;if(ee){let Ve=!1;if(ke!==null){const vt=ke.texture.format;Ve=vt===mv||vt===fv||vt===pv}if(Ve){const vt=ke.texture.type,Ct=vt===oo||vt===pc||vt===Bd||vt===Gu||vt===uv||vt===hv,Bt=W.getClearColor(),Lt=W.getClearAlpha(),Ht=Bt.r,un=Bt.g,tn=Bt.b;Ct?(B[0]=Ht,B[1]=un,B[2]=tn,B[3]=Lt,Fe.clearBufferuiv(Fe.COLOR,0,B)):(Z[0]=Ht,Z[1]=un,Z[2]=tn,Z[3]=Lt,Fe.clearBufferiv(Fe.COLOR,0,Z))}else We|=Fe.COLOR_BUFFER_BIT}Be&&(We|=Fe.DEPTH_BUFFER_BIT),Ke&&(We|=Fe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Fe.clear(We)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ee,!1),n.removeEventListener("webglcontextrestored",Ie,!1),n.removeEventListener("webglcontextcreationerror",Ue,!1),W.dispose(),Gt.dispose(),zn.dispose(),Yt.dispose(),te.dispose(),Ze.dispose(),rt.dispose(),De.dispose(),ne.dispose(),Vt.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",ni),xe.removeEventListener("sessionend",qn),xn.stop()};function Ee(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),de=!0}function Ie(){console.log("THREE.WebGLRenderer: Context Restored."),de=!1;const ee=Tn.autoReset,Be=Ce.enabled,Ke=Ce.autoUpdate,We=Ce.needsUpdate,Ve=Ce.type;_e(),Tn.autoReset=ee,Ce.enabled=Be,Ce.autoUpdate=Ke,Ce.needsUpdate=We,Ce.type=Ve}function Ue(ee){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ee.statusMessage)}function be(ee){const Be=ee.target;Be.removeEventListener("dispose",be),dt(Be)}function dt(ee){Nt(ee),Yt.remove(ee)}function Nt(ee){const Be=Yt.get(ee).programs;Be!==void 0&&(Be.forEach(function(Ke){Vt.releaseProgram(Ke)}),ee.isShaderMaterial&&Vt.releaseShaderCache(ee))}this.renderBufferDirect=function(ee,Be,Ke,We,Ve,vt){Be===null&&(Be=Vn);const Ct=Ve.isMesh&&Ve.matrixWorld.determinant()<0,Bt=wt(ee,Be,Ke,We,Ve);Zt.setMaterial(We,Ct);let Lt=Ke.index,Ht=1;if(We.wireframe===!0){if(Lt=mt.getWireframeAttribute(Ke),Lt===void 0)return;Ht=2}const un=Ke.drawRange,tn=Ke.attributes.position;let Fn=un.start*Ht,On=(un.start+un.count)*Ht;vt!==null&&(Fn=Math.max(Fn,vt.start*Ht),On=Math.min(On,(vt.start+vt.count)*Ht)),Lt!==null?(Fn=Math.max(Fn,0),On=Math.min(On,Lt.count)):tn!=null&&(Fn=Math.max(Fn,0),On=Math.min(On,tn.count));const ri=On-Fn;if(ri<0||ri===1/0)return;De.setup(Ve,We,Bt,Ke,Lt);let _i,Hn=J;if(Lt!==null&&(_i=ct.get(Lt),Hn=ue,Hn.setIndex(_i)),Ve.isMesh)We.wireframe===!0?(Zt.setLineWidth(We.wireframeLinewidth*pn()),Hn.setMode(Fe.LINES)):Hn.setMode(Fe.TRIANGLES);else if(Ve.isLine){let sn=We.linewidth;sn===void 0&&(sn=1),Zt.setLineWidth(sn*pn()),Ve.isLineSegments?Hn.setMode(Fe.LINES):Ve.isLineLoop?Hn.setMode(Fe.LINE_LOOP):Hn.setMode(Fe.LINE_STRIP)}else Ve.isPoints?Hn.setMode(Fe.POINTS):Ve.isSprite&&Hn.setMode(Fe.TRIANGLES);if(Ve.isBatchedMesh)if(Ve._multiDrawInstances!==null)Hn.renderMultiDrawInstances(Ve._multiDrawStarts,Ve._multiDrawCounts,Ve._multiDrawCount,Ve._multiDrawInstances);else if(bn.get("WEBGL_multi_draw"))Hn.renderMultiDraw(Ve._multiDrawStarts,Ve._multiDrawCounts,Ve._multiDrawCount);else{const sn=Ve._multiDrawStarts,vi=Ve._multiDrawCounts,Zn=Ve._multiDrawCount,Ir=Lt?ct.get(Lt).bytesPerElement:1,Yr=Yt.get(We).currentProgram.getUniforms();for(let xr=0;xr<Zn;xr++)Yr.setValue(Fe,"_gl_DrawID",xr),Hn.render(sn[xr]/Ir,vi[xr])}else if(Ve.isInstancedMesh)Hn.renderInstances(Fn,ri,Ve.count);else if(Ke.isInstancedBufferGeometry){const sn=Ke._maxInstanceCount!==void 0?Ke._maxInstanceCount:1/0,vi=Math.min(Ke.instanceCount,sn);Hn.renderInstances(Fn,ri,vi)}else Hn.render(Fn,ri)};function pt(ee,Be,Ke){ee.transparent===!0&&ee.side===wa&&ee.forceSinglePass===!1?(ee.side=ss,ee.needsUpdate=!0,ii(ee,Be,Ke),ee.side=ao,ee.needsUpdate=!0,ii(ee,Be,Ke),ee.side=wa):ii(ee,Be,Ke)}this.compile=function(ee,Be,Ke=null){Ke===null&&(Ke=ee),O=zn.get(Ke),O.init(Be),me.push(O),Ke.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Be.layers)&&(O.pushLight(Ve),Ve.castShadow&&O.pushShadow(Ve))}),ee!==Ke&&ee.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Be.layers)&&(O.pushLight(Ve),Ve.castShadow&&O.pushShadow(Ve))}),O.setupLights();const We=new Set;return ee.traverse(function(Ve){if(!(Ve.isMesh||Ve.isPoints||Ve.isLine||Ve.isSprite))return;const vt=Ve.material;if(vt)if(Array.isArray(vt))for(let Ct=0;Ct<vt.length;Ct++){const Bt=vt[Ct];pt(Bt,Ke,Ve),We.add(Bt)}else pt(vt,Ke,Ve),We.add(vt)}),me.pop(),O=null,We},this.compileAsync=function(ee,Be,Ke=null){const We=this.compile(ee,Be,Ke);return new Promise(Ve=>{function vt(){if(We.forEach(function(Ct){Yt.get(Ct).currentProgram.isReady()&&We.delete(Ct)}),We.size===0){Ve(ee);return}setTimeout(vt,10)}bn.get("KHR_parallel_shader_compile")!==null?vt():setTimeout(vt,10)})};let Dt=null;function Kt(ee){Dt&&Dt(ee)}function ni(){xn.stop()}function qn(){xn.start()}const xn=new AS;xn.setAnimationLoop(Kt),typeof self<"u"&&xn.setContext(self),this.setAnimationLoop=function(ee){Dt=ee,xe.setAnimationLoop(ee),ee===null?xn.stop():xn.start()},xe.addEventListener("sessionstart",ni),xe.addEventListener("sessionend",qn),this.render=function(ee,Be){if(Be!==void 0&&Be.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(de===!0)return;if(ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),Be.parent===null&&Be.matrixWorldAutoUpdate===!0&&Be.updateMatrixWorld(),xe.enabled===!0&&xe.isPresenting===!0&&(xe.cameraAutoUpdate===!0&&xe.updateCamera(Be),Be=xe.getCamera()),ee.isScene===!0&&ee.onBeforeRender(Q,ee,Be,ke),O=zn.get(ee,me.length),O.init(Be),me.push(O),on.multiplyMatrices(Be.projectionMatrix,Be.matrixWorldInverse),it.setFromProjectionMatrix(on),qt=this.localClippingEnabled,Tt=bt.init(this.clippingPlanes,qt),V=Gt.get(ee,ge.length),V.init(),ge.push(V),xe.enabled===!0&&xe.isPresenting===!0){const vt=Q.xr.getDepthSensingMesh();vt!==null&&nn(vt,Be,-1/0,Q.sortObjects)}nn(ee,Be,0,Q.sortObjects),V.finish(),Q.sortObjects===!0&&V.sort(It,Ut),Ln=xe.enabled===!1||xe.isPresenting===!1||xe.hasDepthSensing()===!1,Ln&&W.addToRenderList(V,ee),this.info.render.frame++,Tt===!0&&bt.beginShadows();const Ke=O.state.shadowsArray;Ce.render(Ke,ee,Be),Tt===!0&&bt.endShadows(),this.info.autoReset===!0&&this.info.reset();const We=V.opaque,Ve=V.transmissive;if(O.setupLights(),Be.isArrayCamera){const vt=Be.cameras;if(Ve.length>0)for(let Ct=0,Bt=vt.length;Ct<Bt;Ct++){const Lt=vt[Ct];Ii(We,Ve,ee,Lt)}Ln&&W.render(ee);for(let Ct=0,Bt=vt.length;Ct<Bt;Ct++){const Lt=vt[Ct];wn(V,ee,Lt,Lt.viewport)}}else Ve.length>0&&Ii(We,Ve,ee,Be),Ln&&W.render(ee),wn(V,ee,Be);ke!==null&&ye===0&&(ve.updateMultisampleRenderTarget(ke),ve.updateRenderTargetMipmap(ke)),ee.isScene===!0&&ee.onAfterRender(Q,ee,Be),De.resetDefaultState(),ce=-1,ie=null,me.pop(),me.length>0?(O=me[me.length-1],Tt===!0&&bt.setGlobalState(Q.clippingPlanes,O.state.camera)):O=null,ge.pop(),ge.length>0?V=ge[ge.length-1]:V=null};function nn(ee,Be,Ke,We){if(ee.visible===!1)return;if(ee.layers.test(Be.layers)){if(ee.isGroup)Ke=ee.renderOrder;else if(ee.isLOD)ee.autoUpdate===!0&&ee.update(Be);else if(ee.isLight)O.pushLight(ee),ee.castShadow&&O.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||it.intersectsSprite(ee)){We&&yn.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(on);const Ct=rt.update(ee),Bt=ee.material;Bt.visible&&V.push(ee,Ct,Bt,Ke,yn.z,null)}}else if((ee.isMesh||ee.isLine||ee.isPoints)&&(!ee.frustumCulled||it.intersectsObject(ee))){const Ct=rt.update(ee),Bt=ee.material;if(We&&(ee.boundingSphere!==void 0?(ee.boundingSphere===null&&ee.computeBoundingSphere(),yn.copy(ee.boundingSphere.center)):(Ct.boundingSphere===null&&Ct.computeBoundingSphere(),yn.copy(Ct.boundingSphere.center)),yn.applyMatrix4(ee.matrixWorld).applyMatrix4(on)),Array.isArray(Bt)){const Lt=Ct.groups;for(let Ht=0,un=Lt.length;Ht<un;Ht++){const tn=Lt[Ht],Fn=Bt[tn.materialIndex];Fn&&Fn.visible&&V.push(ee,Ct,Fn,Ke,yn.z,tn)}}else Bt.visible&&V.push(ee,Ct,Bt,Ke,yn.z,null)}}const vt=ee.children;for(let Ct=0,Bt=vt.length;Ct<Bt;Ct++)nn(vt[Ct],Be,Ke,We)}function wn(ee,Be,Ke,We){const Ve=ee.opaque,vt=ee.transmissive,Ct=ee.transparent;O.setupLightsView(Ke),Tt===!0&&bt.setGlobalState(Q.clippingPlanes,Ke),We&&Zt.viewport(Oe.copy(We)),Ve.length>0&&_t(Ve,Be,Ke),vt.length>0&&_t(vt,Be,Ke),Ct.length>0&&_t(Ct,Be,Ke),Zt.buffers.depth.setTest(!0),Zt.buffers.depth.setMask(!0),Zt.buffers.color.setMask(!0),Zt.setPolygonOffset(!1)}function Ii(ee,Be,Ke,We){if((Ke.isScene===!0?Ke.overrideMaterial:null)!==null)return;O.state.transmissionRenderTarget[We.id]===void 0&&(O.state.transmissionRenderTarget[We.id]=new fc(1,1,{generateMipmaps:!0,type:bn.has("EXT_color_buffer_half_float")||bn.has("EXT_color_buffer_float")?Xd:oo,minFilter:eo,samples:4,stencilBuffer:f,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Qn.workingColorSpace}));const vt=O.state.transmissionRenderTarget[We.id],Ct=We.viewport||Oe;vt.setSize(Ct.z*Q.transmissionResolutionScale,Ct.w*Q.transmissionResolutionScale);const Bt=Q.getRenderTarget();Q.setRenderTarget(vt),Q.getClearColor(ut),ht=Q.getClearAlpha(),ht<1&&Q.setClearColor(16777215,.5),Q.clear(),Ln&&W.render(Ke);const Lt=Q.toneMapping;Q.toneMapping=el;const Ht=We.viewport;if(We.viewport!==void 0&&(We.viewport=void 0),O.setupLightsView(We),Tt===!0&&bt.setGlobalState(Q.clippingPlanes,We),_t(ee,Ke,We),ve.updateMultisampleRenderTarget(vt),ve.updateRenderTargetMipmap(vt),bn.has("WEBGL_multisampled_render_to_texture")===!1){let un=!1;for(let tn=0,Fn=Be.length;tn<Fn;tn++){const On=Be[tn],ri=On.object,_i=On.geometry,Hn=On.material,sn=On.group;if(Hn.side===wa&&ri.layers.test(We.layers)){const vi=Hn.side;Hn.side=ss,Hn.needsUpdate=!0,ki(ri,Ke,We,_i,Hn,sn),Hn.side=vi,Hn.needsUpdate=!0,un=!0}}un===!0&&(ve.updateMultisampleRenderTarget(vt),ve.updateRenderTargetMipmap(vt))}Q.setRenderTarget(Bt),Q.setClearColor(ut,ht),Ht!==void 0&&(We.viewport=Ht),Q.toneMapping=Lt}function _t(ee,Be,Ke){const We=Be.isScene===!0?Be.overrideMaterial:null;for(let Ve=0,vt=ee.length;Ve<vt;Ve++){const Ct=ee[Ve],Bt=Ct.object,Lt=Ct.geometry,Ht=We===null?Ct.material:We,un=Ct.group;Bt.layers.test(Ke.layers)&&ki(Bt,Be,Ke,Lt,Ht,un)}}function ki(ee,Be,Ke,We,Ve,vt){ee.onBeforeRender(Q,Be,Ke,We,Ve,vt),ee.modelViewMatrix.multiplyMatrices(Ke.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),Ve.onBeforeRender(Q,Be,Ke,We,ee,vt),Ve.transparent===!0&&Ve.side===wa&&Ve.forceSinglePass===!1?(Ve.side=ss,Ve.needsUpdate=!0,Q.renderBufferDirect(Ke,Be,We,Ve,ee,vt),Ve.side=ao,Ve.needsUpdate=!0,Q.renderBufferDirect(Ke,Be,We,Ve,ee,vt),Ve.side=wa):Q.renderBufferDirect(Ke,Be,We,Ve,ee,vt),ee.onAfterRender(Q,Be,Ke,We,Ve,vt)}function ii(ee,Be,Ke){Be.isScene!==!0&&(Be=Vn);const We=Yt.get(ee),Ve=O.state.lights,vt=O.state.shadowsArray,Ct=Ve.state.version,Bt=Vt.getParameters(ee,Ve.state,vt,Be,Ke),Lt=Vt.getProgramCacheKey(Bt);let Ht=We.programs;We.environment=ee.isMeshStandardMaterial?Be.environment:null,We.fog=Be.fog,We.envMap=(ee.isMeshStandardMaterial?Ze:te).get(ee.envMap||We.environment),We.envMapRotation=We.environment!==null&&ee.envMap===null?Be.environmentRotation:ee.envMapRotation,Ht===void 0&&(ee.addEventListener("dispose",be),Ht=new Map,We.programs=Ht);let un=Ht.get(Lt);if(un!==void 0){if(We.currentProgram===un&&We.lightsStateVersion===Ct)return Ss(ee,Bt),un}else Bt.uniforms=Vt.getUniforms(ee),ee.onBeforeCompile(Bt,Q),un=Vt.acquireProgram(Bt,Lt),Ht.set(Lt,un),We.uniforms=Bt.uniforms;const tn=We.uniforms;return(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||ee.clipping===!0)&&(tn.clippingPlanes=bt.uniform),Ss(ee,Bt),We.needsLights=mn(ee),We.lightsStateVersion=Ct,We.needsLights&&(tn.ambientLightColor.value=Ve.state.ambient,tn.lightProbe.value=Ve.state.probe,tn.directionalLights.value=Ve.state.directional,tn.directionalLightShadows.value=Ve.state.directionalShadow,tn.spotLights.value=Ve.state.spot,tn.spotLightShadows.value=Ve.state.spotShadow,tn.rectAreaLights.value=Ve.state.rectArea,tn.ltc_1.value=Ve.state.rectAreaLTC1,tn.ltc_2.value=Ve.state.rectAreaLTC2,tn.pointLights.value=Ve.state.point,tn.pointLightShadows.value=Ve.state.pointShadow,tn.hemisphereLights.value=Ve.state.hemi,tn.directionalShadowMap.value=Ve.state.directionalShadowMap,tn.directionalShadowMatrix.value=Ve.state.directionalShadowMatrix,tn.spotShadowMap.value=Ve.state.spotShadowMap,tn.spotLightMatrix.value=Ve.state.spotLightMatrix,tn.spotLightMap.value=Ve.state.spotLightMap,tn.pointShadowMap.value=Ve.state.pointShadowMap,tn.pointShadowMatrix.value=Ve.state.pointShadowMatrix),We.currentProgram=un,We.uniformsList=null,un}function as(ee){if(ee.uniformsList===null){const Be=ee.currentProgram.getUniforms();ee.uniformsList=Wf.seqWithValue(Be.seq,ee.uniforms)}return ee.uniformsList}function Ss(ee,Be){const Ke=Yt.get(ee);Ke.outputColorSpace=Be.outputColorSpace,Ke.batching=Be.batching,Ke.batchingColor=Be.batchingColor,Ke.instancing=Be.instancing,Ke.instancingColor=Be.instancingColor,Ke.instancingMorph=Be.instancingMorph,Ke.skinning=Be.skinning,Ke.morphTargets=Be.morphTargets,Ke.morphNormals=Be.morphNormals,Ke.morphColors=Be.morphColors,Ke.morphTargetsCount=Be.morphTargetsCount,Ke.numClippingPlanes=Be.numClippingPlanes,Ke.numIntersection=Be.numClipIntersection,Ke.vertexAlphas=Be.vertexAlphas,Ke.vertexTangents=Be.vertexTangents,Ke.toneMapping=Be.toneMapping}function wt(ee,Be,Ke,We,Ve){Be.isScene!==!0&&(Be=Vn),ve.resetTextureUnits();const vt=Be.fog,Ct=We.isMeshStandardMaterial?Be.environment:null,Bt=ke===null?Q.outputColorSpace:ke.isXRRenderTarget===!0?ke.texture.colorSpace:Zr,Lt=(We.isMeshStandardMaterial?Ze:te).get(We.envMap||Ct),Ht=We.vertexColors===!0&&!!Ke.attributes.color&&Ke.attributes.color.itemSize===4,un=!!Ke.attributes.tangent&&(!!We.normalMap||We.anisotropy>0),tn=!!Ke.morphAttributes.position,Fn=!!Ke.morphAttributes.normal,On=!!Ke.morphAttributes.color;let ri=el;We.toneMapped&&(ke===null||ke.isXRRenderTarget===!0)&&(ri=Q.toneMapping);const _i=Ke.morphAttributes.position||Ke.morphAttributes.normal||Ke.morphAttributes.color,Hn=_i!==void 0?_i.length:0,sn=Yt.get(We),vi=O.state.lights;if(Tt===!0&&(qt===!0||ee!==ie)){const Hi=ee===ie&&We.id===ce;bt.setState(We,ee,Hi)}let Zn=!1;We.version===sn.__version?(sn.needsLights&&sn.lightsStateVersion!==vi.state.version||sn.outputColorSpace!==Bt||Ve.isBatchedMesh&&sn.batching===!1||!Ve.isBatchedMesh&&sn.batching===!0||Ve.isBatchedMesh&&sn.batchingColor===!0&&Ve.colorTexture===null||Ve.isBatchedMesh&&sn.batchingColor===!1&&Ve.colorTexture!==null||Ve.isInstancedMesh&&sn.instancing===!1||!Ve.isInstancedMesh&&sn.instancing===!0||Ve.isSkinnedMesh&&sn.skinning===!1||!Ve.isSkinnedMesh&&sn.skinning===!0||Ve.isInstancedMesh&&sn.instancingColor===!0&&Ve.instanceColor===null||Ve.isInstancedMesh&&sn.instancingColor===!1&&Ve.instanceColor!==null||Ve.isInstancedMesh&&sn.instancingMorph===!0&&Ve.morphTexture===null||Ve.isInstancedMesh&&sn.instancingMorph===!1&&Ve.morphTexture!==null||sn.envMap!==Lt||We.fog===!0&&sn.fog!==vt||sn.numClippingPlanes!==void 0&&(sn.numClippingPlanes!==bt.numPlanes||sn.numIntersection!==bt.numIntersection)||sn.vertexAlphas!==Ht||sn.vertexTangents!==un||sn.morphTargets!==tn||sn.morphNormals!==Fn||sn.morphColors!==On||sn.toneMapping!==ri||sn.morphTargetsCount!==Hn)&&(Zn=!0):(Zn=!0,sn.__version=We.version);let Ir=sn.currentProgram;Zn===!0&&(Ir=ii(We,Be,Ve));let Yr=!1,xr=!1,sa=!1;const ti=Ir.getUniforms(),hr=sn.uniforms;if(Zt.useProgram(Ir.program)&&(Yr=!0,xr=!0,sa=!0),We.id!==ce&&(ce=We.id,xr=!0),Yr||ie!==ee){Zt.buffers.depth.getReversed()?(Rt.copy(ee.projectionMatrix),tP(Rt),nP(Rt),ti.setValue(Fe,"projectionMatrix",Rt)):ti.setValue(Fe,"projectionMatrix",ee.projectionMatrix),ti.setValue(Fe,"viewMatrix",ee.matrixWorldInverse);const Ui=ti.map.cameraPosition;Ui!==void 0&&Ui.setValue(Fe,Xt.setFromMatrixPosition(ee.matrixWorld)),cn.logarithmicDepthBuffer&&ti.setValue(Fe,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),(We.isMeshPhongMaterial||We.isMeshToonMaterial||We.isMeshLambertMaterial||We.isMeshBasicMaterial||We.isMeshStandardMaterial||We.isShaderMaterial)&&ti.setValue(Fe,"isOrthographic",ee.isOrthographicCamera===!0),ie!==ee&&(ie=ee,xr=!0,sa=!0)}if(Ve.isSkinnedMesh){ti.setOptional(Fe,Ve,"bindMatrix"),ti.setOptional(Fe,Ve,"bindMatrixInverse");const Hi=Ve.skeleton;Hi&&(Hi.boneTexture===null&&Hi.computeBoneTexture(),ti.setValue(Fe,"boneTexture",Hi.boneTexture,ve))}Ve.isBatchedMesh&&(ti.setOptional(Fe,Ve,"batchingTexture"),ti.setValue(Fe,"batchingTexture",Ve._matricesTexture,ve),ti.setOptional(Fe,Ve,"batchingIdTexture"),ti.setValue(Fe,"batchingIdTexture",Ve._indirectTexture,ve),ti.setOptional(Fe,Ve,"batchingColorTexture"),Ve._colorsTexture!==null&&ti.setValue(Fe,"batchingColorTexture",Ve._colorsTexture,ve));const dr=Ke.morphAttributes;if((dr.position!==void 0||dr.normal!==void 0||dr.color!==void 0)&&X.update(Ve,Ke,Ir),(xr||sn.receiveShadow!==Ve.receiveShadow)&&(sn.receiveShadow=Ve.receiveShadow,ti.setValue(Fe,"receiveShadow",Ve.receiveShadow)),We.isMeshGouraudMaterial&&We.envMap!==null&&(hr.envMap.value=Lt,hr.flipEnvMap.value=Lt.isCubeTexture&&Lt.isRenderTargetTexture===!1?-1:1),We.isMeshStandardMaterial&&We.envMap===null&&Be.environment!==null&&(hr.envMapIntensity.value=Be.environmentIntensity),xr&&(ti.setValue(Fe,"toneMappingExposure",Q.toneMappingExposure),sn.needsLights&&fn(hr,sa),vt&&We.fog===!0&&At.refreshFogUniforms(hr,vt),At.refreshMaterialUniforms(hr,We,tt,ft,O.state.transmissionRenderTarget[ee.id]),Wf.upload(Fe,as(sn),hr,ve)),We.isShaderMaterial&&We.uniformsNeedUpdate===!0&&(Wf.upload(Fe,as(sn),hr,ve),We.uniformsNeedUpdate=!1),We.isSpriteMaterial&&ti.setValue(Fe,"center",Ve.center),ti.setValue(Fe,"modelViewMatrix",Ve.modelViewMatrix),ti.setValue(Fe,"normalMatrix",Ve.normalMatrix),ti.setValue(Fe,"modelMatrix",Ve.matrixWorld),We.isShaderMaterial||We.isRawShaderMaterial){const Hi=We.uniformsGroups;for(let Ui=0,aa=Hi.length;Ui<aa;Ui++){const ji=Hi[Ui];ne.update(ji,Ir),ne.bind(ji,Ir)}}return Ir}function fn(ee,Be){ee.ambientLightColor.needsUpdate=Be,ee.lightProbe.needsUpdate=Be,ee.directionalLights.needsUpdate=Be,ee.directionalLightShadows.needsUpdate=Be,ee.pointLights.needsUpdate=Be,ee.pointLightShadows.needsUpdate=Be,ee.spotLights.needsUpdate=Be,ee.spotLightShadows.needsUpdate=Be,ee.rectAreaLights.needsUpdate=Be,ee.hemisphereLights.needsUpdate=Be}function mn(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&ee.lights===!0}this.getActiveCubeFace=function(){return fe},this.getActiveMipmapLevel=function(){return ye},this.getRenderTarget=function(){return ke},this.setRenderTargetTextures=function(ee,Be,Ke){Yt.get(ee.texture).__webglTexture=Be,Yt.get(ee.depthTexture).__webglTexture=Ke;const We=Yt.get(ee);We.__hasExternalTextures=!0,We.__autoAllocateDepthBuffer=Ke===void 0,We.__autoAllocateDepthBuffer||bn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),We.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ee,Be){const Ke=Yt.get(ee);Ke.__webglFramebuffer=Be,Ke.__useDefaultFramebuffer=Be===void 0};const vr=Fe.createFramebuffer();this.setRenderTarget=function(ee,Be=0,Ke=0){ke=ee,fe=Be,ye=Ke;let We=!0,Ve=null,vt=!1,Ct=!1;if(ee){const Lt=Yt.get(ee);if(Lt.__useDefaultFramebuffer!==void 0)Zt.bindFramebuffer(Fe.FRAMEBUFFER,null),We=!1;else if(Lt.__webglFramebuffer===void 0)ve.setupRenderTarget(ee);else if(Lt.__hasExternalTextures)ve.rebindTextures(ee,Yt.get(ee.texture).__webglTexture,Yt.get(ee.depthTexture).__webglTexture);else if(ee.depthBuffer){const tn=ee.depthTexture;if(Lt.__boundDepthTexture!==tn){if(tn!==null&&Yt.has(tn)&&(ee.width!==tn.image.width||ee.height!==tn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ve.setupDepthRenderbuffer(ee)}}const Ht=ee.texture;(Ht.isData3DTexture||Ht.isDataArrayTexture||Ht.isCompressedArrayTexture)&&(Ct=!0);const un=Yt.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(Array.isArray(un[Be])?Ve=un[Be][Ke]:Ve=un[Be],vt=!0):ee.samples>0&&ve.useMultisampledRTT(ee)===!1?Ve=Yt.get(ee).__webglMultisampledFramebuffer:Array.isArray(un)?Ve=un[Ke]:Ve=un,Oe.copy(ee.viewport),nt.copy(ee.scissor),Je=ee.scissorTest}else Oe.copy(Wt).multiplyScalar(tt).floor(),nt.copy($t).multiplyScalar(tt).floor(),Je=Rn;if(Ke!==0&&(Ve=vr),Zt.bindFramebuffer(Fe.FRAMEBUFFER,Ve)&&We&&Zt.drawBuffers(ee,Ve),Zt.viewport(Oe),Zt.scissor(nt),Zt.setScissorTest(Je),vt){const Lt=Yt.get(ee.texture);Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Lt.__webglTexture,Ke)}else if(Ct){const Lt=Yt.get(ee.texture),Ht=Be;Fe.framebufferTextureLayer(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Lt.__webglTexture,Ke,Ht)}else if(ee!==null&&Ke!==0){const Lt=Yt.get(ee.texture);Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_2D,Lt.__webglTexture,Ke)}ce=-1},this.readRenderTargetPixels=function(ee,Be,Ke,We,Ve,vt,Ct){if(!(ee&&ee.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Bt=Yt.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&Ct!==void 0&&(Bt=Bt[Ct]),Bt){Zt.bindFramebuffer(Fe.FRAMEBUFFER,Bt);try{const Lt=ee.texture,Ht=Lt.format,un=Lt.type;if(!cn.textureFormatReadable(Ht)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!cn.textureTypeReadable(un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Be>=0&&Be<=ee.width-We&&Ke>=0&&Ke<=ee.height-Ve&&Fe.readPixels(Be,Ke,We,Ve,Te.convert(Ht),Te.convert(un),vt)}finally{const Lt=ke!==null?Yt.get(ke).__webglFramebuffer:null;Zt.bindFramebuffer(Fe.FRAMEBUFFER,Lt)}}},this.readRenderTargetPixelsAsync=async function(ee,Be,Ke,We,Ve,vt,Ct){if(!(ee&&ee.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Bt=Yt.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&Ct!==void 0&&(Bt=Bt[Ct]),Bt){const Lt=ee.texture,Ht=Lt.format,un=Lt.type;if(!cn.textureFormatReadable(Ht))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!cn.textureTypeReadable(un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Be>=0&&Be<=ee.width-We&&Ke>=0&&Ke<=ee.height-Ve){Zt.bindFramebuffer(Fe.FRAMEBUFFER,Bt);const tn=Fe.createBuffer();Fe.bindBuffer(Fe.PIXEL_PACK_BUFFER,tn),Fe.bufferData(Fe.PIXEL_PACK_BUFFER,vt.byteLength,Fe.STREAM_READ),Fe.readPixels(Be,Ke,We,Ve,Te.convert(Ht),Te.convert(un),0);const Fn=ke!==null?Yt.get(ke).__webglFramebuffer:null;Zt.bindFramebuffer(Fe.FRAMEBUFFER,Fn);const On=Fe.fenceSync(Fe.SYNC_GPU_COMMANDS_COMPLETE,0);return Fe.flush(),await eP(Fe,On,4),Fe.bindBuffer(Fe.PIXEL_PACK_BUFFER,tn),Fe.getBufferSubData(Fe.PIXEL_PACK_BUFFER,0,vt),Fe.deleteBuffer(tn),Fe.deleteSync(On),vt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ee,Be=null,Ke=0){ee.isTexture!==!0&&(Tu("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Be=arguments[0]||null,ee=arguments[1]);const We=Math.pow(2,-Ke),Ve=Math.floor(ee.image.width*We),vt=Math.floor(ee.image.height*We),Ct=Be!==null?Be.x:0,Bt=Be!==null?Be.y:0;ve.setTexture2D(ee,0),Fe.copyTexSubImage2D(Fe.TEXTURE_2D,Ke,0,0,Ct,Bt,Ve,vt),Zt.unbindTexture()};const uo=Fe.createFramebuffer(),Xr=Fe.createFramebuffer();this.copyTextureToTexture=function(ee,Be,Ke=null,We=null,Ve=0,vt=null){ee.isTexture!==!0&&(Tu("WebGLRenderer: copyTextureToTexture function signature has changed."),We=arguments[0]||null,ee=arguments[1],Be=arguments[2],vt=arguments[3]||0,Ke=null),vt===null&&(Ve!==0?(Tu("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),vt=Ve,Ve=0):vt=0);let Ct,Bt,Lt,Ht,un,tn,Fn,On,ri;const _i=ee.isCompressedTexture?ee.mipmaps[vt]:ee.image;if(Ke!==null)Ct=Ke.max.x-Ke.min.x,Bt=Ke.max.y-Ke.min.y,Lt=Ke.isBox3?Ke.max.z-Ke.min.z:1,Ht=Ke.min.x,un=Ke.min.y,tn=Ke.isBox3?Ke.min.z:0;else{const dr=Math.pow(2,-Ve);Ct=Math.floor(_i.width*dr),Bt=Math.floor(_i.height*dr),ee.isDataArrayTexture?Lt=_i.depth:ee.isData3DTexture?Lt=Math.floor(_i.depth*dr):Lt=1,Ht=0,un=0,tn=0}We!==null?(Fn=We.x,On=We.y,ri=We.z):(Fn=0,On=0,ri=0);const Hn=Te.convert(Be.format),sn=Te.convert(Be.type);let vi;Be.isData3DTexture?(ve.setTexture3D(Be,0),vi=Fe.TEXTURE_3D):Be.isDataArrayTexture||Be.isCompressedArrayTexture?(ve.setTexture2DArray(Be,0),vi=Fe.TEXTURE_2D_ARRAY):(ve.setTexture2D(Be,0),vi=Fe.TEXTURE_2D),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,Be.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Be.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,Be.unpackAlignment);const Zn=Fe.getParameter(Fe.UNPACK_ROW_LENGTH),Ir=Fe.getParameter(Fe.UNPACK_IMAGE_HEIGHT),Yr=Fe.getParameter(Fe.UNPACK_SKIP_PIXELS),xr=Fe.getParameter(Fe.UNPACK_SKIP_ROWS),sa=Fe.getParameter(Fe.UNPACK_SKIP_IMAGES);Fe.pixelStorei(Fe.UNPACK_ROW_LENGTH,_i.width),Fe.pixelStorei(Fe.UNPACK_IMAGE_HEIGHT,_i.height),Fe.pixelStorei(Fe.UNPACK_SKIP_PIXELS,Ht),Fe.pixelStorei(Fe.UNPACK_SKIP_ROWS,un),Fe.pixelStorei(Fe.UNPACK_SKIP_IMAGES,tn);const ti=ee.isDataArrayTexture||ee.isData3DTexture,hr=Be.isDataArrayTexture||Be.isData3DTexture;if(ee.isDepthTexture){const dr=Yt.get(ee),Hi=Yt.get(Be),Ui=Yt.get(dr.__renderTarget),aa=Yt.get(Hi.__renderTarget);Zt.bindFramebuffer(Fe.READ_FRAMEBUFFER,Ui.__webglFramebuffer),Zt.bindFramebuffer(Fe.DRAW_FRAMEBUFFER,aa.__webglFramebuffer);for(let ji=0;ji<Lt;ji++)ti&&(Fe.framebufferTextureLayer(Fe.READ_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Yt.get(ee).__webglTexture,Ve,tn+ji),Fe.framebufferTextureLayer(Fe.DRAW_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Yt.get(Be).__webglTexture,vt,ri+ji)),Fe.blitFramebuffer(Ht,un,Ct,Bt,Fn,On,Ct,Bt,Fe.DEPTH_BUFFER_BIT,Fe.NEAREST);Zt.bindFramebuffer(Fe.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(Fe.DRAW_FRAMEBUFFER,null)}else if(Ve!==0||ee.isRenderTargetTexture||Yt.has(ee)){const dr=Yt.get(ee),Hi=Yt.get(Be);Zt.bindFramebuffer(Fe.READ_FRAMEBUFFER,uo),Zt.bindFramebuffer(Fe.DRAW_FRAMEBUFFER,Xr);for(let Ui=0;Ui<Lt;Ui++)ti?Fe.framebufferTextureLayer(Fe.READ_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,dr.__webglTexture,Ve,tn+Ui):Fe.framebufferTexture2D(Fe.READ_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_2D,dr.__webglTexture,Ve),hr?Fe.framebufferTextureLayer(Fe.DRAW_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Hi.__webglTexture,vt,ri+Ui):Fe.framebufferTexture2D(Fe.DRAW_FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_2D,Hi.__webglTexture,vt),Ve!==0?Fe.blitFramebuffer(Ht,un,Ct,Bt,Fn,On,Ct,Bt,Fe.COLOR_BUFFER_BIT,Fe.NEAREST):hr?Fe.copyTexSubImage3D(vi,vt,Fn,On,ri+Ui,Ht,un,Ct,Bt):Fe.copyTexSubImage2D(vi,vt,Fn,On,Ht,un,Ct,Bt);Zt.bindFramebuffer(Fe.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(Fe.DRAW_FRAMEBUFFER,null)}else hr?ee.isDataTexture||ee.isData3DTexture?Fe.texSubImage3D(vi,vt,Fn,On,ri,Ct,Bt,Lt,Hn,sn,_i.data):Be.isCompressedArrayTexture?Fe.compressedTexSubImage3D(vi,vt,Fn,On,ri,Ct,Bt,Lt,Hn,_i.data):Fe.texSubImage3D(vi,vt,Fn,On,ri,Ct,Bt,Lt,Hn,sn,_i):ee.isDataTexture?Fe.texSubImage2D(Fe.TEXTURE_2D,vt,Fn,On,Ct,Bt,Hn,sn,_i.data):ee.isCompressedTexture?Fe.compressedTexSubImage2D(Fe.TEXTURE_2D,vt,Fn,On,_i.width,_i.height,Hn,_i.data):Fe.texSubImage2D(Fe.TEXTURE_2D,vt,Fn,On,Ct,Bt,Hn,sn,_i);Fe.pixelStorei(Fe.UNPACK_ROW_LENGTH,Zn),Fe.pixelStorei(Fe.UNPACK_IMAGE_HEIGHT,Ir),Fe.pixelStorei(Fe.UNPACK_SKIP_PIXELS,Yr),Fe.pixelStorei(Fe.UNPACK_SKIP_ROWS,xr),Fe.pixelStorei(Fe.UNPACK_SKIP_IMAGES,sa),vt===0&&Be.generateMipmaps&&Fe.generateMipmap(vi),Zt.unbindTexture()},this.copyTextureToTexture3D=function(ee,Be,Ke=null,We=null,Ve=0){return ee.isTexture!==!0&&(Tu("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Ke=arguments[0]||null,We=arguments[1]||null,ee=arguments[2],Be=arguments[3],Ve=arguments[4]||0),Tu('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(ee,Be,Ke,We,Ve)},this.initRenderTarget=function(ee){Yt.get(ee).__webglFramebuffer===void 0&&ve.setupRenderTarget(ee)},this.initTexture=function(ee){ee.isCubeTexture?ve.setTextureCube(ee,0):ee.isData3DTexture?ve.setTexture3D(ee,0):ee.isDataArrayTexture||ee.isCompressedArrayTexture?ve.setTexture2DArray(ee,0):ve.setTexture2D(ee,0),Zt.unbindTexture()},this.resetState=function(){fe=0,ye=0,ke=null,Zt.reset(),De.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return to}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorspace=Qn._getDrawingBufferColorSpace(e),n.unpackColorSpace=Qn._getUnpackColorSpace()}}var Q3=Object.defineProperty,ek=(c,e,n)=>e in c?Q3(c,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[e]=n,ns=(c,e,n)=>ek(c,typeof e!="symbol"?e+"":e,n);const tk="@maptiler/3d",nk="2.0.2";function y1(c,e){if(e===EC)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),c;if(e===Py||e===sS){let n=c.getIndex();if(n===null){const p=[],s=c.getAttribute("position");if(s!==void 0){for(let S=0;S<s.count;S++)p.push(S);c.setIndex(p),n=c.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c}const r=n.count-2,u=[];if(e===Py)for(let p=1;p<=r;p++)u.push(n.getX(0)),u.push(n.getX(p)),u.push(n.getX(p+1));else for(let p=0;p<r;p++)p%2===0?(u.push(n.getX(p)),u.push(n.getX(p+1)),u.push(n.getX(p+2))):(u.push(n.getX(p+2)),u.push(n.getX(p+1)),u.push(n.getX(p)));u.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const f=c.clone();return f.setIndex(u),f.clearGroups(),f}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),c}class ik extends th{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new lk(n)}),this.register(function(n){return new ck(n)}),this.register(function(n){return new yk(n)}),this.register(function(n){return new vk(n)}),this.register(function(n){return new xk(n)}),this.register(function(n){return new hk(n)}),this.register(function(n){return new dk(n)}),this.register(function(n){return new pk(n)}),this.register(function(n){return new fk(n)}),this.register(function(n){return new ok(n)}),this.register(function(n){return new mk(n)}),this.register(function(n){return new uk(n)}),this.register(function(n){return new _k(n)}),this.register(function(n){return new gk(n)}),this.register(function(n){return new sk(n)}),this.register(function(n){return new bk(n)}),this.register(function(n){return new wk(n)})}load(e,n,r,u){const f=this;let p;if(this.resourcePath!=="")p=this.resourcePath;else if(this.path!==""){const M=Id.extractUrlBase(e);p=Id.resolveURL(M,this.path)}else p=Id.extractUrlBase(e);this.manager.itemStart(e);const s=function(M){u?u(M):console.error(M),f.manager.itemError(e),f.manager.itemEnd(e)},S=new TS(this.manager);S.setPath(this.path),S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setWithCredentials(this.withCredentials),S.load(e,function(M){try{f.parse(M,p,function(C){n(C),f.manager.itemEnd(e)},s)}catch(C){s(C)}},r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,u){let f;const p={},s={},S=new TextDecoder;if(typeof e=="string")f=JSON.parse(e);else if(e instanceof ArrayBuffer)if(S.decode(new Uint8Array(e,0,4))===LS){try{p[Wn.KHR_BINARY_GLTF]=new Sk(e)}catch(C){u&&u(C);return}f=JSON.parse(p[Wn.KHR_BINARY_GLTF].content)}else f=JSON.parse(S.decode(e));else f=e;if(f.asset===void 0||f.asset.version[0]<2){u&&u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const M=new Fk(f,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});M.fileLoader.setRequestHeader(this.requestHeader);for(let C=0;C<this.pluginCallbacks.length;C++){const I=this.pluginCallbacks[C](M);I.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[I.name]=I,p[I.name]=!0}if(f.extensionsUsed)for(let C=0;C<f.extensionsUsed.length;++C){const I=f.extensionsUsed[C],L=f.extensionsRequired||[];switch(I){case Wn.KHR_MATERIALS_UNLIT:p[I]=new ak;break;case Wn.KHR_DRACO_MESH_COMPRESSION:p[I]=new Mk(f,this.dracoLoader);break;case Wn.KHR_TEXTURE_TRANSFORM:p[I]=new Tk;break;case Wn.KHR_MESH_QUANTIZATION:p[I]=new Ek;break;default:L.indexOf(I)>=0&&s[I]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+I+'".')}}M.setExtensions(p),M.setPlugins(s),M.parse(r,u)}parseAsync(e,n){const r=this;return new Promise(function(u,f){r.parse(e,n,u,f)})}}function rk(){let c={};return{get:function(e){return c[e]},add:function(e,n){c[e]=n},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const Wn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class sk{constructor(e){this.parser=e,this.name=Wn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,u=n.length;r<u;r++){const f=n[r];f.extensions&&f.extensions[this.name]&&f.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,f.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let u=n.cache.get(r);if(u)return u;const f=n.json,p=((f.extensions&&f.extensions[this.name]||{}).lights||[])[e];let s;const S=new vn(16777215);p.color!==void 0&&S.setRGB(p.color[0],p.color[1],p.color[2],Zr);const M=p.range!==void 0?p.range:0;switch(p.type){case"directional":s=new iI(S),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new ES(S),s.distance=M;break;case"spot":s=new eI(S),s.distance=M,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,s.angle=p.spot.outerConeAngle,s.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return s.position.set(0,0,0),s.decay=2,Qa(s,p),p.intensity!==void 0&&(s.intensity=p.intensity),s.name=n.createUniqueName(p.name||"light_"+e),u=Promise.resolve(s),n.cache.add(r,u),u}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,u=r.json.nodes[e],f=(u.extensions&&u.extensions[this.name]||{}).light;return f===void 0?null:this._loadLight(f).then(function(p){return r._getNodeRef(n.cache,f,p)})}}class ak{constructor(){this.name=Wn.KHR_MATERIALS_UNLIT}getMaterialType(){return rc}extendParams(e,n,r){const u=[];e.color=new vn(1,1,1),e.opacity=1;const f=n.pbrMetallicRoughness;if(f){if(Array.isArray(f.baseColorFactor)){const p=f.baseColorFactor;e.color.setRGB(p[0],p[1],p[2],Zr),e.opacity=p[3]}f.baseColorTexture!==void 0&&u.push(r.assignTexture(e,"map",f.baseColorTexture,Pr))}return Promise.all(u)}}class ok{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const u=r.extensions[this.name].emissiveStrength;return u!==void 0&&(n.emissiveIntensity=u),Promise.resolve()}}class lk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];if(p.clearcoatFactor!==void 0&&(n.clearcoat=p.clearcoatFactor),p.clearcoatTexture!==void 0&&f.push(r.assignTexture(n,"clearcoatMap",p.clearcoatTexture)),p.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=p.clearcoatRoughnessFactor),p.clearcoatRoughnessTexture!==void 0&&f.push(r.assignTexture(n,"clearcoatRoughnessMap",p.clearcoatRoughnessTexture)),p.clearcoatNormalTexture!==void 0&&(f.push(r.assignTexture(n,"clearcoatNormalMap",p.clearcoatNormalTexture)),p.clearcoatNormalTexture.scale!==void 0)){const s=p.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new ei(s,s)}return Promise.all(f)}}class ck{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const u=r.extensions[this.name];return n.dispersion=u.dispersion!==void 0?u.dispersion:0,Promise.resolve()}}class uk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];return p.iridescenceFactor!==void 0&&(n.iridescence=p.iridescenceFactor),p.iridescenceTexture!==void 0&&f.push(r.assignTexture(n,"iridescenceMap",p.iridescenceTexture)),p.iridescenceIor!==void 0&&(n.iridescenceIOR=p.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),p.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=p.iridescenceThicknessMinimum),p.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=p.iridescenceThicknessMaximum),p.iridescenceThicknessTexture!==void 0&&f.push(r.assignTexture(n,"iridescenceThicknessMap",p.iridescenceThicknessTexture)),Promise.all(f)}}class hk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[];n.sheenColor=new vn(0,0,0),n.sheenRoughness=0,n.sheen=1;const p=u.extensions[this.name];if(p.sheenColorFactor!==void 0){const s=p.sheenColorFactor;n.sheenColor.setRGB(s[0],s[1],s[2],Zr)}return p.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=p.sheenRoughnessFactor),p.sheenColorTexture!==void 0&&f.push(r.assignTexture(n,"sheenColorMap",p.sheenColorTexture,Pr)),p.sheenRoughnessTexture!==void 0&&f.push(r.assignTexture(n,"sheenRoughnessMap",p.sheenRoughnessTexture)),Promise.all(f)}}class dk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];return p.transmissionFactor!==void 0&&(n.transmission=p.transmissionFactor),p.transmissionTexture!==void 0&&f.push(r.assignTexture(n,"transmissionMap",p.transmissionTexture)),Promise.all(f)}}class pk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];n.thickness=p.thicknessFactor!==void 0?p.thicknessFactor:0,p.thicknessTexture!==void 0&&f.push(r.assignTexture(n,"thicknessMap",p.thicknessTexture)),n.attenuationDistance=p.attenuationDistance||1/0;const s=p.attenuationColor||[1,1,1];return n.attenuationColor=new vn().setRGB(s[0],s[1],s[2],Zr),Promise.all(f)}}class fk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const u=r.extensions[this.name];return n.ior=u.ior!==void 0?u.ior:1.5,Promise.resolve()}}class mk{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];n.specularIntensity=p.specularFactor!==void 0?p.specularFactor:1,p.specularTexture!==void 0&&f.push(r.assignTexture(n,"specularIntensityMap",p.specularTexture));const s=p.specularColorFactor||[1,1,1];return n.specularColor=new vn().setRGB(s[0],s[1],s[2],Zr),p.specularColorTexture!==void 0&&f.push(r.assignTexture(n,"specularColorMap",p.specularColorTexture,Pr)),Promise.all(f)}}class gk{constructor(e){this.parser=e,this.name=Wn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];return n.bumpScale=p.bumpFactor!==void 0?p.bumpFactor:1,p.bumpTexture!==void 0&&f.push(r.assignTexture(n,"bumpMap",p.bumpTexture)),Promise.all(f)}}class _k{constructor(e){this.parser=e,this.name=Wn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ra}extendMaterialParams(e,n){const r=this.parser,u=r.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const f=[],p=u.extensions[this.name];return p.anisotropyStrength!==void 0&&(n.anisotropy=p.anisotropyStrength),p.anisotropyRotation!==void 0&&(n.anisotropyRotation=p.anisotropyRotation),p.anisotropyTexture!==void 0&&f.push(r.assignTexture(n,"anisotropyMap",p.anisotropyTexture)),Promise.all(f)}}class yk{constructor(e){this.parser=e,this.name=Wn.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,u=r.textures[e];if(!u.extensions||!u.extensions[this.name])return null;const f=u.extensions[this.name],p=n.options.ktx2Loader;if(!p){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,f.source,p)}}class vk{constructor(e){this.parser=e,this.name=Wn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,u=r.json,f=u.textures[e];if(!f.extensions||!f.extensions[n])return null;const p=f.extensions[n],s=u.images[p.source];let S=r.textureLoader;if(s.uri){const M=r.options.manager.getHandler(s.uri);M!==null&&(S=M)}return this.detectSupport().then(function(M){if(M)return r.loadTextureImage(e,p.source,S);if(u.extensionsRequired&&u.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class xk{constructor(e){this.parser=e,this.name=Wn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,u=r.json,f=u.textures[e];if(!f.extensions||!f.extensions[n])return null;const p=f.extensions[n],s=u.images[p.source];let S=r.textureLoader;if(s.uri){const M=r.options.manager.getHandler(s.uri);M!==null&&(S=M)}return this.detectSupport().then(function(M){if(M)return r.loadTextureImage(e,p.source,S);if(u.extensionsRequired&&u.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class bk{constructor(e){this.name=Wn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const u=r.extensions[this.name],f=this.parser.getDependency("buffer",u.buffer),p=this.parser.options.meshoptDecoder;if(!p||!p.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return f.then(function(s){const S=u.byteOffset||0,M=u.byteLength||0,C=u.count,I=u.byteStride,L=new Uint8Array(s,S,M);return p.decodeGltfBufferAsync?p.decodeGltfBufferAsync(C,I,L,u.mode,u.filter).then(function(R){return R.buffer}):p.ready.then(function(){const R=new ArrayBuffer(C*I);return p.decodeGltfBuffer(new Uint8Array(R),C,I,L,u.mode,u.filter),R})})}else return null}}class wk{constructor(e){this.name=Wn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const u=n.meshes[r.mesh];for(const S of u.primitives)if(S.mode!==Ls.TRIANGLES&&S.mode!==Ls.TRIANGLE_STRIP&&S.mode!==Ls.TRIANGLE_FAN&&S.mode!==void 0)return null;const f=r.extensions[this.name].attributes,p=[],s={};for(const S in f)p.push(this.parser.getDependency("accessor",f[S]).then(M=>(s[S]=M,s[S])));return p.length<1?null:(p.push(this.parser.createNodeMesh(e)),Promise.all(p).then(S=>{const M=S.pop(),C=M.isGroup?M.children:[M],I=S[0].count,L=[];for(const R of C){const B=new dn,Z=new Ge,V=new lo,O=new Ge(1,1,1),ge=new RP(R.geometry,R.material,I);for(let me=0;me<I;me++)s.TRANSLATION&&Z.fromBufferAttribute(s.TRANSLATION,me),s.ROTATION&&V.fromBufferAttribute(s.ROTATION,me),s.SCALE&&O.fromBufferAttribute(s.SCALE,me),ge.setMatrixAt(me,B.compose(Z,V,O));for(const me in s)if(me==="_COLOR_0"){const Q=s[me];ge.instanceColor=new Ry(Q.array,Q.itemSize,Q.normalized)}else me!=="TRANSLATION"&&me!=="ROTATION"&&me!=="SCALE"&&R.geometry.setAttribute(me,s[me]);Di.prototype.copy.call(ge,R),this.parser.assignFinalMaterial(ge),L.push(ge)}return M.isGroup?(M.clear(),M.add(...L),M):L[0]}))}}const LS="glTF",bd=12,v1={JSON:1313821514,BIN:5130562};class Sk{constructor(e){this.name=Wn.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,bd),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==LS)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const u=this.header.length-bd,f=new DataView(e,bd);let p=0;for(;p<u;){const s=f.getUint32(p,!0);p+=4;const S=f.getUint32(p,!0);if(p+=4,S===v1.JSON){const M=new Uint8Array(e,bd+p,s);this.content=r.decode(M)}else if(S===v1.BIN){const M=bd+p;this.body=e.slice(M,M+s)}p+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Mk{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Wn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,u=this.dracoLoader,f=e.extensions[this.name].bufferView,p=e.extensions[this.name].attributes,s={},S={},M={};for(const C in p){const I=ky[C]||C.toLowerCase();s[I]=p[C]}for(const C in e.attributes){const I=ky[C]||C.toLowerCase();if(p[C]!==void 0){const L=r.accessors[e.attributes[C]],R=zu[L.componentType];M[I]=R.name,S[I]=L.normalized===!0}}return n.getDependency("bufferView",f).then(function(C){return new Promise(function(I,L){u.decodeDracoFile(C,function(R){for(const B in R.attributes){const Z=R.attributes[B],V=S[B];V!==void 0&&(Z.normalized=V)}I(R)},s,M,Zr,L)})})}}class Tk{constructor(){this.name=Wn.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Ek{constructor(){this.name=Wn.KHR_MESH_QUANTIZATION}}class DS extends Kd{constructor(e,n,r,u){super(e,n,r,u)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,u=this.valueSize,f=e*u*3+u;for(let p=0;p!==u;p++)n[p]=r[f+p];return n}interpolate_(e,n,r,u){const f=this.resultBuffer,p=this.sampleValues,s=this.valueSize,S=s*2,M=s*3,C=u-n,I=(r-n)/C,L=I*I,R=L*I,B=e*M,Z=B-M,V=-2*R+3*L,O=R-L,ge=1-V,me=O-L+I;for(let Q=0;Q!==s;Q++){const de=p[Z+Q+s],fe=p[Z+Q+S]*C,ye=p[B+Q+s],ke=p[B+Q]*C;f[Q]=ge*de+me*fe+V*ye+O*ke}return f}}const Ak=new lo;class Ck extends DS{interpolate_(e,n,r,u){const f=super.interpolate_(e,n,r,u);return Ak.fromArray(f).normalize().toArray(f),f}}const Ls={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},zu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x1={9728:Wr,9729:bs,9984:Xw,9985:Bf,9986:Sd,9987:eo},b1={33071:Ko,33648:nm,10497:Vu},C_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ky={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Xo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Pk={CUBICSPLINE:void 0,LINEAR:Gd,STEP:Vd},P_={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ik(c){return c.DefaultMaterial===void 0&&(c.DefaultMaterial=new wv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ao})),c.DefaultMaterial}function Yl(c,e,n){for(const r in n.extensions)c[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function Qa(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Rk(c,e,n){let r=!1,u=!1,f=!1;for(let M=0,C=e.length;M<C;M++){const I=e[M];if(I.POSITION!==void 0&&(r=!0),I.NORMAL!==void 0&&(u=!0),I.COLOR_0!==void 0&&(f=!0),r&&u&&f)break}if(!r&&!u&&!f)return Promise.resolve(c);const p=[],s=[],S=[];for(let M=0,C=e.length;M<C;M++){const I=e[M];if(r){const L=I.POSITION!==void 0?n.getDependency("accessor",I.POSITION):c.attributes.position;p.push(L)}if(u){const L=I.NORMAL!==void 0?n.getDependency("accessor",I.NORMAL):c.attributes.normal;s.push(L)}if(f){const L=I.COLOR_0!==void 0?n.getDependency("accessor",I.COLOR_0):c.attributes.color;S.push(L)}}return Promise.all([Promise.all(p),Promise.all(s),Promise.all(S)]).then(function(M){const C=M[0],I=M[1],L=M[2];return r&&(c.morphAttributes.position=C),u&&(c.morphAttributes.normal=I),f&&(c.morphAttributes.color=L),c.morphTargetsRelative=!0,c})}function Lk(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)c.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(c.morphTargetInfluences.length===n.length){c.morphTargetDictionary={};for(let r=0,u=n.length;r<u;r++)c.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Dk(c){let e;const n=c.extensions&&c.extensions[Wn.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+I_(n.attributes):e=c.indices+":"+I_(c.attributes)+":"+c.mode,c.targets!==void 0)for(let r=0,u=c.targets.length;r<u;r++)e+=":"+I_(c.targets[r]);return e}function I_(c){let e="";const n=Object.keys(c).sort();for(let r=0,u=n.length;r<u;r++)e+=n[r]+":"+c[n[r]]+";";return e}function zy(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function kk(c){return c.search(/\.jpe?g($|\?)/i)>0||c.search(/^data\:image\/jpeg/)===0?"image/jpeg":c.search(/\.webp($|\?)/i)>0||c.search(/^data\:image\/webp/)===0?"image/webp":c.search(/\.ktx2($|\?)/i)>0||c.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const zk=new dn;class Fk{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new rk,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,u=-1,f=!1,p=-1;if(typeof navigator<"u"){const s=navigator.userAgent;r=/^((?!chrome|android).)*safari/i.test(s)===!0;const S=s.match(/Version\/(\d+)/);u=r&&S?parseInt(S[1],10):-1,f=s.indexOf("Firefox")>-1,p=f?s.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||r&&u<17||f&&p<98?this.textureLoader=new JP(this.options.manager):this.textureLoader=new sI(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new TS(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,u=this.json,f=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(p){return p._markDefs&&p._markDefs()}),Promise.all(this._invokeAll(function(p){return p.beforeRoot&&p.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(p){const s={scene:p[0][u.scene||0],scenes:p[0],animations:p[1],cameras:p[2],asset:u.asset,parser:r,userData:{}};return Yl(f,s,u),Qa(s,u),Promise.all(r._invokeAll(function(S){return S.afterRoot&&S.afterRoot(s)})).then(function(){for(const S of s.scenes)S.updateMatrixWorld();e(s)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let u=0,f=n.length;u<f;u++){const p=n[u].joints;for(let s=0,S=p.length;s<S;s++)e[p[s]].isBone=!0}for(let u=0,f=e.length;u<f;u++){const p=e[u];p.mesh!==void 0&&(this._addNodeRef(this.meshCache,p.mesh),p.skin!==void 0&&(r[p.mesh].isSkinnedMesh=!0)),p.camera!==void 0&&this._addNodeRef(this.cameraCache,p.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const u=r.clone(),f=(p,s)=>{const S=this.associations.get(p);S!=null&&this.associations.set(s,S);for(const[M,C]of p.children.entries())f(C,s.children[M])};return f(r,u),u.name+="_instance_"+e.uses[n]++,u}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const u=e(n[r]);if(u)return u}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let u=0;u<n.length;u++){const f=e(n[u]);f&&r.push(f)}return r}getDependency(e,n){const r=e+":"+n;let u=this.cache.get(r);if(!u){switch(e){case"scene":u=this.loadScene(n);break;case"node":u=this._invokeOne(function(f){return f.loadNode&&f.loadNode(n)});break;case"mesh":u=this._invokeOne(function(f){return f.loadMesh&&f.loadMesh(n)});break;case"accessor":u=this.loadAccessor(n);break;case"bufferView":u=this._invokeOne(function(f){return f.loadBufferView&&f.loadBufferView(n)});break;case"buffer":u=this.loadBuffer(n);break;case"material":u=this._invokeOne(function(f){return f.loadMaterial&&f.loadMaterial(n)});break;case"texture":u=this._invokeOne(function(f){return f.loadTexture&&f.loadTexture(n)});break;case"skin":u=this.loadSkin(n);break;case"animation":u=this._invokeOne(function(f){return f.loadAnimation&&f.loadAnimation(n)});break;case"camera":u=this.loadCamera(n);break;default:if(u=this._invokeOne(function(f){return f!=this&&f.getDependency&&f.getDependency(e,n)}),!u)throw new Error("Unknown type: "+e);break}this.cache.add(r,u)}return u}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,u=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(u.map(function(f,p){return r.getDependency(e,p)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[Wn.KHR_BINARY_GLTF].body);const u=this.options;return new Promise(function(f,p){r.load(Id.resolveURL(n.uri,u.path),f,void 0,function(){p(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const u=n.byteLength||0,f=n.byteOffset||0;return r.slice(f,f+u)})}loadAccessor(e){const n=this,r=this.json,u=this.json.accessors[e];if(u.bufferView===void 0&&u.sparse===void 0){const p=C_[u.type],s=zu[u.componentType],S=u.normalized===!0,M=new s(u.count*p);return Promise.resolve(new qr(M,p,S))}const f=[];return u.bufferView!==void 0?f.push(this.getDependency("bufferView",u.bufferView)):f.push(null),u.sparse!==void 0&&(f.push(this.getDependency("bufferView",u.sparse.indices.bufferView)),f.push(this.getDependency("bufferView",u.sparse.values.bufferView))),Promise.all(f).then(function(p){const s=p[0],S=C_[u.type],M=zu[u.componentType],C=M.BYTES_PER_ELEMENT,I=C*S,L=u.byteOffset||0,R=u.bufferView!==void 0?r.bufferViews[u.bufferView].byteStride:void 0,B=u.normalized===!0;let Z,V;if(R&&R!==I){const O=Math.floor(L/R),ge="InterleavedBuffer:"+u.bufferView+":"+u.componentType+":"+O+":"+u.count;let me=n.cache.get(ge);me||(Z=new M(s,O*R,u.count*R/C),me=new EP(Z,R/C),n.cache.add(ge,me)),V=new yv(me,S,L%R/C,B)}else s===null?Z=new M(u.count*S):Z=new M(s,L,u.count*S),V=new qr(Z,S,B);if(u.sparse!==void 0){const O=C_.SCALAR,ge=zu[u.sparse.indices.componentType],me=u.sparse.indices.byteOffset||0,Q=u.sparse.values.byteOffset||0,de=new ge(p[1],me,u.sparse.count*O),fe=new M(p[2],Q,u.sparse.count*S);s!==null&&(V=new qr(V.array.slice(),V.itemSize,V.normalized)),V.normalized=!1;for(let ye=0,ke=de.length;ye<ke;ye++){const ce=de[ye];if(V.setX(ce,fe[ye*S]),S>=2&&V.setY(ce,fe[ye*S+1]),S>=3&&V.setZ(ce,fe[ye*S+2]),S>=4&&V.setW(ce,fe[ye*S+3]),S>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}V.normalized=B}return V})}loadTexture(e){const n=this.json,r=this.options,u=n.textures[e].source,f=n.images[u];let p=this.textureLoader;if(f.uri){const s=r.manager.getHandler(f.uri);s!==null&&(p=s)}return this.loadTextureImage(e,u,p)}loadTextureImage(e,n,r){const u=this,f=this.json,p=f.textures[e],s=f.images[n],S=(s.uri||s.bufferView)+":"+p.sampler;if(this.textureCache[S])return this.textureCache[S];const M=this.loadImageSource(n,r).then(function(C){C.flipY=!1,C.name=p.name||s.name||"",C.name===""&&typeof s.uri=="string"&&s.uri.startsWith("data:image/")===!1&&(C.name=s.uri);const I=(f.samplers||{})[p.sampler]||{};return C.magFilter=x1[I.magFilter]||bs,C.minFilter=x1[I.minFilter]||eo,C.wrapS=b1[I.wrapS]||Vu,C.wrapT=b1[I.wrapT]||Vu,C.generateMipmaps=!C.isCompressedTexture&&C.minFilter!==Wr&&C.minFilter!==bs,u.associations.set(C,{textures:e}),C}).catch(function(){return null});return this.textureCache[S]=M,M}loadImageSource(e,n){const r=this,u=this.json,f=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(I=>I.clone());const p=u.images[e],s=self.URL||self.webkitURL;let S=p.uri||"",M=!1;if(p.bufferView!==void 0)S=r.getDependency("bufferView",p.bufferView).then(function(I){M=!0;const L=new Blob([I],{type:p.mimeType});return S=s.createObjectURL(L),S});else if(p.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const C=Promise.resolve(S).then(function(I){return new Promise(function(L,R){let B=L;n.isImageBitmapLoader===!0&&(B=function(Z){const V=new yr(Z);V.needsUpdate=!0,L(V)}),n.load(Id.resolveURL(I,f.path),B,void 0,R)})}).then(function(I){return M===!0&&s.revokeObjectURL(S),Qa(I,p),I.userData.mimeType=p.mimeType||kk(p.uri),I}).catch(function(I){throw console.error("THREE.GLTFLoader: Couldn't load texture",S),I});return this.sourceCache[e]=C,C}assignTexture(e,n,r,u){const f=this;return this.getDependency("texture",r.index).then(function(p){if(!p)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(p=p.clone(),p.channel=r.texCoord),f.extensions[Wn.KHR_TEXTURE_TRANSFORM]){const s=r.extensions!==void 0?r.extensions[Wn.KHR_TEXTURE_TRANSFORM]:void 0;if(s){const S=f.associations.get(p);p=f.extensions[Wn.KHR_TEXTURE_TRANSFORM].extendTexture(p,s),f.associations.set(p,S)}}return u!==void 0&&(p.colorSpace=u),e[n]=p,p})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const u=n.attributes.tangent===void 0,f=n.attributes.color!==void 0,p=n.attributes.normal===void 0;if(e.isPoints){const s="PointsMaterial:"+r.uuid;let S=this.cache.get(s);S||(S=new bS,Aa.prototype.copy.call(S,r),S.color.copy(r.color),S.map=r.map,S.sizeAttenuation=!1,this.cache.add(s,S)),r=S}else if(e.isLine){const s="LineBasicMaterial:"+r.uuid;let S=this.cache.get(s);S||(S=new xS,Aa.prototype.copy.call(S,r),S.color.copy(r.color),S.map=r.map,this.cache.add(s,S)),r=S}if(u||f||p){let s="ClonedMaterial:"+r.uuid+":";u&&(s+="derivative-tangents:"),f&&(s+="vertex-colors:"),p&&(s+="flat-shading:");let S=this.cache.get(s);S||(S=r.clone(),f&&(S.vertexColors=!0),p&&(S.flatShading=!0),u&&(S.normalScale&&(S.normalScale.y*=-1),S.clearcoatNormalScale&&(S.clearcoatNormalScale.y*=-1)),this.cache.add(s,S),this.associations.set(S,this.associations.get(r))),r=S}e.material=r}getMaterialType(){return wv}loadMaterial(e){const n=this,r=this.json,u=this.extensions,f=r.materials[e];let p;const s={},S=f.extensions||{},M=[];if(S[Wn.KHR_MATERIALS_UNLIT]){const I=u[Wn.KHR_MATERIALS_UNLIT];p=I.getMaterialType(),M.push(I.extendParams(s,f,n))}else{const I=f.pbrMetallicRoughness||{};if(s.color=new vn(1,1,1),s.opacity=1,Array.isArray(I.baseColorFactor)){const L=I.baseColorFactor;s.color.setRGB(L[0],L[1],L[2],Zr),s.opacity=L[3]}I.baseColorTexture!==void 0&&M.push(n.assignTexture(s,"map",I.baseColorTexture,Pr)),s.metalness=I.metallicFactor!==void 0?I.metallicFactor:1,s.roughness=I.roughnessFactor!==void 0?I.roughnessFactor:1,I.metallicRoughnessTexture!==void 0&&(M.push(n.assignTexture(s,"metalnessMap",I.metallicRoughnessTexture)),M.push(n.assignTexture(s,"roughnessMap",I.metallicRoughnessTexture))),p=this._invokeOne(function(L){return L.getMaterialType&&L.getMaterialType(e)}),M.push(Promise.all(this._invokeAll(function(L){return L.extendMaterialParams&&L.extendMaterialParams(e,s)})))}f.doubleSided===!0&&(s.side=wa);const C=f.alphaMode||P_.OPAQUE;if(C===P_.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,C===P_.MASK&&(s.alphaTest=f.alphaCutoff!==void 0?f.alphaCutoff:.5)),f.normalTexture!==void 0&&p!==rc&&(M.push(n.assignTexture(s,"normalMap",f.normalTexture)),s.normalScale=new ei(1,1),f.normalTexture.scale!==void 0)){const I=f.normalTexture.scale;s.normalScale.set(I,I)}if(f.occlusionTexture!==void 0&&p!==rc&&(M.push(n.assignTexture(s,"aoMap",f.occlusionTexture)),f.occlusionTexture.strength!==void 0&&(s.aoMapIntensity=f.occlusionTexture.strength)),f.emissiveFactor!==void 0&&p!==rc){const I=f.emissiveFactor;s.emissive=new vn().setRGB(I[0],I[1],I[2],Zr)}return f.emissiveTexture!==void 0&&p!==rc&&M.push(n.assignTexture(s,"emissiveMap",f.emissiveTexture,Pr)),Promise.all(M).then(function(){const I=new p(s);return f.name&&(I.name=f.name),Qa(I,f),n.associations.set(I,{materials:e}),f.extensions&&Yl(u,I,f),I})}createUniqueName(e){const n=di.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,u=this.primitiveCache;function f(s){return r[Wn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(s,n).then(function(S){return w1(S,s,n)})}const p=[];for(let s=0,S=e.length;s<S;s++){const M=e[s],C=Dk(M),I=u[C];if(I)p.push(I.promise);else{let L;M.extensions&&M.extensions[Wn.KHR_DRACO_MESH_COMPRESSION]?L=f(M):L=w1(new Ia,M,n),u[C]={primitive:M,promise:L},p.push(L)}}return Promise.all(p)}loadMesh(e){const n=this,r=this.json,u=this.extensions,f=r.meshes[e],p=f.primitives,s=[];for(let S=0,M=p.length;S<M;S++){const C=p[S].material===void 0?Ik(this.cache):this.getDependency("material",p[S].material);s.push(C)}return s.push(n.loadGeometries(p)),Promise.all(s).then(function(S){const M=S.slice(0,S.length-1),C=S[S.length-1],I=[];for(let R=0,B=C.length;R<B;R++){const Z=C[R],V=p[R];let O;const ge=M[R];if(V.mode===Ls.TRIANGLES||V.mode===Ls.TRIANGLE_STRIP||V.mode===Ls.TRIANGLE_FAN||V.mode===void 0)O=f.isSkinnedMesh===!0?new CP(Z,ge):new rs(Z,ge),O.isSkinnedMesh===!0&&O.normalizeSkinWeights(),V.mode===Ls.TRIANGLE_STRIP?O.geometry=y1(O.geometry,sS):V.mode===Ls.TRIANGLE_FAN&&(O.geometry=y1(O.geometry,Py));else if(V.mode===Ls.LINES)O=new kP(Z,ge);else if(V.mode===Ls.LINE_STRIP)O=new bv(Z,ge);else if(V.mode===Ls.LINE_LOOP)O=new zP(Z,ge);else if(V.mode===Ls.POINTS)O=new FP(Z,ge);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+V.mode);Object.keys(O.geometry.morphAttributes).length>0&&Lk(O,f),O.name=n.createUniqueName(f.name||"mesh_"+e),Qa(O,f),V.extensions&&Yl(u,O,V),n.assignFinalMaterial(O),I.push(O)}for(let R=0,B=I.length;R<B;R++)n.associations.set(I[R],{meshes:e,primitives:R});if(I.length===1)return f.extensions&&Yl(u,I[0],f),I[0];const L=new sc;f.extensions&&Yl(u,L,f),n.associations.set(L,{meshes:e});for(let R=0,B=I.length;R<B;R++)L.add(I[R]);return L})}loadCamera(e){let n;const r=this.json.cameras[e],u=r[r.type];if(!u){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new is(lS.radToDeg(u.yfov),u.aspectRatio||1,u.znear||1,u.zfar||2e6):r.type==="orthographic"&&(n=new Mv(-u.xmag,u.xmag,u.ymag,-u.ymag,u.znear,u.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),Qa(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let u=0,f=n.joints.length;u<f;u++)r.push(this._loadNodeShallow(n.joints[u]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(u){const f=u.pop(),p=u,s=[],S=[];for(let M=0,C=p.length;M<C;M++){const I=p[M];if(I){s.push(I);const L=new dn;f!==null&&L.fromArray(f.array,M*16),S.push(L)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[M])}return new vv(s,S)})}loadAnimation(e){const n=this.json,r=this,u=n.animations[e],f=u.name?u.name:"animation_"+e,p=[],s=[],S=[],M=[],C=[];for(let I=0,L=u.channels.length;I<L;I++){const R=u.channels[I],B=u.samplers[R.sampler],Z=R.target,V=Z.node,O=u.parameters!==void 0?u.parameters[B.input]:B.input,ge=u.parameters!==void 0?u.parameters[B.output]:B.output;Z.node!==void 0&&(p.push(this.getDependency("node",V)),s.push(this.getDependency("accessor",O)),S.push(this.getDependency("accessor",ge)),M.push(B),C.push(Z))}return Promise.all([Promise.all(p),Promise.all(s),Promise.all(S),Promise.all(M),Promise.all(C)]).then(function(I){const L=I[0],R=I[1],B=I[2],Z=I[3],V=I[4],O=[];for(let ge=0,me=L.length;ge<me;ge++){const Q=L[ge],de=R[ge],fe=B[ge],ye=Z[ge],ke=V[ge];if(Q===void 0)continue;Q.updateMatrix&&Q.updateMatrix();const ce=r._createAnimationTracks(Q,de,fe,ye,ke);if(ce)for(let ie=0;ie<ce.length;ie++)O.push(ce[ie])}return new $P(f,void 0,O)})}createNodeMesh(e){const n=this.json,r=this,u=n.nodes[e];return u.mesh===void 0?null:r.getDependency("mesh",u.mesh).then(function(f){const p=r._getNodeRef(r.meshCache,u.mesh,f);return u.weights!==void 0&&p.traverse(function(s){if(s.isMesh)for(let S=0,M=u.weights.length;S<M;S++)s.morphTargetInfluences[S]=u.weights[S]}),p})}loadNode(e){const n=this.json,r=this,u=n.nodes[e],f=r._loadNodeShallow(e),p=[],s=u.children||[];for(let M=0,C=s.length;M<C;M++)p.push(r.getDependency("node",s[M]));const S=u.skin===void 0?Promise.resolve(null):r.getDependency("skin",u.skin);return Promise.all([f,Promise.all(p),S]).then(function(M){const C=M[0],I=M[1],L=M[2];L!==null&&C.traverse(function(R){R.isSkinnedMesh&&R.bind(L,zk)});for(let R=0,B=I.length;R<B;R++)C.add(I[R]);return C})}_loadNodeShallow(e){const n=this.json,r=this.extensions,u=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const f=n.nodes[e],p=f.name?u.createUniqueName(f.name):"",s=[],S=u._invokeOne(function(M){return M.createNodeMesh&&M.createNodeMesh(e)});return S&&s.push(S),f.camera!==void 0&&s.push(u.getDependency("camera",f.camera).then(function(M){return u._getNodeRef(u.cameraCache,f.camera,M)})),u._invokeAll(function(M){return M.createNodeAttachment&&M.createNodeAttachment(e)}).forEach(function(M){s.push(M)}),this.nodeCache[e]=Promise.all(s).then(function(M){let C;if(f.isBone===!0?C=new yS:M.length>1?C=new sc:M.length===1?C=M[0]:C=new Di,C!==M[0])for(let I=0,L=M.length;I<L;I++)C.add(M[I]);if(f.name&&(C.userData.name=f.name,C.name=p),Qa(C,f),f.extensions&&Yl(r,C,f),f.matrix!==void 0){const I=new dn;I.fromArray(f.matrix),C.applyMatrix4(I)}else f.translation!==void 0&&C.position.fromArray(f.translation),f.rotation!==void 0&&C.quaternion.fromArray(f.rotation),f.scale!==void 0&&C.scale.fromArray(f.scale);return u.associations.has(C)||u.associations.set(C,{}),u.associations.get(C).nodes=e,C}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],u=this,f=new sc;r.name&&(f.name=u.createUniqueName(r.name)),Qa(f,r),r.extensions&&Yl(n,f,r);const p=r.nodes||[],s=[];for(let S=0,M=p.length;S<M;S++)s.push(u.getDependency("node",p[S]));return Promise.all(s).then(function(S){for(let C=0,I=S.length;C<I;C++)f.add(S[C]);const M=C=>{const I=new Map;for(const[L,R]of u.associations)(L instanceof Aa||L instanceof yr)&&I.set(L,R);return C.traverse(L=>{const R=u.associations.get(L);R!=null&&I.set(L,R)}),I};return u.associations=M(f),f})}_createAnimationTracks(e,n,r,u,f){const p=[],s=e.name?e.name:e.uuid,S=[];Xo[f.path]===Xo.weights?e.traverse(function(L){L.morphTargetInfluences&&S.push(L.name?L.name:L.uuid)}):S.push(s);let M;switch(Xo[f.path]){case Xo.weights:M=Wu;break;case Xo.rotation:M=qu;break;case Xo.position:case Xo.scale:M=Zu;break;default:switch(r.itemSize){case 1:M=Wu;break;case 2:case 3:default:M=Zu;break}break}const C=u.interpolation!==void 0?Pk[u.interpolation]:Gd,I=this._getArrayFromAccessor(r);for(let L=0,R=S.length;L<R;L++){const B=new M(S[L]+"."+Xo[f.path],n.array,I,C);u.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(B),p.push(B)}return p}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const r=zy(n.constructor),u=new Float32Array(n.length);for(let f=0,p=n.length;f<p;f++)u[f]=n[f]*r;n=u}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof qu?Ck:DS;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ok(c,e,n){const r=e.attributes,u=new co;if(r.POSITION!==void 0){const s=n.json.accessors[r.POSITION],S=s.min,M=s.max;if(S!==void 0&&M!==void 0){if(u.set(new Ge(S[0],S[1],S[2]),new Ge(M[0],M[1],M[2])),s.normalized){const C=zy(zu[s.componentType]);u.min.multiplyScalar(C),u.max.multiplyScalar(C)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const f=e.targets;if(f!==void 0){const s=new Ge,S=new Ge;for(let M=0,C=f.length;M<C;M++){const I=f[M];if(I.POSITION!==void 0){const L=n.json.accessors[I.POSITION],R=L.min,B=L.max;if(R!==void 0&&B!==void 0){if(S.setX(Math.max(Math.abs(R[0]),Math.abs(B[0]))),S.setY(Math.max(Math.abs(R[1]),Math.abs(B[1]))),S.setZ(Math.max(Math.abs(R[2]),Math.abs(B[2]))),L.normalized){const Z=zy(zu[L.componentType]);S.multiplyScalar(Z)}s.max(S)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}u.expandByVector(s)}c.boundingBox=u;const p=new Pa;u.getCenter(p.center),p.radius=u.min.distanceTo(u.max)/2,c.boundingSphere=p}function w1(c,e,n){const r=e.attributes,u=[];function f(p,s){return n.getDependency("accessor",p).then(function(S){c.setAttribute(s,S)})}for(const p in r){const s=ky[p]||p.toLowerCase();s in c.attributes||u.push(f(r[p],s))}if(e.indices!==void 0&&!c.index){const p=n.getDependency("accessor",e.indices).then(function(s){c.setIndex(s)});u.push(p)}return Qn.workingColorSpace!==Zr&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Qn.workingColorSpace}" not supported.`),Qa(c,e),Ok(c,e,n),Promise.all(u).then(function(){return e.targets!==void 0?Rk(c,e.targets,n):c})}var Rd=(c=>(c[c.X_UP=1]="X_UP",c[c.Y_UP=2]="Y_UP",c[c.Z_UP=3]="Z_UP",c))(Rd||{});const Nk=c=>"isPointLight"in c&&c.isPointLight===!0,Uk=c=>{const e=new lo;switch(c){case Rd.X_UP:e.setFromAxisAngle(new Ge(0,0,1),-Math.PI/2);break;case Rd.Y_UP:e.identity();break;case Rd.Z_UP:e.setFromAxisAngle(new Ge(1,0,0),-Math.PI/2);break}return e},S1=(c,e,n)=>{const r=new dn().makeScale(c,c,c),u=new dn().makeRotationFromQuaternion(Uk(n)),f=new dn().makeRotationY(lS.degToRad(-e));return new dn().multiply(r).multiply(u).multiply(f)},M1=.01;class Bk{constructor(e,n={}){ns(this,"id"),ns(this,"type","custom"),ns(this,"renderingMode","3d"),ns(this,"map"),ns(this,"minZoom"),ns(this,"maxZoom"),ns(this,"antialias"),ns(this,"renderer"),ns(this,"scene"),ns(this,"camera"),ns(this,"ambientLight"),ns(this,"items3D",new Map),ns(this,"onRemoveCallbacks",[]),ns(this,"isElevationNeedUpdate",!1),this.type="custom",this.id=e,this.minZoom=n.minZoom??Number.NEGATIVE_INFINITY,this.maxZoom=n.maxZoom??22,this.antialias=n.antialias??!0,this.camera=new _v,this.camera.matrixWorldAutoUpdate=!1,this.scene=new TP,this.ambientLight=new rI(n.ambientLightColor??16777215,n.ambientLightIntensity??.5),this.scene.add(this.ambientLight)}isInZoomRange(){const e=this.map.getZoom();return e>=this.minZoom&&e<=this.maxZoom}onAdd(e,n){e.telemetry.registerModule(tk,nk),this.map=e,this.renderer=new J3({canvas:e.getCanvas(),context:n,antialias:this.antialias,powerPreference:"high-performance"}),this.renderer.autoClear=!1;const{unsubscribe:r}=this.map.on("terrainAnimationStart",()=>{this.isElevationNeedUpdate=!0}),{unsubscribe:u}=this.map.on("terrainAnimationStop",()=>{this.isElevationNeedUpdate=!1});this.onRemoveCallbacks=[r,u]}onRemove(e,n){this.clear(),this.renderer.dispose();for(const r of this.onRemoveCallbacks)r();this.onRemoveCallbacks=[]}render(e,n){if(this.isInZoomRange()===!1||this.items3D.size===0||[0,1].includes(n.defaultProjectionData.projectionTransition)===!1)return;const r=this.map.getCenter(),u=new dd(r.lng+M1,r.lat+M1),f=this.map.queryTerrainElevation(u)||0,p=this.map.transform.getMatrixForModel(u,f),s=new dn().fromArray(p),S=s.clone().invert();for(const[I,L]of this.items3D){const R=L.mesh;if(R!==null){let B=L.altitude;L.altitudeReference===1&&(this.isElevationNeedUpdate===!0&&(L.elevation=this.map.queryTerrainElevation(L.lngLat)||0),B+=L.elevation);const Z=this.map.transform.getMatrixForModel(L.lngLat,B),V=new dn().fromArray(Z).multiply(L.additionalTransformationMatrix).premultiply(S);R.matrix=V}}const M=n.defaultProjectionData.mainMatrix,C=new dn().fromArray(M);this.camera.projectionMatrix=C.multiply(s),this.renderer.resetState(),this.renderer.render(this.scene,this.camera)}setAmbientLight(e={}){typeof e.intensity=="number"&&(this.ambientLight.intensity=e.intensity),"color"in e&&(this.ambientLight.color=new vn(e.color))}addMesh(e,n,r={}){this.throwUniqueID(e);const u=r.sourceOrientation??Rd.Y_UP,f=r.altitude??0,p=r.lngLat??[0,0],s=r.heading??0,S=r.visible??!0,M=r.opacity??1,C=r.scale??1,I=r.pointSize??1,L=r.wireframe??!1;M!==1&&this.setMeshOpacity(n,M,!1),"pointSize"in r&&this.setMeshPointSize(n,I),"wireframe"in r&&this.setMeshWireframe(n,L);const R=S1(C,s,u),B=this.map.queryTerrainElevation(p)||0,Z={id:e,lngLat:dd.convert(p),altitude:f,scale:C,sourceOrientation:u,heading:s,mesh:n,altitudeReference:r.altitudeReference??1,url:n.userData._originalUrl??null,opacity:M,pointSize:I,wireframe:L,additionalTransformationMatrix:R,elevation:B};this.items3D.set(e,Z),n.matrixAutoUpdate=!1,n.visible=S,this.scene.add(n),this.map.triggerRepaint()}modifyMesh(e,n){const r=this.items3D.get(e);if(!r||!r.mesh)return;let u=!1;typeof n.visible=="boolean"&&(r.mesh.visible=n.visible),"lngLat"in n&&(r.lngLat=dd.convert(n.lngLat),r.elevation=this.map.queryTerrainElevation(r.lngLat)||0),typeof n.scale=="number"&&(r.scale=n.scale,u=!0),typeof n.altitude=="number"&&(r.altitude=n.altitude),typeof n.altitudeReference=="number"&&(r.altitudeReference=n.altitudeReference,r.elevation=this.map.queryTerrainElevation(r.lngLat)||0),typeof n.heading=="number"&&(r.heading=n.heading,u=!0),u===!0&&(r.additionalTransformationMatrix=S1(r.scale,r.heading,r.sourceOrientation)),typeof n.opacity=="number"&&this.setMeshOpacity(r.mesh,n.opacity,!1),typeof n.pointSize=="number"&&this.setMeshPointSize(r.mesh,n.pointSize),typeof n.wireframe=="boolean"&&this.setMeshWireframe(r.mesh,n.wireframe),this.map.triggerRepaint()}cloneMesh(e,n,r){this.throwUniqueID(n);const u=this.items3D.get(e);if(!u||!u.mesh)return;const f={lngLat:new dd(u.lngLat.lng,u.lngLat.lat),altitude:u.altitude,altitudeReference:u.altitudeReference,visible:u.mesh.visible,sourceOrientation:u.sourceOrientation,scale:u.scale,heading:u.heading,...r},p=u.mesh.clone(!0);p.traverse(s=>{s instanceof rs&&(Array.isArray(s.material)?s.material=s.material.map(S=>S.clone()):s.material=s.material.clone())}),this.addMesh(n,p,f)}modifyPointLight(e,n){const r=this.items3D.get(e);r!==void 0&&(r.mesh===null||Nk(r.mesh)===!1||("decay"in n&&typeof n.decay=="number"&&(r.mesh.decay=n.decay),"intensity"in n&&typeof n.intensity=="number"&&(r.mesh.intensity=n.intensity),"color"in n&&r.mesh.color.set(new vn(n.color)),"altitude"in n&&typeof n.altitude=="number"&&(r.altitude=n.altitude),"lngLat"in n&&(r.lngLat=dd.convert(n.lngLat)),"altitudeReference"in n&&typeof n.altitudeReference=="number"&&(r.altitudeReference=n.altitudeReference),"visible"in n&&typeof n.visible=="boolean"&&(r.mesh.visible=n.visible),this.map.triggerRepaint()))}async addMeshFromURL(e,n,r={}){this.throwUniqueID(e);const u=n.trim().toLowerCase().split(".").pop();if(!(u==="glb"||u==="gltf"))throw new Error("Mesh files must be glTF/glb.");const f=(await new ik().loadAsync(n)).scene;f.userData._originalUrl=n,this.addMesh(e,f,r)}clear(){for(const[e,n]of this.items3D)this.removeMesh(e)}removeMesh(e){const n=this.items3D.get(e);if(!n)throw new Error(`Mesh with ID ${e} does not exist.`);const r=n==null?void 0:n.mesh;r&&(this.scene.remove(r),r.traverse(u=>{if("isMesh"in u&&u.isMesh===!0){const f=u,p=Array.isArray(f.material)?f.material:[f.material];for(const s of p)s.dispose();f.geometry.dispose()}})),this.items3D.delete(e),this.map.triggerRepaint()}setMeshOpacity(e,n,r=!1){e.traverse(u=>{if("isMesh"in u&&u.isMesh===!0||"isPoints"in u&&u.isPoints===!0){const f=u,p=Array.isArray(f.material)?f.material:[f.material];for(const s of p)s.opacity=n,s.transparent=!0}}),r&&this.map.triggerRepaint()}setMeshPointSize(e,n,r=!1){e.traverse(u=>{if("isPoints"in u&&u.isPoints===!0){const f=u,p=Array.isArray(f.material)?f.material:[f.material];for(const s of p)s.size=n}}),r&&this.map.triggerRepaint()}setMeshWireframe(e,n,r=!1){e.traverse(u=>{if("isMesh"in u&&u.isMesh===!0){const f=u,p=Array.isArray(f.material)?f.material:[f.material];for(const s of p)"wireframe"in s&&typeof s.wireframe=="boolean"&&(s.wireframe=n)}}),r&&this.map.triggerRepaint()}addPointLight(e,n={}){this.throwUniqueID(e);const r=new ES(n.color??16777215,n.intensity??75,0,n.decay??.2);this.addMesh(e,r,{lngLat:n.lngLat??[0,0],altitude:n.altitude??2e6,altitudeReference:n.altitudeReference??2})}throwUniqueID(e){if(this.items3D.has(e))throw new Error(`Mesh IDs are unique. A mesh or light with the id "${e}" already exist.`)}}lr.apiKey="clZrmP7UgVs1sKWo5A8V";const Vk={container:document.getElementById("map"),style:Pu.OUTDOOR,center:[15.1725192,50.7348128],zoom:15,projectionControl:!0,pitch:45},T1=new jw(Vk);T1.on("ready",async()=>{const c=new Bk("layer3D");T1.addLayer(c),await c.addMeshFromURL("duck","rubber_duck.glb",{lngLat:[15.1725188,50.7348114],heading:325,scale:.4}),c.cloneMesh("duck","duck-baby1",{lngLat:[15.1727942,50.7363203],heading:20,scale:.3}),c.cloneMesh("duck","duck-baby2",{lngLat:[15.1728194,50.7377597],heading:350,scale:.3})});
